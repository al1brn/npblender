
<!doctype html>
<html lang="fr" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="NumPy-based geometry for Blender">
      
      
        <meta name="author" content="Alain Bernard">
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="mesh/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>npblender - NPBlender</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#reference-api" class="md-skip">
          Aller au contenu
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="En-tête">
    <a href=".." title="NPBlender" class="md-header__button md-logo" aria-label="NPBlender" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NPBlender
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              npblender
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Rechercher" placeholder="Rechercher" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Recherche">
        
        <button type="reset" class="md-search__icon md-icon" title="Effacer" aria-label="Effacer" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initialisation de la recherche
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/al1brn/npblender" title="Aller au dépôt" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="NPBlender" class="md-nav__button md-logo" aria-label="NPBlender" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    NPBlender
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/al1brn/npblender" title="Aller au dépôt" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Accueil
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Référence API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Référence API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    npblender
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    npblender
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#npblender" class="md-nav__link">
    <span class="md-ellipsis">
      npblender
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.Camera" class="md-nav__link">
    <span class="md-ellipsis">
      Camera
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Camera">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.distance_for_scale" class="md-nav__link">
    <span class="md-ellipsis">
      distance_for_scale
    </span>
  </a>
  
    <nav class="md-nav" aria-label="distance_for_scale">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.distance_for_scale--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.distance_for_scale--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.distance_for_scale--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.pixels_per_meter" class="md-nav__link">
    <span class="md-ellipsis">
      pixels_per_meter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="pixels_per_meter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.pixels_per_meter--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.pixels_per_meter--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.visible_edges" class="md-nav__link">
    <span class="md-ellipsis">
      visible_edges
    </span>
  </a>
  
    <nav class="md-nav" aria-label="visible_edges">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.visible_edges--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.visible_edges--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.visible_faces" class="md-nav__link">
    <span class="md-ellipsis">
      visible_faces
    </span>
  </a>
  
    <nav class="md-nav" aria-label="visible_faces">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.visible_faces--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.visible_faces--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.visible_islands" class="md-nav__link">
    <span class="md-ellipsis">
      visible_islands
    </span>
  </a>
  
    <nav class="md-nav" aria-label="visible_islands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.visible_islands--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.visible_islands--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.visible_points" class="md-nav__link">
    <span class="md-ellipsis">
      visible_points
    </span>
  </a>
  
    <nav class="md-nav" aria-label="visible_points">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.visible_points--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.visible_points--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.Cloud" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cloud">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.__init__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.__init__--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.capture" class="md-nav__link">
    <span class="md-ellipsis">
      capture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="capture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.capture--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.capture--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.clear_geometry" class="md-nav__link">
    <span class="md-ellipsis">
      clear_geometry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.from_data" class="md-nav__link">
    <span class="md-ellipsis">
      from_data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="from_data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.from_data--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.from_geometry" class="md-nav__link">
    <span class="md-ellipsis">
      from_geometry
    </span>
  </a>
  
    <nav class="md-nav" aria-label="from_geometry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.from_geometry--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.from_geometry--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.from_object" class="md-nav__link">
    <span class="md-ellipsis">
      from_object
    </span>
  </a>
  
    <nav class="md-nav" aria-label="from_object">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.from_object--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.from_object--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.join" class="md-nav__link">
    <span class="md-ellipsis">
      join
    </span>
  </a>
  
    <nav class="md-nav" aria-label="join">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.join--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.to_data" class="md-nav__link">
    <span class="md-ellipsis">
      to_data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.to_data--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.to_object" class="md-nav__link">
    <span class="md-ellipsis">
      to_object
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_object">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.to_object--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.to_object--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.Corner" class="md-nav__link">
    <span class="md-ellipsis">
      Corner
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Corner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Corner--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.Curve" class="md-nav__link">
    <span class="md-ellipsis">
      Curve
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Curve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.__init__--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.add_bezier" class="md-nav__link">
    <span class="md-ellipsis">
      add_bezier
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_bezier">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.add_bezier--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.add_bezier--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.add_poly" class="md-nav__link">
    <span class="md-ellipsis">
      add_poly
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_poly">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.add_poly--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.add_poly--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.add_splines" class="md-nav__link">
    <span class="md-ellipsis">
      add_splines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.blender_data" class="md-nav__link">
    <span class="md-ellipsis">
      blender_data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="blender_data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.blender_data--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.blender_data--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.capture" class="md-nav__link">
    <span class="md-ellipsis">
      capture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="capture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.capture--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.capture--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.clear" class="md-nav__link">
    <span class="md-ellipsis">
      clear
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.compute_bezier_handles" class="md-nav__link">
    <span class="md-ellipsis">
      compute_bezier_handles
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compute_bezier_handles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.compute_bezier_handles--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.compute_bezier_handles--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.delete_points" class="md-nav__link">
    <span class="md-ellipsis">
      delete_points
    </span>
  </a>
  
    <nav class="md-nav" aria-label="delete_points">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.delete_points--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.delete_splines" class="md-nav__link">
    <span class="md-ellipsis">
      delete_splines
    </span>
  </a>
  
    <nav class="md-nav" aria-label="delete_splines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.delete_splines--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.for_each_bucket" class="md-nav__link">
    <span class="md-ellipsis">
      for_each_bucket
    </span>
  </a>
  
    <nav class="md-nav" aria-label="for_each_bucket">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.for_each_bucket--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.for_each_bucket--yields" class="md-nav__link">
    <span class="md-ellipsis">
      Yields
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.from_curve" class="md-nav__link">
    <span class="md-ellipsis">
      from_curve
    </span>
  </a>
  
    <nav class="md-nav" aria-label="from_curve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.from_curve--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.from_curve--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.from_curve_data" class="md-nav__link">
    <span class="md-ellipsis">
      from_curve_data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="from_curve_data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.from_curve_data--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.from_object" class="md-nav__link">
    <span class="md-ellipsis">
      from_object
    </span>
  </a>
  
    <nav class="md-nav" aria-label="from_object">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.from_object--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.from_object--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.get_points_selection" class="md-nav__link">
    <span class="md-ellipsis">
      get_points_selection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_points_selection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.get_points_selection--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.join" class="md-nav__link">
    <span class="md-ellipsis">
      join
    </span>
  </a>
  
    <nav class="md-nav" aria-label="join">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.join--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.multiply" class="md-nav__link">
    <span class="md-ellipsis">
      multiply
    </span>
  </a>
  
    <nav class="md-nav" aria-label="multiply">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.multiply--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.multiply--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.no_view" class="md-nav__link">
    <span class="md-ellipsis">
      no_view
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.select" class="md-nav__link">
    <span class="md-ellipsis">
      select
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.to_bezier" class="md-nav__link">
    <span class="md-ellipsis">
      to_bezier
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_bezier">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.to_bezier--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.to_curve_data" class="md-nav__link">
    <span class="md-ellipsis">
      to_curve_data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_curve_data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.to_curve_data--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.to_mesh" class="md-nav__link">
    <span class="md-ellipsis">
      to_mesh
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_mesh">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.to_mesh--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.to_mesh--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.to_object" class="md-nav__link">
    <span class="md-ellipsis">
      to_object
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_object">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.to_object--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.to_object--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.to_poly" class="md-nav__link">
    <span class="md-ellipsis">
      to_poly
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.Edge" class="md-nav__link">
    <span class="md-ellipsis">
      Edge
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Edge">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Edge--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.Face" class="md-nav__link">
    <span class="md-ellipsis">
      Face
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Face">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Face.area" class="md-nav__link">
    <span class="md-ellipsis">
      area
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Face.area_vectors" class="md-nav__link">
    <span class="md-ellipsis">
      area_vectors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="area_vectors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Face.area_vectors--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Face.area_vectors--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Face.get_edges" class="md-nav__link">
    <span class="md-ellipsis">
      get_edges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Face.get_face_edges" class="md-nav__link">
    <span class="md-ellipsis">
      get_face_edges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Face.normal" class="md-nav__link">
    <span class="md-ellipsis">
      normal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Face.position" class="md-nav__link">
    <span class="md-ellipsis">
      position
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.FieldArray" class="md-nav__link">
    <span class="md-ellipsis">
      FieldArray
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FieldArray">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.actual_names" class="md-nav__link">
    <span class="md-ellipsis">
      actual_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.all_names" class="md-nav__link">
    <span class="md-ellipsis">
      all_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.dtype" class="md-nav__link">
    <span class="md-ellipsis">
      dtype
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.__array__" class="md-nav__link">
    <span class="md-ellipsis">
      __array__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.__init__--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.add" class="md-nav__link">
    <span class="md-ellipsis">
      add
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.add--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.append" class="md-nav__link">
    <span class="md-ellipsis">
      append
    </span>
  </a>
  
    <nav class="md-nav" aria-label="append">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.append--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.as_kwargs" class="md-nav__link">
    <span class="md-ellipsis">
      as_kwargs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="as_kwargs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.as_kwargs--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.as_kwargs--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.copy_field" class="md-nav__link">
    <span class="md-ellipsis">
      copy_field
    </span>
  </a>
  
    <nav class="md-nav" aria-label="copy_field">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.copy_field--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.copy_field--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.delete" class="md-nav__link">
    <span class="md-ellipsis">
      delete
    </span>
  </a>
  
    <nav class="md-nav" aria-label="delete">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.delete--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.delete--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.extend" class="md-nav__link">
    <span class="md-ellipsis">
      extend
    </span>
  </a>
  
    <nav class="md-nav" aria-label="extend">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.extend--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.filtered" class="md-nav__link">
    <span class="md-ellipsis">
      filtered
    </span>
  </a>
  
    <nav class="md-nav" aria-label="filtered">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.filtered--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.filtered--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.from_dict" class="md-nav__link">
    <span class="md-ellipsis">
      from_dict
    </span>
  </a>
  
    <nav class="md-nav" aria-label="from_dict">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.from_dict--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.from_dict--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.get" class="md-nav__link">
    <span class="md-ellipsis">
      get
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.join_fields" class="md-nav__link">
    <span class="md-ellipsis">
      join_fields
    </span>
  </a>
  
    <nav class="md-nav" aria-label="join_fields">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.join_fields--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.join_fields--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.multiply" class="md-nav__link">
    <span class="md-ellipsis">
      multiply
    </span>
  </a>
  
    <nav class="md-nav" aria-label="multiply">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.multiply--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.multiply--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.multiply--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.new_field" class="md-nav__link">
    <span class="md-ellipsis">
      new_field
    </span>
  </a>
  
    <nav class="md-nav" aria-label="new_field">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.new_field--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.to_dict" class="md-nav__link">
    <span class="md-ellipsis">
      to_dict
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_dict">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.to_dict--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.to_dict--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.Geometry" class="md-nav__link">
    <span class="md-ellipsis">
      Geometry
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Geometry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Geometry.add_materials" class="md-nav__link">
    <span class="md-ellipsis">
      add_materials
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_materials">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Geometry.add_materials--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Geometry.get_material_index" class="md-nav__link">
    <span class="md-ellipsis">
      get_material_index
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_material_index">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Geometry.get_material_index--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Geometry.get_material_index--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Geometry.join_attributes" class="md-nav__link">
    <span class="md-ellipsis">
      join_attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Geometry.load_models" class="md-nav__link">
    <span class="md-ellipsis">
      load_models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="load_models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Geometry.load_models--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Geometry.load_models--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Geometry.load_object" class="md-nav__link">
    <span class="md-ellipsis">
      load_object
    </span>
  </a>
  
    <nav class="md-nav" aria-label="load_object">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Geometry.load_object--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Geometry.load_object--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.Instances" class="md-nav__link">
    <span class="md-ellipsis">
      Instances
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Instances">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Instances.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Instances.__init__--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.Mesh" class="md-nav__link">
    <span class="md-ellipsis">
      Mesh
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Mesh">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.__init__--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.add_geometry" class="md-nav__link">
    <span class="md-ellipsis">
      add_geometry
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_geometry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.add_geometry--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.add_geometry--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.add_points" class="md-nav__link">
    <span class="md-ellipsis">
      add_points
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_points">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.add_points--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.add_points--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.bl_circle" class="md-nav__link">
    <span class="md-ellipsis">
      bl_circle
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bl_circle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.bl_circle--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.bl_circle--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.bl_cone" class="md-nav__link">
    <span class="md-ellipsis">
      bl_cone
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bl_cone">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.bl_cone--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.bl_cone--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.bl_grid" class="md-nav__link">
    <span class="md-ellipsis">
      bl_grid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bl_grid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.bl_grid--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.bl_grid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.blender_data" class="md-nav__link">
    <span class="md-ellipsis">
      blender_data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="blender_data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.blender_data--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.blender_data--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.bmesh" class="md-nav__link">
    <span class="md-ellipsis">
      bmesh
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bmesh">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.bmesh--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.boolean" class="md-nav__link">
    <span class="md-ellipsis">
      boolean
    </span>
  </a>
  
    <nav class="md-nav" aria-label="boolean">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.boolean--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.bridge_loops" class="md-nav__link">
    <span class="md-ellipsis">
      bridge_loops
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bridge_loops">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.bridge_loops--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.capture" class="md-nav__link">
    <span class="md-ellipsis">
      capture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="capture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.capture--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.capture--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.chain_link" class="md-nav__link">
    <span class="md-ellipsis">
      chain_link
    </span>
  </a>
  
    <nav class="md-nav" aria-label="chain_link">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.chain_link--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.chain_link--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.circle" class="md-nav__link">
    <span class="md-ellipsis">
      circle
    </span>
  </a>
  
    <nav class="md-nav" aria-label="circle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.circle--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.circle--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.clear_geometry" class="md-nav__link">
    <span class="md-ellipsis">
      clear_geometry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.cone" class="md-nav__link">
    <span class="md-ellipsis">
      cone
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cone">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.cone--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.cone--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.cube" class="md-nav__link">
    <span class="md-ellipsis">
      cube
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cube">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.cube--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.cube--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.cylinder" class="md-nav__link">
    <span class="md-ellipsis">
      cylinder
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cylinder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.cylinder--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.cylinder--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.delete_faces" class="md-nav__link">
    <span class="md-ellipsis">
      delete_faces
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.delete_vertices" class="md-nav__link">
    <span class="md-ellipsis">
      delete_vertices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="delete_vertices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.delete_vertices--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.disk" class="md-nav__link">
    <span class="md-ellipsis">
      disk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.extrude_faces" class="md-nav__link">
    <span class="md-ellipsis">
      extrude_faces
    </span>
  </a>
  
    <nav class="md-nav" aria-label="extrude_faces">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.extrude_faces--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.extrude_faces--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.extrude_loop" class="md-nav__link">
    <span class="md-ellipsis">
      extrude_loop
    </span>
  </a>
  
    <nav class="md-nav" aria-label="extrude_loop">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.extrude_loop--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.extrude_loop--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.extrude_region" class="md-nav__link">
    <span class="md-ellipsis">
      extrude_region
    </span>
  </a>
  
    <nav class="md-nav" aria-label="extrude_region">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.extrude_region--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.extrude_region--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.extrude_vertices" class="md-nav__link">
    <span class="md-ellipsis">
      extrude_vertices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="extrude_vertices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.extrude_vertices--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.extrude_vertices--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.fill_cap" class="md-nav__link">
    <span class="md-ellipsis">
      fill_cap
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fill_cap">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.fill_cap--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.from_mesh" class="md-nav__link">
    <span class="md-ellipsis">
      from_mesh
    </span>
  </a>
  
    <nav class="md-nav" aria-label="from_mesh">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.from_mesh--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.from_mesh--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.from_mesh_data" class="md-nav__link">
    <span class="md-ellipsis">
      from_mesh_data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="from_mesh_data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.from_mesh_data--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.from_object" class="md-nav__link">
    <span class="md-ellipsis">
      from_object
    </span>
  </a>
  
    <nav class="md-nav" aria-label="from_object">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.from_object--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.from_object--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.get_islands" class="md-nav__link">
    <span class="md-ellipsis">
      get_islands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.grid" class="md-nav__link">
    <span class="md-ellipsis">
      grid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="grid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.grid--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.grid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.icosphere" class="md-nav__link">
    <span class="md-ellipsis">
      icosphere
    </span>
  </a>
  
    <nav class="md-nav" aria-label="icosphere">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.icosphere--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.icosphere--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.inset_faces" class="md-nav__link">
    <span class="md-ellipsis">
      inset_faces
    </span>
  </a>
  
    <nav class="md-nav" aria-label="inset_faces">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.inset_faces--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.inset_faces--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.join" class="md-nav__link">
    <span class="md-ellipsis">
      join
    </span>
  </a>
  
    <nav class="md-nav" aria-label="join">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.join--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.join_geometry" class="md-nav__link">
    <span class="md-ellipsis">
      join_geometry
    </span>
  </a>
  
    <nav class="md-nav" aria-label="join_geometry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.join_geometry--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.line" class="md-nav__link">
    <span class="md-ellipsis">
      line
    </span>
  </a>
  
    <nav class="md-nav" aria-label="line">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.line--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.line--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.monkey" class="md-nav__link">
    <span class="md-ellipsis">
      monkey
    </span>
  </a>
  
    <nav class="md-nav" aria-label="monkey">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.monkey--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.monkey--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.multiply" class="md-nav__link">
    <span class="md-ellipsis">
      multiply
    </span>
  </a>
  
    <nav class="md-nav" aria-label="multiply">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.multiply--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.multiply--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.points_cloud" class="md-nav__link">
    <span class="md-ellipsis">
      points_cloud
    </span>
  </a>
  
    <nav class="md-nav" aria-label="points_cloud">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.points_cloud--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.points_cloud--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.pyramid" class="md-nav__link">
    <span class="md-ellipsis">
      pyramid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="pyramid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.pyramid--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.pyramid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.remove_doubles" class="md-nav__link">
    <span class="md-ellipsis">
      remove_doubles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.separate_faces" class="md-nav__link">
    <span class="md-ellipsis">
      separate_faces
    </span>
  </a>
  
    <nav class="md-nav" aria-label="separate_faces">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.separate_faces--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.solidify" class="md-nav__link">
    <span class="md-ellipsis">
      solidify
    </span>
  </a>
  
    <nav class="md-nav" aria-label="solidify">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.solidify--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.solidify--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.solidify_socle" class="md-nav__link">
    <span class="md-ellipsis">
      solidify_socle
    </span>
  </a>
  
    <nav class="md-nav" aria-label="solidify_socle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.solidify_socle--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.solidify_socle--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.to_curve_REVIEW" class="md-nav__link">
    <span class="md-ellipsis">
      to_curve_REVIEW
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.to_mesh_data" class="md-nav__link">
    <span class="md-ellipsis">
      to_mesh_data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_mesh_data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.to_mesh_data--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.to_object" class="md-nav__link">
    <span class="md-ellipsis">
      to_object
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_object">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.to_object--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.to_object--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.torus" class="md-nav__link">
    <span class="md-ellipsis">
      torus
    </span>
  </a>
  
    <nav class="md-nav" aria-label="torus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.torus--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.torus--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.uvsphere" class="md-nav__link">
    <span class="md-ellipsis">
      uvsphere
    </span>
  </a>
  
    <nav class="md-nav" aria-label="uvsphere">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.uvsphere--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.uvsphere--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.vectors_field" class="md-nav__link">
    <span class="md-ellipsis">
      vectors_field
    </span>
  </a>
  
    <nav class="md-nav" aria-label="vectors_field">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.vectors_field--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.vectors_field--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.Meshes" class="md-nav__link">
    <span class="md-ellipsis">
      Meshes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Meshes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Meshes.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Meshes.__init__--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.MultiResGrid" class="md-nav__link">
    <span class="md-ellipsis">
      MultiResGrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MultiResGrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.MultiResGrid--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.MultiResGrid.call_func" class="md-nav__link">
    <span class="md-ellipsis">
      call_func
    </span>
  </a>
  
    <nav class="md-nav" aria-label="call_func">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.MultiResGrid.call_func--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.MultiResGrid.call_func--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.MultiResGrid.compute_normals" class="md-nav__link">
    <span class="md-ellipsis">
      compute_normals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.MultiResGrid.get_normals" class="md-nav__link">
    <span class="md-ellipsis">
      get_normals
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_normals">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.MultiResGrid.get_normals--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.MultiResGrid.get_normals--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.MultiResGrid.update_grid" class="md-nav__link">
    <span class="md-ellipsis">
      update_grid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="update_grid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.MultiResGrid.update_grid--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.ShapeKeys" class="md-nav__link">
    <span class="md-ellipsis">
      ShapeKeys
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ShapeKeys">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.ShapeKeys.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.ShapeKeys.__init__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.ShapeKeys.abs_interpolate" class="md-nav__link">
    <span class="md-ellipsis">
      abs_interpolate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="abs_interpolate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.ShapeKeys.abs_interpolate--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.ShapeKeys.abs_interpolate--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.ShapeKeys.rel_interpolate" class="md-nav__link">
    <span class="md-ellipsis">
      rel_interpolate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="rel_interpolate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.ShapeKeys.rel_interpolate--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.ShapeKeys.rel_interpolate--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.Simulation" class="md-nav__link">
    <span class="md-ellipsis">
      Simulation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Simulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Simulation.add_action" class="md-nav__link">
    <span class="md-ellipsis">
      add_action
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_action">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Simulation.add_action--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Simulation.add_action--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Simulation.add_event" class="md-nav__link">
    <span class="md-ellipsis">
      add_event
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_event">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Simulation.add_event--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Simulation.add_event--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Simulation.change_attribute" class="md-nav__link">
    <span class="md-ellipsis">
      change_attribute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Simulation.newton_law" class="md-nav__link">
    <span class="md-ellipsis">
      newton_law
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Simulation.reset" class="md-nav__link">
    <span class="md-ellipsis">
      reset
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.Spline" class="md-nav__link">
    <span class="md-ellipsis">
      Spline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Spline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Spline--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Spline.functions" class="md-nav__link">
    <span class="md-ellipsis">
      functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Spline.functions--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Spline.length" class="md-nav__link">
    <span class="md-ellipsis">
      length
    </span>
  </a>
  
    <nav class="md-nav" aria-label="length">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Spline.length--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Spline.add_splines" class="md-nav__link">
    <span class="md-ellipsis">
      add_splines
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_splines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Spline.add_splines--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Spline.load_bl_attributes" class="md-nav__link">
    <span class="md-ellipsis">
      load_bl_attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="load_bl_attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Spline.load_bl_attributes--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Spline.tangent" class="md-nav__link">
    <span class="md-ellipsis">
      tangent
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tangent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Spline.tangent--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Spline.tangent--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Spline.to_object" class="md-nav__link">
    <span class="md-ellipsis">
      to_object
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_object">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Spline.to_object--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="mesh/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mesh
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#npblender" class="md-nav__link">
    <span class="md-ellipsis">
      npblender
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.Camera" class="md-nav__link">
    <span class="md-ellipsis">
      Camera
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Camera">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.distance_for_scale" class="md-nav__link">
    <span class="md-ellipsis">
      distance_for_scale
    </span>
  </a>
  
    <nav class="md-nav" aria-label="distance_for_scale">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.distance_for_scale--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.distance_for_scale--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.distance_for_scale--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.pixels_per_meter" class="md-nav__link">
    <span class="md-ellipsis">
      pixels_per_meter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="pixels_per_meter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.pixels_per_meter--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.pixels_per_meter--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.visible_edges" class="md-nav__link">
    <span class="md-ellipsis">
      visible_edges
    </span>
  </a>
  
    <nav class="md-nav" aria-label="visible_edges">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.visible_edges--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.visible_edges--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.visible_faces" class="md-nav__link">
    <span class="md-ellipsis">
      visible_faces
    </span>
  </a>
  
    <nav class="md-nav" aria-label="visible_faces">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.visible_faces--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.visible_faces--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.visible_islands" class="md-nav__link">
    <span class="md-ellipsis">
      visible_islands
    </span>
  </a>
  
    <nav class="md-nav" aria-label="visible_islands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.visible_islands--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.visible_islands--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.visible_points" class="md-nav__link">
    <span class="md-ellipsis">
      visible_points
    </span>
  </a>
  
    <nav class="md-nav" aria-label="visible_points">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.visible_points--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Camera.visible_points--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.Cloud" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cloud">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.__init__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.__init__--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.capture" class="md-nav__link">
    <span class="md-ellipsis">
      capture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="capture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.capture--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.capture--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.clear_geometry" class="md-nav__link">
    <span class="md-ellipsis">
      clear_geometry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.from_data" class="md-nav__link">
    <span class="md-ellipsis">
      from_data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="from_data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.from_data--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.from_geometry" class="md-nav__link">
    <span class="md-ellipsis">
      from_geometry
    </span>
  </a>
  
    <nav class="md-nav" aria-label="from_geometry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.from_geometry--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.from_geometry--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.from_object" class="md-nav__link">
    <span class="md-ellipsis">
      from_object
    </span>
  </a>
  
    <nav class="md-nav" aria-label="from_object">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.from_object--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.from_object--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.join" class="md-nav__link">
    <span class="md-ellipsis">
      join
    </span>
  </a>
  
    <nav class="md-nav" aria-label="join">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.join--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.to_data" class="md-nav__link">
    <span class="md-ellipsis">
      to_data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.to_data--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.to_object" class="md-nav__link">
    <span class="md-ellipsis">
      to_object
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_object">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.to_object--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Cloud.to_object--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.Corner" class="md-nav__link">
    <span class="md-ellipsis">
      Corner
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Corner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Corner--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.Curve" class="md-nav__link">
    <span class="md-ellipsis">
      Curve
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Curve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.__init__--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.add_bezier" class="md-nav__link">
    <span class="md-ellipsis">
      add_bezier
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_bezier">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.add_bezier--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.add_bezier--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.add_poly" class="md-nav__link">
    <span class="md-ellipsis">
      add_poly
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_poly">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.add_poly--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.add_poly--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.add_splines" class="md-nav__link">
    <span class="md-ellipsis">
      add_splines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.blender_data" class="md-nav__link">
    <span class="md-ellipsis">
      blender_data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="blender_data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.blender_data--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.blender_data--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.capture" class="md-nav__link">
    <span class="md-ellipsis">
      capture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="capture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.capture--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.capture--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.clear" class="md-nav__link">
    <span class="md-ellipsis">
      clear
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.compute_bezier_handles" class="md-nav__link">
    <span class="md-ellipsis">
      compute_bezier_handles
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compute_bezier_handles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.compute_bezier_handles--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.compute_bezier_handles--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.delete_points" class="md-nav__link">
    <span class="md-ellipsis">
      delete_points
    </span>
  </a>
  
    <nav class="md-nav" aria-label="delete_points">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.delete_points--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.delete_splines" class="md-nav__link">
    <span class="md-ellipsis">
      delete_splines
    </span>
  </a>
  
    <nav class="md-nav" aria-label="delete_splines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.delete_splines--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.for_each_bucket" class="md-nav__link">
    <span class="md-ellipsis">
      for_each_bucket
    </span>
  </a>
  
    <nav class="md-nav" aria-label="for_each_bucket">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.for_each_bucket--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.for_each_bucket--yields" class="md-nav__link">
    <span class="md-ellipsis">
      Yields
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.from_curve" class="md-nav__link">
    <span class="md-ellipsis">
      from_curve
    </span>
  </a>
  
    <nav class="md-nav" aria-label="from_curve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.from_curve--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.from_curve--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.from_curve_data" class="md-nav__link">
    <span class="md-ellipsis">
      from_curve_data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="from_curve_data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.from_curve_data--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.from_object" class="md-nav__link">
    <span class="md-ellipsis">
      from_object
    </span>
  </a>
  
    <nav class="md-nav" aria-label="from_object">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.from_object--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.from_object--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.get_points_selection" class="md-nav__link">
    <span class="md-ellipsis">
      get_points_selection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_points_selection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.get_points_selection--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.join" class="md-nav__link">
    <span class="md-ellipsis">
      join
    </span>
  </a>
  
    <nav class="md-nav" aria-label="join">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.join--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.multiply" class="md-nav__link">
    <span class="md-ellipsis">
      multiply
    </span>
  </a>
  
    <nav class="md-nav" aria-label="multiply">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.multiply--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.multiply--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.no_view" class="md-nav__link">
    <span class="md-ellipsis">
      no_view
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.select" class="md-nav__link">
    <span class="md-ellipsis">
      select
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.to_bezier" class="md-nav__link">
    <span class="md-ellipsis">
      to_bezier
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_bezier">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.to_bezier--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.to_curve_data" class="md-nav__link">
    <span class="md-ellipsis">
      to_curve_data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_curve_data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.to_curve_data--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.to_mesh" class="md-nav__link">
    <span class="md-ellipsis">
      to_mesh
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_mesh">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.to_mesh--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.to_mesh--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.to_object" class="md-nav__link">
    <span class="md-ellipsis">
      to_object
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_object">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.to_object--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.to_object--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Curve.to_poly" class="md-nav__link">
    <span class="md-ellipsis">
      to_poly
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.Edge" class="md-nav__link">
    <span class="md-ellipsis">
      Edge
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Edge">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Edge--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.Face" class="md-nav__link">
    <span class="md-ellipsis">
      Face
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Face">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Face.area" class="md-nav__link">
    <span class="md-ellipsis">
      area
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Face.area_vectors" class="md-nav__link">
    <span class="md-ellipsis">
      area_vectors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="area_vectors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Face.area_vectors--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Face.area_vectors--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Face.get_edges" class="md-nav__link">
    <span class="md-ellipsis">
      get_edges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Face.get_face_edges" class="md-nav__link">
    <span class="md-ellipsis">
      get_face_edges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Face.normal" class="md-nav__link">
    <span class="md-ellipsis">
      normal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Face.position" class="md-nav__link">
    <span class="md-ellipsis">
      position
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.FieldArray" class="md-nav__link">
    <span class="md-ellipsis">
      FieldArray
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FieldArray">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.actual_names" class="md-nav__link">
    <span class="md-ellipsis">
      actual_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.all_names" class="md-nav__link">
    <span class="md-ellipsis">
      all_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.dtype" class="md-nav__link">
    <span class="md-ellipsis">
      dtype
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.__array__" class="md-nav__link">
    <span class="md-ellipsis">
      __array__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.__init__--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.add" class="md-nav__link">
    <span class="md-ellipsis">
      add
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.add--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.append" class="md-nav__link">
    <span class="md-ellipsis">
      append
    </span>
  </a>
  
    <nav class="md-nav" aria-label="append">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.append--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.as_kwargs" class="md-nav__link">
    <span class="md-ellipsis">
      as_kwargs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="as_kwargs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.as_kwargs--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.as_kwargs--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.copy_field" class="md-nav__link">
    <span class="md-ellipsis">
      copy_field
    </span>
  </a>
  
    <nav class="md-nav" aria-label="copy_field">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.copy_field--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.copy_field--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.delete" class="md-nav__link">
    <span class="md-ellipsis">
      delete
    </span>
  </a>
  
    <nav class="md-nav" aria-label="delete">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.delete--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.delete--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.extend" class="md-nav__link">
    <span class="md-ellipsis">
      extend
    </span>
  </a>
  
    <nav class="md-nav" aria-label="extend">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.extend--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.filtered" class="md-nav__link">
    <span class="md-ellipsis">
      filtered
    </span>
  </a>
  
    <nav class="md-nav" aria-label="filtered">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.filtered--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.filtered--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.from_dict" class="md-nav__link">
    <span class="md-ellipsis">
      from_dict
    </span>
  </a>
  
    <nav class="md-nav" aria-label="from_dict">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.from_dict--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.from_dict--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.get" class="md-nav__link">
    <span class="md-ellipsis">
      get
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.join_fields" class="md-nav__link">
    <span class="md-ellipsis">
      join_fields
    </span>
  </a>
  
    <nav class="md-nav" aria-label="join_fields">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.join_fields--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.join_fields--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.multiply" class="md-nav__link">
    <span class="md-ellipsis">
      multiply
    </span>
  </a>
  
    <nav class="md-nav" aria-label="multiply">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.multiply--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.multiply--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.multiply--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.new_field" class="md-nav__link">
    <span class="md-ellipsis">
      new_field
    </span>
  </a>
  
    <nav class="md-nav" aria-label="new_field">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.new_field--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.to_dict" class="md-nav__link">
    <span class="md-ellipsis">
      to_dict
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_dict">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.to_dict--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.FieldArray.to_dict--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.Geometry" class="md-nav__link">
    <span class="md-ellipsis">
      Geometry
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Geometry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Geometry.add_materials" class="md-nav__link">
    <span class="md-ellipsis">
      add_materials
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_materials">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Geometry.add_materials--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Geometry.get_material_index" class="md-nav__link">
    <span class="md-ellipsis">
      get_material_index
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_material_index">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Geometry.get_material_index--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Geometry.get_material_index--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Geometry.join_attributes" class="md-nav__link">
    <span class="md-ellipsis">
      join_attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Geometry.load_models" class="md-nav__link">
    <span class="md-ellipsis">
      load_models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="load_models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Geometry.load_models--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Geometry.load_models--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Geometry.load_object" class="md-nav__link">
    <span class="md-ellipsis">
      load_object
    </span>
  </a>
  
    <nav class="md-nav" aria-label="load_object">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Geometry.load_object--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Geometry.load_object--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.Instances" class="md-nav__link">
    <span class="md-ellipsis">
      Instances
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Instances">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Instances.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Instances.__init__--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.Mesh" class="md-nav__link">
    <span class="md-ellipsis">
      Mesh
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Mesh">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.__init__--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.add_geometry" class="md-nav__link">
    <span class="md-ellipsis">
      add_geometry
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_geometry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.add_geometry--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.add_geometry--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.add_points" class="md-nav__link">
    <span class="md-ellipsis">
      add_points
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_points">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.add_points--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.add_points--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.bl_circle" class="md-nav__link">
    <span class="md-ellipsis">
      bl_circle
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bl_circle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.bl_circle--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.bl_circle--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.bl_cone" class="md-nav__link">
    <span class="md-ellipsis">
      bl_cone
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bl_cone">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.bl_cone--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.bl_cone--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.bl_grid" class="md-nav__link">
    <span class="md-ellipsis">
      bl_grid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bl_grid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.bl_grid--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.bl_grid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.blender_data" class="md-nav__link">
    <span class="md-ellipsis">
      blender_data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="blender_data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.blender_data--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.blender_data--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.bmesh" class="md-nav__link">
    <span class="md-ellipsis">
      bmesh
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bmesh">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.bmesh--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.boolean" class="md-nav__link">
    <span class="md-ellipsis">
      boolean
    </span>
  </a>
  
    <nav class="md-nav" aria-label="boolean">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.boolean--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.bridge_loops" class="md-nav__link">
    <span class="md-ellipsis">
      bridge_loops
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bridge_loops">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.bridge_loops--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.capture" class="md-nav__link">
    <span class="md-ellipsis">
      capture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="capture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.capture--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.capture--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.chain_link" class="md-nav__link">
    <span class="md-ellipsis">
      chain_link
    </span>
  </a>
  
    <nav class="md-nav" aria-label="chain_link">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.chain_link--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.chain_link--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.circle" class="md-nav__link">
    <span class="md-ellipsis">
      circle
    </span>
  </a>
  
    <nav class="md-nav" aria-label="circle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.circle--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.circle--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.clear_geometry" class="md-nav__link">
    <span class="md-ellipsis">
      clear_geometry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.cone" class="md-nav__link">
    <span class="md-ellipsis">
      cone
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cone">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.cone--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.cone--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.cube" class="md-nav__link">
    <span class="md-ellipsis">
      cube
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cube">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.cube--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.cube--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.cylinder" class="md-nav__link">
    <span class="md-ellipsis">
      cylinder
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cylinder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.cylinder--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.cylinder--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.delete_faces" class="md-nav__link">
    <span class="md-ellipsis">
      delete_faces
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.delete_vertices" class="md-nav__link">
    <span class="md-ellipsis">
      delete_vertices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="delete_vertices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.delete_vertices--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.disk" class="md-nav__link">
    <span class="md-ellipsis">
      disk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.extrude_faces" class="md-nav__link">
    <span class="md-ellipsis">
      extrude_faces
    </span>
  </a>
  
    <nav class="md-nav" aria-label="extrude_faces">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.extrude_faces--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.extrude_faces--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.extrude_loop" class="md-nav__link">
    <span class="md-ellipsis">
      extrude_loop
    </span>
  </a>
  
    <nav class="md-nav" aria-label="extrude_loop">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.extrude_loop--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.extrude_loop--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.extrude_region" class="md-nav__link">
    <span class="md-ellipsis">
      extrude_region
    </span>
  </a>
  
    <nav class="md-nav" aria-label="extrude_region">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.extrude_region--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.extrude_region--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.extrude_vertices" class="md-nav__link">
    <span class="md-ellipsis">
      extrude_vertices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="extrude_vertices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.extrude_vertices--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.extrude_vertices--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.fill_cap" class="md-nav__link">
    <span class="md-ellipsis">
      fill_cap
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fill_cap">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.fill_cap--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.from_mesh" class="md-nav__link">
    <span class="md-ellipsis">
      from_mesh
    </span>
  </a>
  
    <nav class="md-nav" aria-label="from_mesh">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.from_mesh--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.from_mesh--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.from_mesh_data" class="md-nav__link">
    <span class="md-ellipsis">
      from_mesh_data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="from_mesh_data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.from_mesh_data--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.from_object" class="md-nav__link">
    <span class="md-ellipsis">
      from_object
    </span>
  </a>
  
    <nav class="md-nav" aria-label="from_object">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.from_object--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.from_object--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.get_islands" class="md-nav__link">
    <span class="md-ellipsis">
      get_islands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.grid" class="md-nav__link">
    <span class="md-ellipsis">
      grid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="grid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.grid--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.grid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.icosphere" class="md-nav__link">
    <span class="md-ellipsis">
      icosphere
    </span>
  </a>
  
    <nav class="md-nav" aria-label="icosphere">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.icosphere--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.icosphere--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.inset_faces" class="md-nav__link">
    <span class="md-ellipsis">
      inset_faces
    </span>
  </a>
  
    <nav class="md-nav" aria-label="inset_faces">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.inset_faces--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.inset_faces--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.join" class="md-nav__link">
    <span class="md-ellipsis">
      join
    </span>
  </a>
  
    <nav class="md-nav" aria-label="join">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.join--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.join_geometry" class="md-nav__link">
    <span class="md-ellipsis">
      join_geometry
    </span>
  </a>
  
    <nav class="md-nav" aria-label="join_geometry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.join_geometry--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.line" class="md-nav__link">
    <span class="md-ellipsis">
      line
    </span>
  </a>
  
    <nav class="md-nav" aria-label="line">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.line--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.line--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.monkey" class="md-nav__link">
    <span class="md-ellipsis">
      monkey
    </span>
  </a>
  
    <nav class="md-nav" aria-label="monkey">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.monkey--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.monkey--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.multiply" class="md-nav__link">
    <span class="md-ellipsis">
      multiply
    </span>
  </a>
  
    <nav class="md-nav" aria-label="multiply">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.multiply--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.multiply--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.points_cloud" class="md-nav__link">
    <span class="md-ellipsis">
      points_cloud
    </span>
  </a>
  
    <nav class="md-nav" aria-label="points_cloud">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.points_cloud--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.points_cloud--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.pyramid" class="md-nav__link">
    <span class="md-ellipsis">
      pyramid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="pyramid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.pyramid--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.pyramid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.remove_doubles" class="md-nav__link">
    <span class="md-ellipsis">
      remove_doubles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.separate_faces" class="md-nav__link">
    <span class="md-ellipsis">
      separate_faces
    </span>
  </a>
  
    <nav class="md-nav" aria-label="separate_faces">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.separate_faces--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.solidify" class="md-nav__link">
    <span class="md-ellipsis">
      solidify
    </span>
  </a>
  
    <nav class="md-nav" aria-label="solidify">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.solidify--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.solidify--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.solidify_socle" class="md-nav__link">
    <span class="md-ellipsis">
      solidify_socle
    </span>
  </a>
  
    <nav class="md-nav" aria-label="solidify_socle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.solidify_socle--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.solidify_socle--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.to_curve_REVIEW" class="md-nav__link">
    <span class="md-ellipsis">
      to_curve_REVIEW
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.to_mesh_data" class="md-nav__link">
    <span class="md-ellipsis">
      to_mesh_data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_mesh_data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.to_mesh_data--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.to_object" class="md-nav__link">
    <span class="md-ellipsis">
      to_object
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_object">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.to_object--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.to_object--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.torus" class="md-nav__link">
    <span class="md-ellipsis">
      torus
    </span>
  </a>
  
    <nav class="md-nav" aria-label="torus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.torus--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.torus--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.uvsphere" class="md-nav__link">
    <span class="md-ellipsis">
      uvsphere
    </span>
  </a>
  
    <nav class="md-nav" aria-label="uvsphere">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.uvsphere--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.uvsphere--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.vectors_field" class="md-nav__link">
    <span class="md-ellipsis">
      vectors_field
    </span>
  </a>
  
    <nav class="md-nav" aria-label="vectors_field">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.vectors_field--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Mesh.vectors_field--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.Meshes" class="md-nav__link">
    <span class="md-ellipsis">
      Meshes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Meshes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Meshes.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Meshes.__init__--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.MultiResGrid" class="md-nav__link">
    <span class="md-ellipsis">
      MultiResGrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MultiResGrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.MultiResGrid--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.MultiResGrid.call_func" class="md-nav__link">
    <span class="md-ellipsis">
      call_func
    </span>
  </a>
  
    <nav class="md-nav" aria-label="call_func">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.MultiResGrid.call_func--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.MultiResGrid.call_func--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.MultiResGrid.compute_normals" class="md-nav__link">
    <span class="md-ellipsis">
      compute_normals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.MultiResGrid.get_normals" class="md-nav__link">
    <span class="md-ellipsis">
      get_normals
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_normals">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.MultiResGrid.get_normals--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.MultiResGrid.get_normals--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.MultiResGrid.update_grid" class="md-nav__link">
    <span class="md-ellipsis">
      update_grid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="update_grid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.MultiResGrid.update_grid--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.ShapeKeys" class="md-nav__link">
    <span class="md-ellipsis">
      ShapeKeys
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ShapeKeys">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.ShapeKeys.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.ShapeKeys.__init__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.ShapeKeys.abs_interpolate" class="md-nav__link">
    <span class="md-ellipsis">
      abs_interpolate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="abs_interpolate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.ShapeKeys.abs_interpolate--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.ShapeKeys.abs_interpolate--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.ShapeKeys.rel_interpolate" class="md-nav__link">
    <span class="md-ellipsis">
      rel_interpolate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="rel_interpolate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.ShapeKeys.rel_interpolate--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.ShapeKeys.rel_interpolate--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.Simulation" class="md-nav__link">
    <span class="md-ellipsis">
      Simulation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Simulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Simulation.add_action" class="md-nav__link">
    <span class="md-ellipsis">
      add_action
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_action">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Simulation.add_action--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Simulation.add_action--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Simulation.add_event" class="md-nav__link">
    <span class="md-ellipsis">
      add_event
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_event">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Simulation.add_event--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Simulation.add_event--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Simulation.change_attribute" class="md-nav__link">
    <span class="md-ellipsis">
      change_attribute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Simulation.newton_law" class="md-nav__link">
    <span class="md-ellipsis">
      newton_law
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Simulation.reset" class="md-nav__link">
    <span class="md-ellipsis">
      reset
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npblender.Spline" class="md-nav__link">
    <span class="md-ellipsis">
      Spline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Spline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Spline--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Spline.functions" class="md-nav__link">
    <span class="md-ellipsis">
      functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Spline.functions--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Spline.length" class="md-nav__link">
    <span class="md-ellipsis">
      length
    </span>
  </a>
  
    <nav class="md-nav" aria-label="length">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Spline.length--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Spline.add_splines" class="md-nav__link">
    <span class="md-ellipsis">
      add_splines
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_splines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Spline.add_splines--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Spline.load_bl_attributes" class="md-nav__link">
    <span class="md-ellipsis">
      load_bl_attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="load_bl_attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Spline.load_bl_attributes--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Spline.tangent" class="md-nav__link">
    <span class="md-ellipsis">
      tangent
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tangent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Spline.tangent--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Spline.tangent--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npblender.Spline.to_object" class="md-nav__link">
    <span class="md-ellipsis">
      to_object
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_object">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npblender.Spline.to_object--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="reference-api">Référence API<a class="headerlink" href="#reference-api" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<a id="npblender"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="npblender.Camera" class="doc doc-heading">
            <code>Camera</code>


<a href="#npblender.Camera" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">









              <details class="quote">
                <summary>Source code in <code>npblender/camera.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Camera</span><span class="p">:</span>

    <span class="n">VISIBLE</span>   <span class="o">=</span> <span class="mi">0</span>
    <span class="n">BACK_FACE</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">BEHIND</span>    <span class="o">=</span> <span class="mi">2</span>
    <span class="n">LEFT</span>      <span class="o">=</span> <span class="mi">3</span>
    <span class="n">RIGHT</span>     <span class="o">=</span> <span class="mi">4</span>
    <span class="n">BELOW</span>     <span class="o">=</span> <span class="mi">5</span>
    <span class="n">ABOVE</span>     <span class="o">=</span> <span class="mi">6</span>
    <span class="n">SLICE_END</span> <span class="o">=</span> <span class="mi">7</span>

    <span class="n">DISTANCE</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">SIZE</span>     <span class="o">=</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">camera</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">camera</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">camera</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bcamera</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bcamera</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">camera</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Camera</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bcamera</span> <span class="o">=</span> <span class="n">camera</span>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;Camera &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bcamera</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;: focal: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">focal_angle</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">°, resolution: (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution_x</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution_y</span><span class="si">}</span><span class="s2">)&gt;&quot;</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># The Blender camera</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bcamera</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bcamera</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">camera</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bcamera</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Camera world location</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">location</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcamera</span><span class="o">.</span><span class="n">matrix_world</span><span class="o">.</span><span class="n">translation</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Focal angle of the camera</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">focal_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcamera</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">angle</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Clip</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">clip_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcamera</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">clip_start</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">clip_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcamera</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">clip_end</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Normalized vector representing the direction of the camera</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">direction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bcamera</span><span class="o">.</span><span class="n">matrix_world</span> <span class="o">@</span> <span class="n">Vector</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span><span class="o">.</span><span class="n">resized</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Scene resolution</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">resolution_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">render</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">render</span>
        <span class="k">return</span> <span class="n">render</span><span class="o">.</span><span class="n">resolution_x</span> <span class="o">*</span> <span class="n">render</span><span class="o">.</span><span class="n">pixel_aspect_x</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">resolution_y</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">render</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">render</span>
        <span class="k">return</span> <span class="n">render</span><span class="o">.</span><span class="n">resolution_y</span> <span class="o">*</span> <span class="n">render</span><span class="o">.</span><span class="n">pixel_aspect_y</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">resolution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcamera</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sensor_fit</span> <span class="o">==</span> <span class="s1">&#39;VERTICAL&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution_y</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution_x</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Number of pixels per meter function of the distance</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pixels_per_meter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distances</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Returns the number of pixels per meter given the distances</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        - distances (array of floats) : the distances</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        - array of floats : the size of a meter in pixels</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cam_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcamera</span><span class="o">.</span><span class="n">data</span>

        <span class="c1"># Focal and sensor in mm</span>
        <span class="n">focal_mm</span> <span class="o">=</span> <span class="n">cam_data</span><span class="o">.</span><span class="n">lens</span>
        <span class="n">sensor_fit</span> <span class="o">=</span> <span class="n">cam_data</span><span class="o">.</span><span class="n">sensor_fit</span>

        <span class="k">if</span> <span class="n">sensor_fit</span> <span class="o">==</span> <span class="s1">&#39;VERTICAL&#39;</span><span class="p">:</span>
            <span class="n">sensor_mm</span> <span class="o">=</span> <span class="n">cam_data</span><span class="o">.</span><span class="n">sensor_height</span>
            <span class="n">res_px</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution_y</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># &#39;HORIZONTAL&#39; or &#39;AUTO&#39;</span>
            <span class="n">sensor_mm</span> <span class="o">=</span> <span class="n">cam_data</span><span class="o">.</span><span class="n">sensor_width</span>
            <span class="n">res_px</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution_x</span>

        <span class="c1"># Focal in pixels</span>
        <span class="n">focal_px</span> <span class="o">=</span> <span class="p">(</span><span class="n">focal_mm</span> <span class="o">/</span> <span class="n">sensor_mm</span><span class="p">)</span> <span class="o">*</span> <span class="n">res_px</span>

        <span class="c1"># Meter size</span>
        <span class="n">size_in_pixels</span> <span class="o">=</span> <span class="n">focal_px</span> <span class="o">/</span> <span class="n">distances</span>

        <span class="k">return</span> <span class="n">size_in_pixels</span>    

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Distance of a location to the camera</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">Vector</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">location</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">-</span> <span class="n">Vector</span><span class="p">(</span><span class="n">location</span><span class="p">))</span><span class="o">.</span><span class="n">length</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">location</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Compute visibility, distance and apparent size</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Visible points</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visible_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verts</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">normals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_proj</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Compute the visibility of vertices.</span>

<span class="sd">        For each vertex, the following values are computed:</span>
<span class="sd">        - visible : vertex is visible (all bools below are False)</span>
<span class="sd">        - behind : vertex is behind the visible rectangle</span>
<span class="sd">        - left : vertex is left to the visible rectangle</span>
<span class="sd">        - right : vertex if right to the visible rectangle</span>
<span class="sd">        - above : vertex is above the visible rectangle</span>
<span class="sd">        - below : vertex is below the visible rectangle</span>
<span class="sd">        - back : normal points outards</span>
<span class="sd">        - distance : distance to the camera</span>
<span class="sd">        - size : apparent size (based on radius)</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - verts (array of vectors) : vertex locations</span>
<span class="sd">            - radius (array of floats or float = 0.) : size at the locations</span>
<span class="sd">            - margin (float, default=0.) : margin factor around the camera</span>
<span class="sd">            - normals (array of vectors = None) : normal pointing outwards are not visible</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - couple of arrays : array[n, 7] of bools, array[n, 2] of floats</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Resulting arrays</span>

        <span class="c1">#count = np.size(verts)//3</span>
        <span class="c1">#vis  = np.zeros((count, 7), dtype=bool)</span>
        <span class="c1">#dist = np.zeros((count, 2), dtype=float)</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Current camera object</span>

        <span class="n">camera</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcamera</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># The projection rectangle</span>
        <span class="c1"># The plane is horizontal. All z&lt;0 are identical</span>
        <span class="c1"># View frame corners are returned in the order:</span>
        <span class="c1"># - top-right</span>
        <span class="c1"># - bottom-right</span>
        <span class="c1"># - bottom-left</span>
        <span class="c1"># - top-left        </span>

        <span class="n">c0</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">view_frame</span><span class="p">(</span><span class="n">scene</span><span class="o">=</span><span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="p">)</span>

        <span class="n">cam_x0</span><span class="p">,</span> <span class="n">cam_y0</span> <span class="o">=</span> <span class="n">c2</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">margin</span><span class="p">,</span> <span class="n">c2</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">margin</span>
        <span class="n">cam_x1</span><span class="p">,</span> <span class="n">cam_y1</span> <span class="o">=</span> <span class="n">c0</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">margin</span><span class="p">,</span> <span class="n">c0</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">margin</span>
        <span class="n">cam_z</span> <span class="o">=</span> <span class="n">c0</span><span class="o">.</span><span class="n">z</span>

        <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;view_frame&quot;</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CAMERA SHAPE: plane z = </span><span class="si">{</span><span class="n">cam_z</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   x: </span><span class="si">{</span><span class="n">cam_x0</span><span class="si">:</span><span class="s2">5.1f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">cam_x1</span><span class="si">:</span><span class="s2">5.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   y: </span><span class="si">{</span><span class="n">cam_y0</span><span class="si">:</span><span class="s2">5.1f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">cam_y1</span><span class="si">:</span><span class="s2">5.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Camera rotation matrix</span>

        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">matrix_world</span><span class="o">.</span><span class="n">inverted</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Prepare arguments</span>

        <span class="n">count</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span><span class="o">//</span><span class="mi">3</span>
        <span class="n">verts</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">normals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">normals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">normals</span><span class="p">,</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">cam_loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">USE_JIT</span><span class="p">:</span>
            <span class="n">vis</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">pts</span> <span class="o">=</span> <span class="n">camera_projection_jit</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">cam_z</span><span class="p">,</span> <span class="n">cam_x0</span><span class="p">,</span> <span class="n">cam_x1</span><span class="p">,</span> <span class="n">cam_y0</span><span class="p">,</span> <span class="n">cam_y1</span><span class="p">,</span> <span class="n">verts</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">cam_loc</span><span class="p">,</span> <span class="n">normals</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vis</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">pts</span> <span class="o">=</span> <span class="n">camera_projection</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">cam_z</span><span class="p">,</span> <span class="n">cam_x0</span><span class="p">,</span> <span class="n">cam_x1</span><span class="p">,</span> <span class="n">cam_y0</span><span class="p">,</span> <span class="n">cam_y1</span><span class="p">,</span> <span class="n">verts</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">cam_loc</span><span class="p">,</span> <span class="n">normals</span><span class="p">)</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Return visibility and distances</span>

        <span class="k">if</span> <span class="n">return_proj</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">vis</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">pts</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">vis</span><span class="p">,</span> <span class="n">dist</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Visible edges</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visible_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Mesh edges visibility</span>

<span class="sd">        The visibility of each point is computed with the given radius.</span>
<span class="sd">        An edge is considered invisible if both points are hidden for the same reason:</span>
<span class="sd">        both are left to the camera, or right, or behind...</span>

<span class="sd">        In the other case, the edge is considered as visible.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        mesh : Mesh</span>
<span class="sd">            The mesh with points and edges</span>
<span class="sd">        radius : float</span>
<span class="sd">            The radius of the camera</span>
<span class="sd">        margin : float</span>
<span class="sd">            The margin of the camera</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        vis : array (n) of bools</span>
<span class="sd">            The visibility of each edge</span>
<span class="sd">        size : array (n) of floats</span>
<span class="sd">            The size of the projected edges</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">v_vis</span><span class="p">,</span> <span class="n">v_dist</span><span class="p">,</span> <span class="n">proj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visible_points</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">,</span> <span class="n">return_proj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">edge0</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">vertex0</span>
        <span class="n">edge1</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">vertex1</span>

        <span class="n">diff_side</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">v_vis</span><span class="p">[</span><span class="n">edge0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">v_vis</span><span class="p">[</span><span class="n">edge1</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">vis</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">diff_side</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">7</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">proj</span><span class="p">[</span><span class="n">edge1</span><span class="p">]</span> <span class="o">-</span> <span class="n">proj</span><span class="p">[</span><span class="n">edge0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">vis</span><span class="p">,</span> <span class="n">size</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Visible faces</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visible_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">back_face_culling</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Mesh faces visibility</span>

<span class="sd">        A face is considered invisible if all its points are hidden for the same reason:</span>
<span class="sd">        all are left to the camera, or right, or behind...</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        mesh : Mesh</span>
<span class="sd">            The mesh with points and faces</span>
<span class="sd">        margin : float</span>
<span class="sd">            The margin of the camera</span>
<span class="sd">        back_face_culling : bool</span>
<span class="sd">            If True, the back face is not considered as visible</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        vis : array (n) of bools</span>
<span class="sd">            The visibility of each face</span>
<span class="sd">        size : array (n) of floats</span>
<span class="sd">            The size of the projected faces</span>
<span class="sd">        proj : array (n, 3) of floats</span>
<span class="sd">            The projected position of each face</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># ----- Number of faces to analyze</span>

        <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>

        <span class="c1"># ----- Project the points</span>

        <span class="n">v_vis</span><span class="p">,</span> <span class="n">v_dist</span><span class="p">,</span> <span class="n">proj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visible_points</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">,</span> <span class="n">return_proj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># ----- Back face culling : normal centered on the face position</span>

        <span class="k">if</span> <span class="n">back_face_culling</span><span class="p">:</span>
            <span class="n">n_vis</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visible_points</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">,</span> <span class="n">normals</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">normal</span><span class="p">)</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Loop on the faces</span>

        <span class="n">vis_faces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i_face</span><span class="p">,</span> <span class="n">face</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">):</span>

            <span class="c1"># ----- Nothing to do if back face</span>

            <span class="k">if</span> <span class="n">back_face_culling</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">n_vis</span><span class="p">[</span><span class="n">i_face</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">BACK_FACE</span><span class="p">]:</span>
                    <span class="k">continue</span>

            <span class="c1"># ----- Visibility of corners : (n, 7)</span>

            <span class="n">index</span> <span class="o">=</span> <span class="n">face</span><span class="o">.</span><span class="n">loop_start</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">face</span><span class="o">.</span><span class="n">loop_total</span>

            <span class="n">c_vis</span> <span class="o">=</span> <span class="n">v_vis</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">index</span> <span class="o">+</span> <span class="n">n</span><span class="p">]]</span>
            <span class="n">diff_side</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">c_vis</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">vis_faces</span><span class="p">[</span><span class="n">i_face</span><span class="p">]</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">diff_side</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">SLICE_END</span><span class="p">])</span>

            <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Camera c_vis</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">c_vis</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Camera diff_side</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">diff_side</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Camera vis_faces</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">vis_faces</span><span class="p">)</span>

            <span class="c1"># ----- Face Size</span>

            <span class="n">f_proj</span> <span class="o">=</span> <span class="n">proj</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">index</span> <span class="o">+</span> <span class="n">n</span><span class="p">]]</span>
            <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">f_proj</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">f_proj</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">size</span><span class="p">[</span><span class="n">i_face</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">vis_faces</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">proj</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Visible islands</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">visible_islands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">islands</span><span class="p">,</span> <span class="n">attribute</span><span class="o">=</span><span class="s2">&quot;Island&quot;</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Mesh islands visibility</span>

<span class="sd">        Islands are defined by an integer.</span>

<span class="sd">        Visibility is computed with the position and size of the islands</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        mesh : Mesh</span>
<span class="sd">            The mesh with points and faces</span>
<span class="sd">        islands: array of ints</span>
<span class="sd">            One identifier per island</span>
<span class="sd">        attribute: attribute name</span>
<span class="sd">            The attribute name to use for the islands</span>
<span class="sd">        margin : float</span>
<span class="sd">            The margin of the camera</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - couple of arrays : array[n, 7] of bools, array[n, 2] of floats</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># ----- Number of islands to analyze</span>

        <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">islands</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Loop on the islands</span>

        <span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">count</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i_island</span><span class="p">,</span> <span class="n">island</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">islands</span><span class="p">):</span>

            <span class="n">sel</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">==</span> <span class="n">island</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span><span class="o">.</span><span class="n">position</span>

            <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">vmin</span> <span class="o">+</span> <span class="n">vmax</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vmax</span> <span class="o">-</span> <span class="n">vmin</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

            <span class="n">positions</span><span class="p">[</span><span class="n">i_island</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span>
            <span class="n">radius</span><span class="p">[</span><span class="n">i_island</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span>

        <span class="c1"># ----- Let&#39; go</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">visible_points</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Scaling</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">distance_for_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size_max</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">fit_axis</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute:</span>
<span class="sd">        - d0: distance at which an unscaled object of real size `size_max` exactly fits</span>
<span class="sd">                the camera frame along `fit_axis` (largest dimension touches the borders).</span>
<span class="sd">        - d : distance such that the UNscaled object at distance d has the same apparent size</span>
<span class="sd">                as the SCALED object (size_max * scale) at distance d0. (i.e. d = d0 / scale)</span>
<span class="sd">        - meters_per_pixel: world-space length at distance d that projects to exactly 1 pixel</span>
<span class="sd">                (so two vertices closer than this fall onto the same pixel).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size_max : float</span>
<span class="sd">            Largest real dimension of the mesh (Blender units).</span>
<span class="sd">        scale : float</span>
<span class="sd">            Geometry scale (&gt; 0) applied at distance d0.</span>
<span class="sd">        margin : float, optional</span>
<span class="sd">            Extra margin around the frame (same convention as elsewhere).</span>
<span class="sd">        fit_axis : {&quot;auto&quot;, &quot;width&quot;, &quot;height&quot;}</span>
<span class="sd">            Which frame span to use to define &quot;exactly fits&quot;.</span>
<span class="sd">            - &quot;auto&quot;: min(width, height)</span>
<span class="sd">            - &quot;width&quot;: frame width</span>
<span class="sd">            - &quot;height&quot;: frame height</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        d : float</span>
<span class="sd">            Distance where the UNscaled object matches the apparent size</span>
<span class="sd">            of the SCALED one at d0 (d = d0 / scale).</span>
<span class="sd">        meters_per_pixel : float</span>
<span class="sd">            World-space size corresponding to 1 pixel at distance d.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - Uses Blender&#39;s view_frame on plane z = cam_z.</span>
<span class="sd">        width  = cam_x1 - cam_x0</span>
<span class="sd">        height = cam_y1 - cam_y0</span>
<span class="sd">        - Perspective: apparent_size ∝ size / distance</span>
<span class="sd">        equality ⇒ size_max / d = (size_max * scale) / d0 ⇒ d = d0 / scale.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`scale` must be &gt; 0.&quot;</span><span class="p">)</span>

        <span class="n">camera</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcamera</span>
        <span class="n">c0</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">view_frame</span><span class="p">(</span><span class="n">scene</span><span class="o">=</span><span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="p">)</span>

        <span class="n">cam_x0</span><span class="p">,</span> <span class="n">cam_y0</span> <span class="o">=</span> <span class="n">c2</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">margin</span><span class="p">,</span> <span class="n">c2</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">margin</span>
        <span class="n">cam_x1</span><span class="p">,</span> <span class="n">cam_y1</span> <span class="o">=</span> <span class="n">c0</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">margin</span><span class="p">,</span> <span class="n">c0</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">margin</span>
        <span class="n">cam_z</span> <span class="o">=</span> <span class="n">c0</span><span class="o">.</span><span class="n">z</span>  <span class="c1"># typically negative in Blender</span>

        <span class="n">frame_w</span> <span class="o">=</span> <span class="p">(</span><span class="n">cam_x1</span> <span class="o">-</span> <span class="n">cam_x0</span><span class="p">)</span>
        <span class="n">frame_h</span> <span class="o">=</span> <span class="p">(</span><span class="n">cam_y1</span> <span class="o">-</span> <span class="n">cam_y0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fit_axis</span> <span class="o">==</span> <span class="s2">&quot;width&quot;</span><span class="p">:</span>
            <span class="n">frame_span</span> <span class="o">=</span> <span class="n">frame_w</span>
        <span class="k">elif</span> <span class="n">fit_axis</span> <span class="o">==</span> <span class="s2">&quot;height&quot;</span><span class="p">:</span>
            <span class="n">frame_span</span> <span class="o">=</span> <span class="n">frame_h</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># &quot;auto&quot;</span>
            <span class="n">frame_span</span> <span class="o">=</span> <span class="n">frame_w</span> <span class="k">if</span> <span class="n">frame_w</span> <span class="o">&lt;</span> <span class="n">frame_h</span> <span class="k">else</span> <span class="n">frame_h</span>

        <span class="k">if</span> <span class="n">frame_span</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Invalid camera frame span (width/height &lt;= 0).&quot;</span><span class="p">)</span>

        <span class="c1"># d0: unchanged logic — object (unscaled) exactly fits the frame</span>
        <span class="n">d0</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">cam_z</span><span class="p">)</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">size_max</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">frame_span</span><span class="p">)</span>

        <span class="c1"># Distance so that UNscaled@d matches SCALED@d0</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">d0</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>

        <span class="c1"># Pixel size at distance d:</span>
        <span class="c1"># pixels_per_meter(d) -&gt; px/m, so 1 px corresponds to 1 / (px/m) meters</span>
        <span class="n">px_per_m</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pixels_per_meter</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
        <span class="n">meters_per_pixel</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">px_per_m</span> <span class="k">if</span> <span class="n">px_per_m</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">d</span><span class="p">,</span> <span class="n">meters_per_pixel</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="npblender.Camera.distance_for_scale" class="doc doc-heading">
            <code class=" language-python"><span class="n">distance_for_scale</span><span class="p">(</span><span class="n">size_max</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">fit_axis</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span></code>

<a href="#npblender.Camera.distance_for_scale" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute:
- d0: distance at which an unscaled object of real size <code>size_max</code> exactly fits
        the camera frame along <code>fit_axis</code> (largest dimension touches the borders).
- d : distance such that the UNscaled object at distance d has the same apparent size
        as the SCALED object (size_max * scale) at distance d0. (i.e. d = d0 / scale)
- meters_per_pixel: world-space length at distance d that projects to exactly 1 pixel
        (so two vertices closer than this fall onto the same pixel).</p>
<h5 id="npblender.Camera.distance_for_scale--parameters">Parameters<a class="headerlink" href="#npblender.Camera.distance_for_scale--parameters" title="Permanent link">&para;</a></h5>
<p>size_max : float
    Largest real dimension of the mesh (Blender units).
scale : float
    Geometry scale (&gt; 0) applied at distance d0.
margin : float, optional
    Extra margin around the frame (same convention as elsewhere).
fit_axis : {"auto", "width", "height"}
    Which frame span to use to define "exactly fits".
    - "auto": min(width, height)
    - "width": frame width
    - "height": frame height</p>
<h5 id="npblender.Camera.distance_for_scale--returns">Returns<a class="headerlink" href="#npblender.Camera.distance_for_scale--returns" title="Permanent link">&para;</a></h5>
<p>d : float
    Distance where the UNscaled object matches the apparent size
    of the SCALED one at d0 (d = d0 / scale).
meters_per_pixel : float
    World-space size corresponding to 1 pixel at distance d.</p>
<h5 id="npblender.Camera.distance_for_scale--notes">Notes<a class="headerlink" href="#npblender.Camera.distance_for_scale--notes" title="Permanent link">&para;</a></h5>
<ul>
<li>Uses Blender's view_frame on plane z = cam_z.
width  = cam_x1 - cam_x0
height = cam_y1 - cam_y0</li>
<li>Perspective: apparent_size ∝ size / distance
equality ⇒ size_max / d = (size_max * scale) / d0 ⇒ d = d0 / scale.</li>
</ul>


            <details class="quote">
              <summary>Source code in <code>npblender/camera.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">distance_for_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size_max</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">fit_axis</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute:</span>
<span class="sd">    - d0: distance at which an unscaled object of real size `size_max` exactly fits</span>
<span class="sd">            the camera frame along `fit_axis` (largest dimension touches the borders).</span>
<span class="sd">    - d : distance such that the UNscaled object at distance d has the same apparent size</span>
<span class="sd">            as the SCALED object (size_max * scale) at distance d0. (i.e. d = d0 / scale)</span>
<span class="sd">    - meters_per_pixel: world-space length at distance d that projects to exactly 1 pixel</span>
<span class="sd">            (so two vertices closer than this fall onto the same pixel).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    size_max : float</span>
<span class="sd">        Largest real dimension of the mesh (Blender units).</span>
<span class="sd">    scale : float</span>
<span class="sd">        Geometry scale (&gt; 0) applied at distance d0.</span>
<span class="sd">    margin : float, optional</span>
<span class="sd">        Extra margin around the frame (same convention as elsewhere).</span>
<span class="sd">    fit_axis : {&quot;auto&quot;, &quot;width&quot;, &quot;height&quot;}</span>
<span class="sd">        Which frame span to use to define &quot;exactly fits&quot;.</span>
<span class="sd">        - &quot;auto&quot;: min(width, height)</span>
<span class="sd">        - &quot;width&quot;: frame width</span>
<span class="sd">        - &quot;height&quot;: frame height</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    d : float</span>
<span class="sd">        Distance where the UNscaled object matches the apparent size</span>
<span class="sd">        of the SCALED one at d0 (d = d0 / scale).</span>
<span class="sd">    meters_per_pixel : float</span>
<span class="sd">        World-space size corresponding to 1 pixel at distance d.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Uses Blender&#39;s view_frame on plane z = cam_z.</span>
<span class="sd">    width  = cam_x1 - cam_x0</span>
<span class="sd">    height = cam_y1 - cam_y0</span>
<span class="sd">    - Perspective: apparent_size ∝ size / distance</span>
<span class="sd">    equality ⇒ size_max / d = (size_max * scale) / d0 ⇒ d = d0 / scale.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">scale</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`scale` must be &gt; 0.&quot;</span><span class="p">)</span>

    <span class="n">camera</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcamera</span>
    <span class="n">c0</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">view_frame</span><span class="p">(</span><span class="n">scene</span><span class="o">=</span><span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="p">)</span>

    <span class="n">cam_x0</span><span class="p">,</span> <span class="n">cam_y0</span> <span class="o">=</span> <span class="n">c2</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">margin</span><span class="p">,</span> <span class="n">c2</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">margin</span>
    <span class="n">cam_x1</span><span class="p">,</span> <span class="n">cam_y1</span> <span class="o">=</span> <span class="n">c0</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">margin</span><span class="p">,</span> <span class="n">c0</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">margin</span>
    <span class="n">cam_z</span> <span class="o">=</span> <span class="n">c0</span><span class="o">.</span><span class="n">z</span>  <span class="c1"># typically negative in Blender</span>

    <span class="n">frame_w</span> <span class="o">=</span> <span class="p">(</span><span class="n">cam_x1</span> <span class="o">-</span> <span class="n">cam_x0</span><span class="p">)</span>
    <span class="n">frame_h</span> <span class="o">=</span> <span class="p">(</span><span class="n">cam_y1</span> <span class="o">-</span> <span class="n">cam_y0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fit_axis</span> <span class="o">==</span> <span class="s2">&quot;width&quot;</span><span class="p">:</span>
        <span class="n">frame_span</span> <span class="o">=</span> <span class="n">frame_w</span>
    <span class="k">elif</span> <span class="n">fit_axis</span> <span class="o">==</span> <span class="s2">&quot;height&quot;</span><span class="p">:</span>
        <span class="n">frame_span</span> <span class="o">=</span> <span class="n">frame_h</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># &quot;auto&quot;</span>
        <span class="n">frame_span</span> <span class="o">=</span> <span class="n">frame_w</span> <span class="k">if</span> <span class="n">frame_w</span> <span class="o">&lt;</span> <span class="n">frame_h</span> <span class="k">else</span> <span class="n">frame_h</span>

    <span class="k">if</span> <span class="n">frame_span</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Invalid camera frame span (width/height &lt;= 0).&quot;</span><span class="p">)</span>

    <span class="c1"># d0: unchanged logic — object (unscaled) exactly fits the frame</span>
    <span class="n">d0</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">cam_z</span><span class="p">)</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">size_max</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">frame_span</span><span class="p">)</span>

    <span class="c1"># Distance so that UNscaled@d matches SCALED@d0</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">d0</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>

    <span class="c1"># Pixel size at distance d:</span>
    <span class="c1"># pixels_per_meter(d) -&gt; px/m, so 1 px corresponds to 1 / (px/m) meters</span>
    <span class="n">px_per_m</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pixels_per_meter</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
    <span class="n">meters_per_pixel</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">px_per_m</span> <span class="k">if</span> <span class="n">px_per_m</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">d</span><span class="p">,</span> <span class="n">meters_per_pixel</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Camera.pixels_per_meter" class="doc doc-heading">
            <code class=" language-python"><span class="n">pixels_per_meter</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span></code>

<a href="#npblender.Camera.pixels_per_meter" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Returns the number of pixels per meter given the distances</p>
<h5 id="npblender.Camera.pixels_per_meter--arguments">Arguments<a class="headerlink" href="#npblender.Camera.pixels_per_meter--arguments" title="Permanent link">&para;</a></h5>
<ul>
<li>distances (array of floats) : the distances</li>
</ul>
<h5 id="npblender.Camera.pixels_per_meter--returns">Returns<a class="headerlink" href="#npblender.Camera.pixels_per_meter--returns" title="Permanent link">&para;</a></h5>
<ul>
<li>array of floats : the size of a meter in pixels</li>
</ul>


            <details class="quote">
              <summary>Source code in <code>npblender/camera.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pixels_per_meter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distances</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Returns the number of pixels per meter given the distances</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    - distances (array of floats) : the distances</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    - array of floats : the size of a meter in pixels</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cam_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcamera</span><span class="o">.</span><span class="n">data</span>

    <span class="c1"># Focal and sensor in mm</span>
    <span class="n">focal_mm</span> <span class="o">=</span> <span class="n">cam_data</span><span class="o">.</span><span class="n">lens</span>
    <span class="n">sensor_fit</span> <span class="o">=</span> <span class="n">cam_data</span><span class="o">.</span><span class="n">sensor_fit</span>

    <span class="k">if</span> <span class="n">sensor_fit</span> <span class="o">==</span> <span class="s1">&#39;VERTICAL&#39;</span><span class="p">:</span>
        <span class="n">sensor_mm</span> <span class="o">=</span> <span class="n">cam_data</span><span class="o">.</span><span class="n">sensor_height</span>
        <span class="n">res_px</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution_y</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># &#39;HORIZONTAL&#39; or &#39;AUTO&#39;</span>
        <span class="n">sensor_mm</span> <span class="o">=</span> <span class="n">cam_data</span><span class="o">.</span><span class="n">sensor_width</span>
        <span class="n">res_px</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution_x</span>

    <span class="c1"># Focal in pixels</span>
    <span class="n">focal_px</span> <span class="o">=</span> <span class="p">(</span><span class="n">focal_mm</span> <span class="o">/</span> <span class="n">sensor_mm</span><span class="p">)</span> <span class="o">*</span> <span class="n">res_px</span>

    <span class="c1"># Meter size</span>
    <span class="n">size_in_pixels</span> <span class="o">=</span> <span class="n">focal_px</span> <span class="o">/</span> <span class="n">distances</span>

    <span class="k">return</span> <span class="n">size_in_pixels</span>    
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Camera.visible_edges" class="doc doc-heading">
            <code class=" language-python"><span class="n">visible_edges</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span></code>

<a href="#npblender.Camera.visible_edges" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Mesh edges visibility</p>
<p>The visibility of each point is computed with the given radius.
An edge is considered invisible if both points are hidden for the same reason:
both are left to the camera, or right, or behind...</p>
<p>In the other case, the edge is considered as visible.</p>
<h5 id="npblender.Camera.visible_edges--arguments">Arguments<a class="headerlink" href="#npblender.Camera.visible_edges--arguments" title="Permanent link">&para;</a></h5>
<p>mesh : Mesh
    The mesh with points and edges
radius : float
    The radius of the camera
margin : float
    The margin of the camera</p>
<h5 id="npblender.Camera.visible_edges--returns">Returns<a class="headerlink" href="#npblender.Camera.visible_edges--returns" title="Permanent link">&para;</a></h5>
<p>vis : array (n) of bools
    The visibility of each edge
size : array (n) of floats
    The size of the projected edges</p>


            <details class="quote">
              <summary>Source code in <code>npblender/camera.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">visible_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Mesh edges visibility</span>

<span class="sd">    The visibility of each point is computed with the given radius.</span>
<span class="sd">    An edge is considered invisible if both points are hidden for the same reason:</span>
<span class="sd">    both are left to the camera, or right, or behind...</span>

<span class="sd">    In the other case, the edge is considered as visible.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    mesh : Mesh</span>
<span class="sd">        The mesh with points and edges</span>
<span class="sd">    radius : float</span>
<span class="sd">        The radius of the camera</span>
<span class="sd">    margin : float</span>
<span class="sd">        The margin of the camera</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    vis : array (n) of bools</span>
<span class="sd">        The visibility of each edge</span>
<span class="sd">    size : array (n) of floats</span>
<span class="sd">        The size of the projected edges</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">v_vis</span><span class="p">,</span> <span class="n">v_dist</span><span class="p">,</span> <span class="n">proj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visible_points</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">,</span> <span class="n">return_proj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">edge0</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">vertex0</span>
    <span class="n">edge1</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">vertex1</span>

    <span class="n">diff_side</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">v_vis</span><span class="p">[</span><span class="n">edge0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">v_vis</span><span class="p">[</span><span class="n">edge1</span><span class="p">,</span> <span class="p">:])</span>
    <span class="n">vis</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">diff_side</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">7</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">proj</span><span class="p">[</span><span class="n">edge1</span><span class="p">]</span> <span class="o">-</span> <span class="n">proj</span><span class="p">[</span><span class="n">edge0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">vis</span><span class="p">,</span> <span class="n">size</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Camera.visible_faces" class="doc doc-heading">
            <code class=" language-python"><span class="n">visible_faces</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">back_face_culling</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#npblender.Camera.visible_faces" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Mesh faces visibility</p>
<p>A face is considered invisible if all its points are hidden for the same reason:
all are left to the camera, or right, or behind...</p>
<h5 id="npblender.Camera.visible_faces--arguments">Arguments<a class="headerlink" href="#npblender.Camera.visible_faces--arguments" title="Permanent link">&para;</a></h5>
<p>mesh : Mesh
    The mesh with points and faces
margin : float
    The margin of the camera
back_face_culling : bool
    If True, the back face is not considered as visible</p>
<h5 id="npblender.Camera.visible_faces--returns">Returns<a class="headerlink" href="#npblender.Camera.visible_faces--returns" title="Permanent link">&para;</a></h5>
<p>vis : array (n) of bools
    The visibility of each face
size : array (n) of floats
    The size of the projected faces
proj : array (n, 3) of floats
    The projected position of each face</p>


            <details class="quote">
              <summary>Source code in <code>npblender/camera.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">visible_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">back_face_culling</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Mesh faces visibility</span>

<span class="sd">    A face is considered invisible if all its points are hidden for the same reason:</span>
<span class="sd">    all are left to the camera, or right, or behind...</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    mesh : Mesh</span>
<span class="sd">        The mesh with points and faces</span>
<span class="sd">    margin : float</span>
<span class="sd">        The margin of the camera</span>
<span class="sd">    back_face_culling : bool</span>
<span class="sd">        If True, the back face is not considered as visible</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    vis : array (n) of bools</span>
<span class="sd">        The visibility of each face</span>
<span class="sd">    size : array (n) of floats</span>
<span class="sd">        The size of the projected faces</span>
<span class="sd">    proj : array (n, 3) of floats</span>
<span class="sd">        The projected position of each face</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># ----- Number of faces to analyze</span>

    <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>

    <span class="c1"># ----- Project the points</span>

    <span class="n">v_vis</span><span class="p">,</span> <span class="n">v_dist</span><span class="p">,</span> <span class="n">proj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visible_points</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">,</span> <span class="n">return_proj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># ----- Back face culling : normal centered on the face position</span>

    <span class="k">if</span> <span class="n">back_face_culling</span><span class="p">:</span>
        <span class="n">n_vis</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visible_points</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">,</span> <span class="n">normals</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">normal</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Loop on the faces</span>

    <span class="n">vis_faces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i_face</span><span class="p">,</span> <span class="n">face</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">):</span>

        <span class="c1"># ----- Nothing to do if back face</span>

        <span class="k">if</span> <span class="n">back_face_culling</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">n_vis</span><span class="p">[</span><span class="n">i_face</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">BACK_FACE</span><span class="p">]:</span>
                <span class="k">continue</span>

        <span class="c1"># ----- Visibility of corners : (n, 7)</span>

        <span class="n">index</span> <span class="o">=</span> <span class="n">face</span><span class="o">.</span><span class="n">loop_start</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">face</span><span class="o">.</span><span class="n">loop_total</span>

        <span class="n">c_vis</span> <span class="o">=</span> <span class="n">v_vis</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">index</span> <span class="o">+</span> <span class="n">n</span><span class="p">]]</span>
        <span class="n">diff_side</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">c_vis</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">vis_faces</span><span class="p">[</span><span class="n">i_face</span><span class="p">]</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">diff_side</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">SLICE_END</span><span class="p">])</span>

        <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Camera c_vis</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">c_vis</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Camera diff_side</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">diff_side</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Camera vis_faces</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">vis_faces</span><span class="p">)</span>

        <span class="c1"># ----- Face Size</span>

        <span class="n">f_proj</span> <span class="o">=</span> <span class="n">proj</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">index</span> <span class="o">+</span> <span class="n">n</span><span class="p">]]</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">f_proj</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">f_proj</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">size</span><span class="p">[</span><span class="n">i_face</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">vis_faces</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">proj</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Camera.visible_islands" class="doc doc-heading">
            <code class=" language-python"><span class="n">visible_islands</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">islands</span><span class="p">,</span> <span class="n">attribute</span><span class="o">=</span><span class="s1">&#39;Island&#39;</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span></code>

<a href="#npblender.Camera.visible_islands" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Mesh islands visibility</p>
<p>Islands are defined by an integer.</p>
<p>Visibility is computed with the position and size of the islands</p>
<h5 id="npblender.Camera.visible_islands--arguments">Arguments<a class="headerlink" href="#npblender.Camera.visible_islands--arguments" title="Permanent link">&para;</a></h5>
<p>mesh : Mesh
    The mesh with points and faces
islands: array of ints
    One identifier per island
attribute: attribute name
    The attribute name to use for the islands
margin : float
    The margin of the camera</p>
<h5 id="npblender.Camera.visible_islands--returns">Returns<a class="headerlink" href="#npblender.Camera.visible_islands--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- couple of arrays : array[n, 7] of bools, array[n, 2] of floats
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/camera.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">visible_islands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">islands</span><span class="p">,</span> <span class="n">attribute</span><span class="o">=</span><span class="s2">&quot;Island&quot;</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Mesh islands visibility</span>

<span class="sd">    Islands are defined by an integer.</span>

<span class="sd">    Visibility is computed with the position and size of the islands</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    mesh : Mesh</span>
<span class="sd">        The mesh with points and faces</span>
<span class="sd">    islands: array of ints</span>
<span class="sd">        One identifier per island</span>
<span class="sd">    attribute: attribute name</span>
<span class="sd">        The attribute name to use for the islands</span>
<span class="sd">    margin : float</span>
<span class="sd">        The margin of the camera</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - couple of arrays : array[n, 7] of bools, array[n, 2] of floats</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># ----- Number of islands to analyze</span>

    <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">islands</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Loop on the islands</span>

    <span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">count</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i_island</span><span class="p">,</span> <span class="n">island</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">islands</span><span class="p">):</span>

        <span class="n">sel</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">==</span> <span class="n">island</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span><span class="o">.</span><span class="n">position</span>

        <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">vmin</span> <span class="o">+</span> <span class="n">vmax</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vmax</span> <span class="o">-</span> <span class="n">vmin</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">positions</span><span class="p">[</span><span class="n">i_island</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="n">radius</span><span class="p">[</span><span class="n">i_island</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span>

    <span class="c1"># ----- Let&#39; go</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">visible_points</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Camera.visible_points" class="doc doc-heading">
            <code class=" language-python"><span class="n">visible_points</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">normals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_proj</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#npblender.Camera.visible_points" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute the visibility of vertices.</p>
<p>For each vertex, the following values are computed:
- visible : vertex is visible (all bools below are False)
- behind : vertex is behind the visible rectangle
- left : vertex is left to the visible rectangle
- right : vertex if right to the visible rectangle
- above : vertex is above the visible rectangle
- below : vertex is below the visible rectangle
- back : normal points outards
- distance : distance to the camera
- size : apparent size (based on radius)</p>
<h5 id="npblender.Camera.visible_points--arguments">Arguments<a class="headerlink" href="#npblender.Camera.visible_points--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="n">verts</span><span class="w"> </span><span class="p">(</span><span class="n">array</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">vectors</span><span class="p">)</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="n">vertex</span><span class="w"> </span><span class="n">locations</span>
<span class="o">-</span><span class="w"> </span><span class="k">radius</span><span class="w"> </span><span class="p">(</span><span class="n">array</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">floats</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="o">.</span><span class="p">)</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">locations</span>
<span class="o">-</span><span class="w"> </span><span class="n">margin</span><span class="w"> </span><span class="p">(</span><span class="n">float</span><span class="p">,</span><span class="w"> </span><span class="k">default</span><span class="o">=</span><span class="mi">0</span><span class="o">.</span><span class="p">)</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="n">margin</span><span class="w"> </span><span class="n">factor</span><span class="w"> </span><span class="n">around</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nb">camera</span>
<span class="o">-</span><span class="w"> </span><span class="n">normals</span><span class="w"> </span><span class="p">(</span><span class="n">array</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">vectors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">None</span><span class="p">)</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="k">normal</span><span class="w"> </span><span class="n">pointing</span><span class="w"> </span><span class="n">outwards</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">visible</span>
</code></pre></div>

<h5 id="npblender.Camera.visible_points--returns">Returns<a class="headerlink" href="#npblender.Camera.visible_points--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- couple of arrays : array[n, 7] of bools, array[n, 2] of floats
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/camera.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">visible_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verts</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">normals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_proj</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Compute the visibility of vertices.</span>

<span class="sd">    For each vertex, the following values are computed:</span>
<span class="sd">    - visible : vertex is visible (all bools below are False)</span>
<span class="sd">    - behind : vertex is behind the visible rectangle</span>
<span class="sd">    - left : vertex is left to the visible rectangle</span>
<span class="sd">    - right : vertex if right to the visible rectangle</span>
<span class="sd">    - above : vertex is above the visible rectangle</span>
<span class="sd">    - below : vertex is below the visible rectangle</span>
<span class="sd">    - back : normal points outards</span>
<span class="sd">    - distance : distance to the camera</span>
<span class="sd">    - size : apparent size (based on radius)</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - verts (array of vectors) : vertex locations</span>
<span class="sd">        - radius (array of floats or float = 0.) : size at the locations</span>
<span class="sd">        - margin (float, default=0.) : margin factor around the camera</span>
<span class="sd">        - normals (array of vectors = None) : normal pointing outwards are not visible</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - couple of arrays : array[n, 7] of bools, array[n, 2] of floats</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Resulting arrays</span>

    <span class="c1">#count = np.size(verts)//3</span>
    <span class="c1">#vis  = np.zeros((count, 7), dtype=bool)</span>
    <span class="c1">#dist = np.zeros((count, 2), dtype=float)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Current camera object</span>

    <span class="n">camera</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcamera</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># The projection rectangle</span>
    <span class="c1"># The plane is horizontal. All z&lt;0 are identical</span>
    <span class="c1"># View frame corners are returned in the order:</span>
    <span class="c1"># - top-right</span>
    <span class="c1"># - bottom-right</span>
    <span class="c1"># - bottom-left</span>
    <span class="c1"># - top-left        </span>

    <span class="n">c0</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">view_frame</span><span class="p">(</span><span class="n">scene</span><span class="o">=</span><span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="p">)</span>

    <span class="n">cam_x0</span><span class="p">,</span> <span class="n">cam_y0</span> <span class="o">=</span> <span class="n">c2</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">margin</span><span class="p">,</span> <span class="n">c2</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">margin</span>
    <span class="n">cam_x1</span><span class="p">,</span> <span class="n">cam_y1</span> <span class="o">=</span> <span class="n">c0</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">margin</span><span class="p">,</span> <span class="n">c0</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">margin</span>
    <span class="n">cam_z</span> <span class="o">=</span> <span class="n">c0</span><span class="o">.</span><span class="n">z</span>

    <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;view_frame&quot;</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CAMERA SHAPE: plane z = </span><span class="si">{</span><span class="n">cam_z</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   x: </span><span class="si">{</span><span class="n">cam_x0</span><span class="si">:</span><span class="s2">5.1f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">cam_x1</span><span class="si">:</span><span class="s2">5.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   y: </span><span class="si">{</span><span class="n">cam_y0</span><span class="si">:</span><span class="s2">5.1f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">cam_y1</span><span class="si">:</span><span class="s2">5.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Camera rotation matrix</span>

    <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">matrix_world</span><span class="o">.</span><span class="n">inverted</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Prepare arguments</span>

    <span class="n">count</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span><span class="o">//</span><span class="mi">3</span>
    <span class="n">verts</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">normals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">normals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">normals</span><span class="p">,</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">cam_loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">USE_JIT</span><span class="p">:</span>
        <span class="n">vis</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">pts</span> <span class="o">=</span> <span class="n">camera_projection_jit</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">cam_z</span><span class="p">,</span> <span class="n">cam_x0</span><span class="p">,</span> <span class="n">cam_x1</span><span class="p">,</span> <span class="n">cam_y0</span><span class="p">,</span> <span class="n">cam_y1</span><span class="p">,</span> <span class="n">verts</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">cam_loc</span><span class="p">,</span> <span class="n">normals</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vis</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">pts</span> <span class="o">=</span> <span class="n">camera_projection</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">cam_z</span><span class="p">,</span> <span class="n">cam_x0</span><span class="p">,</span> <span class="n">cam_x1</span><span class="p">,</span> <span class="n">cam_y0</span><span class="p">,</span> <span class="n">cam_y1</span><span class="p">,</span> <span class="n">verts</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">cam_loc</span><span class="p">,</span> <span class="n">normals</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Return visibility and distances</span>

    <span class="k">if</span> <span class="n">return_proj</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">vis</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">pts</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">vis</span><span class="p">,</span> <span class="n">dist</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="npblender.Cloud" class="doc doc-heading">
            <code>Cloud</code>


<a href="#npblender.Cloud" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Geometry (npblender.geometry.Geometry)" href="#npblender.Geometry">Geometry</a></code></p>


        <p>Cloud Geometry class representing a collection of points with various attributes.</p>
<p>This class provides methods to create, manipulate, and transform point clouds, including
loading from and saving to Blender data structures, combining multiple clouds, and generating
point distributions in various shapes (line, arc, circle, rectangle, pie, disk, cylinder, sphere,
dome, cube, ball).</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="npblender.Cloud.points">points</span></code></td>
            <td>
                  <code><span title="npblender.domain.Point">Point</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The vertices of the cloud with associated attributes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="from_geometry(other, selection=None)

  
      classmethod
   (npblender.Cloud.from_geometry)" href="#npblender.Cloud.from_geometry">from_geometry</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Create a Cloud from another geometry with points.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="npblender.Cloud.from_cloud">from_cloud</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Synonym for from_geometry.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="capture(other) (npblender.Cloud.capture)" href="#npblender.Cloud.capture">capture</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Capture data from another Cloud instance.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="from_data(data)

  
      classmethod
   (npblender.Cloud.from_data)" href="#npblender.Cloud.from_data">from_data</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Initialize from Blender Mesh or PointCloud data.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="to_data(data) (npblender.Cloud.to_data)" href="#npblender.Cloud.to_data">to_data</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Write the cloud geometry into a Blender Mesh.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="from_object(obj, evaluated=False)

  
      classmethod
   (npblender.Cloud.from_object)" href="#npblender.Cloud.from_object">from_object</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Create a Cloud from a Blender object.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="to_object(obj, point_cloud=False, collection=None) (npblender.Cloud.to_object)" href="#npblender.Cloud.to_object">to_object</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Create or update a Blender object with the cloud data.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="npblender.Cloud.object">object</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Context manager for temporary Blender object editing.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="join(*others) (npblender.Cloud.join)" href="#npblender.Cloud.join">join</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Join other Clouds into this one.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="npblender.Cloud.transform, translate, scale">transform, translate, scale</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Geometric transformations.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="npblender.Cloud.Various distribution methods">Various distribution methods</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>line_dist, arc_dist, circle_dist, rect_dist, pie_dist, disk_dist,
cylinder_dist, sphere_dist, dome_dist, cube_dist, ball_dist for generating points in shapes.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>npblender/cloud.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Cloud</span><span class="p">(</span><span class="n">Geometry</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cloud Geometry class representing a collection of points with various attributes.</span>

<span class="sd">    This class provides methods to create, manipulate, and transform point clouds, including</span>
<span class="sd">    loading from and saving to Blender data structures, combining multiple clouds, and generating</span>
<span class="sd">    point distributions in various shapes (line, arc, circle, rectangle, pie, disk, cylinder, sphere,</span>
<span class="sd">    dome, cube, ball).</span>

<span class="sd">    Attributes:</span>
<span class="sd">        points (Point): The vertices of the cloud with associated attributes.</span>

<span class="sd">    Methods:</span>
<span class="sd">        from_geometry: Create a Cloud from another geometry with points.</span>
<span class="sd">        from_cloud: Synonym for from_geometry.</span>
<span class="sd">        capture: Capture data from another Cloud instance.</span>
<span class="sd">        from_data: Initialize from Blender Mesh or PointCloud data.</span>
<span class="sd">        to_data: Write the cloud geometry into a Blender Mesh.</span>
<span class="sd">        from_object: Create a Cloud from a Blender object.</span>
<span class="sd">        to_object: Create or update a Blender object with the cloud data.</span>
<span class="sd">        object: Context manager for temporary Blender object editing.</span>
<span class="sd">        join: Join other Clouds into this one.</span>
<span class="sd">        transform, translate, scale: Geometric transformations.</span>
<span class="sd">        Various distribution methods: line_dist, arc_dist, circle_dist, rect_dist, pie_dist, disk_dist,</span>
<span class="sd">            cylinder_dist, sphere_dist, dome_dist, cube_dist, ball_dist for generating points in shapes.</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attr_from</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Cloud Geometry.</span>

<span class="sd">        Initialize a Cloud geometry object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        points : array-like of vectors, optional</span>
<span class="sd">            The vertices of the cloud geometry. Default is None.</span>
<span class="sd">        attr_from : optional</span>
<span class="sd">            An optional source from which to join attributes.</span>
<span class="sd">        **attrs : dict</span>
<span class="sd">            Additional geometry attributes to be added.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - Initializes an empty geometry with a Point container.</span>
<span class="sd">        - Joins attributes from `attr_from` if provided.</span>
<span class="sd">        - Appends given points and attributes to the geometry.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">Point</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">join_attributes</span><span class="p">(</span><span class="n">attr_from</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">points</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Dump</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;Mesh: points </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span><span class="si">}</span><span class="s2">, corners </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">)</span><span class="si">}</span><span class="s2">, faces </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span><span class="si">}</span><span class="s2">, edges </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span><span class="si">}</span><span class="s2">&gt;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;Mesh:</span><span class="se">\n</span><span class="s2">   &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">)])</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Serialization</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="s1">&#39;Cloud&#39;</span><span class="p">,</span>
            <span class="s1">&#39;points&#39;</span><span class="p">:</span>    <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
            <span class="p">}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="n">cloud</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">Point</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">cloud</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Clear the geometry</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clear_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Clear the geometry.</span>

<span class="sd">        Delete all the content.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># From another geometry with points</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Copy</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_geometry</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">selection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a Cloud from another gemetry with points domain.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - other (Geometry) : the geometry to copy</span>
<span class="sd">            - selection (selection) : a valid selection on points</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - Cloud</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">points</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;points&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;from_geometry&gt; </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="si">}</span><span class="s2"> has no points.&quot;</span><span class="p">)</span>

        <span class="n">cloud</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">points</span><span class="p">,</span>  <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;COPY&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">selection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">points_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
            <span class="n">points_mask</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">points_mask</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cloud</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Synonym</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_cloud</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">selection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_geometry</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">selection</span><span class="p">)</span>


    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Capture another Mesh</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">capture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Capture the data of another Mesh.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - other (Cloud) : the mesh to capture</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - self</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span>  <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">points</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Blender Interface</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># From Mesh data</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_data</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Initialize the geometry from a Blender data (Mesh or PointCloud)</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - data (Blender Mesh or PointCloud) : the data to load</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">import</span><span class="w"> </span><span class="nn">bpy</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">blender</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">cloud</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Mesh</span><span class="p">):</span>

            <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">vertices</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

            <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">from_bl_attributes</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">):</span>

            <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

            <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">from_bl_attributes</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cloud.from_data&gt; data type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">date</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> not supported yet&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cloud</span>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>
    <span class="c1"># To data</span>
    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Write the geometry into a Blender Mesh</span>

<span class="sd">        &gt; [!CAUTION]:</span>
<span class="sd">        &gt; to_data creates a blender Mesh, not PointCloud since the pyton API doesn&#39;t allow to dynamically</span>
<span class="sd">        &gt; change the number of points</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - mesh (Blender Mesh instance) : the mesh to write</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">blender</span>

        <span class="n">bl_mesh</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">bl_mesh</span><span class="o">.</span><span class="n">clear_geometry</span><span class="p">()</span>

        <span class="n">bl_mesh</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Vertices</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">):</span>
            <span class="n">bl_mesh</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">))</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Attributes</span>

        <span class="n">attributes</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">attributes</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">to_bl_attributes</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Update</span>

        <span class="n">bl_mesh</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Initialize from an object</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_object</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">evaluated</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a Mesh from an existing object.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - obj (str or Blender object) : the object to initialize from</span>
<span class="sd">            - evaluated (bool = False) : object modified by the modifiers if True, raw vertices otherwise</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - Mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">blender</span>

        <span class="k">if</span> <span class="n">evaluated</span><span class="p">:</span>
            <span class="n">depsgraph</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluated_depsgraph_get</span><span class="p">()</span>
            <span class="n">object_eval</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">evaluated_get</span><span class="p">(</span><span class="n">depsgraph</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_data</span><span class="p">(</span><span class="n">object_eval</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_data</span><span class="p">(</span><span class="n">blender</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># To blender object</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">point_cloud</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create or update a blender object.</span>

<span class="sd">        By default, a mesh object is created. If as_point_cloud is True, the object is the converted</span>
<span class="sd">        to a PointCloud object.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - obj (str or Blender object) : the object the create</span>
<span class="sd">            - point_cloud (bool = False) : the object is a PointCloud object if True</span>
<span class="sd">            - collection (str or Blender collection) : the collection to add the object to</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - Blender Mesh or PointCloud object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">blender</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">create_mesh_object</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">halt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_data</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">point_cloud</span><span class="p">:</span>
            <span class="n">blender</span><span class="o">.</span><span class="n">mesh_to_point_cloud</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">obj</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Object edition</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="nd">@contextmanager</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">as_point_cloud</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="n">temp_name</span> <span class="o">=</span> <span class="n">index</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;BPBL Temp Mesh </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">ctx</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span>

        <span class="n">old_sel</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">select_get</span><span class="p">()]</span>
        <span class="n">old_active</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">active</span>
        <span class="k">if</span> <span class="n">old_active</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">old_active_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">old_active_name</span> <span class="o">=</span> <span class="n">old_active</span><span class="o">.</span><span class="n">name</span>

        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">select_all</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;DESELECT&#39;</span><span class="p">)</span>        

        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_object</span><span class="p">(</span><span class="n">temp_name</span><span class="p">,</span> <span class="n">as_point_cloud</span><span class="o">=</span><span class="n">as_point_cloud</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">select_set</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">obj</span>        

        <span class="k">yield</span> <span class="n">obj</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">readonly</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="n">Mesh</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>

        <span class="n">blender</span><span class="o">.</span><span class="n">delete_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">select_all</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;DESELECT&#39;</span><span class="p">)</span>        
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">old_sel</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">select_set</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">old_active_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">old_active_name</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Combining</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Join other clouds</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">others</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Join other clouds.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - other (Mesh) : the Meshes to append</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">others</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># =============================================================================================================================</span>
    <span class="c1"># Transformation</span>
    <span class="c1"># =============================================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transfo</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">transfo</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">translation</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span> <span class="o">+=</span> <span class="n">translation</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">pivot</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">pivot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span> <span class="o">-=</span> <span class="n">pivot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span> <span class="o">*=</span> <span class="n">scale</span>
        <span class="k">if</span> <span class="n">pivot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span> <span class="o">+=</span> <span class="n">pivot</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Distributions</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">line_dist</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">point0</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">point1</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">count</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">cloud</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">new_vector</span><span class="p">(</span><span class="s1">&#39;tangent&#39;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">distribs</span><span class="o">.</span><span class="n">line_dist</span><span class="p">(</span><span class="n">point0</span><span class="p">,</span> <span class="n">point1</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">],</span> <span class="n">tangent</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;tangents&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">cloud</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">arc_dist</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">arc_center</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">arc_angle</span><span class="o">=</span><span class="n">PI</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">use_vonmises</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">count</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">cloud</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">new_vector</span><span class="p">(</span><span class="s1">&#39;tangent&#39;</span><span class="p">)</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">new_float</span><span class="p">(</span><span class="s1">&#39;angle&#39;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">distribs</span><span class="o">.</span><span class="n">arc_dist</span><span class="p">(</span>
            <span class="n">radius</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">arc_center</span><span class="p">,</span> <span class="n">arc_angle</span><span class="p">,</span> <span class="n">use_vonmises</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">seed</span>
        <span class="p">)</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">],</span> <span class="n">tangent</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;tangents&#39;</span><span class="p">],</span> <span class="n">angle</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;angles&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">cloud</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">circle_dist</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">count</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">cloud</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">new_vector</span><span class="p">(</span><span class="s1">&#39;tangent&#39;</span><span class="p">)</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">new_float</span><span class="p">(</span><span class="s1">&#39;angle&#39;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">distribs</span><span class="o">.</span><span class="n">circle_dist</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">],</span> <span class="n">tangent</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;tangents&#39;</span><span class="p">],</span> <span class="n">angle</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;angles&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">cloud</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rect_dist</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">count</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">cloud</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">distribs</span><span class="o">.</span><span class="n">rect_dist</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">cloud</span>


    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">pie_dist</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">outer_radius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">pie_center</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
        <span class="n">pie_angle</span><span class="o">=</span><span class="n">PI</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">use_vonmises</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">count</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="n">cloud</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">new_vector</span><span class="p">(</span><span class="s1">&#39;tangent&#39;</span><span class="p">)</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">new_float</span><span class="p">(</span><span class="s1">&#39;angle&#39;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">distribs</span><span class="o">.</span><span class="n">pie_dist</span><span class="p">(</span>
            <span class="n">radius</span><span class="p">,</span> <span class="n">outer_radius</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">pie_center</span><span class="p">,</span> <span class="n">pie_angle</span><span class="p">,</span> <span class="n">use_vonmises</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">seed</span>
        <span class="p">)</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">],</span> <span class="n">tangent</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;tangents&#39;</span><span class="p">],</span> <span class="n">angle</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;angles&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">cloud</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">disk_dist</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">outer_radius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">count</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">cloud</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">new_vector</span><span class="p">(</span><span class="s1">&#39;tangent&#39;</span><span class="p">)</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">new_float</span><span class="p">(</span><span class="s1">&#39;angle&#39;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">distribs</span><span class="o">.</span><span class="n">disk_dist</span><span class="p">(</span>
            <span class="n">radius</span><span class="p">,</span> <span class="n">outer_radius</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">seed</span>
        <span class="p">)</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">],</span> <span class="n">tangent</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;tangents&#39;</span><span class="p">],</span> <span class="n">angle</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;angles&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">cloud</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cylinder_dist</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">arc_center</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">arc_angle</span><span class="o">=</span><span class="n">TAU</span><span class="p">,</span>
        <span class="n">use_vonmises</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">count</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">cloud</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">new_vector</span><span class="p">(</span><span class="s1">&#39;normal&#39;</span><span class="p">)</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">new_vector</span><span class="p">(</span><span class="s1">&#39;tangent&#39;</span><span class="p">)</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">new_float</span><span class="p">(</span><span class="s1">&#39;angle&#39;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">distribs</span><span class="o">.</span><span class="n">cylinder_dist</span><span class="p">(</span>
            <span class="n">radius</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">arc_center</span><span class="p">,</span> <span class="n">arc_angle</span><span class="p">,</span> <span class="n">use_vonmises</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">seed</span>
        <span class="p">)</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">],</span> <span class="n">normal</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;normals&#39;</span><span class="p">],</span> <span class="n">tangent</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;tangents&#39;</span><span class="p">],</span> <span class="n">angle</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;angles&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">cloud</span>


    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sphere_dist</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">count</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="n">cloud</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">new_vector</span><span class="p">(</span><span class="s1">&#39;normal&#39;</span><span class="p">)</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">new_float</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">)</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">new_float</span><span class="p">(</span><span class="s1">&#39;phi&#39;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">distribs</span><span class="o">.</span><span class="n">sphere_dist</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">],</span> <span class="n">normal</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;normals&#39;</span><span class="p">],</span> <span class="n">theta</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;thetas&#39;</span><span class="p">],</span> <span class="n">phi</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;phis&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">cloud</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">dome_dist</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">angle</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">use_vonmises</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">count</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="n">cloud</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">new_vector</span><span class="p">(</span><span class="s1">&#39;normal&#39;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">distribs</span><span class="o">.</span><span class="n">dome_dist</span><span class="p">(</span>
            <span class="n">radius</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">use_vonmises</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">seed</span>
        <span class="p">)</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">],</span> <span class="n">normal</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;normals&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">cloud</span>


    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cube_dist</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">count</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">distribs</span><span class="o">.</span><span class="n">cube_dist</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">seed</span><span class="p">)[</span><span class="s1">&#39;points&#39;</span><span class="p">])</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ball_dist</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">angle</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
        <span class="n">use_vonmises</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">count</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="n">cloud</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">new_vector</span><span class="p">(</span><span class="s1">&#39;normal&#39;</span><span class="p">)</span>        
        <span class="n">d</span> <span class="o">=</span> <span class="n">distribs</span><span class="o">.</span><span class="n">ball_dist</span><span class="p">(</span>
            <span class="n">radius</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">use_vonmises</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">],</span> <span class="n">normal</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;normals&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">cloud</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Tests</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_test_distribs</span><span class="p">():</span>

        <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">cloud</span> <span class="o">=</span> <span class="n">Cloud</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dist_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span>
            <span class="s2">&quot;line_dist&quot;</span><span class="p">,</span> <span class="s2">&quot;arc_dist&quot;</span><span class="p">,</span> <span class="s2">&quot;circle_dist&quot;</span><span class="p">,</span> <span class="s2">&quot;rect_dist&quot;</span><span class="p">,</span> <span class="s2">&quot;pie_dist&quot;</span><span class="p">,</span> <span class="s2">&quot;disk_dist&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;cylinder_dist&quot;</span><span class="p">,</span> <span class="s2">&quot;sphere_dist&quot;</span><span class="p">,</span> <span class="s2">&quot;dome_dist&quot;</span><span class="p">,</span> <span class="s2">&quot;cube_dist&quot;</span><span class="p">,</span> <span class="s2">&quot;ball_dist&quot;</span><span class="p">]):</span>

            <span class="n">f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">Cloud</span><span class="p">,</span> <span class="n">dist_name</span><span class="p">)</span>
            <span class="n">cl</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">density</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
            <span class="n">cl</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">i</span><span class="o">*</span><span class="mi">3</span>
            <span class="n">cloud</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>

        <span class="n">cloud</span><span class="o">.</span><span class="n">to_object</span><span class="p">(</span><span class="s2">&quot;Distributions&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="npblender.Cloud.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attr_from</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span></code>

<a href="#npblender.Cloud.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Cloud Geometry.</p>
<p>Initialize a Cloud geometry object.</p>
<h5 id="npblender.Cloud.__init__--parameters">Parameters<a class="headerlink" href="#npblender.Cloud.__init__--parameters" title="Permanent link">&para;</a></h5>
<p>points : array-like of vectors, optional
    The vertices of the cloud geometry. Default is None.
attr_from : optional
    An optional source from which to join attributes.
**attrs : dict
    Additional geometry attributes to be added.</p>
<h5 id="npblender.Cloud.__init__--notes">Notes<a class="headerlink" href="#npblender.Cloud.__init__--notes" title="Permanent link">&para;</a></h5>
<ul>
<li>Initializes an empty geometry with a Point container.</li>
<li>Joins attributes from <code>attr_from</code> if provided.</li>
<li>Appends given points and attributes to the geometry.</li>
</ul>


            <details class="quote">
              <summary>Source code in <code>npblender/cloud.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attr_from</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Cloud Geometry.</span>

<span class="sd">    Initialize a Cloud geometry object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    points : array-like of vectors, optional</span>
<span class="sd">        The vertices of the cloud geometry. Default is None.</span>
<span class="sd">    attr_from : optional</span>
<span class="sd">        An optional source from which to join attributes.</span>
<span class="sd">    **attrs : dict</span>
<span class="sd">        Additional geometry attributes to be added.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Initializes an empty geometry with a Point container.</span>
<span class="sd">    - Joins attributes from `attr_from` if provided.</span>
<span class="sd">    - Appends given points and attributes to the geometry.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">Point</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">join_attributes</span><span class="p">(</span><span class="n">attr_from</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">points</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Cloud.capture" class="doc doc-heading">
            <code class=" language-python"><span class="n">capture</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></code>

<a href="#npblender.Cloud.capture" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Capture the data of another Mesh.</p>
<h5 id="npblender.Cloud.capture--arguments">Arguments<a class="headerlink" href="#npblender.Cloud.capture--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- other (Cloud) : the mesh to capture
</code></pre></div>

<h5 id="npblender.Cloud.capture--returns">Returns<a class="headerlink" href="#npblender.Cloud.capture--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- self
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/cloud.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">capture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Capture the data of another Mesh.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - other (Cloud) : the mesh to capture</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - self</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">points</span>  <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">points</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Cloud.clear_geometry" class="doc doc-heading">
            <code class=" language-python"><span class="n">clear_geometry</span><span class="p">()</span></code>

<a href="#npblender.Cloud.clear_geometry" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Clear the geometry.</p>
<p>Delete all the content.</p>


            <details class="quote">
              <summary>Source code in <code>npblender/cloud.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">clear_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Clear the geometry.</span>

<span class="sd">    Delete all the content.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Cloud.from_data" class="doc doc-heading">
            <code class=" language-python"><span class="n">from_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#npblender.Cloud.from_data" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize the geometry from a Blender data (Mesh or PointCloud)</p>
<h5 id="npblender.Cloud.from_data--arguments">Arguments<a class="headerlink" href="#npblender.Cloud.from_data--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="p">(</span><span class="n">Blender</span><span class="w"> </span><span class="n">Mesh</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">PointCloud</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="nb">load</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/cloud.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_data</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Initialize the geometry from a Blender data (Mesh or PointCloud)</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - data (Blender Mesh or PointCloud) : the data to load</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span><span class="w"> </span><span class="nn">bpy</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">blender</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">cloud</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Mesh</span><span class="p">):</span>

        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">vertices</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">from_bl_attributes</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">):</span>

        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">from_bl_attributes</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cloud.from_data&gt; data type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">date</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> not supported yet&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cloud</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Cloud.from_geometry" class="doc doc-heading">
            <code class=" language-python"><span class="n">from_geometry</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">selection</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#npblender.Cloud.from_geometry" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a Cloud from another gemetry with points domain.</p>
<h5 id="npblender.Cloud.from_geometry--arguments">Arguments<a class="headerlink" href="#npblender.Cloud.from_geometry--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- other (Geometry) : the geometry to copy
- selection (selection) : a valid selection on points
</code></pre></div>

<h5 id="npblender.Cloud.from_geometry--returns">Returns<a class="headerlink" href="#npblender.Cloud.from_geometry--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- Cloud
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/cloud.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_geometry</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">selection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create a Cloud from another gemetry with points domain.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - other (Geometry) : the geometry to copy</span>
<span class="sd">        - selection (selection) : a valid selection on points</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - Cloud</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">points</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;points&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;from_geometry&gt; </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="si">}</span><span class="s2"> has no points.&quot;</span><span class="p">)</span>

    <span class="n">cloud</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
    <span class="n">cloud</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">points</span><span class="p">,</span>  <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;COPY&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">selection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">points_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">points_mask</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">points_mask</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cloud</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Cloud.from_object" class="doc doc-heading">
            <code class=" language-python"><span class="n">from_object</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">evaluated</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#npblender.Cloud.from_object" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a Mesh from an existing object.</p>
<h5 id="npblender.Cloud.from_object--arguments">Arguments<a class="headerlink" href="#npblender.Cloud.from_object--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="nv">obj</span><span class="w"> </span><span class="ss">(</span><span class="nv">str</span><span class="w"> </span><span class="nv">or</span><span class="w"> </span><span class="nv">Blender</span><span class="w"> </span><span class="nv">object</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">object</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">initialize</span><span class="w"> </span><span class="nv">from</span>
<span class="o">-</span><span class="w"> </span><span class="nv">evaluated</span><span class="w"> </span><span class="ss">(</span><span class="nv">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">False</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">object</span><span class="w"> </span><span class="nv">modified</span><span class="w"> </span><span class="nv">by</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">modifiers</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">True</span>,<span class="w"> </span><span class="nv">raw</span><span class="w"> </span><span class="nv">vertices</span><span class="w"> </span><span class="nv">otherwise</span>
</code></pre></div>

<h5 id="npblender.Cloud.from_object--returns">Returns<a class="headerlink" href="#npblender.Cloud.from_object--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- Mesh
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/cloud.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_object</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">evaluated</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create a Mesh from an existing object.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - obj (str or Blender object) : the object to initialize from</span>
<span class="sd">        - evaluated (bool = False) : object modified by the modifiers if True, raw vertices otherwise</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - Mesh</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">blender</span>

    <span class="k">if</span> <span class="n">evaluated</span><span class="p">:</span>
        <span class="n">depsgraph</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluated_depsgraph_get</span><span class="p">()</span>
        <span class="n">object_eval</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">evaluated_get</span><span class="p">(</span><span class="n">depsgraph</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_data</span><span class="p">(</span><span class="n">object_eval</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_data</span><span class="p">(</span><span class="n">blender</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Cloud.join" class="doc doc-heading">
            <code class=" language-python"><span class="n">join</span><span class="p">(</span><span class="o">*</span><span class="n">others</span><span class="p">)</span></code>

<a href="#npblender.Cloud.join" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Join other clouds.</p>
<h5 id="npblender.Cloud.join--arguments">Arguments<a class="headerlink" href="#npblender.Cloud.join--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- other (Mesh) : the Meshes to append
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/cloud.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">others</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Join other clouds.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - other (Mesh) : the Meshes to append</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">others</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Cloud.to_data" class="doc doc-heading">
            <code class=" language-python"><span class="n">to_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

<a href="#npblender.Cloud.to_data" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Write the geometry into a Blender Mesh</p>
<blockquote>
<p>[!CAUTION]:
to_data creates a blender Mesh, not PointCloud since the pyton API doesn't allow to dynamically
change the number of points</p>
</blockquote>
<h5 id="npblender.Cloud.to_data--arguments">Arguments<a class="headerlink" href="#npblender.Cloud.to_data--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- mesh (Blender Mesh instance) : the mesh to write
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/cloud.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Write the geometry into a Blender Mesh</span>

<span class="sd">    &gt; [!CAUTION]:</span>
<span class="sd">    &gt; to_data creates a blender Mesh, not PointCloud since the pyton API doesn&#39;t allow to dynamically</span>
<span class="sd">    &gt; change the number of points</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - mesh (Blender Mesh instance) : the mesh to write</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">blender</span>

    <span class="n">bl_mesh</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">bl_mesh</span><span class="o">.</span><span class="n">clear_geometry</span><span class="p">()</span>

    <span class="n">bl_mesh</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Vertices</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">):</span>
        <span class="n">bl_mesh</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">))</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Attributes</span>

    <span class="n">attributes</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">attributes</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">to_bl_attributes</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Update</span>

    <span class="n">bl_mesh</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Cloud.to_object" class="doc doc-heading">
            <code class=" language-python"><span class="n">to_object</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">point_cloud</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#npblender.Cloud.to_object" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create or update a blender object.</p>
<p>By default, a mesh object is created. If as_point_cloud is True, the object is the converted
to a PointCloud object.</p>
<h5 id="npblender.Cloud.to_object--arguments">Arguments<a class="headerlink" href="#npblender.Cloud.to_object--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="k">-</span> obj (str or Blender object) : the object the create
<span class="k">-</span> point_cloud (bool = False) : the object is a PointCloud object if True
<span class="k">-</span> collection (str or Blender collection) : the collection to add the object to
</code></pre></div>

<h5 id="npblender.Cloud.to_object--returns">Returns<a class="headerlink" href="#npblender.Cloud.to_object--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- Blender Mesh or PointCloud object
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/cloud.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">point_cloud</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create or update a blender object.</span>

<span class="sd">    By default, a mesh object is created. If as_point_cloud is True, the object is the converted</span>
<span class="sd">    to a PointCloud object.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - obj (str or Blender object) : the object the create</span>
<span class="sd">        - point_cloud (bool = False) : the object is a PointCloud object if True</span>
<span class="sd">        - collection (str or Blender collection) : the collection to add the object to</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - Blender Mesh or PointCloud object</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">blender</span>

    <span class="n">obj</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">create_mesh_object</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">halt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">to_data</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">point_cloud</span><span class="p">:</span>
        <span class="n">blender</span><span class="o">.</span><span class="n">mesh_to_point_cloud</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">obj</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="npblender.Corner" class="doc doc-heading">
            <code>Corner</code>


<a href="#npblender.Corner" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="npblender.domain.Domain">Domain</span></code></p>


        <p>Corner domain stores a vertex index for face descriptions.</p>
<p>This domain is specific to Mesh geometry.
It keeps a pointer to the Mesh POINT domain.</p>
<h4 id="npblender.Corner--attributes">Attributes<a class="headerlink" href="#npblender.Corner--attributes" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="k">-</span> vertex_index (int) : vertex index in the points array
<span class="k">-</span> UVMap (float2, optional) : UV Map coordinates
</code></pre></div>








              <details class="quote">
                <summary>Source code in <code>npblender/domain.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Corner</span><span class="p">(</span><span class="n">Domain</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Corner domain stores a vertex index for face descriptions.</span>

<span class="sd">    This domain is specific to Mesh geometry.</span>
<span class="sd">    It keeps a pointer to the Mesh POINT domain.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">        - vertex_index (int) : vertex index in the points array</span>
<span class="sd">        - UVMap (float2, optional) : UV Map coordinates</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">domain_name</span> <span class="o">=</span> <span class="s1">&#39;CORNER&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">declare_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_int</span><span class="p">(</span><span class="s1">&#39;vertex_index&#39;</span><span class="p">,</span> <span class="n">transfer</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">transdom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_vector2</span><span class="p">(</span><span class="s1">&#39;UVMap&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transfer</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transdom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Check</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">halt</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">count</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Corner check fail: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">)</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">count</span><span class="si">=}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">halt</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Methods</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">new_uvmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_vector2</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Compute attribute on points</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_attribute_on_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>

        <span class="nd">@njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">_to_points</span><span class="p">(</span><span class="n">vertex_index</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span>
            <span class="n">npoints</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ncorners</span> <span class="o">=</span> <span class="n">vertex_index</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npoints</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">icorner</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncorners</span><span class="p">):</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="n">icorner</span><span class="p">]</span>

                <span class="n">ipoint</span> <span class="o">=</span> <span class="n">vertex_index</span><span class="p">[</span><span class="n">icorner</span><span class="p">]</span>
                <span class="n">res</span><span class="p">[</span><span class="n">ipoint</span><span class="p">]</span> <span class="o">+=</span> <span class="n">s</span>
                <span class="n">count</span><span class="p">[</span><span class="n">ipoint</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">trailing</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">ndim</span><span class="p">):</span>
                <span class="n">trailing</span> <span class="o">*=</span> <span class="n">res</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>

            <span class="n">R2</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">npoints</span><span class="p">,</span> <span class="n">trailing</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">ipoint</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npoints</span><span class="p">):</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">count</span><span class="p">[</span><span class="n">ipoint</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">inv</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">c</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trailing</span><span class="p">):</span>
                        <span class="n">R2</span><span class="p">[</span><span class="n">ipoint</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*=</span> <span class="n">inv</span>

            <span class="k">return</span> <span class="n">res</span>  

        <span class="n">attr</span><span class="p">,</span> <span class="n">item_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_attribute_to_compute</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">),)</span> <span class="o">+</span> <span class="n">item_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">attr</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_to_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>                
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="npblender.Curve" class="doc doc-heading">
            <code>Curve</code>


<a href="#npblender.Curve" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Geometry (npblender.geometry.Geometry)" href="#npblender.Geometry">Geometry</a></code></p>









              <details class="quote">
                <summary>Source code in <code>npblender/curve.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Curve</span><span class="p">(</span><span class="n">Geometry</span><span class="p">):</span>

    <span class="n">domain_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">,</span> <span class="s2">&quot;splines&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">curve_type</span><span class="o">=</span><span class="n">POLY</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attr_from</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Curve Geometry.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - points (array of vectors = None) : the vertices</span>
<span class="sd">            - splines (array of ints = None) : sizes</span>
<span class="sd">            - curve_type (array onf ints) : curve types</span>
<span class="sd">            - materials (str or list of strs = None) : list of materials used in the geometry</span>
<span class="sd">            - **attrs (dict) : other geometry attributes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># ----- The materials</span>
        <span class="k">if</span> <span class="n">materials</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">materials</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">materials</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">materials</span> <span class="o">=</span> <span class="p">[</span><span class="n">materials</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">materials</span> <span class="o">=</span> <span class="p">[</span><span class="n">mat</span> <span class="k">for</span> <span class="n">mat</span> <span class="ow">in</span> <span class="n">materials</span><span class="p">]</span>

        <span class="c1"># ----- The two domains are already built</span>
        <span class="c1"># can be a view on a larger curve</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">ControlPoint</span><span class="p">)</span> <span class="ow">and</span>
             <span class="n">splines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">splines</span><span class="p">,</span> <span class="n">Spline</span><span class="p">)</span> <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">points</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">splines</span> <span class="o">=</span> <span class="n">splines</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_view</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">loop_total</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">is_view</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># ----- Initialize empty domains</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">points</span>  <span class="o">=</span> <span class="n">ControlPoint</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splines</span> <span class="o">=</span> <span class="n">Spline</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">join_attributes</span><span class="p">(</span><span class="n">attr_from</span><span class="p">)</span>

        <span class="c1"># ----- Add geometry</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_splines</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">splines</span><span class="p">,</span> <span class="n">curve_type</span><span class="o">=</span><span class="n">curve_type</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Utilities</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_points_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Get selection on points associated to the splines.</span>

<span class="sd">        If the Curve is not a view on splines, if return [:], otherwise</span>
<span class="sd">        it returns a selection on the points.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - sel (slice) : indices of splines points</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_view</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="n">all_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">))</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

        <span class="n">totals</span><span class="p">,</span> <span class="n">rev_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">loop_total</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">total</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">totals</span><span class="p">):</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">loop_total</span><span class="p">[</span><span class="n">rev_index</span> <span class="o">==</span> <span class="n">index</span><span class="p">][</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">total</span><span class="p">)</span>
            <span class="n">sel</span><span class="p">[</span><span class="n">indices</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">sel</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">no_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Materialize a view-curve into a standalone curve (deep copy of splines and points),</span>
<span class="sd">        preserving all point-domain fields (handles, custom attrs, ...).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_view</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

        <span class="c1"># 1) Copy splines domain (owning copy)</span>
        <span class="n">splines</span> <span class="o">=</span> <span class="n">Spline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;COPY&#39;</span><span class="p">)</span>

        <span class="c1"># 2) Build a single flat index of point rows, bucketed by loop_total (N)</span>
        <span class="n">lt</span> <span class="o">=</span> <span class="n">splines</span><span class="o">.</span><span class="n">loop_total</span>
        <span class="n">ls</span> <span class="o">=</span> <span class="n">splines</span><span class="o">.</span><span class="n">loop_start</span>

        <span class="n">uniq_N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">lt</span><span class="p">)</span>
        <span class="n">idx_blocks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">N</span> <span class="ow">in</span> <span class="n">uniq_N</span><span class="p">:</span>
            <span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">N</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">sel</span> <span class="o">=</span> <span class="p">(</span><span class="n">lt</span> <span class="o">==</span> <span class="n">N</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">sel</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">starts</span> <span class="o">=</span> <span class="n">ls</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span>                                   <span class="c1"># (B,)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">starts</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>  <span class="c1"># (B, N)</span>
            <span class="n">idx_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>                 <span class="c1"># (B*N,)</span>

        <span class="k">if</span> <span class="n">idx_blocks</span><span class="p">:</span>
            <span class="n">idx_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">idx_blocks</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># 3) Slice the point FieldArray to keep all fields aligned</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">ControlPoint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;COPY&#39;</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="n">idx_all</span><span class="p">)</span>  <span class="c1"># owning copy</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">ControlPoint</span><span class="p">()</span>                       <span class="c1"># empty</span>

        <span class="c1"># 4) Assign back and normalize bookkeeping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">points</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splines</span> <span class="o">=</span> <span class="n">splines</span><span class="o">.</span><span class="n">update_loop_start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_view</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Mesh Check&quot;</span><span class="p">,</span> <span class="n">halt</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">halt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">halt</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2"> check failed&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2"> check failed&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">scount</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">)</span><span class="si">}</span><span class="s2"> spline</span><span class="si">{</span><span class="s1">&#39;s&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">sview</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;view </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">loop_total</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_view</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;Curve: </span><span class="si">{</span><span class="n">scount</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">sview</span><span class="si">}</span><span class="s2"> points.&gt;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">max_n</span> <span class="o">=</span> <span class="mi">10</span>

        <span class="n">scount</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">)</span><span class="si">}</span><span class="s2"> spline</span><span class="si">{</span><span class="s1">&#39;s&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">sview</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;view </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">loop_total</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_view</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">s</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&lt;Curve: </span><span class="si">{</span><span class="n">scount</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">sview</span><span class="si">}</span><span class="s2"> points:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">is_scalar</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;BEZIER&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">curve_type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;POLY  &#39;</span><span class="si">}</span><span class="s2">, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Cyclic&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">cyclic</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Open  &#39;</span><span class="si">}</span><span class="s2">, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">loop_total</span><span class="si">:</span><span class="s2">3d</span><span class="si">}</span><span class="s2"> points, &quot;</span>
                <span class="s2">&quot;f[</span><span class="si">{self.splines.loop_start:3d}</span><span class="s2">:]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">max_n</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">))):</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="s1">&#39;BEZIER&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">curve_type</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;POLY  &#39;</span><span class="si">}</span><span class="s2">, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Cyclic&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">cyclic</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Open  &#39;</span><span class="si">}</span><span class="s2">, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">loop_total</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">3d</span><span class="si">}</span><span class="s2"> points, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">loop_start</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">3d</span><span class="si">}</span><span class="s2">:]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_n</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot; ...&quot;</span>
        <span class="k">return</span> <span class="n">s</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span>


    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Serialization</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;geometry&#39;</span><span class="p">:</span>     <span class="s1">&#39;Curve&#39;</span><span class="p">,</span>
            <span class="s1">&#39;materials&#39;</span> <span class="p">:</span>   <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">,</span>
            <span class="s1">&#39;points&#39;</span><span class="p">:</span>       <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
            <span class="s1">&#39;splines&#39;</span><span class="p">:</span>      <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
            <span class="p">}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="n">curve</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">curve</span><span class="o">.</span><span class="n">materials</span>  <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;materials&#39;</span><span class="p">]</span>
        <span class="n">curve</span><span class="o">.</span><span class="n">points</span>     <span class="o">=</span> <span class="n">ControlPoint</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">])</span>
        <span class="n">curve</span><span class="o">.</span><span class="n">splines</span>    <span class="o">=</span> <span class="n">Spline</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;splines&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">curve</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Clear the geometry</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Clear the geometry</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># From another Curve</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Copy</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_curve</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a Curve from another curve.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - other (Mesh) : the mesh to copy</span>
<span class="sd">            - points (selector = None) : points selection</span>
<span class="sd">            - splines (selector = None) : splines selection</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - Curve</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">curve</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">materials</span><span class="o">=</span><span class="n">other</span><span class="o">.</span><span class="n">materials</span><span class="p">)</span>
        <span class="n">curve</span><span class="o">.</span><span class="n">points</span>  <span class="o">=</span> <span class="n">ControlPoint</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">points</span><span class="p">,</span>  <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;COPY&#39;</span><span class="p">)</span>
        <span class="n">curve</span><span class="o">.</span><span class="n">splines</span> <span class="o">=</span> <span class="n">Spline</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;COPY&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">points_mask</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">points_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
            <span class="n">points_mask</span><span class="p">[</span><span class="n">points</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">splines</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">splines_mask</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">splines_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
            <span class="n">splines_mask</span><span class="p">[</span><span class="n">splines</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">curve</span><span class="o">.</span><span class="n">delete_points</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">points_mask</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="n">splines_mask</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">curve</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Capture another Curve</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">capture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Capture the data of another Curve.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - other (Curve) : the mesh to capture</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - self</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">materials</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">materials</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">is_view</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">is_view</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span>  <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">points</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splines</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">splines</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Interface with Blender</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Initialize from Blender Curve data</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_curve_data</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Initialize the geometry from a Blender Curve</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - data (Blender Curve instance) : the curve to load</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">read_point_attr</span><span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">n</span><span class="p">,)</span> <span class="o">+</span> <span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
            <span class="n">coll</span><span class="o">.</span><span class="n">foreach_get</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
            <span class="k">return</span> <span class="n">a</span>

        <span class="n">bl_splines</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">splines</span>
        <span class="n">nsplines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bl_splines</span><span class="p">)</span>
        <span class="n">curve</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">nsplines</span><span class="p">)</span>

        <span class="c1"># ----- Read the spline attributes</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">nsplines</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[(</span><span class="s1">&#39;material_index&#39;</span><span class="p">,</span> <span class="s1">&#39;material_index&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;resolution_u&#39;</span><span class="p">,</span> <span class="s1">&#39;resolution&#39;</span><span class="p">)]:</span>
            <span class="n">bl_splines</span><span class="o">.</span><span class="n">foreach_get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">nsplines</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[(</span><span class="s1">&#39;use_cyclic_u&#39;</span><span class="p">,</span> <span class="s1">&#39;cyclic&#39;</span><span class="p">)]:</span>
            <span class="n">bl_splines</span><span class="o">.</span><span class="n">foreach_get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

        <span class="c1"># ----- Read the points</span>

        <span class="k">for</span> <span class="n">i_spline</span><span class="p">,</span> <span class="n">bl_spline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">splines</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">bl_spline</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;POLY&#39;</span><span class="p">:</span>
                <span class="n">stype</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">bl_spline</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;NURBS&#39;</span><span class="p">:</span>
                <span class="n">stype</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stype</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="p">[</span><span class="n">i_spline</span><span class="p">]</span><span class="o">.</span><span class="n">curve_type</span> <span class="o">=</span> <span class="n">stype</span>

            <span class="k">if</span> <span class="n">stype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">coll</span> <span class="o">=</span> <span class="n">bl_spline</span><span class="o">.</span><span class="n">bezier_points</span>
                <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;position&#39;</span>          <span class="p">:</span> <span class="n">read_point_attr</span><span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="s1">&#39;co&#39;</span><span class="p">,</span>                <span class="n">bfloat</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,)),</span>
                    <span class="s1">&#39;handle_left&#39;</span>       <span class="p">:</span> <span class="n">read_point_attr</span><span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="s1">&#39;handle_left&#39;</span><span class="p">,</span>       <span class="n">bfloat</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,)),</span>
                    <span class="s1">&#39;handle_right&#39;</span>      <span class="p">:</span> <span class="n">read_point_attr</span><span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="s1">&#39;handle_right&#39;</span><span class="p">,</span>      <span class="n">bfloat</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,)),</span>
                    <span class="s1">&#39;handle_type_left&#39;</span>  <span class="p">:</span> <span class="n">read_point_attr</span><span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="s1">&#39;handle_left_type&#39;</span><span class="p">,</span>  <span class="n">bint</span><span class="p">,</span>   <span class="p">()),</span>
                    <span class="s1">&#39;handle_type_right&#39;</span> <span class="p">:</span> <span class="n">read_point_attr</span><span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="s1">&#39;handle_right_type&#39;</span><span class="p">,</span> <span class="n">bint</span><span class="p">,</span>   <span class="p">()),</span>
                    <span class="s1">&#39;radius&#39;</span>            <span class="p">:</span> <span class="n">read_point_attr</span><span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="s1">&#39;radius&#39;</span><span class="p">,</span>            <span class="n">bfloat</span><span class="p">,</span> <span class="p">()),</span>
                    <span class="s1">&#39;tilt&#39;</span>              <span class="p">:</span> <span class="n">read_point_attr</span><span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="s1">&#39;tilt&#39;</span><span class="p">,</span>              <span class="n">bfloat</span><span class="p">,</span> <span class="p">()),</span>
                <span class="p">}</span>
                <span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="p">[</span><span class="n">i_spline</span><span class="p">]</span><span class="o">.</span><span class="n">loop_start</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
                <span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="p">[</span><span class="n">i_spline</span><span class="p">]</span><span class="o">.</span><span class="n">loop_total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>
                <span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">**</span><span class="n">attrs</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">coll</span> <span class="o">=</span> <span class="n">bl_spline</span><span class="o">.</span><span class="n">points</span>
                <span class="n">points4</span> <span class="o">=</span> <span class="n">read_point_attr</span><span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">bfloat</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,))</span>
                <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;radius&#39;</span>  <span class="p">:</span> <span class="n">read_point_attr</span><span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="s1">&#39;radius&#39;</span><span class="p">,</span>            <span class="n">bfloat</span><span class="p">,</span> <span class="p">()),</span>
                    <span class="s1">&#39;tilt&#39;</span>    <span class="p">:</span> <span class="n">read_point_attr</span><span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="s1">&#39;tilt&#39;</span><span class="p">,</span>              <span class="n">bfloat</span><span class="p">,</span> <span class="p">()),</span>
                <span class="p">}</span>
                <span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="p">[</span><span class="n">i_spline</span><span class="p">]</span><span class="o">.</span><span class="n">loop_start</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
                <span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="p">[</span><span class="n">i_spline</span><span class="p">]</span><span class="o">.</span><span class="n">loop_total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>
                <span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">points4</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">w</span><span class="o">=</span><span class="n">points4</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">],</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">curve</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Write curve data</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_curve_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Initialize the geometry from a Blender Curve</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - data (Blender Curve instance) : the curve to load</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

        <span class="n">bl_splines</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">splines</span>
        <span class="n">bl_splines</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i_spline</span><span class="p">,</span> <span class="p">(</span><span class="n">curve_type</span><span class="p">,</span> <span class="n">loop_start</span><span class="p">,</span> <span class="n">loop_total</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">curve_type</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">loop_start</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">loop_total</span><span class="p">,</span>
        <span class="p">)):</span>

            <span class="k">if</span> <span class="n">curve_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">bl_spline</span> <span class="o">=</span> <span class="n">bl_splines</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;BEZIER&#39;</span><span class="p">)</span>
                <span class="n">coll</span> <span class="o">=</span> <span class="n">bl_spline</span><span class="o">.</span><span class="n">bezier_points</span>

                <span class="n">coll</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">loop_total</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">coll</span><span class="p">))</span>

                <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">loop_start</span><span class="p">:</span><span class="n">loop_start</span><span class="o">+</span><span class="n">loop_total</span><span class="p">]</span>
                <span class="n">coll</span><span class="o">.</span><span class="n">foreach_set</span><span class="p">(</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>

                <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="s1">&#39;handle_left&#39;</span><span class="p">,</span> 
                    <span class="s1">&#39;handle_right&#39;</span><span class="p">,</span> 
                    <span class="p">(</span><span class="s1">&#39;handle_type_left&#39;</span><span class="p">,</span> <span class="s1">&#39;handle_left_type&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;handle_type_right&#39;</span><span class="p">,</span> <span class="s1">&#39;handle_right_type&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;radius&#39;</span><span class="p">,</span> 
                    <span class="s1">&#39;tilt&#39;</span><span class="p">,</span>
                    <span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">curve_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">bl_spline</span> <span class="o">=</span> <span class="n">bl_splines</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;POLY&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>            
                    <span class="n">bl_spline</span> <span class="o">=</span> <span class="n">bl_splines</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;NURBS&#39;</span><span class="p">)</span>

                <span class="n">coll</span> <span class="o">=</span> <span class="n">bl_spline</span><span class="o">.</span><span class="n">points</span>
                <span class="n">coll</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">loop_total</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">coll</span><span class="p">))</span>

                <span class="n">p4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">loop_total</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bfloat</span><span class="p">)</span>
                <span class="n">p4</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">loop_start</span><span class="p">:</span><span class="n">loop_start</span><span class="o">+</span><span class="n">loop_total</span><span class="p">]</span>
                <span class="n">p4</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="n">loop_start</span><span class="p">:</span><span class="n">loop_start</span><span class="o">+</span><span class="n">loop_total</span><span class="p">]</span>

                <span class="n">coll</span><span class="o">.</span><span class="n">foreach_set</span><span class="p">(</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">p4</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>

                <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">,</span> <span class="s1">&#39;tilt&#39;</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">]</span>


            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">field_name</span> <span class="o">=</span> <span class="n">attr</span>
                    <span class="n">attr_name</span> <span class="o">=</span> <span class="n">attr</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">field_name</span> <span class="o">=</span> <span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">attr_name</span> <span class="o">=</span> <span class="n">attr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                <span class="n">a</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)[</span><span class="n">loop_start</span><span class="p">:</span><span class="n">loop_start</span><span class="o">+</span><span class="n">loop_total</span><span class="p">]</span>
                <span class="n">coll</span><span class="o">.</span><span class="n">foreach_set</span><span class="p">(</span><span class="n">attr_name</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>

        <span class="c1"># Spline attrixbxutes</span>

        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">material_index</span>
        <span class="n">bl_splines</span><span class="o">.</span><span class="n">foreach_set</span><span class="p">(</span><span class="s1">&#39;material_index&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">resolution</span>
        <span class="n">bl_splines</span><span class="o">.</span><span class="n">foreach_set</span><span class="p">(</span><span class="s1">&#39;resolution_u&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">cyclic</span>
        <span class="n">bl_splines</span><span class="o">.</span><span class="n">foreach_set</span><span class="p">(</span><span class="s1">&#39;use_cyclic_u&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># From object</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_object</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">evaluated</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a Curve from an existing curve.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - obj (str or Blender object) : the object to initialize from</span>
<span class="sd">            - evaluated (bool = False) : object modified by the modifiers if True, raw vertices otherwise</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - Curve</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">evaluated</span><span class="p">:</span>
            <span class="n">depsgraph</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluated_depsgraph_get</span><span class="p">()</span>
            <span class="n">object_eval</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">evaluated_get</span><span class="p">(</span><span class="n">depsgraph</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_curve_data</span><span class="p">(</span><span class="n">object_eval</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_curve_data</span><span class="p">(</span><span class="n">blender</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># To object</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create or update a blender object.</span>

<span class="sd">        The method &#39;to_object&#39; creates the whole geometry. It creates a new object if it doesn&#39;t already exist.</span>
<span class="sd">        If the object exists, it must be a curve, there is no object type conversion.</span>

<span class="sd">        Once the object is created, use the method &#39;update_object&#39; to change the vertices.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - obj (str or Blender object) : the object the create</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - Blender curve object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">curve</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">create_curve_object</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_curve_data</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">curve</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Blender data context manager</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@contextmanager</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">blender_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Acces to Blender Curve API.</span>

<span class="sd">        Transfer the geometry to a temporay Blender Curve.</span>
<span class="sd">        The example below use a blender Mesh to get the normals.</span>

<span class="sd">        ``` python</span>
<span class="sd">        curve = Curve.Spiral()</span>

<span class="sd">        with curve.blender_data() as bcurve:</span>
<span class="sd">            print(&quot;Number of points&quot;, len(bcurve.splines[0].points))</span>

<span class="sd">        # &gt; Number of points 65</span>
<span class="sd">        ```</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - readonly (bool=False) : don&#39;t read back the geometry if not modified</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - Blender Mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">curves</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">DATA_TEMP_NAME</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">curves</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">DATA_TEMP_NAME</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;CURVE&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">to_curve_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">yield</span> <span class="n">data</span>

        <span class="c1"># ----- Back</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">readonly</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="n">Curve</span><span class="o">.</span><span class="n">FromCurveData</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>   

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Add splines</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Extract attributes per domain</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_attributes_per_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>

        <span class="n">dispatched</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;points&#39;</span>  <span class="p">:</span> <span class="p">{},</span>
            <span class="s1">&#39;splines&#39;</span> <span class="p">:</span> <span class="p">{},</span>
            <span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">all_names</span><span class="p">:</span>
                <span class="n">dispatched</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">all_names</span><span class="p">:</span>
                <span class="n">dispatched</span><span class="p">[</span><span class="s1">&#39;corners&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown curve attribute &#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
                                     <span class="s2">&quot;- points:  </span><span class="si">{self.points.all_names}</span><span class="se">\n</span><span class="s2">&quot;</span>
                                     <span class="s2">&quot;- splines: </span><span class="si">{self.splines.all_names}</span><span class="se">\n</span><span class="s2">&quot;</span>
                                     <span class="p">)</span>

            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Curve attribute &#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&#39; is ambigous, it belongs to more than one domain (count).&quot;</span>
                                     <span class="s2">&quot;- points:  </span><span class="si">{self.points.all_names}</span><span class="se">\n</span><span class="s2">&quot;</span>
                                     <span class="s2">&quot;- splines: </span><span class="si">{self.splines.all_names}</span><span class="se">\n</span><span class="s2">&quot;</span>
                                     <span class="p">)</span>
        <span class="k">return</span> <span class="n">dispatched</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Check consistency between points shape and spline sizes</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_points_splines_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">splines</span><span class="p">):</span>

        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">splines</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">splines</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)]</span>

            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">splines</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">%</span> <span class="n">splines</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;splines length (</span><span class="si">{</span><span class="n">splines</span><span class="si">}</span><span class="s2">) is not a divider of the number of points (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="si">}</span><span class="s2">).&quot;</span><span class="p">)</span>

                <span class="n">nsplines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">//</span> <span class="n">splines</span>
                <span class="c1">#splines = [splines]*nsplines</span>
                <span class="n">points</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nsplines</span><span class="p">,</span> <span class="n">splines</span><span class="p">,</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">splines</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">splines</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The sum of spline lengths </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">splines</span><span class="p">)</span><span class="si">}</span><span class="s2"> doesn&#39;t match the number of points </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">splines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">splines</span> <span class="o">!=</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Points arguments is an array of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="si">}</span><span class="s2"> splines of </span><span class="si">{</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> points each, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;splines argument must be None or </span><span class="si">{</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, not </span><span class="si">{</span><span class="n">splines</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">splines</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Points argument must be an array of points, shape </span><span class="si">{</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> is not valid.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">points</span><span class="p">,</span> <span class="n">splines</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Compute Bezier handles</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">compute_bezier_handles</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute cubic Bezier handles (left/right) from anchors using Catmull-Rom style tangents.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        points : (N,3) or (B,N,3) float32/float64</span>
<span class="sd">            OPEN storage (no duplicated first point).</span>
<span class="sd">        cyclic : bool</span>
<span class="sd">            If True, wrap neighbors; else use one-sided differences at ends.</span>
<span class="sd">        eps : float</span>
<span class="sd">            Small epsilon to guard against zero-length tangents.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        left, right : same shape as `points`</span>
<span class="sd">            left[i]  = P[i] - T[i] * (len_in[i]  / 3)</span>
<span class="sd">            right[i] = P[i] + T[i] * (len_out[i] / 3)</span>
<span class="sd">            with len_in = ||P[i] - P[i-1]|| and len_out = ||P[i+1] - P[i]|| (wrapped if cyclic).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="n">single</span> <span class="o">=</span> <span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">single</span><span class="p">:</span>
            <span class="n">P</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>  <span class="c1"># (1,N,3)</span>

        <span class="n">B</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
            <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">single</span> <span class="k">else</span> <span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># With a single point, handles equal the point</span>
            <span class="n">L</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">R</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">single</span> <span class="k">else</span> <span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>

        <span class="c1"># Neighbors (OPEN). Use roll for cyclic, clamp edges for non-cyclic.</span>
        <span class="k">if</span> <span class="n">cyclic</span><span class="p">:</span>
            <span class="n">P_prev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>    <span class="c1"># P[i-1]</span>
            <span class="n">P_next</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># P[i+1]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">P_prev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">P</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span>  <span class="n">P</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># [P0, P0..P_{N-2}]</span>
            <span class="n">P_next</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">P</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:,</span> <span class="p">:],</span>  <span class="n">P</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># [P1..P_{N-1}, P_{N-1}]</span>

        <span class="c1"># Catmull-Rom style tangent (centered diff), then normalize</span>
        <span class="n">der</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">P_next</span> <span class="o">-</span> <span class="n">P_prev</span><span class="p">)</span>                         <span class="c1"># (B,N,3)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">der</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>       <span class="c1"># (B,N,1)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">eps</span><span class="p">)</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">der</span> <span class="o">/</span> <span class="n">n</span>                                           <span class="c1"># unit tangents</span>

        <span class="c1"># Segment lengths in/out</span>
        <span class="n">d_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">P_next</span> <span class="o">-</span> <span class="n">P</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># |P[i+1]-P[i]|</span>
        <span class="n">d_in</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">P</span> <span class="o">-</span> <span class="n">P_prev</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># |P[i]-P[i-1]|</span>

        <span class="c1"># Handles: linear-preserving scale (len/3)</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">P</span> <span class="o">-</span> <span class="n">T</span> <span class="o">*</span> <span class="p">(</span><span class="n">d_in</span>  <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">P</span> <span class="o">+</span> <span class="n">T</span> <span class="o">*</span> <span class="p">(</span><span class="n">d_out</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">single</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">L</span><span class="p">,</span> <span class="n">R</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_bezier_handles_OLD</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="n">single</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">single</span><span class="p">:</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>

        <span class="c1"># ----- Add the first point at the end if cyclic</span>

        <span class="n">count</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">cyclic</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="p">[</span><span class="n">points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># ----- Compute the control points</span>

        <span class="n">der</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="n">der</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:]</span>  <span class="o">-</span> <span class="n">points</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">der</span><span class="p">[:,</span>  <span class="mi">0</span><span class="p">]</span>   <span class="o">=</span> <span class="p">(</span><span class="n">points</span><span class="p">[:,</span>  <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">der</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>   <span class="o">=</span> <span class="p">(</span><span class="n">points</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">points</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>

        <span class="n">nrm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">der</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">nrm</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">nrm</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="n">der</span> <span class="o">/=</span> <span class="n">nrm</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span>

        <span class="n">dists</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">points</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span>

        <span class="c1"># Left handles</span>
        <span class="n">lefts</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">lefts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">-=</span> <span class="n">der</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">*</span><span class="n">dists</span><span class="o">/</span><span class="mi">3</span>
        <span class="n">lefts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>  <span class="o">-=</span> <span class="n">der</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">dists</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">3</span>

        <span class="c1"># Right handles</span>
        <span class="n">rights</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">rights</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">der</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">dists</span><span class="o">/</span><span class="mi">3</span>
        <span class="n">rights</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="o">+=</span> <span class="n">der</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">dists</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">3</span>

        <span class="c1"># ----- Returns the result</span>

        <span class="k">if</span> <span class="n">cyclic</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">single</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lefts</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rights</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lefts</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rights</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">single</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">lefts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rights</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">lefts</span><span class="p">,</span> <span class="n">rights</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Add Bezier</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_bezier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">points</span><span class="p">,</span> 
                   <span class="n">splines</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                   <span class="n">handle_left</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                   <span class="n">handle_right</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                   <span class="n">cyclic</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                   <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Add Bezier splines</span>

<span class="sd">        The arguments &#39;splines&#39; gives the length(s) of the bezier spline(s). If None:</span>
<span class="sd">        - the number of points is taken (one spline is added)</span>
<span class="sd">        - points.shape[1] is taken if the shape of points is (m, , 3)</span>

<span class="sd">        handle_left and handle_right must have the same shape as points if provided.</span>
<span class="sd">        If they aren&#39;t provided, they are computed.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        - points (array (n, 3) or (m, n, 3) of vectors) : the points of the curves</span>
<span class="sd">        - splines (int or array of ints = None) : spline or splines length</span>
<span class="sd">        - handle_left (same shape as points = None) : left handles</span>
<span class="sd">        - handle_right (same shape as points = None) : right handles</span>
<span class="sd">        - cyclic (bool = False) : whether the curve is cyclic or not</span>
<span class="sd">        - attrs (dict) : spline and/or points attributes</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        - dict (&#39;points&#39;: added points indices, &#39;splines&#39;: added splines indices)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;points&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;splines&#39;</span><span class="p">:</span> <span class="p">[]}</span>

        <span class="c1"># ----- handle_left and handle_right shapes must match points shape</span>

        <span class="k">if</span> <span class="n">handle_left</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">handle_left</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;add_bezier&gt; handle_left and points shapes must match.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">handle_right</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">handle_right</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;add_bezier&gt; handle_right and points shapes must match.&quot;</span><span class="p">)</span>

        <span class="c1"># ----- Make sure args are consistent</span>

        <span class="n">points</span><span class="p">,</span> <span class="n">splines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_points_splines_args</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">splines</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;add_bezier&gt; points must be an array of 3D vectors.&quot;</span><span class="p">)</span>

        <span class="c1"># ----- Dispatch attributes</span>

        <span class="n">disp_attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes_per_domain</span><span class="p">(</span><span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
        <span class="n">added</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># ----- A stack of splines</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">handle_left</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">handle_right</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">h_left</span><span class="p">,</span> <span class="n">h_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_bezier_handles</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="n">disp_attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cyclic&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">handle_left</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">handle_left</span> <span class="o">=</span> <span class="n">h_left</span>
                <span class="k">if</span> <span class="n">handle_right</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">handle_right</span> <span class="o">=</span> <span class="n">h_right</span>

            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">handle_left</span><span class="p">)</span> <span class="o">!=</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">handle_right</span><span class="p">)</span> <span class="o">!=</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;add_bezier&gt; handle_left (</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">handle_left</span><span class="p">)</span><span class="si">}</span><span class="s2">) and handle_right &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">handle_right</span><span class="p">)</span><span class="si">}</span><span class="s2">) must have the same shape as points  (</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="si">}</span><span class="s2">).&quot;</span><span class="p">)</span>

            <span class="n">shape</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>
            <span class="n">p_attrs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">sh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;shape&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">sh</span> <span class="o">==</span> <span class="p">():</span>
                    <span class="n">p_attrs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p_attrs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">shape</span> <span class="o">+</span> <span class="n">sh</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">n</span><span class="p">,)</span> <span class="o">+</span> <span class="n">sh</span> <span class="p">)</span>

            <span class="n">added</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">position</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                <span class="n">handle_left</span> <span class="o">=</span> <span class="n">handle_left</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                <span class="n">handle_right</span> <span class="o">=</span> <span class="n">handle_right</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                <span class="o">**</span><span class="n">p_attrs</span><span class="p">,</span>
                <span class="c1">#**{name: [value] for name, value in disp_attrs[&#39;points&#39;].items()},</span>
                <span class="p">)</span>

            <span class="c1"># Add the splines (splines argument is an int)</span>
            <span class="n">added</span><span class="p">[</span><span class="s1">&#39;splines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">append_sizes</span><span class="p">([</span><span class="n">splines</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">),</span> <span class="n">curve_type</span><span class="o">=</span><span class="n">BEZIER</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="n">cyclic</span><span class="p">,</span> <span class="o">**</span><span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;splines&#39;</span><span class="p">])</span>

        <span class="c1"># ----- A series of splines</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">cur_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>

            <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">h_left</span><span class="p">,</span> <span class="n">h_right</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">size</span><span class="p">,</span> <span class="n">cycl</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">splines</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">cyclic</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">splines</span><span class="p">))):</span>

                <span class="n">pts</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span> <span class="o">+</span> <span class="n">size</span><span class="p">]</span>

                <span class="c1"># Compute handles</span>
                <span class="k">if</span> <span class="n">handle_left</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">handle_right</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">h_left</span><span class="p">,</span> <span class="n">h_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_bezier_handles</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="n">cycl</span><span class="p">)</span>
                <span class="n">hl</span> <span class="o">=</span> <span class="n">h_left</span> <span class="k">if</span> <span class="n">handle_left</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">handle_left</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span> <span class="o">+</span> <span class="n">size</span><span class="p">]</span>
                <span class="n">hr</span> <span class="o">=</span> <span class="n">h_right</span> <span class="k">if</span> <span class="n">handle_right</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">handle_right</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span> <span class="o">+</span> <span class="n">size</span><span class="p">]</span>

                <span class="c1"># Append points</span>
                <span class="n">new_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">pts</span><span class="p">,</span> <span class="n">handle_left</span><span class="o">=</span><span class="n">hl</span><span class="p">,</span> <span class="n">handle_right</span><span class="o">=</span><span class="n">hr</span><span class="p">,</span> <span class="o">**</span><span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">])</span>

                <span class="c1"># Next</span>
                <span class="n">offset</span> <span class="o">+=</span> <span class="n">size</span>

            <span class="n">added</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">cur_points</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">))</span>

            <span class="c1"># Add the splines (splines argument is an array of ints)</span>
            <span class="n">added</span><span class="p">[</span><span class="s1">&#39;splines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">append_sizes</span><span class="p">(</span><span class="n">splines</span><span class="p">,</span> <span class="n">curve_type</span><span class="o">=</span><span class="n">BEZIER</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="n">cyclic</span><span class="p">,</span> <span class="o">**</span><span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;splines&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">added</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Add Bezier</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_poly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">points</span><span class="p">,</span> 
                   <span class="n">splines</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">curve_type</span> <span class="o">=</span> <span class="n">POLY</span><span class="p">,</span>
                   <span class="n">cyclic</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                   <span class="n">w</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span>
                   <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Add Poly or Nurbs splines</span>

<span class="sd">        The arguments &#39;splines&#39; gives the length(s) of the spline(s). If None:</span>
<span class="sd">        - the number of points is taken (one spline is added)</span>
<span class="sd">        - points.shape[1] is taken if the shape of points is (m, , 3)</span>

<span class="sd">        Non bezeier splines use 4D points. If the provided vectors are 4D, the argument w</span>
<span class="sd">        is ignored.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        - points (array (n, 3 or 4) or (m, n, 3 or 4) of vectors) : the points of the curves</span>
<span class="sd">        - splines (int or array of ints = None) : spline or splines length</span>
<span class="sd">        - cyclic (bool = False) : whether the curve is cyclic or not</span>
<span class="sd">        - w (float) : w value, ignored if points are 4D</span>
<span class="sd">        - attrs (dict) : spline and/or points attributes</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        - dict (&#39;points&#39;: added points indices, &#39;splines&#39;: added splines indices)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;points&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;splines&#39;</span><span class="p">:</span> <span class="p">[]}</span>

        <span class="c1"># ----- Make sure args are consistent</span>

        <span class="n">points</span><span class="p">,</span> <span class="n">splines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_points_splines_args</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">splines</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;add_poly&gt; points must be an array of 3D or 4D vectors.&quot;</span><span class="p">)</span>

        <span class="c1"># ----- Dispatch attributes</span>

        <span class="n">disp_attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes_per_domain</span><span class="p">(</span><span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
        <span class="n">added</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># ----- A stack of splines</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>

            <span class="n">position</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

            <span class="n">shape</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>
            <span class="n">p_attrs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">sh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;shape&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">sh</span> <span class="o">==</span> <span class="p">():</span>
                    <span class="n">p_attrs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p_attrs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">shape</span> <span class="o">+</span> <span class="n">sh</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">n</span><span class="p">,)</span> <span class="o">+</span> <span class="n">sh</span> <span class="p">)</span>

            <span class="c1"># Add the points</span>
            <span class="n">added</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">w</span><span class="p">,</span>
                <span class="c1">#**{name: [value] for name, value in disp_attrs[&#39;points&#39;].items()},</span>
                <span class="o">**</span><span class="n">p_attrs</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># Add the splines (splines argument is an int)</span>
            <span class="n">added</span><span class="p">[</span><span class="s1">&#39;splines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">append_sizes</span><span class="p">([</span><span class="n">splines</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">),</span> <span class="n">curve_type</span><span class="o">=</span><span class="n">curve_type</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="n">cyclic</span><span class="p">,</span> <span class="o">**</span><span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;splines&#39;</span><span class="p">])</span>

        <span class="c1"># ----- A series of splines</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Add the points</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">points</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">points</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">))</span>

            <span class="n">added</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">w</span><span class="p">,</span>
                <span class="o">**</span><span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">],</span>
            <span class="p">)</span>

            <span class="c1"># Add the splines (splines argument is an array of ints)</span>
            <span class="n">added</span><span class="p">[</span><span class="s1">&#39;splines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">append_sizes</span><span class="p">(</span><span class="n">splines</span><span class="p">,</span> <span class="n">curve_type</span><span class="o">=</span><span class="n">curve_type</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="n">cyclic</span><span class="p">,</span> <span class="o">**</span><span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;splines&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">added</span>    

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Add splines</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_splines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">curve_type</span><span class="o">=</span><span class="n">POLY</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Add splines</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">curve_type</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Curve add_splines&gt; curve_type must be a single value in (BEZIER, POLY, NURBS), not a list.</span><span class="se">\n</span><span class="s2">curve_type: </span><span class="si">{curve_type}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">curve_type</span> <span class="o">==</span> <span class="n">BEZIER</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_bezier</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="n">splines</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_poly</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="n">splines</span><span class="p">,</span> <span class="n">curve_type</span><span class="o">=</span><span class="n">curve_type</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Delete</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Delete points</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete points.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            points : points selection, optional</span>
<span class="sd">                Points indices to delete directly.</span>
<span class="sd">            splines : splines selection, optional</span>
<span class="sd">                Splines owning vertices to delete.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

        <span class="n">del_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">del_points</span><span class="p">[</span><span class="n">points</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">del_splines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">splines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">del_splines</span><span class="p">[</span><span class="n">splines</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">new_total</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">loop_total</span>
        <span class="k">for</span> <span class="n">i_spline</span><span class="p">,</span> <span class="p">(</span><span class="n">loop_start</span><span class="p">,</span> <span class="n">loop_total</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">loop_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">loop_total</span><span class="p">)):</span>

            <span class="k">if</span> <span class="n">del_splines</span><span class="p">[</span><span class="n">i_spline</span><span class="p">]:</span>
                <span class="n">del_points</span><span class="p">[</span><span class="n">loop_start</span><span class="p">:</span><span class="n">loop_start</span><span class="o">+</span><span class="n">loop_total</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">del_points</span><span class="p">[</span><span class="n">loop_start</span><span class="p">:</span><span class="n">loop_start</span><span class="o">+</span><span class="n">loop_total</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="n">loop_total</span><span class="p">:</span>
                    <span class="n">del_splines</span><span class="p">[</span><span class="n">i_spline</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_total</span><span class="p">[</span><span class="n">i_spline</span><span class="p">]</span> <span class="o">=</span> <span class="n">loop_total</span> <span class="o">-</span> <span class="n">n</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">del_points</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">del_splines</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">update_loop_start</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Delete splines</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_splines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete splines.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            splines : splines selection, optional</span>
<span class="sd">                Splines owning vertices to delete.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_points</span><span class="p">(</span><span class="n">splines</span><span class="o">=</span><span class="n">splines</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Combining</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Join other curves</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">others</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Join other Curves.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - others (Curve) : the curves to append</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">others</span><span class="p">:</span>
            <span class="n">other</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

            <span class="c1"># Splines</span>

            <span class="n">pts_offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>

            <span class="n">spl_offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">splines</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">[</span><span class="n">spl_offset</span><span class="p">:]</span><span class="o">.</span><span class="n">loop_start</span> <span class="o">+=</span> <span class="n">pts_offset</span>

            <span class="c1"># Materials</span>

            <span class="n">remap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">get_material_index</span><span class="p">(</span><span class="n">mat_name</span><span class="p">)</span> <span class="k">for</span> <span class="n">mat_name</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">materials</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">remap</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">material_index</span><span class="p">[</span><span class="n">spl_offset</span><span class="p">:]</span> <span class="o">=</span> <span class="n">remap</span><span class="p">[</span><span class="n">other</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">material_index</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Multiply</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Duplicate the geometry.</span>

<span class="sd">        Multiplying is a way to efficiently duplicate the geometry a great number of times.</span>
<span class="sd">        Once duplicated, the points can be reshapped to address each instance individually.</span>

<span class="sd">        ``` python</span>
<span class="sd">        count = 16</span>

<span class="sd">        cube = Mesh.Cube() * count</span>

<span class="sd">        # Shape the points as 16 blocks of 8 vertices</span>
<span class="sd">        points = np.reshape(cube.points.position, (16, 8, 3))</span>

<span class="sd">        # Place the cubes in a circle</span>
<span class="sd">        ags = np.linspace(0, 2*np.pi, count, endpoint=False)</span>
<span class="sd">        points[..., 0] += 6 * np.cos(ags)[:, None]</span>
<span class="sd">        points[..., 1] += 6 * np.sin(ags)[:, None]</span>

<span class="sd">        cube.to_object(&quot;Cubes&quot;)</span>
<span class="sd">        ```</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - count (int=10) : number of instances</span>
<span class="sd">            - attributes (name=value) : value for named attributes</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - Mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Checks and simple cases</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A Mesh can be multiplied only by an int, not &#39;</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">from_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">in_place</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">from_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Points</span>

        <span class="n">nverts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Splines</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">update_loop_start</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Operators</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Evaluation</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">splinemaths</span><span class="o">.</span><span class="n">length_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">splinemaths</span><span class="o">.</span><span class="n">evaluate_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">tangent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">splinemaths</span><span class="o">.</span><span class="n">tangent_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="n">normalize</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cubic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">splinemaths</span><span class="o">.</span><span class="n">sample_attributes_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">,</span> <span class="n">cubic</span><span class="o">=</span><span class="n">cubic</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Operations on splines</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="n">splines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">splines</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Curve index is not valid on curve </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">, index:</span><span class="se">\n</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Curve</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="n">splines</span><span class="o">.</span><span class="n">no_scalar</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Explicit alias for subsetting splines; same semantics as curve[indices].&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>   

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Loop on buckets</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">for_each_bucket</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate over homogeneous spline buckets and call `func` once per bucket.</span>

<span class="sd">        Bucketing key:</span>
<span class="sd">        (curve_type, N, cyclic, resolution)    # resolution only relevant for BEZIER</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func : callable</span>
<span class="sd">            Signature:</span>
<span class="sd">                func(curve, curve_type, loop_total, is_cyclic, resolution=None) -&gt; any</span>
<span class="sd">            - `curve` is a Curve view on self .</span>
<span class="sd">            - `curve_type` is the spline type.</span>
<span class="sd">            - `loop_total` is the number of points in the spline.</span>
<span class="sd">            - `is_cyclic` is True if the spline is cyclic.</span>
<span class="sd">            - `resolution` is the resolution of the loop, or None if the spline is not Bezier.</span>

<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        (indices, result)</span>
<span class="sd">            indices : list[int]</span>
<span class="sd">                Spline indices for this bucket, in stacking order.</span>
<span class="sd">            result : any</span>
<span class="sd">                Whatever `func` returned for this bucket.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">spl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spl</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Build buckets keyed by (type, N, cyclic, resolution_or_None)</span>
        <span class="n">buckets</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">ctype</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">cyc</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">spl</span><span class="o">.</span><span class="n">curve_type</span><span class="p">,</span> <span class="n">spl</span><span class="o">.</span><span class="n">loop_total</span><span class="p">,</span> <span class="n">spl</span><span class="o">.</span><span class="n">cyclic</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">ctype</span> <span class="o">==</span> <span class="n">BEZIER</span><span class="p">:</span>
                <span class="n">resol</span> <span class="o">=</span> <span class="n">spl</span><span class="o">.</span><span class="n">resolution</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">ctype</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">cyc</span><span class="p">,</span> <span class="n">resol</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">ctype</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">cyc</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">buckets</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

        <span class="c1"># Iterate buckets and call user function once per bucket</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">ctype</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">cyc</span><span class="p">,</span> <span class="n">resol</span><span class="p">),</span> <span class="n">idxs</span> <span class="ow">in</span> <span class="n">buckets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">idxs</span><span class="p">],</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">cyc</span><span class="p">,</span> <span class="n">resol</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">idxs</span><span class="p">,</span> <span class="n">result</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Conversions</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># To poly</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_poly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Convert the splines to Poly splines.</span>

<span class="sd">        If resolution is None:</span>
<span class="sd">        - `splines.resolution` is used to split Bezier segments</span>
<span class="sd">        - poly lines are left unchanged</span>

<span class="sd">        If resolution is not None, all splines are resampled using this value</span>

<span class="sd">        Arguments:</span>
<span class="sd">        ---------</span>
<span class="sd">            resolution (int):          Poly resolution, use spline resolution for Bezier if None.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">resolution</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">resolution</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>

        <span class="n">attr_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">transdom_names</span>
        <span class="n">attr_names</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;tilt&#39;</span><span class="p">])</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_to_poly</span><span class="p">(</span><span class="n">curve</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">loop_total</span><span class="p">,</span> <span class="n">is_cyclic</span><span class="p">,</span> <span class="n">resol</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">resolution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ctype</span> <span class="o">==</span> <span class="n">POLY</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">curve</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

                <span class="n">r</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">resol</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">is_cyclic</span><span class="p">:</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loop_total</span><span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bfloat</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">loop_total</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bfloat</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ctype</span> <span class="o">==</span> <span class="n">POLY</span> <span class="ow">and</span> <span class="n">resolution</span> <span class="o">==</span> <span class="n">loop_total</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">curve</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

                <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="ow">not</span> <span class="n">is_cyclic</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bfloat</span><span class="p">)</span>

            <span class="n">pos</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">curve</span><span class="o">.</span><span class="n">sample_attributes</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">attr_names</span><span class="p">,</span> <span class="n">cubic</span><span class="o">=</span><span class="n">ctype</span><span class="o">==</span><span class="n">BEZIER</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">field_shape</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">get_field_shape</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">field_shape</span> <span class="o">==</span> <span class="p">():</span>
                    <span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,)</span> <span class="o">+</span> <span class="n">field_shape</span><span class="p">)</span>

            <span class="n">points</span> <span class="o">=</span> <span class="n">ControlPoint</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">attr_from</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
            <span class="n">splines</span> <span class="o">=</span> <span class="n">Spline</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="p">)</span>
            <span class="n">splines</span><span class="o">.</span><span class="n">curve_type</span> <span class="o">=</span> <span class="n">POLY</span>
            <span class="n">splines</span><span class="o">.</span><span class="n">loop_total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="n">splines</span><span class="o">.</span><span class="n">update_loop_start</span><span class="p">()</span>

            <span class="n">new_curve</span> <span class="o">=</span> <span class="n">Curve</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">points</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="n">splines</span><span class="p">)</span>
            <span class="n">new_curve</span><span class="o">.</span><span class="n">is_view</span><span class="o">=</span><span class="kc">False</span>
            <span class="k">return</span> <span class="n">new_curve</span>

        <span class="n">new_curve</span> <span class="o">=</span> <span class="n">Curve</span><span class="p">(</span><span class="n">materials</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">for_each_bucket</span><span class="p">(</span><span class="n">_to_poly</span><span class="p">):</span>
            <span class="n">new_curve</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">splines</span><span class="p">)</span>
            <span class="n">new_curve</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>

        <span class="n">new_curve</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">update_loop_start</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">new_curve</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># To Bezier</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_bezier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">control_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">16</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert splines to Bezier splines (OPEN storage).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        control_count : int or None</span>
<span class="sd">            Number of anchor points to generate per spline. If None, keep current loop_total.</span>
<span class="sd">            For cyclic splines, anchors are sampled on [0,1) (no duplicate). For non-cyclic, on [0,1].</span>
<span class="sd">        resolution : int</span>
<span class="sd">            Per-segment resolution to write into `splines.resolution` (&gt;=1).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resolution</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">resolution</span><span class="p">))</span>

        <span class="n">attr_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">transdom_names</span>
        <span class="n">attr_names</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;tilt&#39;</span><span class="p">])</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_to_bezier</span><span class="p">(</span><span class="n">curve</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">loop_total</span><span class="p">,</span> <span class="n">is_cyclic</span><span class="p">,</span> <span class="n">_resol</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">ctype</span> <span class="o">==</span> <span class="n">BEZIER</span> <span class="ow">and</span> <span class="n">control_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">curve</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

            <span class="c1"># Decide target anchor count N for this bucket</span>
            <span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">control_count</span><span class="p">)</span> <span class="k">if</span> <span class="n">control_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">loop_total</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">N</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># build empty bucket preserving schema</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">ControlPoint</span><span class="p">()</span>
                <span class="n">spl</span> <span class="o">=</span> <span class="n">Spline</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="p">)</span>
                <span class="n">spl</span><span class="o">.</span><span class="n">curve_type</span> <span class="o">=</span> <span class="n">BEZIER</span>
                <span class="n">spl</span><span class="o">.</span><span class="n">loop_total</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">spl</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">resolution</span>
                <span class="n">spl</span><span class="o">.</span><span class="n">update_loop_start</span><span class="p">()</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">Curve</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">pts</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="n">spl</span><span class="p">)</span>
                <span class="n">out</span><span class="o">.</span><span class="n">is_view</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">return</span> <span class="n">out</span>

            <span class="c1"># Parameter grid for anchors</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="ow">not</span> <span class="n">is_cyclic</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bfloat</span><span class="p">)</span>

            <span class="c1"># Evaluate anchors</span>
            <span class="n">P</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>                  <span class="c1"># (S, N, 3) or (S,3) if N==1</span>
            <span class="k">if</span> <span class="n">P</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">P</span> <span class="o">=</span> <span class="n">P</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>                  <span class="c1"># (S,1,3) uniformize</span>

            <span class="c1"># Compute handles from anchors (Catmull-Rom style tangents, linear-preserving scale)</span>
            <span class="n">L</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">Curve</span><span class="o">.</span><span class="n">compute_bezier_handles</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="n">is_cyclic</span><span class="p">)</span>  <span class="c1"># (S,N,3) each</span>

            <span class="c1"># Flatten (S,N,3) → (S*N,3)</span>
            <span class="n">P_flat</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">L_flat</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">R_flat</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

            <span class="c1"># Sample additional point attributes at anchors</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">curve</span><span class="o">.</span><span class="n">sample_attributes</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">attr_names</span><span class="p">,</span> <span class="n">cubic</span><span class="o">=</span><span class="p">(</span><span class="n">ctype</span> <span class="o">==</span> <span class="n">BEZIER</span><span class="p">))</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">field_shape</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">get_field_shape</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>  <span class="c1"># e.g. (), (D,), (H,W), ...</span>
                <span class="k">if</span> <span class="n">field_shape</span> <span class="o">==</span> <span class="p">():</span>
                    <span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,)</span> <span class="o">+</span> <span class="n">field_shape</span><span class="p">)</span>

            <span class="c1"># Build new domains for this bucket</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">ControlPoint</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">P_flat</span><span class="p">,</span>
                                    <span class="n">handle_left</span><span class="o">=</span><span class="n">L_flat</span><span class="p">,</span>
                                    <span class="n">handle_right</span><span class="o">=</span><span class="n">R_flat</span><span class="p">,</span>
                                    <span class="n">attr_from</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">,</span>
                                    <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>

            <span class="n">splines</span> <span class="o">=</span> <span class="n">Spline</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="p">)</span>  <span class="c1"># copy bucket rows</span>
            <span class="n">splines</span><span class="o">.</span><span class="n">curve_type</span> <span class="o">=</span> <span class="n">BEZIER</span>
            <span class="n">splines</span><span class="o">.</span><span class="n">loop_total</span> <span class="o">=</span> <span class="n">N</span>
            <span class="n">splines</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">resolution</span>
            <span class="n">splines</span><span class="o">.</span><span class="n">update_loop_start</span><span class="p">()</span>

            <span class="n">out</span> <span class="o">=</span> <span class="n">Curve</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">points</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="n">splines</span><span class="p">)</span>
            <span class="n">out</span><span class="o">.</span><span class="n">is_view</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="n">out</span>

        <span class="c1"># Aggregate all buckets into a fresh curve (materials kept)</span>
        <span class="n">new_curve</span> <span class="o">=</span> <span class="n">Curve</span><span class="p">(</span><span class="n">materials</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">for_each_bucket</span><span class="p">(</span><span class="n">_to_bezier</span><span class="p">):</span>
            <span class="n">new_curve</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span> <span class="n">join_fields</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">new_curve</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">points</span><span class="p">,</span>   <span class="n">join_fields</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">new_curve</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">update_loop_start</span><span class="p">()</span>
        <span class="n">new_curve</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">resolution</span>
        <span class="k">return</span> <span class="n">new_curve</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># To mesh</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">caps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_radius</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">camera_culling</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; &gt; Transform curve to mesh</span>

<span class="sd">        If profile is None, the mesh contains only edges</span>
<span class="sd">        otherwise they are ignored</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        - profile (Curve = None) : profile curve</span>
<span class="sd">        - caps (bool = True) : use caps</span>
<span class="sd">        - use_radius (bool = True) : use the radius as a scale for profile</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        - Mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">.</span> <span class="n">camera</span> <span class="kn">import</span><span class="w"> </span><span class="nn">Camera</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.</span> <span class="n">mesh</span> <span class="kn">import</span><span class="w"> </span><span class="nn">Mesh</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.maths.topology</span><span class="w"> </span><span class="kn">import</span> <span class="n">grid_corners</span><span class="p">,</span> <span class="n">grid_uv_map</span><span class="p">,</span> <span class="n">disk_uv_map</span>

        <span class="k">if</span> <span class="n">camera_culling</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">camera</span> <span class="o">=</span> <span class="n">Camera</span><span class="p">(</span><span class="n">camera_culling</span><span class="p">)</span>
            <span class="n">camera_culling</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Circle as default profile</span>
        <span class="k">if</span> <span class="n">profile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">profile_size</span> <span class="o">=</span> <span class="mf">.001</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">full_prof_mesh</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_mesh</span><span class="p">()</span>
            <span class="n">full_prof_pts</span> <span class="o">=</span> <span class="n">full_prof_mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span>
            <span class="n">full_nprof</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">full_prof_pts</span><span class="p">)</span>
            <span class="n">prof_closed</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">cyclic</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">profile_size</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">max_size</span>

        <span class="c1"># ---------------------------------------------------------------------------</span>
        <span class="c1"># Add a set of splines of the same type, number of points and cyclic</span>
        <span class="c1"># ---------------------------------------------------------------------------</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_to_mesh</span><span class="p">(</span><span class="n">curve</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">cyclic</span><span class="p">,</span> <span class="n">resol</span><span class="p">,</span> <span class="n">profile_scale</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">ctype</span> <span class="o">==</span> <span class="n">BEZIER</span><span class="p">:</span>
                <span class="n">curve</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">to_poly</span><span class="p">()</span>
                <span class="n">N</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">loop_total</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">curve</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

            <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">()</span>

            <span class="c1"># Number of splines and points</span>
            <span class="n">nsplines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="p">)</span>
            <span class="n">npoints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>

            <span class="c1"># ---------------------------------------------------------------------------</span>
            <span class="c1"># No profile : we simply build edges</span>
            <span class="c1"># ---------------------------------------------------------------------------</span>

            <span class="k">if</span> <span class="n">profile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

                <span class="c1"># Create mesh points</span>
                <span class="n">mesh</span><span class="o">.</span><span class="n">add_points</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>

                <span class="c1"># Transfer trans domain attributes</span>
                <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">transfer_attributes</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>

                <span class="c1"># Edges</span>
                <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npoints</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nsplines</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cyclic</span><span class="p">:</span>
                    <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">nsplines</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bint</span><span class="p">)</span>
                    <span class="n">edges</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">inds</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">edges</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">inds</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>
                    <span class="n">edges</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">inds</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">edges</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">inds</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">nsplines</span><span class="p">,</span> <span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bint</span><span class="p">)</span>
                    <span class="n">edges</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">inds</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">edges</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">inds</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>

                <span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">mesh</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vertex0</span><span class="o">=</span><span class="n">edges</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">vertex1</span><span class="o">=</span><span class="n">edges</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

                <span class="k">return</span> <span class="n">mesh</span>

            <span class="c1"># ---------------------------------------------------------------------------</span>
            <span class="c1"># We have a profile</span>
            <span class="c1"># ---------------------------------------------------------------------------</span>

            <span class="n">ok_caps</span> <span class="o">=</span> <span class="n">caps</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">cyclic</span> <span class="ow">and</span> <span class="n">prof_closed</span>

            <span class="c1"># Let&#39;s adapt to the scale</span>
            <span class="k">if</span> <span class="n">profile_scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">nprof</span> <span class="o">=</span> <span class="n">full_nprof</span>
                <span class="n">prof_mesh</span> <span class="o">=</span> <span class="n">full_prof_mesh</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nprof</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">profile_scale</span><span class="o">*</span><span class="n">full_nprof</span><span class="p">))</span>
                <span class="n">prof_mesh</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_poly</span><span class="p">(</span><span class="n">nprof</span><span class="p">)</span><span class="o">.</span><span class="n">to_mesh</span><span class="p">()</span>
                <span class="n">ok_caps</span> <span class="o">=</span> <span class="n">ok_caps</span> <span class="ow">and</span> <span class="p">(</span><span class="n">profile_scale</span> <span class="o">&gt;</span> <span class="mf">.8</span><span class="p">)</span>

            <span class="c1"># One profile per center</span>
            <span class="n">all_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">nsplines</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">nprof</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bfloat</span><span class="p">)</span>
            <span class="n">all_points</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">prof_mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span>

            <span class="c1"># Radius</span>
            <span class="k">if</span> <span class="n">use_radius</span><span class="p">:</span>
                <span class="n">all_points</span> <span class="o">*=</span> <span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">radius</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nsplines</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Orientation along the tangent</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="ow">not</span> <span class="n">cyclic</span><span class="p">)</span>
            <span class="n">tangent</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">tangent</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># (nsplines, N, 3)</span>

            <span class="n">rot</span> <span class="o">=</span> <span class="n">Rotation</span><span class="o">.</span><span class="n">look_at</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">tangent</span><span class="p">,</span> <span class="n">up</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">normalized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># (nsplines, N, 3)</span>

            <span class="c1"># Tilt</span>
            <span class="n">euler</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">npoints</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bfloat</span><span class="p">)</span>
            <span class="n">euler</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">tilt</span>
            <span class="n">tilt</span> <span class="o">=</span> <span class="n">Rotation</span><span class="o">.</span><span class="n">from_euler</span><span class="p">(</span><span class="n">euler</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nsplines</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">rot</span> <span class="o">=</span> <span class="n">rot</span> <span class="o">@</span> <span class="n">tilt</span>

            <span class="c1"># Rotation</span>
            <span class="n">all_points</span> <span class="o">=</span> <span class="n">rot</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">@</span> <span class="n">all_points</span>

            <span class="c1"># Translation</span>
            <span class="n">all_points</span> <span class="o">+=</span> <span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nsplines</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

            <span class="n">all_points</span> <span class="o">=</span> <span class="n">all_points</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

            <span class="n">mesh</span><span class="o">.</span><span class="n">add_points</span><span class="p">(</span><span class="n">all_points</span><span class="p">)</span>

            <span class="c1"># Transfer trans domain attributes</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">transfer_attributes</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">nsplines</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">nprof</span><span class="p">),</span> <span class="n">other_shape</span><span class="o">=</span><span class="p">(</span><span class="n">nsplines</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">transfer_attributes</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">nsplines</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">nprof</span><span class="p">),</span> <span class="n">other_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nprof</span><span class="p">))</span>

            <span class="c1"># Grid corners</span>
            <span class="n">corners</span> <span class="o">=</span> <span class="n">grid_corners</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">nprof</span><span class="p">,</span> <span class="n">row_first</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">close_x</span><span class="o">=</span><span class="n">cyclic</span><span class="p">,</span> <span class="n">close_y</span><span class="o">=</span><span class="n">prof_closed</span><span class="p">,</span> <span class="n">clockwise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">ncorners</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span>
            <span class="n">corners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">corners</span><span class="p">,</span> <span class="n">nsplines</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nsplines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bint</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">nprof</span><span class="o">*</span><span class="n">N</span><span class="p">),</span> <span class="n">ncorners</span><span class="p">)</span>

            <span class="n">bbox</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">.499</span><span class="p">]</span> <span class="k">if</span> <span class="n">ok_caps</span> <span class="k">else</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">uvmap</span> <span class="o">=</span> <span class="n">grid_uv_map</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">nprof</span><span class="p">,</span> <span class="n">close_x</span><span class="o">=</span><span class="n">cyclic</span><span class="p">,</span> <span class="n">close_y</span><span class="o">=</span><span class="n">prof_closed</span><span class="p">,</span> <span class="n">clockwise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">uvmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">uvmap</span><span class="p">,</span> <span class="p">(</span><span class="n">nsplines</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

            <span class="n">mesh</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">corners</span><span class="o">=</span><span class="n">corners</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">faces</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">UVMap</span><span class="o">=</span><span class="n">uvmap</span><span class="p">)</span>

            <span class="c1">#Caps</span>
            <span class="k">if</span> <span class="n">ok_caps</span><span class="p">:</span>
                <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_points</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nsplines</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">nprof</span><span class="p">)</span>

                <span class="n">cap_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">inds</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">uvmap</span> <span class="o">=</span> <span class="n">disk_uv_map</span><span class="p">(</span><span class="n">nprof</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;NGON&#39;</span><span class="p">,</span> <span class="n">clockwise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">uvmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">uvmap</span><span class="p">,</span> <span class="p">(</span><span class="n">nsplines</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">mesh</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">corners</span><span class="o">=</span><span class="n">cap_inds</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">faces</span><span class="o">=</span><span class="n">nprof</span><span class="p">,</span> <span class="n">UVMap</span><span class="o">=</span><span class="n">uvmap</span><span class="p">)</span>

                <span class="n">cap_inds</span> <span class="o">=</span> <span class="n">inds</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">uvmap</span> <span class="o">=</span> <span class="n">disk_uv_map</span><span class="p">(</span><span class="n">nprof</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;NGON&#39;</span><span class="p">,</span> <span class="n">clockwise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="p">[</span><span class="mf">.5</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">uvmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">uvmap</span><span class="p">,</span> <span class="p">(</span><span class="n">nsplines</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">mesh</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">corners</span><span class="o">=</span><span class="n">cap_inds</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">faces</span><span class="o">=</span><span class="n">nprof</span><span class="p">,</span> <span class="n">UVMap</span><span class="o">=</span><span class="n">uvmap</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">mesh</span>

        <span class="c1"># ---------------------------------------------------------------------------</span>
        <span class="c1"># Add a set of splines of the same type, number of points and cyclic</span>
        <span class="c1"># ---------------------------------------------------------------------------</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_cam_culling</span><span class="p">(</span><span class="n">curve</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">cyclic</span><span class="p">,</span> <span class="n">resol</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">ctype</span> <span class="o">==</span> <span class="n">BEZIER</span><span class="p">:</span>
                <span class="n">curve</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">to_poly</span><span class="p">()</span>
                <span class="n">N</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">loop_total</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">curve</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

            <span class="c1"># No camera culling, this is simple</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">camera_culling</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_to_mesh</span><span class="p">(</span><span class="n">curve</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">cyclic</span><span class="p">,</span> <span class="n">resol</span><span class="p">)</span>

            <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">()</span>

            <span class="c1"># Visible points</span>
            <span class="n">vis</span><span class="p">,</span> <span class="n">dist</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">visible_points</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">profile_size</span><span class="p">)</span>
            <span class="n">vis</span> <span class="o">=</span> <span class="n">vis</span><span class="p">[:,</span> <span class="n">camera</span><span class="o">.</span><span class="n">VISIBLE</span><span class="p">]</span>

            <span class="c1"># Spline is visible if any point is visible</span>
            <span class="n">sel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">curve</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">mesh</span>

            <span class="c1"># One p_size per spline</span>
            <span class="n">p_size</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[:,</span> <span class="n">camera</span><span class="o">.</span><span class="n">SIZE</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)[</span><span class="n">sel</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="c1"># On distance per spline</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[:,</span> <span class="n">camera</span><span class="o">.</span><span class="n">DISTANCE</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)[</span><span class="n">sel</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Curve length</span>
            <span class="n">length</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">length</span>

            <span class="c1"># profile_size is seen as p_size, ratio = p_size/profile_size</span>
            <span class="c1">#ratio = p_size/profile_size</span>
            <span class="c1">#app_length = ratio*length</span>
            <span class="n">app_length</span> <span class="o">=</span> <span class="n">length</span><span class="o">*</span><span class="n">camera</span><span class="o">.</span><span class="n">pixels_per_meter</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>

            <span class="c1"># around 5 pixel per segment</span>
            <span class="n">npix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">app_length</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

            <span class="c1"># We loop per npix</span>
            <span class="n">new_Ns</span><span class="p">,</span> <span class="n">rev_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">npix</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i_new</span><span class="p">,</span> <span class="n">new_N</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_Ns</span><span class="p">):</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="n">rev_index</span> <span class="o">==</span> <span class="n">i_new</span><span class="p">]</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span><span class="o">.</span><span class="n">to_poly</span><span class="p">(</span><span class="n">new_N</span><span class="p">)</span>
                <span class="n">mesh</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_to_mesh</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">POLY</span><span class="p">,</span> <span class="n">new_N</span><span class="p">,</span> <span class="n">cyclic</span><span class="p">,</span> <span class="n">resol</span><span class="p">,</span> <span class="n">profile_scale</span><span class="o">=</span><span class="n">new_N</span><span class="o">/</span><span class="n">N</span><span class="p">))</span>

            <span class="c1"># Done !!!</span>
            <span class="k">return</span> <span class="n">mesh</span>

        <span class="c1"># ---------------------------------------------------------------------------</span>
        <span class="c1"># Main</span>
        <span class="c1"># ---------------------------------------------------------------------------</span>

        <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">for_each_bucket</span><span class="p">(</span><span class="n">_cam_culling</span><span class="p">):</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mesh</span>    

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Primitives</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bezier_circle</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">points</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span> <span class="mf">1.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">]],</span>
            <span class="n">curve_type</span> <span class="o">=</span> <span class="n">BEZIER</span><span class="p">,</span> 
            <span class="n">cyclic</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">handle_left</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.55212522</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.55212522</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span> <span class="mf">1.</span><span class="p">,</span>  <span class="mf">0.55212522</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span> <span class="mf">0.55212522</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">]],</span>
            <span class="n">handle_right</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span>  <span class="mf">0.55212522</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span> <span class="mf">0.55212522</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">0.</span> <span class="p">],[</span> <span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.55212522</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.55212522</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">]],</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">circle</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
        <span class="n">ags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ags</span><span class="p">),</span> <span class="n">radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ags</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">resolution</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">curve_type</span> <span class="o">=</span> <span class="n">POLY</span><span class="p">,</span> 
            <span class="n">cyclic</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">arc</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">start_angle</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">sweep_angle</span><span class="o">=</span><span class="mi">7</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">connect_center</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">invert_arc</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">ag0</span><span class="p">,</span> <span class="n">ag1</span> <span class="o">=</span> <span class="p">(</span><span class="n">start_angle</span> <span class="o">+</span> <span class="n">sweep_angle</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">start_angle</span><span class="p">)</span> <span class="k">if</span> <span class="n">invert_arc</span> <span class="k">else</span> <span class="p">(</span><span class="n">start_angle</span><span class="p">,</span> <span class="n">start_angle</span> <span class="o">+</span> <span class="n">sweep_angle</span><span class="p">)</span>
        <span class="n">ags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ag0</span><span class="p">,</span> <span class="n">ag1</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ags</span><span class="p">),</span> <span class="n">radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ags</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">resolution</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">connect_center</span><span class="p">:</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">points</span><span class="p">,</span> 
            <span class="n">curve_type</span> <span class="o">=</span> <span class="n">POLY</span><span class="p">,</span>
            <span class="n">cyclic</span> <span class="o">=</span> <span class="n">connect_center</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bezier_segment</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">start_handle</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">.5</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">end_handle</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">points</span><span class="p">,</span>
            <span class="n">curve_type</span> <span class="o">=</span> <span class="n">BEZIER</span><span class="p">,</span>
            <span class="n">handle_left</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">start_handle</span><span class="p">,</span> <span class="n">end_handle</span><span class="p">],</span>
            <span class="n">handle_right</span> <span class="o">=</span> <span class="p">[</span><span class="n">start_handle</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">end_handle</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">line</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">resolution</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="n">splines</span> <span class="o">=</span> <span class="n">resolution</span><span class="p">,</span>
            <span class="n">curve_type</span> <span class="o">=</span> <span class="n">POLY</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">spiral</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">rotations</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">start_radius</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">end_radius</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">rotations</span><span class="o">*</span><span class="n">resolution</span><span class="p">)</span>
        <span class="c1"># Reverse is strangely trigonometric!</span>
        <span class="n">ags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">rotations</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">reverse</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">rs</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start_radius</span><span class="p">,</span> <span class="n">end_radius</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">rs</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ags</span><span class="p">),</span> <span class="n">rs</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ags</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">count</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">curve_type</span> <span class="o">=</span> <span class="n">POLY</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">quadratic_bezier</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">middle</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Not implemented yet&quot;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">quadrilateral</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mf">2.</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">points</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
            <span class="n">curve_type</span> <span class="o">=</span> <span class="n">POLY</span><span class="p">,</span>
            <span class="n">cyclic</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">star</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">inner_radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">outer_radius</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">twist</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>

        <span class="n">points</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">points</span><span class="p">)</span>
        <span class="n">ag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">vs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">points</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
        <span class="n">vs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ag</span><span class="p">)</span>
        <span class="n">vs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ag</span><span class="p">)</span>
        <span class="n">vs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">inner_radius</span> <span class="o">*</span> <span class="n">vs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">vs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">*=</span> <span class="n">outer_radius</span>

        <span class="n">rot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">points</span> <span class="o">+</span> <span class="n">twist</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
        <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rot</span><span class="p">)</span>
        <span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rot</span><span class="p">)</span>
        <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

        <span class="n">vs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;...ij, ...j&#39;</span><span class="p">,</span> <span class="n">M</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">vs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">])</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">points</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
            <span class="n">curve_type</span> <span class="o">=</span> <span class="n">POLY</span><span class="p">,</span>
            <span class="n">cyclic</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">xyfunction</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bfloat</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> <span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="npblender.Curve.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">curve_type</span><span class="o">=</span><span class="n">POLY</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attr_from</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span></code>

<a href="#npblender.Curve.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Curve Geometry.</p>
<h5 id="npblender.Curve.__init__--arguments">Arguments<a class="headerlink" href="#npblender.Curve.__init__--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="nx">points</span><span class="w"> </span><span class="p">(</span><span class="nx">array</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">vectors</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">None</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">vertices</span>
<span class="o">-</span><span class="w"> </span><span class="nx">splines</span><span class="w"> </span><span class="p">(</span><span class="nx">array</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">ints</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">None</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">sizes</span>
<span class="o">-</span><span class="w"> </span><span class="nx">curve_type</span><span class="w"> </span><span class="p">(</span><span class="nx">array</span><span class="w"> </span><span class="nx">onf</span><span class="w"> </span><span class="nx">ints</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">curve</span><span class="w"> </span><span class="nx">types</span>
<span class="o">-</span><span class="w"> </span><span class="nx">materials</span><span class="w"> </span><span class="p">(</span><span class="nx">str</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="nx">list</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">strs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">None</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">list</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">materials</span><span class="w"> </span><span class="nx">used</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">geometry</span>
<span class="o">-</span><span class="w"> </span><span class="o">**</span><span class="nx">attrs</span><span class="w"> </span><span class="p">(</span><span class="nx">dict</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">other</span><span class="w"> </span><span class="nx">geometry</span><span class="w"> </span><span class="nx">attributes</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/curve.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">curve_type</span><span class="o">=</span><span class="n">POLY</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attr_from</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Curve Geometry.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - points (array of vectors = None) : the vertices</span>
<span class="sd">        - splines (array of ints = None) : sizes</span>
<span class="sd">        - curve_type (array onf ints) : curve types</span>
<span class="sd">        - materials (str or list of strs = None) : list of materials used in the geometry</span>
<span class="sd">        - **attrs (dict) : other geometry attributes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># ----- The materials</span>
    <span class="k">if</span> <span class="n">materials</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materials</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">materials</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materials</span> <span class="o">=</span> <span class="p">[</span><span class="n">materials</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materials</span> <span class="o">=</span> <span class="p">[</span><span class="n">mat</span> <span class="k">for</span> <span class="n">mat</span> <span class="ow">in</span> <span class="n">materials</span><span class="p">]</span>

    <span class="c1"># ----- The two domains are already built</span>
    <span class="c1"># can be a view on a larger curve</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">ControlPoint</span><span class="p">)</span> <span class="ow">and</span>
         <span class="n">splines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">splines</span><span class="p">,</span> <span class="n">Spline</span><span class="p">)</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">points</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splines</span> <span class="o">=</span> <span class="n">splines</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_view</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">loop_total</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">is_view</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># ----- Initialize empty domains</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">points</span>  <span class="o">=</span> <span class="n">ControlPoint</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">splines</span> <span class="o">=</span> <span class="n">Spline</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">join_attributes</span><span class="p">(</span><span class="n">attr_from</span><span class="p">)</span>

    <span class="c1"># ----- Add geometry</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_splines</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">splines</span><span class="p">,</span> <span class="n">curve_type</span><span class="o">=</span><span class="n">curve_type</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Curve.add_bezier" class="doc doc-heading">
            <code class=" language-python"><span class="n">add_bezier</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">handle_left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">handle_right</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span></code>

<a href="#npblender.Curve.add_bezier" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Add Bezier splines</p>
<p>The arguments 'splines' gives the length(s) of the bezier spline(s). If None:
- the number of points is taken (one spline is added)
- points.shape[1] is taken if the shape of points is (m, , 3)</p>
<p>handle_left and handle_right must have the same shape as points if provided.
If they aren't provided, they are computed.</p>
<h5 id="npblender.Curve.add_bezier--arguments">Arguments<a class="headerlink" href="#npblender.Curve.add_bezier--arguments" title="Permanent link">&para;</a></h5>
<ul>
<li>points (array (n, 3) or (m, n, 3) of vectors) : the points of the curves</li>
<li>splines (int or array of ints = None) : spline or splines length</li>
<li>handle_left (same shape as points = None) : left handles</li>
<li>handle_right (same shape as points = None) : right handles</li>
<li>cyclic (bool = False) : whether the curve is cyclic or not</li>
<li>attrs (dict) : spline and/or points attributes</li>
</ul>
<h5 id="npblender.Curve.add_bezier--returns">Returns<a class="headerlink" href="#npblender.Curve.add_bezier--returns" title="Permanent link">&para;</a></h5>
<ul>
<li>dict ('points': added points indices, 'splines': added splines indices)</li>
</ul>


            <details class="quote">
              <summary>Source code in <code>npblender/curve.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_bezier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">points</span><span class="p">,</span> 
               <span class="n">splines</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
               <span class="n">handle_left</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
               <span class="n">handle_right</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
               <span class="n">cyclic</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
               <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Add Bezier splines</span>

<span class="sd">    The arguments &#39;splines&#39; gives the length(s) of the bezier spline(s). If None:</span>
<span class="sd">    - the number of points is taken (one spline is added)</span>
<span class="sd">    - points.shape[1] is taken if the shape of points is (m, , 3)</span>

<span class="sd">    handle_left and handle_right must have the same shape as points if provided.</span>
<span class="sd">    If they aren&#39;t provided, they are computed.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    - points (array (n, 3) or (m, n, 3) of vectors) : the points of the curves</span>
<span class="sd">    - splines (int or array of ints = None) : spline or splines length</span>
<span class="sd">    - handle_left (same shape as points = None) : left handles</span>
<span class="sd">    - handle_right (same shape as points = None) : right handles</span>
<span class="sd">    - cyclic (bool = False) : whether the curve is cyclic or not</span>
<span class="sd">    - attrs (dict) : spline and/or points attributes</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    - dict (&#39;points&#39;: added points indices, &#39;splines&#39;: added splines indices)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;points&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;splines&#39;</span><span class="p">:</span> <span class="p">[]}</span>

    <span class="c1"># ----- handle_left and handle_right shapes must match points shape</span>

    <span class="k">if</span> <span class="n">handle_left</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">handle_left</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;add_bezier&gt; handle_left and points shapes must match.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">handle_right</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">handle_right</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;add_bezier&gt; handle_right and points shapes must match.&quot;</span><span class="p">)</span>

    <span class="c1"># ----- Make sure args are consistent</span>

    <span class="n">points</span><span class="p">,</span> <span class="n">splines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_points_splines_args</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">splines</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;add_bezier&gt; points must be an array of 3D vectors.&quot;</span><span class="p">)</span>

    <span class="c1"># ----- Dispatch attributes</span>

    <span class="n">disp_attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes_per_domain</span><span class="p">(</span><span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
    <span class="n">added</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># ----- A stack of splines</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">handle_left</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">handle_right</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">h_left</span><span class="p">,</span> <span class="n">h_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_bezier_handles</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="n">disp_attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cyclic&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">handle_left</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">handle_left</span> <span class="o">=</span> <span class="n">h_left</span>
            <span class="k">if</span> <span class="n">handle_right</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">handle_right</span> <span class="o">=</span> <span class="n">h_right</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">handle_left</span><span class="p">)</span> <span class="o">!=</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">handle_right</span><span class="p">)</span> <span class="o">!=</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;add_bezier&gt; handle_left (</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">handle_left</span><span class="p">)</span><span class="si">}</span><span class="s2">) and handle_right &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">handle_right</span><span class="p">)</span><span class="si">}</span><span class="s2">) must have the same shape as points  (</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="si">}</span><span class="s2">).&quot;</span><span class="p">)</span>

        <span class="n">shape</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>
        <span class="n">p_attrs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">sh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;shape&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">sh</span> <span class="o">==</span> <span class="p">():</span>
                <span class="n">p_attrs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p_attrs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">shape</span> <span class="o">+</span> <span class="n">sh</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">n</span><span class="p">,)</span> <span class="o">+</span> <span class="n">sh</span> <span class="p">)</span>

        <span class="n">added</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="n">handle_left</span> <span class="o">=</span> <span class="n">handle_left</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="n">handle_right</span> <span class="o">=</span> <span class="n">handle_right</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="o">**</span><span class="n">p_attrs</span><span class="p">,</span>
            <span class="c1">#**{name: [value] for name, value in disp_attrs[&#39;points&#39;].items()},</span>
            <span class="p">)</span>

        <span class="c1"># Add the splines (splines argument is an int)</span>
        <span class="n">added</span><span class="p">[</span><span class="s1">&#39;splines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">append_sizes</span><span class="p">([</span><span class="n">splines</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">),</span> <span class="n">curve_type</span><span class="o">=</span><span class="n">BEZIER</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="n">cyclic</span><span class="p">,</span> <span class="o">**</span><span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;splines&#39;</span><span class="p">])</span>

    <span class="c1"># ----- A series of splines</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">cur_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>

        <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">h_left</span><span class="p">,</span> <span class="n">h_right</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">size</span><span class="p">,</span> <span class="n">cycl</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">splines</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">cyclic</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">splines</span><span class="p">))):</span>

            <span class="n">pts</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span> <span class="o">+</span> <span class="n">size</span><span class="p">]</span>

            <span class="c1"># Compute handles</span>
            <span class="k">if</span> <span class="n">handle_left</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">handle_right</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">h_left</span><span class="p">,</span> <span class="n">h_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_bezier_handles</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="n">cycl</span><span class="p">)</span>
            <span class="n">hl</span> <span class="o">=</span> <span class="n">h_left</span> <span class="k">if</span> <span class="n">handle_left</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">handle_left</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span> <span class="o">+</span> <span class="n">size</span><span class="p">]</span>
            <span class="n">hr</span> <span class="o">=</span> <span class="n">h_right</span> <span class="k">if</span> <span class="n">handle_right</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">handle_right</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span> <span class="o">+</span> <span class="n">size</span><span class="p">]</span>

            <span class="c1"># Append points</span>
            <span class="n">new_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">pts</span><span class="p">,</span> <span class="n">handle_left</span><span class="o">=</span><span class="n">hl</span><span class="p">,</span> <span class="n">handle_right</span><span class="o">=</span><span class="n">hr</span><span class="p">,</span> <span class="o">**</span><span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">])</span>

            <span class="c1"># Next</span>
            <span class="n">offset</span> <span class="o">+=</span> <span class="n">size</span>

        <span class="n">added</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">cur_points</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">))</span>

        <span class="c1"># Add the splines (splines argument is an array of ints)</span>
        <span class="n">added</span><span class="p">[</span><span class="s1">&#39;splines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">append_sizes</span><span class="p">(</span><span class="n">splines</span><span class="p">,</span> <span class="n">curve_type</span><span class="o">=</span><span class="n">BEZIER</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="n">cyclic</span><span class="p">,</span> <span class="o">**</span><span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;splines&#39;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">added</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Curve.add_poly" class="doc doc-heading">
            <code class=" language-python"><span class="n">add_poly</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">curve_type</span><span class="o">=</span><span class="n">POLY</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span></code>

<a href="#npblender.Curve.add_poly" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Add Poly or Nurbs splines</p>
<p>The arguments 'splines' gives the length(s) of the spline(s). If None:
- the number of points is taken (one spline is added)
- points.shape[1] is taken if the shape of points is (m, , 3)</p>
<p>Non bezeier splines use 4D points. If the provided vectors are 4D, the argument w
is ignored.</p>
<h5 id="npblender.Curve.add_poly--arguments">Arguments<a class="headerlink" href="#npblender.Curve.add_poly--arguments" title="Permanent link">&para;</a></h5>
<ul>
<li>points (array (n, 3 or 4) or (m, n, 3 or 4) of vectors) : the points of the curves</li>
<li>splines (int or array of ints = None) : spline or splines length</li>
<li>cyclic (bool = False) : whether the curve is cyclic or not</li>
<li>w (float) : w value, ignored if points are 4D</li>
<li>attrs (dict) : spline and/or points attributes</li>
</ul>
<h5 id="npblender.Curve.add_poly--returns">Returns<a class="headerlink" href="#npblender.Curve.add_poly--returns" title="Permanent link">&para;</a></h5>
<ul>
<li>dict ('points': added points indices, 'splines': added splines indices)</li>
</ul>


            <details class="quote">
              <summary>Source code in <code>npblender/curve.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_poly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">points</span><span class="p">,</span> 
               <span class="n">splines</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
               <span class="n">curve_type</span> <span class="o">=</span> <span class="n">POLY</span><span class="p">,</span>
               <span class="n">cyclic</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
               <span class="n">w</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span>
               <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Add Poly or Nurbs splines</span>

<span class="sd">    The arguments &#39;splines&#39; gives the length(s) of the spline(s). If None:</span>
<span class="sd">    - the number of points is taken (one spline is added)</span>
<span class="sd">    - points.shape[1] is taken if the shape of points is (m, , 3)</span>

<span class="sd">    Non bezeier splines use 4D points. If the provided vectors are 4D, the argument w</span>
<span class="sd">    is ignored.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    - points (array (n, 3 or 4) or (m, n, 3 or 4) of vectors) : the points of the curves</span>
<span class="sd">    - splines (int or array of ints = None) : spline or splines length</span>
<span class="sd">    - cyclic (bool = False) : whether the curve is cyclic or not</span>
<span class="sd">    - w (float) : w value, ignored if points are 4D</span>
<span class="sd">    - attrs (dict) : spline and/or points attributes</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    - dict (&#39;points&#39;: added points indices, &#39;splines&#39;: added splines indices)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;points&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;splines&#39;</span><span class="p">:</span> <span class="p">[]}</span>

    <span class="c1"># ----- Make sure args are consistent</span>

    <span class="n">points</span><span class="p">,</span> <span class="n">splines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_points_splines_args</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">splines</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;add_poly&gt; points must be an array of 3D or 4D vectors.&quot;</span><span class="p">)</span>

    <span class="c1"># ----- Dispatch attributes</span>

    <span class="n">disp_attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes_per_domain</span><span class="p">(</span><span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
    <span class="n">added</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># ----- A stack of splines</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>

        <span class="n">position</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="n">shape</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>
        <span class="n">p_attrs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">sh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;shape&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">sh</span> <span class="o">==</span> <span class="p">():</span>
                <span class="n">p_attrs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p_attrs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">shape</span> <span class="o">+</span> <span class="n">sh</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">n</span><span class="p">,)</span> <span class="o">+</span> <span class="n">sh</span> <span class="p">)</span>

        <span class="c1"># Add the points</span>
        <span class="n">added</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">w</span><span class="p">,</span>
            <span class="c1">#**{name: [value] for name, value in disp_attrs[&#39;points&#39;].items()},</span>
            <span class="o">**</span><span class="n">p_attrs</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Add the splines (splines argument is an int)</span>
        <span class="n">added</span><span class="p">[</span><span class="s1">&#39;splines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">append_sizes</span><span class="p">([</span><span class="n">splines</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">),</span> <span class="n">curve_type</span><span class="o">=</span><span class="n">curve_type</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="n">cyclic</span><span class="p">,</span> <span class="o">**</span><span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;splines&#39;</span><span class="p">])</span>

    <span class="c1"># ----- A series of splines</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Add the points</span>
        <span class="n">position</span> <span class="o">=</span> <span class="n">points</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">points</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">))</span>

        <span class="n">added</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">w</span><span class="p">,</span>
            <span class="o">**</span><span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="c1"># Add the splines (splines argument is an array of ints)</span>
        <span class="n">added</span><span class="p">[</span><span class="s1">&#39;splines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">append_sizes</span><span class="p">(</span><span class="n">splines</span><span class="p">,</span> <span class="n">curve_type</span><span class="o">=</span><span class="n">curve_type</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="n">cyclic</span><span class="p">,</span> <span class="o">**</span><span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;splines&#39;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">added</span>    
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Curve.add_splines" class="doc doc-heading">
            <code class=" language-python"><span class="n">add_splines</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">curve_type</span><span class="o">=</span><span class="n">POLY</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span></code>

<a href="#npblender.Curve.add_splines" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Add splines</p>


            <details class="quote">
              <summary>Source code in <code>npblender/curve.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span>
<span class="normal">988</span>
<span class="normal">989</span>
<span class="normal">990</span>
<span class="normal">991</span>
<span class="normal">992</span>
<span class="normal">993</span>
<span class="normal">994</span>
<span class="normal">995</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_splines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">curve_type</span><span class="o">=</span><span class="n">POLY</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Add splines</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">curve_type</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Curve add_splines&gt; curve_type must be a single value in (BEZIER, POLY, NURBS), not a list.</span><span class="se">\n</span><span class="s2">curve_type: </span><span class="si">{curve_type}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">curve_type</span> <span class="o">==</span> <span class="n">BEZIER</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_bezier</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="n">splines</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_poly</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="n">splines</span><span class="p">,</span> <span class="n">curve_type</span><span class="o">=</span><span class="n">curve_type</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Curve.blender_data" class="doc doc-heading">
            <code class=" language-python"><span class="n">blender_data</span><span class="p">(</span><span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#npblender.Curve.blender_data" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Acces to Blender Curve API.</p>
<p>Transfer the geometry to a temporay Blender Curve.
The example below use a blender Mesh to get the normals.</p>
<div class="codehilite"><pre><span></span><code><span class="n">curve</span> <span class="o">=</span> <span class="n">Curve</span><span class="o">.</span><span class="n">Spiral</span><span class="p">()</span>

<span class="k">with</span> <span class="n">curve</span><span class="o">.</span><span class="n">blender_data</span><span class="p">()</span> <span class="k">as</span> <span class="n">bcurve</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of points&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">bcurve</span><span class="o">.</span><span class="n">splines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">points</span><span class="p">))</span>

<span class="c1"># &gt; Number of points 65</span>
</code></pre></div>

<h5 id="npblender.Curve.blender_data--arguments">Arguments<a class="headerlink" href="#npblender.Curve.blender_data--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="nv">readonly</span><span class="w"> </span><span class="ss">(</span><span class="nv">bool</span><span class="o">=</span><span class="nv">False</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">don</span><span class="err">&#39;t read back the geometry if not modified</span>
</code></pre></div>

<h5 id="npblender.Curve.blender_data--returns">Returns<a class="headerlink" href="#npblender.Curve.blender_data--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- Blender Mesh
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/curve.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@contextmanager</span>
<span class="k">def</span><span class="w"> </span><span class="nf">blender_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Acces to Blender Curve API.</span>

<span class="sd">    Transfer the geometry to a temporay Blender Curve.</span>
<span class="sd">    The example below use a blender Mesh to get the normals.</span>

<span class="sd">    ``` python</span>
<span class="sd">    curve = Curve.Spiral()</span>

<span class="sd">    with curve.blender_data() as bcurve:</span>
<span class="sd">        print(&quot;Number of points&quot;, len(bcurve.splines[0].points))</span>

<span class="sd">    # &gt; Number of points 65</span>
<span class="sd">    ```</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - readonly (bool=False) : don&#39;t read back the geometry if not modified</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - Blender Mesh</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">curves</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">DATA_TEMP_NAME</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">curves</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">DATA_TEMP_NAME</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;CURVE&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">to_curve_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">yield</span> <span class="n">data</span>

    <span class="c1"># ----- Back</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">readonly</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="n">Curve</span><span class="o">.</span><span class="n">FromCurveData</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>   
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Curve.capture" class="doc doc-heading">
            <code class=" language-python"><span class="n">capture</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></code>

<a href="#npblender.Curve.capture" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Capture the data of another Curve.</p>
<h5 id="npblender.Curve.capture--arguments">Arguments<a class="headerlink" href="#npblender.Curve.capture--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- other (Curve) : the mesh to capture
</code></pre></div>

<h5 id="npblender.Curve.capture--returns">Returns<a class="headerlink" href="#npblender.Curve.capture--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- self
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/curve.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">capture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Capture the data of another Curve.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - other (Curve) : the mesh to capture</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - self</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">materials</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">materials</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">is_view</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">is_view</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">points</span>  <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">points</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">splines</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">splines</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Curve.clear" class="doc doc-heading">
            <code class=" language-python"><span class="n">clear</span><span class="p">()</span></code>

<a href="#npblender.Curve.clear" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Clear the geometry</p>


            <details class="quote">
              <summary>Source code in <code>npblender/curve.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Clear the geometry</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Curve.compute_bezier_handles" class="doc doc-heading">
            <code class=" language-python"><span class="n">compute_bezier_handles</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-06</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#npblender.Curve.compute_bezier_handles" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute cubic Bezier handles (left/right) from anchors using Catmull-Rom style tangents.</p>
<h5 id="npblender.Curve.compute_bezier_handles--parameters">Parameters<a class="headerlink" href="#npblender.Curve.compute_bezier_handles--parameters" title="Permanent link">&para;</a></h5>
<p>points : (N,3) or (B,N,3) float32/float64
    OPEN storage (no duplicated first point).
cyclic : bool
    If True, wrap neighbors; else use one-sided differences at ends.
eps : float
    Small epsilon to guard against zero-length tangents.</p>
<h5 id="npblender.Curve.compute_bezier_handles--returns">Returns<a class="headerlink" href="#npblender.Curve.compute_bezier_handles--returns" title="Permanent link">&para;</a></h5>
<p>left, right : same shape as <code>points</code>
    left[i]  = P[i] - T[i] * (len_in[i]  / 3)
    right[i] = P[i] + T[i] * (len_out[i] / 3)
    with len_in = ||P[i] - P[i-1]|| and len_out = ||P[i+1] - P[i]|| (wrapped if cyclic).</p>


            <details class="quote">
              <summary>Source code in <code>npblender/curve.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">compute_bezier_handles</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute cubic Bezier handles (left/right) from anchors using Catmull-Rom style tangents.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    points : (N,3) or (B,N,3) float32/float64</span>
<span class="sd">        OPEN storage (no duplicated first point).</span>
<span class="sd">    cyclic : bool</span>
<span class="sd">        If True, wrap neighbors; else use one-sided differences at ends.</span>
<span class="sd">    eps : float</span>
<span class="sd">        Small epsilon to guard against zero-length tangents.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    left, right : same shape as `points`</span>
<span class="sd">        left[i]  = P[i] - T[i] * (len_in[i]  / 3)</span>
<span class="sd">        right[i] = P[i] + T[i] * (len_out[i] / 3)</span>
<span class="sd">        with len_in = ||P[i] - P[i-1]|| and len_out = ||P[i+1] - P[i]|| (wrapped if cyclic).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">single</span> <span class="o">=</span> <span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">single</span><span class="p">:</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>  <span class="c1"># (1,N,3)</span>

    <span class="n">B</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">single</span> <span class="k">else</span> <span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># With a single point, handles equal the point</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">single</span> <span class="k">else</span> <span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>

    <span class="c1"># Neighbors (OPEN). Use roll for cyclic, clamp edges for non-cyclic.</span>
    <span class="k">if</span> <span class="n">cyclic</span><span class="p">:</span>
        <span class="n">P_prev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>    <span class="c1"># P[i-1]</span>
        <span class="n">P_next</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># P[i+1]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">P_prev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">P</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span>  <span class="n">P</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># [P0, P0..P_{N-2}]</span>
        <span class="n">P_next</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">P</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:,</span> <span class="p">:],</span>  <span class="n">P</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># [P1..P_{N-1}, P_{N-1}]</span>

    <span class="c1"># Catmull-Rom style tangent (centered diff), then normalize</span>
    <span class="n">der</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">P_next</span> <span class="o">-</span> <span class="n">P_prev</span><span class="p">)</span>                         <span class="c1"># (B,N,3)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">der</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>       <span class="c1"># (B,N,1)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">eps</span><span class="p">)</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">der</span> <span class="o">/</span> <span class="n">n</span>                                           <span class="c1"># unit tangents</span>

    <span class="c1"># Segment lengths in/out</span>
    <span class="n">d_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">P_next</span> <span class="o">-</span> <span class="n">P</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># |P[i+1]-P[i]|</span>
    <span class="n">d_in</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">P</span> <span class="o">-</span> <span class="n">P_prev</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># |P[i]-P[i-1]|</span>

    <span class="c1"># Handles: linear-preserving scale (len/3)</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">P</span> <span class="o">-</span> <span class="n">T</span> <span class="o">*</span> <span class="p">(</span><span class="n">d_in</span>  <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">P</span> <span class="o">+</span> <span class="n">T</span> <span class="o">*</span> <span class="p">(</span><span class="n">d_out</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">single</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">L</span><span class="p">,</span> <span class="n">R</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Curve.delete_points" class="doc doc-heading">
            <code class=" language-python"><span class="n">delete_points</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#npblender.Curve.delete_points" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Delete points.</p>
<h5 id="npblender.Curve.delete_points--arguments">Arguments<a class="headerlink" href="#npblender.Curve.delete_points--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="n">points</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">points</span><span class="w"> </span><span class="n">selection</span><span class="o">,</span><span class="w"> </span><span class="n">optional</span>
<span class="w">    </span><span class="n">Points</span><span class="w"> </span><span class="n">indices</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">delete</span><span class="w"> </span><span class="n">directly</span><span class="o">.</span>
<span class="n">splines</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">splines</span><span class="w"> </span><span class="n">selection</span><span class="o">,</span><span class="w"> </span><span class="n">optional</span>
<span class="w">    </span><span class="n">Splines</span><span class="w"> </span><span class="n">owning</span><span class="w"> </span><span class="n">vertices</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">delete</span><span class="o">.</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/curve.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete points.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        points : points selection, optional</span>
<span class="sd">            Points indices to delete directly.</span>
<span class="sd">        splines : splines selection, optional</span>
<span class="sd">            Splines owning vertices to delete.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

    <span class="n">del_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">del_points</span><span class="p">[</span><span class="n">points</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">del_splines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">splines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">del_splines</span><span class="p">[</span><span class="n">splines</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">new_total</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">loop_total</span>
    <span class="k">for</span> <span class="n">i_spline</span><span class="p">,</span> <span class="p">(</span><span class="n">loop_start</span><span class="p">,</span> <span class="n">loop_total</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">loop_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">loop_total</span><span class="p">)):</span>

        <span class="k">if</span> <span class="n">del_splines</span><span class="p">[</span><span class="n">i_spline</span><span class="p">]:</span>
            <span class="n">del_points</span><span class="p">[</span><span class="n">loop_start</span><span class="p">:</span><span class="n">loop_start</span><span class="o">+</span><span class="n">loop_total</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">del_points</span><span class="p">[</span><span class="n">loop_start</span><span class="p">:</span><span class="n">loop_start</span><span class="o">+</span><span class="n">loop_total</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="n">loop_total</span><span class="p">:</span>
                <span class="n">del_splines</span><span class="p">[</span><span class="n">i_spline</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_total</span><span class="p">[</span><span class="n">i_spline</span><span class="p">]</span> <span class="o">=</span> <span class="n">loop_total</span> <span class="o">-</span> <span class="n">n</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">del_points</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">del_splines</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">update_loop_start</span><span class="p">()</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Curve.delete_splines" class="doc doc-heading">
            <code class=" language-python"><span class="n">delete_splines</span><span class="p">(</span><span class="n">splines</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#npblender.Curve.delete_splines" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Delete splines.</p>
<h5 id="npblender.Curve.delete_splines--arguments">Arguments<a class="headerlink" href="#npblender.Curve.delete_splines--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="n">splines</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">splines</span><span class="w"> </span><span class="n">selection</span><span class="o">,</span><span class="w"> </span><span class="n">optional</span>
<span class="w">    </span><span class="n">Splines</span><span class="w"> </span><span class="n">owning</span><span class="w"> </span><span class="n">vertices</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">delete</span><span class="o">.</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/curve.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_splines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete splines.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        splines : splines selection, optional</span>
<span class="sd">            Splines owning vertices to delete.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_points</span><span class="p">(</span><span class="n">splines</span><span class="o">=</span><span class="n">splines</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Curve.for_each_bucket" class="doc doc-heading">
            <code class=" language-python"><span class="n">for_each_bucket</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></code>

<a href="#npblender.Curve.for_each_bucket" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Iterate over homogeneous spline buckets and call <code>func</code> once per bucket.</p>
<p>Bucketing key:
(curve_type, N, cyclic, resolution)    # resolution only relevant for BEZIER</p>
<h5 id="npblender.Curve.for_each_bucket--parameters">Parameters<a class="headerlink" href="#npblender.Curve.for_each_bucket--parameters" title="Permanent link">&para;</a></h5>
<p>func : callable
    Signature:
        func(curve, curve_type, loop_total, is_cyclic, resolution=None) -&gt; any
    - <code>curve</code> is a Curve view on self .
    - <code>curve_type</code> is the spline type.
    - <code>loop_total</code> is the number of points in the spline.
    - <code>is_cyclic</code> is True if the spline is cyclic.
    - <code>resolution</code> is the resolution of the loop, or None if the spline is not Bezier.</p>
<h5 id="npblender.Curve.for_each_bucket--yields">Yields<a class="headerlink" href="#npblender.Curve.for_each_bucket--yields" title="Permanent link">&para;</a></h5>
<p>(indices, result)
    indices : list[int]
        Spline indices for this bucket, in stacking order.
    result : any
        Whatever <code>func</code> returned for this bucket.</p>


            <details class="quote">
              <summary>Source code in <code>npblender/curve.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">for_each_bucket</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterate over homogeneous spline buckets and call `func` once per bucket.</span>

<span class="sd">    Bucketing key:</span>
<span class="sd">    (curve_type, N, cyclic, resolution)    # resolution only relevant for BEZIER</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    func : callable</span>
<span class="sd">        Signature:</span>
<span class="sd">            func(curve, curve_type, loop_total, is_cyclic, resolution=None) -&gt; any</span>
<span class="sd">        - `curve` is a Curve view on self .</span>
<span class="sd">        - `curve_type` is the spline type.</span>
<span class="sd">        - `loop_total` is the number of points in the spline.</span>
<span class="sd">        - `is_cyclic` is True if the spline is cyclic.</span>
<span class="sd">        - `resolution` is the resolution of the loop, or None if the spline is not Bezier.</span>

<span class="sd">    Yields</span>
<span class="sd">    ------</span>
<span class="sd">    (indices, result)</span>
<span class="sd">        indices : list[int]</span>
<span class="sd">            Spline indices for this bucket, in stacking order.</span>
<span class="sd">        result : any</span>
<span class="sd">            Whatever `func` returned for this bucket.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">spl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spl</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># Build buckets keyed by (type, N, cyclic, resolution_or_None)</span>
    <span class="n">buckets</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">ctype</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">cyc</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">spl</span><span class="o">.</span><span class="n">curve_type</span><span class="p">,</span> <span class="n">spl</span><span class="o">.</span><span class="n">loop_total</span><span class="p">,</span> <span class="n">spl</span><span class="o">.</span><span class="n">cyclic</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">ctype</span> <span class="o">==</span> <span class="n">BEZIER</span><span class="p">:</span>
            <span class="n">resol</span> <span class="o">=</span> <span class="n">spl</span><span class="o">.</span><span class="n">resolution</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">ctype</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">cyc</span><span class="p">,</span> <span class="n">resol</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">ctype</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">cyc</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">buckets</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="c1"># Iterate buckets and call user function once per bucket</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">ctype</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">cyc</span><span class="p">,</span> <span class="n">resol</span><span class="p">),</span> <span class="n">idxs</span> <span class="ow">in</span> <span class="n">buckets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">idxs</span><span class="p">],</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">cyc</span><span class="p">,</span> <span class="n">resol</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">idxs</span><span class="p">,</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Curve.from_curve" class="doc doc-heading">
            <code class=" language-python"><span class="n">from_curve</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#npblender.Curve.from_curve" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a Curve from another curve.</p>
<h5 id="npblender.Curve.from_curve--arguments">Arguments<a class="headerlink" href="#npblender.Curve.from_curve--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- other (Mesh) : the mesh to copy
- points (selector = None) : points selection
- splines (selector = None) : splines selection
</code></pre></div>

<h5 id="npblender.Curve.from_curve--returns">Returns<a class="headerlink" href="#npblender.Curve.from_curve--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- Curve
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/curve.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_curve</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create a Curve from another curve.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - other (Mesh) : the mesh to copy</span>
<span class="sd">        - points (selector = None) : points selection</span>
<span class="sd">        - splines (selector = None) : splines selection</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - Curve</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">curve</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">materials</span><span class="o">=</span><span class="n">other</span><span class="o">.</span><span class="n">materials</span><span class="p">)</span>
    <span class="n">curve</span><span class="o">.</span><span class="n">points</span>  <span class="o">=</span> <span class="n">ControlPoint</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">points</span><span class="p">,</span>  <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;COPY&#39;</span><span class="p">)</span>
    <span class="n">curve</span><span class="o">.</span><span class="n">splines</span> <span class="o">=</span> <span class="n">Spline</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;COPY&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">points_mask</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">points_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">points_mask</span><span class="p">[</span><span class="n">points</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">splines</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">splines_mask</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">splines_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">splines_mask</span><span class="p">[</span><span class="n">splines</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">curve</span><span class="o">.</span><span class="n">delete_points</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">points_mask</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="n">splines_mask</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">curve</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Curve.from_curve_data" class="doc doc-heading">
            <code class=" language-python"><span class="n">from_curve_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#npblender.Curve.from_curve_data" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize the geometry from a Blender Curve</p>
<h5 id="npblender.Curve.from_curve_data--arguments">Arguments<a class="headerlink" href="#npblender.Curve.from_curve_data--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="p">(</span><span class="n">Blender</span><span class="w"> </span><span class="n">Curve</span><span class="w"> </span><span class="n">instance</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">curve</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="nb">load</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/curve.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_curve_data</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Initialize the geometry from a Blender Curve</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - data (Blender Curve instance) : the curve to load</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">read_point_attr</span><span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">n</span><span class="p">,)</span> <span class="o">+</span> <span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">coll</span><span class="o">.</span><span class="n">foreach_get</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">a</span>

    <span class="n">bl_splines</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">splines</span>
    <span class="n">nsplines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bl_splines</span><span class="p">)</span>
    <span class="n">curve</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
    <span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">nsplines</span><span class="p">)</span>

    <span class="c1"># ----- Read the spline attributes</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">nsplines</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[(</span><span class="s1">&#39;material_index&#39;</span><span class="p">,</span> <span class="s1">&#39;material_index&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;resolution_u&#39;</span><span class="p">,</span> <span class="s1">&#39;resolution&#39;</span><span class="p">)]:</span>
        <span class="n">bl_splines</span><span class="o">.</span><span class="n">foreach_get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">nsplines</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[(</span><span class="s1">&#39;use_cyclic_u&#39;</span><span class="p">,</span> <span class="s1">&#39;cyclic&#39;</span><span class="p">)]:</span>
        <span class="n">bl_splines</span><span class="o">.</span><span class="n">foreach_get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

    <span class="c1"># ----- Read the points</span>

    <span class="k">for</span> <span class="n">i_spline</span><span class="p">,</span> <span class="n">bl_spline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">splines</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">bl_spline</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;POLY&#39;</span><span class="p">:</span>
            <span class="n">stype</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">bl_spline</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;NURBS&#39;</span><span class="p">:</span>
            <span class="n">stype</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stype</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="p">[</span><span class="n">i_spline</span><span class="p">]</span><span class="o">.</span><span class="n">curve_type</span> <span class="o">=</span> <span class="n">stype</span>

        <span class="k">if</span> <span class="n">stype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">coll</span> <span class="o">=</span> <span class="n">bl_spline</span><span class="o">.</span><span class="n">bezier_points</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;position&#39;</span>          <span class="p">:</span> <span class="n">read_point_attr</span><span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="s1">&#39;co&#39;</span><span class="p">,</span>                <span class="n">bfloat</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,)),</span>
                <span class="s1">&#39;handle_left&#39;</span>       <span class="p">:</span> <span class="n">read_point_attr</span><span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="s1">&#39;handle_left&#39;</span><span class="p">,</span>       <span class="n">bfloat</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,)),</span>
                <span class="s1">&#39;handle_right&#39;</span>      <span class="p">:</span> <span class="n">read_point_attr</span><span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="s1">&#39;handle_right&#39;</span><span class="p">,</span>      <span class="n">bfloat</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,)),</span>
                <span class="s1">&#39;handle_type_left&#39;</span>  <span class="p">:</span> <span class="n">read_point_attr</span><span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="s1">&#39;handle_left_type&#39;</span><span class="p">,</span>  <span class="n">bint</span><span class="p">,</span>   <span class="p">()),</span>
                <span class="s1">&#39;handle_type_right&#39;</span> <span class="p">:</span> <span class="n">read_point_attr</span><span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="s1">&#39;handle_right_type&#39;</span><span class="p">,</span> <span class="n">bint</span><span class="p">,</span>   <span class="p">()),</span>
                <span class="s1">&#39;radius&#39;</span>            <span class="p">:</span> <span class="n">read_point_attr</span><span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="s1">&#39;radius&#39;</span><span class="p">,</span>            <span class="n">bfloat</span><span class="p">,</span> <span class="p">()),</span>
                <span class="s1">&#39;tilt&#39;</span>              <span class="p">:</span> <span class="n">read_point_attr</span><span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="s1">&#39;tilt&#39;</span><span class="p">,</span>              <span class="n">bfloat</span><span class="p">,</span> <span class="p">()),</span>
            <span class="p">}</span>
            <span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="p">[</span><span class="n">i_spline</span><span class="p">]</span><span class="o">.</span><span class="n">loop_start</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
            <span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="p">[</span><span class="n">i_spline</span><span class="p">]</span><span class="o">.</span><span class="n">loop_total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>
            <span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">**</span><span class="n">attrs</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">coll</span> <span class="o">=</span> <span class="n">bl_spline</span><span class="o">.</span><span class="n">points</span>
            <span class="n">points4</span> <span class="o">=</span> <span class="n">read_point_attr</span><span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">bfloat</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,))</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;radius&#39;</span>  <span class="p">:</span> <span class="n">read_point_attr</span><span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="s1">&#39;radius&#39;</span><span class="p">,</span>            <span class="n">bfloat</span><span class="p">,</span> <span class="p">()),</span>
                <span class="s1">&#39;tilt&#39;</span>    <span class="p">:</span> <span class="n">read_point_attr</span><span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="s1">&#39;tilt&#39;</span><span class="p">,</span>              <span class="n">bfloat</span><span class="p">,</span> <span class="p">()),</span>
            <span class="p">}</span>
            <span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="p">[</span><span class="n">i_spline</span><span class="p">]</span><span class="o">.</span><span class="n">loop_start</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
            <span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="p">[</span><span class="n">i_spline</span><span class="p">]</span><span class="o">.</span><span class="n">loop_total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>
            <span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">points4</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">w</span><span class="o">=</span><span class="n">points4</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">],</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">curve</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Curve.from_object" class="doc doc-heading">
            <code class=" language-python"><span class="n">from_object</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">evaluated</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#npblender.Curve.from_object" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a Curve from an existing curve.</p>
<h5 id="npblender.Curve.from_object--arguments">Arguments<a class="headerlink" href="#npblender.Curve.from_object--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="nv">obj</span><span class="w"> </span><span class="ss">(</span><span class="nv">str</span><span class="w"> </span><span class="nv">or</span><span class="w"> </span><span class="nv">Blender</span><span class="w"> </span><span class="nv">object</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">object</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">initialize</span><span class="w"> </span><span class="nv">from</span>
<span class="o">-</span><span class="w"> </span><span class="nv">evaluated</span><span class="w"> </span><span class="ss">(</span><span class="nv">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">False</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">object</span><span class="w"> </span><span class="nv">modified</span><span class="w"> </span><span class="nv">by</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">modifiers</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">True</span>,<span class="w"> </span><span class="nv">raw</span><span class="w"> </span><span class="nv">vertices</span><span class="w"> </span><span class="nv">otherwise</span>
</code></pre></div>

<h5 id="npblender.Curve.from_object--returns">Returns<a class="headerlink" href="#npblender.Curve.from_object--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- Curve
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/curve.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_object</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">evaluated</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create a Curve from an existing curve.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - obj (str or Blender object) : the object to initialize from</span>
<span class="sd">        - evaluated (bool = False) : object modified by the modifiers if True, raw vertices otherwise</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - Curve</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">evaluated</span><span class="p">:</span>
        <span class="n">depsgraph</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluated_depsgraph_get</span><span class="p">()</span>
        <span class="n">object_eval</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">evaluated_get</span><span class="p">(</span><span class="n">depsgraph</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_curve_data</span><span class="p">(</span><span class="n">object_eval</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_curve_data</span><span class="p">(</span><span class="n">blender</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Curve.get_points_selection" class="doc doc-heading">
            <code class=" language-python"><span class="n">get_points_selection</span><span class="p">()</span></code>

<a href="#npblender.Curve.get_points_selection" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get selection on points associated to the splines.</p>
<p>If the Curve is not a view on splines, if return [:], otherwise
it returns a selection on the points.</p>
<h5 id="npblender.Curve.get_points_selection--returns">Returns<a class="headerlink" href="#npblender.Curve.get_points_selection--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- sel (slice) : indices of splines points
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/curve.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_points_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Get selection on points associated to the splines.</span>

<span class="sd">    If the Curve is not a view on splines, if return [:], otherwise</span>
<span class="sd">    it returns a selection on the points.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - sel (slice) : indices of splines points</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_view</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="n">all_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">))</span>
    <span class="n">sel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="n">totals</span><span class="p">,</span> <span class="n">rev_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">loop_total</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">total</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">totals</span><span class="p">):</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">loop_total</span><span class="p">[</span><span class="n">rev_index</span> <span class="o">==</span> <span class="n">index</span><span class="p">][</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">total</span><span class="p">)</span>
        <span class="n">sel</span><span class="p">[</span><span class="n">indices</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">sel</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Curve.join" class="doc doc-heading">
            <code class=" language-python"><span class="n">join</span><span class="p">(</span><span class="o">*</span><span class="n">others</span><span class="p">)</span></code>

<a href="#npblender.Curve.join" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Join other Curves.</p>
<h5 id="npblender.Curve.join--arguments">Arguments<a class="headerlink" href="#npblender.Curve.join--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- others (Curve) : the curves to append
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/curve.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">others</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Join other Curves.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - others (Curve) : the curves to append</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">others</span><span class="p">:</span>
        <span class="n">other</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

        <span class="c1"># Splines</span>

        <span class="n">pts_offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>

        <span class="n">spl_offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">splines</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">[</span><span class="n">spl_offset</span><span class="p">:]</span><span class="o">.</span><span class="n">loop_start</span> <span class="o">+=</span> <span class="n">pts_offset</span>

        <span class="c1"># Materials</span>

        <span class="n">remap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">get_material_index</span><span class="p">(</span><span class="n">mat_name</span><span class="p">)</span> <span class="k">for</span> <span class="n">mat_name</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">materials</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">remap</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">material_index</span><span class="p">[</span><span class="n">spl_offset</span><span class="p">:]</span> <span class="o">=</span> <span class="n">remap</span><span class="p">[</span><span class="n">other</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">material_index</span><span class="p">]</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Curve.multiply" class="doc doc-heading">
            <code class=" language-python"><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#npblender.Curve.multiply" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Duplicate the geometry.</p>
<p>Multiplying is a way to efficiently duplicate the geometry a great number of times.
Once duplicated, the points can be reshapped to address each instance individually.</p>
<div class="codehilite"><pre><span></span><code><span class="n">count</span> <span class="o">=</span> <span class="mi">16</span>

<span class="n">cube</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">Cube</span><span class="p">()</span> <span class="o">*</span> <span class="n">count</span>

<span class="c1"># Shape the points as 16 blocks of 8 vertices</span>
<span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">cube</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="c1"># Place the cubes in a circle</span>
<span class="n">ags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">points</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ags</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">points</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ags</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>

<span class="n">cube</span><span class="o">.</span><span class="n">to_object</span><span class="p">(</span><span class="s2">&quot;Cubes&quot;</span><span class="p">)</span>
</code></pre></div>

<h5 id="npblender.Curve.multiply--arguments">Arguments<a class="headerlink" href="#npblender.Curve.multiply--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="nv">count</span><span class="w"> </span><span class="ss">(</span><span class="nv">int</span><span class="o">=</span><span class="mi">10</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">number</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">instances</span>
<span class="o">-</span><span class="w"> </span><span class="nv">attributes</span><span class="w"> </span><span class="ss">(</span><span class="nv">name</span><span class="o">=</span><span class="nv">value</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">named</span><span class="w"> </span><span class="nv">attributes</span>
</code></pre></div>

<h5 id="npblender.Curve.multiply--returns">Returns<a class="headerlink" href="#npblender.Curve.multiply--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- Mesh
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/curve.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Duplicate the geometry.</span>

<span class="sd">    Multiplying is a way to efficiently duplicate the geometry a great number of times.</span>
<span class="sd">    Once duplicated, the points can be reshapped to address each instance individually.</span>

<span class="sd">    ``` python</span>
<span class="sd">    count = 16</span>

<span class="sd">    cube = Mesh.Cube() * count</span>

<span class="sd">    # Shape the points as 16 blocks of 8 vertices</span>
<span class="sd">    points = np.reshape(cube.points.position, (16, 8, 3))</span>

<span class="sd">    # Place the cubes in a circle</span>
<span class="sd">    ags = np.linspace(0, 2*np.pi, count, endpoint=False)</span>
<span class="sd">    points[..., 0] += 6 * np.cos(ags)[:, None]</span>
<span class="sd">    points[..., 1] += 6 * np.sin(ags)[:, None]</span>

<span class="sd">    cube.to_object(&quot;Cubes&quot;)</span>
<span class="sd">    ```</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - count (int=10) : number of instances</span>
<span class="sd">        - attributes (name=value) : value for named attributes</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - Mesh</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Checks and simple cases</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A Mesh can be multiplied only by an int, not &#39;</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">from_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">in_place</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">from_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Points</span>

    <span class="n">nverts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Splines</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">update_loop_start</span><span class="p">()</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Curve.no_view" class="doc doc-heading">
            <code class=" language-python"><span class="n">no_view</span><span class="p">()</span></code>

<a href="#npblender.Curve.no_view" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Materialize a view-curve into a standalone curve (deep copy of splines and points),
preserving all point-domain fields (handles, custom attrs, ...).</p>


            <details class="quote">
              <summary>Source code in <code>npblender/curve.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">no_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Materialize a view-curve into a standalone curve (deep copy of splines and points),</span>
<span class="sd">    preserving all point-domain fields (handles, custom attrs, ...).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_view</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

    <span class="c1"># 1) Copy splines domain (owning copy)</span>
    <span class="n">splines</span> <span class="o">=</span> <span class="n">Spline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;COPY&#39;</span><span class="p">)</span>

    <span class="c1"># 2) Build a single flat index of point rows, bucketed by loop_total (N)</span>
    <span class="n">lt</span> <span class="o">=</span> <span class="n">splines</span><span class="o">.</span><span class="n">loop_total</span>
    <span class="n">ls</span> <span class="o">=</span> <span class="n">splines</span><span class="o">.</span><span class="n">loop_start</span>

    <span class="n">uniq_N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">lt</span><span class="p">)</span>
    <span class="n">idx_blocks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">N</span> <span class="ow">in</span> <span class="n">uniq_N</span><span class="p">:</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">N</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="p">(</span><span class="n">lt</span> <span class="o">==</span> <span class="n">N</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">sel</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">starts</span> <span class="o">=</span> <span class="n">ls</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span>                                   <span class="c1"># (B,)</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">starts</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>  <span class="c1"># (B, N)</span>
        <span class="n">idx_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>                 <span class="c1"># (B*N,)</span>

    <span class="k">if</span> <span class="n">idx_blocks</span><span class="p">:</span>
        <span class="n">idx_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">idx_blocks</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># 3) Slice the point FieldArray to keep all fields aligned</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">ControlPoint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;COPY&#39;</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="n">idx_all</span><span class="p">)</span>  <span class="c1"># owning copy</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">ControlPoint</span><span class="p">()</span>                       <span class="c1"># empty</span>

    <span class="c1"># 4) Assign back and normalize bookkeeping</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">points</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">splines</span> <span class="o">=</span> <span class="n">splines</span><span class="o">.</span><span class="n">update_loop_start</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_view</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Curve.select" class="doc doc-heading">
            <code class=" language-python"><span class="n">select</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span></code>

<a href="#npblender.Curve.select" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Explicit alias for subsetting splines; same semantics as curve[indices].</p>


            <details class="quote">
              <summary>Source code in <code>npblender/curve.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Explicit alias for subsetting splines; same semantics as curve[indices].&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>   
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Curve.to_bezier" class="doc doc-heading">
            <code class=" language-python"><span class="n">to_bezier</span><span class="p">(</span><span class="n">control_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span></code>

<a href="#npblender.Curve.to_bezier" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Convert splines to Bezier splines (OPEN storage).</p>
<h5 id="npblender.Curve.to_bezier--parameters">Parameters<a class="headerlink" href="#npblender.Curve.to_bezier--parameters" title="Permanent link">&para;</a></h5>
<p>control_count : int or None
    Number of anchor points to generate per spline. If None, keep current loop_total.
    For cyclic splines, anchors are sampled on [0,1) (no duplicate). For non-cyclic, on [0,1].
resolution : int
    Per-segment resolution to write into <code>splines.resolution</code> (&gt;=1).</p>


            <details class="quote">
              <summary>Source code in <code>npblender/curve.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_bezier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">control_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">16</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert splines to Bezier splines (OPEN storage).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    control_count : int or None</span>
<span class="sd">        Number of anchor points to generate per spline. If None, keep current loop_total.</span>
<span class="sd">        For cyclic splines, anchors are sampled on [0,1) (no duplicate). For non-cyclic, on [0,1].</span>
<span class="sd">    resolution : int</span>
<span class="sd">        Per-segment resolution to write into `splines.resolution` (&gt;=1).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">resolution</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">resolution</span><span class="p">))</span>

    <span class="n">attr_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">transdom_names</span>
    <span class="n">attr_names</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;tilt&#39;</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_to_bezier</span><span class="p">(</span><span class="n">curve</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">loop_total</span><span class="p">,</span> <span class="n">is_cyclic</span><span class="p">,</span> <span class="n">_resol</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">ctype</span> <span class="o">==</span> <span class="n">BEZIER</span> <span class="ow">and</span> <span class="n">control_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">curve</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

        <span class="c1"># Decide target anchor count N for this bucket</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">control_count</span><span class="p">)</span> <span class="k">if</span> <span class="n">control_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">loop_total</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">N</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># build empty bucket preserving schema</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">ControlPoint</span><span class="p">()</span>
            <span class="n">spl</span> <span class="o">=</span> <span class="n">Spline</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="p">)</span>
            <span class="n">spl</span><span class="o">.</span><span class="n">curve_type</span> <span class="o">=</span> <span class="n">BEZIER</span>
            <span class="n">spl</span><span class="o">.</span><span class="n">loop_total</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">spl</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">resolution</span>
            <span class="n">spl</span><span class="o">.</span><span class="n">update_loop_start</span><span class="p">()</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">Curve</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">pts</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="n">spl</span><span class="p">)</span>
            <span class="n">out</span><span class="o">.</span><span class="n">is_view</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="n">out</span>

        <span class="c1"># Parameter grid for anchors</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="ow">not</span> <span class="n">is_cyclic</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bfloat</span><span class="p">)</span>

        <span class="c1"># Evaluate anchors</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>                  <span class="c1"># (S, N, 3) or (S,3) if N==1</span>
        <span class="k">if</span> <span class="n">P</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">P</span> <span class="o">=</span> <span class="n">P</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>                  <span class="c1"># (S,1,3) uniformize</span>

        <span class="c1"># Compute handles from anchors (Catmull-Rom style tangents, linear-preserving scale)</span>
        <span class="n">L</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">Curve</span><span class="o">.</span><span class="n">compute_bezier_handles</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="n">is_cyclic</span><span class="p">)</span>  <span class="c1"># (S,N,3) each</span>

        <span class="c1"># Flatten (S,N,3) → (S*N,3)</span>
        <span class="n">P_flat</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">L_flat</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">R_flat</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="c1"># Sample additional point attributes at anchors</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">curve</span><span class="o">.</span><span class="n">sample_attributes</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">attr_names</span><span class="p">,</span> <span class="n">cubic</span><span class="o">=</span><span class="p">(</span><span class="n">ctype</span> <span class="o">==</span> <span class="n">BEZIER</span><span class="p">))</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">field_shape</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">get_field_shape</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>  <span class="c1"># e.g. (), (D,), (H,W), ...</span>
            <span class="k">if</span> <span class="n">field_shape</span> <span class="o">==</span> <span class="p">():</span>
                <span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,)</span> <span class="o">+</span> <span class="n">field_shape</span><span class="p">)</span>

        <span class="c1"># Build new domains for this bucket</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">ControlPoint</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">P_flat</span><span class="p">,</span>
                                <span class="n">handle_left</span><span class="o">=</span><span class="n">L_flat</span><span class="p">,</span>
                                <span class="n">handle_right</span><span class="o">=</span><span class="n">R_flat</span><span class="p">,</span>
                                <span class="n">attr_from</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">,</span>
                                <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>

        <span class="n">splines</span> <span class="o">=</span> <span class="n">Spline</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="p">)</span>  <span class="c1"># copy bucket rows</span>
        <span class="n">splines</span><span class="o">.</span><span class="n">curve_type</span> <span class="o">=</span> <span class="n">BEZIER</span>
        <span class="n">splines</span><span class="o">.</span><span class="n">loop_total</span> <span class="o">=</span> <span class="n">N</span>
        <span class="n">splines</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">resolution</span>
        <span class="n">splines</span><span class="o">.</span><span class="n">update_loop_start</span><span class="p">()</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">Curve</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">points</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="n">splines</span><span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">is_view</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="c1"># Aggregate all buckets into a fresh curve (materials kept)</span>
    <span class="n">new_curve</span> <span class="o">=</span> <span class="n">Curve</span><span class="p">(</span><span class="n">materials</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">for_each_bucket</span><span class="p">(</span><span class="n">_to_bezier</span><span class="p">):</span>
        <span class="n">new_curve</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span> <span class="n">join_fields</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">new_curve</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">points</span><span class="p">,</span>   <span class="n">join_fields</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">new_curve</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">update_loop_start</span><span class="p">()</span>
    <span class="n">new_curve</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">resolution</span>
    <span class="k">return</span> <span class="n">new_curve</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Curve.to_curve_data" class="doc doc-heading">
            <code class=" language-python"><span class="n">to_curve_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

<a href="#npblender.Curve.to_curve_data" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize the geometry from a Blender Curve</p>
<h5 id="npblender.Curve.to_curve_data--arguments">Arguments<a class="headerlink" href="#npblender.Curve.to_curve_data--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="p">(</span><span class="n">Blender</span><span class="w"> </span><span class="n">Curve</span><span class="w"> </span><span class="n">instance</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">curve</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="nb">load</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/curve.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_curve_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Initialize the geometry from a Blender Curve</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - data (Blender Curve instance) : the curve to load</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

    <span class="n">bl_splines</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">splines</span>
    <span class="n">bl_splines</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i_spline</span><span class="p">,</span> <span class="p">(</span><span class="n">curve_type</span><span class="p">,</span> <span class="n">loop_start</span><span class="p">,</span> <span class="n">loop_total</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">curve_type</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">loop_start</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">loop_total</span><span class="p">,</span>
    <span class="p">)):</span>

        <span class="k">if</span> <span class="n">curve_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">bl_spline</span> <span class="o">=</span> <span class="n">bl_splines</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;BEZIER&#39;</span><span class="p">)</span>
            <span class="n">coll</span> <span class="o">=</span> <span class="n">bl_spline</span><span class="o">.</span><span class="n">bezier_points</span>

            <span class="n">coll</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">loop_total</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">coll</span><span class="p">))</span>

            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">loop_start</span><span class="p">:</span><span class="n">loop_start</span><span class="o">+</span><span class="n">loop_total</span><span class="p">]</span>
            <span class="n">coll</span><span class="o">.</span><span class="n">foreach_set</span><span class="p">(</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>

            <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;handle_left&#39;</span><span class="p">,</span> 
                <span class="s1">&#39;handle_right&#39;</span><span class="p">,</span> 
                <span class="p">(</span><span class="s1">&#39;handle_type_left&#39;</span><span class="p">,</span> <span class="s1">&#39;handle_left_type&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;handle_type_right&#39;</span><span class="p">,</span> <span class="s1">&#39;handle_right_type&#39;</span><span class="p">),</span>
                <span class="s1">&#39;radius&#39;</span><span class="p">,</span> 
                <span class="s1">&#39;tilt&#39;</span><span class="p">,</span>
                <span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">curve_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">bl_spline</span> <span class="o">=</span> <span class="n">bl_splines</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;POLY&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>            
                <span class="n">bl_spline</span> <span class="o">=</span> <span class="n">bl_splines</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;NURBS&#39;</span><span class="p">)</span>

            <span class="n">coll</span> <span class="o">=</span> <span class="n">bl_spline</span><span class="o">.</span><span class="n">points</span>
            <span class="n">coll</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">loop_total</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">coll</span><span class="p">))</span>

            <span class="n">p4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">loop_total</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bfloat</span><span class="p">)</span>
            <span class="n">p4</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">loop_start</span><span class="p">:</span><span class="n">loop_start</span><span class="o">+</span><span class="n">loop_total</span><span class="p">]</span>
            <span class="n">p4</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="n">loop_start</span><span class="p">:</span><span class="n">loop_start</span><span class="o">+</span><span class="n">loop_total</span><span class="p">]</span>

            <span class="n">coll</span><span class="o">.</span><span class="n">foreach_set</span><span class="p">(</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">p4</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>

            <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">,</span> <span class="s1">&#39;tilt&#39;</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">]</span>


        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">field_name</span> <span class="o">=</span> <span class="n">attr</span>
                <span class="n">attr_name</span> <span class="o">=</span> <span class="n">attr</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">field_name</span> <span class="o">=</span> <span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">attr_name</span> <span class="o">=</span> <span class="n">attr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">a</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)[</span><span class="n">loop_start</span><span class="p">:</span><span class="n">loop_start</span><span class="o">+</span><span class="n">loop_total</span><span class="p">]</span>
            <span class="n">coll</span><span class="o">.</span><span class="n">foreach_set</span><span class="p">(</span><span class="n">attr_name</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>

    <span class="c1"># Spline attrixbxutes</span>

    <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">material_index</span>
    <span class="n">bl_splines</span><span class="o">.</span><span class="n">foreach_set</span><span class="p">(</span><span class="s1">&#39;material_index&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">resolution</span>
    <span class="n">bl_splines</span><span class="o">.</span><span class="n">foreach_set</span><span class="p">(</span><span class="s1">&#39;resolution_u&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">cyclic</span>
    <span class="n">bl_splines</span><span class="o">.</span><span class="n">foreach_set</span><span class="p">(</span><span class="s1">&#39;use_cyclic_u&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Curve.to_mesh" class="doc doc-heading">
            <code class=" language-python"><span class="n">to_mesh</span><span class="p">(</span><span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">caps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_radius</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">camera_culling</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#npblender.Curve.to_mesh" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <blockquote>
<p>Transform curve to mesh</p>
</blockquote>
<p>If profile is None, the mesh contains only edges
otherwise they are ignored</p>
<h5 id="npblender.Curve.to_mesh--arguments">Arguments<a class="headerlink" href="#npblender.Curve.to_mesh--arguments" title="Permanent link">&para;</a></h5>
<ul>
<li>profile (Curve = None) : profile curve</li>
<li>caps (bool = True) : use caps</li>
<li>use_radius (bool = True) : use the radius as a scale for profile</li>
</ul>
<h5 id="npblender.Curve.to_mesh--returns">Returns<a class="headerlink" href="#npblender.Curve.to_mesh--returns" title="Permanent link">&para;</a></h5>
<ul>
<li>Mesh</li>
</ul>


            <details class="quote">
              <summary>Source code in <code>npblender/curve.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">caps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_radius</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">camera_culling</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; &gt; Transform curve to mesh</span>

<span class="sd">    If profile is None, the mesh contains only edges</span>
<span class="sd">    otherwise they are ignored</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    - profile (Curve = None) : profile curve</span>
<span class="sd">    - caps (bool = True) : use caps</span>
<span class="sd">    - use_radius (bool = True) : use the radius as a scale for profile</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    - Mesh</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">.</span> <span class="n">camera</span> <span class="kn">import</span><span class="w"> </span><span class="nn">Camera</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.</span> <span class="n">mesh</span> <span class="kn">import</span><span class="w"> </span><span class="nn">Mesh</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.maths.topology</span><span class="w"> </span><span class="kn">import</span> <span class="n">grid_corners</span><span class="p">,</span> <span class="n">grid_uv_map</span><span class="p">,</span> <span class="n">disk_uv_map</span>

    <span class="k">if</span> <span class="n">camera_culling</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">camera</span> <span class="o">=</span> <span class="n">Camera</span><span class="p">(</span><span class="n">camera_culling</span><span class="p">)</span>
        <span class="n">camera_culling</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Circle as default profile</span>
    <span class="k">if</span> <span class="n">profile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">profile_size</span> <span class="o">=</span> <span class="mf">.001</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">full_prof_mesh</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_mesh</span><span class="p">()</span>
        <span class="n">full_prof_pts</span> <span class="o">=</span> <span class="n">full_prof_mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span>
        <span class="n">full_nprof</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">full_prof_pts</span><span class="p">)</span>
        <span class="n">prof_closed</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">cyclic</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">profile_size</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">max_size</span>

    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="c1"># Add a set of splines of the same type, number of points and cyclic</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_to_mesh</span><span class="p">(</span><span class="n">curve</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">cyclic</span><span class="p">,</span> <span class="n">resol</span><span class="p">,</span> <span class="n">profile_scale</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">ctype</span> <span class="o">==</span> <span class="n">BEZIER</span><span class="p">:</span>
            <span class="n">curve</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">to_poly</span><span class="p">()</span>
            <span class="n">N</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">loop_total</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">curve</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

        <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">()</span>

        <span class="c1"># Number of splines and points</span>
        <span class="n">nsplines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="p">)</span>
        <span class="n">npoints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>

        <span class="c1"># ---------------------------------------------------------------------------</span>
        <span class="c1"># No profile : we simply build edges</span>
        <span class="c1"># ---------------------------------------------------------------------------</span>

        <span class="k">if</span> <span class="n">profile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="c1"># Create mesh points</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">add_points</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>

            <span class="c1"># Transfer trans domain attributes</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">transfer_attributes</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>

            <span class="c1"># Edges</span>
            <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npoints</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nsplines</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cyclic</span><span class="p">:</span>
                <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">nsplines</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bint</span><span class="p">)</span>
                <span class="n">edges</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">inds</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">edges</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">inds</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>
                <span class="n">edges</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">inds</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">edges</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">inds</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">nsplines</span><span class="p">,</span> <span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bint</span><span class="p">)</span>
                <span class="n">edges</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">inds</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">edges</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">inds</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>

            <span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vertex0</span><span class="o">=</span><span class="n">edges</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">vertex1</span><span class="o">=</span><span class="n">edges</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

            <span class="k">return</span> <span class="n">mesh</span>

        <span class="c1"># ---------------------------------------------------------------------------</span>
        <span class="c1"># We have a profile</span>
        <span class="c1"># ---------------------------------------------------------------------------</span>

        <span class="n">ok_caps</span> <span class="o">=</span> <span class="n">caps</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">cyclic</span> <span class="ow">and</span> <span class="n">prof_closed</span>

        <span class="c1"># Let&#39;s adapt to the scale</span>
        <span class="k">if</span> <span class="n">profile_scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nprof</span> <span class="o">=</span> <span class="n">full_nprof</span>
            <span class="n">prof_mesh</span> <span class="o">=</span> <span class="n">full_prof_mesh</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nprof</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">profile_scale</span><span class="o">*</span><span class="n">full_nprof</span><span class="p">))</span>
            <span class="n">prof_mesh</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_poly</span><span class="p">(</span><span class="n">nprof</span><span class="p">)</span><span class="o">.</span><span class="n">to_mesh</span><span class="p">()</span>
            <span class="n">ok_caps</span> <span class="o">=</span> <span class="n">ok_caps</span> <span class="ow">and</span> <span class="p">(</span><span class="n">profile_scale</span> <span class="o">&gt;</span> <span class="mf">.8</span><span class="p">)</span>

        <span class="c1"># One profile per center</span>
        <span class="n">all_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">nsplines</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">nprof</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bfloat</span><span class="p">)</span>
        <span class="n">all_points</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">prof_mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span>

        <span class="c1"># Radius</span>
        <span class="k">if</span> <span class="n">use_radius</span><span class="p">:</span>
            <span class="n">all_points</span> <span class="o">*=</span> <span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">radius</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nsplines</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Orientation along the tangent</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="ow">not</span> <span class="n">cyclic</span><span class="p">)</span>
        <span class="n">tangent</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">tangent</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># (nsplines, N, 3)</span>

        <span class="n">rot</span> <span class="o">=</span> <span class="n">Rotation</span><span class="o">.</span><span class="n">look_at</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">tangent</span><span class="p">,</span> <span class="n">up</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">normalized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># (nsplines, N, 3)</span>

        <span class="c1"># Tilt</span>
        <span class="n">euler</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">npoints</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bfloat</span><span class="p">)</span>
        <span class="n">euler</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">tilt</span>
        <span class="n">tilt</span> <span class="o">=</span> <span class="n">Rotation</span><span class="o">.</span><span class="n">from_euler</span><span class="p">(</span><span class="n">euler</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nsplines</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">rot</span> <span class="o">=</span> <span class="n">rot</span> <span class="o">@</span> <span class="n">tilt</span>

        <span class="c1"># Rotation</span>
        <span class="n">all_points</span> <span class="o">=</span> <span class="n">rot</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">@</span> <span class="n">all_points</span>

        <span class="c1"># Translation</span>
        <span class="n">all_points</span> <span class="o">+=</span> <span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nsplines</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="n">all_points</span> <span class="o">=</span> <span class="n">all_points</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="n">mesh</span><span class="o">.</span><span class="n">add_points</span><span class="p">(</span><span class="n">all_points</span><span class="p">)</span>

        <span class="c1"># Transfer trans domain attributes</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">transfer_attributes</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">nsplines</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">nprof</span><span class="p">),</span> <span class="n">other_shape</span><span class="o">=</span><span class="p">(</span><span class="n">nsplines</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">transfer_attributes</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">nsplines</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">nprof</span><span class="p">),</span> <span class="n">other_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nprof</span><span class="p">))</span>

        <span class="c1"># Grid corners</span>
        <span class="n">corners</span> <span class="o">=</span> <span class="n">grid_corners</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">nprof</span><span class="p">,</span> <span class="n">row_first</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">close_x</span><span class="o">=</span><span class="n">cyclic</span><span class="p">,</span> <span class="n">close_y</span><span class="o">=</span><span class="n">prof_closed</span><span class="p">,</span> <span class="n">clockwise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">ncorners</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span>
        <span class="n">corners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">corners</span><span class="p">,</span> <span class="n">nsplines</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nsplines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bint</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">nprof</span><span class="o">*</span><span class="n">N</span><span class="p">),</span> <span class="n">ncorners</span><span class="p">)</span>

        <span class="n">bbox</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">.499</span><span class="p">]</span> <span class="k">if</span> <span class="n">ok_caps</span> <span class="k">else</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">uvmap</span> <span class="o">=</span> <span class="n">grid_uv_map</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">nprof</span><span class="p">,</span> <span class="n">close_x</span><span class="o">=</span><span class="n">cyclic</span><span class="p">,</span> <span class="n">close_y</span><span class="o">=</span><span class="n">prof_closed</span><span class="p">,</span> <span class="n">clockwise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">uvmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">uvmap</span><span class="p">,</span> <span class="p">(</span><span class="n">nsplines</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="n">mesh</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">corners</span><span class="o">=</span><span class="n">corners</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">faces</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">UVMap</span><span class="o">=</span><span class="n">uvmap</span><span class="p">)</span>

        <span class="c1">#Caps</span>
        <span class="k">if</span> <span class="n">ok_caps</span><span class="p">:</span>
            <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_points</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nsplines</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">nprof</span><span class="p">)</span>

            <span class="n">cap_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">inds</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">uvmap</span> <span class="o">=</span> <span class="n">disk_uv_map</span><span class="p">(</span><span class="n">nprof</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;NGON&#39;</span><span class="p">,</span> <span class="n">clockwise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">uvmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">uvmap</span><span class="p">,</span> <span class="p">(</span><span class="n">nsplines</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">corners</span><span class="o">=</span><span class="n">cap_inds</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">faces</span><span class="o">=</span><span class="n">nprof</span><span class="p">,</span> <span class="n">UVMap</span><span class="o">=</span><span class="n">uvmap</span><span class="p">)</span>

            <span class="n">cap_inds</span> <span class="o">=</span> <span class="n">inds</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">uvmap</span> <span class="o">=</span> <span class="n">disk_uv_map</span><span class="p">(</span><span class="n">nprof</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;NGON&#39;</span><span class="p">,</span> <span class="n">clockwise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="p">[</span><span class="mf">.5</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">uvmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">uvmap</span><span class="p">,</span> <span class="p">(</span><span class="n">nsplines</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">corners</span><span class="o">=</span><span class="n">cap_inds</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">faces</span><span class="o">=</span><span class="n">nprof</span><span class="p">,</span> <span class="n">UVMap</span><span class="o">=</span><span class="n">uvmap</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mesh</span>

    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="c1"># Add a set of splines of the same type, number of points and cyclic</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_cam_culling</span><span class="p">(</span><span class="n">curve</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">cyclic</span><span class="p">,</span> <span class="n">resol</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">ctype</span> <span class="o">==</span> <span class="n">BEZIER</span><span class="p">:</span>
            <span class="n">curve</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">to_poly</span><span class="p">()</span>
            <span class="n">N</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">loop_total</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">curve</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

        <span class="c1"># No camera culling, this is simple</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">camera_culling</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_to_mesh</span><span class="p">(</span><span class="n">curve</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">cyclic</span><span class="p">,</span> <span class="n">resol</span><span class="p">)</span>

        <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">()</span>

        <span class="c1"># Visible points</span>
        <span class="n">vis</span><span class="p">,</span> <span class="n">dist</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">visible_points</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">profile_size</span><span class="p">)</span>
        <span class="n">vis</span> <span class="o">=</span> <span class="n">vis</span><span class="p">[:,</span> <span class="n">camera</span><span class="o">.</span><span class="n">VISIBLE</span><span class="p">]</span>

        <span class="c1"># Spline is visible if any point is visible</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">curve</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mesh</span>

        <span class="c1"># One p_size per spline</span>
        <span class="n">p_size</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[:,</span> <span class="n">camera</span><span class="o">.</span><span class="n">SIZE</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)[</span><span class="n">sel</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span>

        <span class="c1"># On distance per spline</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[:,</span> <span class="n">camera</span><span class="o">.</span><span class="n">DISTANCE</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)[</span><span class="n">sel</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Curve length</span>
        <span class="n">length</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">length</span>

        <span class="c1"># profile_size is seen as p_size, ratio = p_size/profile_size</span>
        <span class="c1">#ratio = p_size/profile_size</span>
        <span class="c1">#app_length = ratio*length</span>
        <span class="n">app_length</span> <span class="o">=</span> <span class="n">length</span><span class="o">*</span><span class="n">camera</span><span class="o">.</span><span class="n">pixels_per_meter</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>

        <span class="c1"># around 5 pixel per segment</span>
        <span class="n">npix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">app_length</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="c1"># We loop per npix</span>
        <span class="n">new_Ns</span><span class="p">,</span> <span class="n">rev_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">npix</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i_new</span><span class="p">,</span> <span class="n">new_N</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_Ns</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="n">rev_index</span> <span class="o">==</span> <span class="n">i_new</span><span class="p">]</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span><span class="o">.</span><span class="n">to_poly</span><span class="p">(</span><span class="n">new_N</span><span class="p">)</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_to_mesh</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">POLY</span><span class="p">,</span> <span class="n">new_N</span><span class="p">,</span> <span class="n">cyclic</span><span class="p">,</span> <span class="n">resol</span><span class="p">,</span> <span class="n">profile_scale</span><span class="o">=</span><span class="n">new_N</span><span class="o">/</span><span class="n">N</span><span class="p">))</span>

        <span class="c1"># Done !!!</span>
        <span class="k">return</span> <span class="n">mesh</span>

    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="c1"># Main</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>

    <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">for_each_bucket</span><span class="p">(</span><span class="n">_cam_culling</span><span class="p">):</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mesh</span>    
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Curve.to_object" class="doc doc-heading">
            <code class=" language-python"><span class="n">to_object</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#npblender.Curve.to_object" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create or update a blender object.</p>
<p>The method 'to_object' creates the whole geometry. It creates a new object if it doesn't already exist.
If the object exists, it must be a curve, there is no object type conversion.</p>
<p>Once the object is created, use the method 'update_object' to change the vertices.</p>
<h5 id="npblender.Curve.to_object--arguments">Arguments<a class="headerlink" href="#npblender.Curve.to_object--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- obj (str or Blender object) : the object the create
</code></pre></div>

<h5 id="npblender.Curve.to_object--returns">Returns<a class="headerlink" href="#npblender.Curve.to_object--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- Blender curve object
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/curve.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create or update a blender object.</span>

<span class="sd">    The method &#39;to_object&#39; creates the whole geometry. It creates a new object if it doesn&#39;t already exist.</span>
<span class="sd">    If the object exists, it must be a curve, there is no object type conversion.</span>

<span class="sd">    Once the object is created, use the method &#39;update_object&#39; to change the vertices.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - obj (str or Blender object) : the object the create</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - Blender curve object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">curve</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">create_curve_object</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">to_curve_data</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">curve</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Curve.to_poly" class="doc doc-heading">
            <code class=" language-python"><span class="n">to_poly</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#npblender.Curve.to_poly" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Convert the splines to Poly splines.</p>
<p>If resolution is None:
- <code>splines.resolution</code> is used to split Bezier segments
- poly lines are left unchanged</p>
<p>If resolution is not None, all splines are resampled using this value</p>
        <hr />
<div class="codehilite"><pre><span></span><code><span class="nv">resolution</span><span class="w"> </span><span class="ss">(</span><span class="nv">int</span><span class="ss">)</span>:<span class="w">          </span><span class="nv">Poly</span><span class="w"> </span><span class="nv">resolution</span>,<span class="w"> </span><span class="nv">use</span><span class="w"> </span><span class="nv">spline</span><span class="w"> </span><span class="nv">resolution</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">Bezier</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">None</span>.
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/curve.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_poly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Convert the splines to Poly splines.</span>

<span class="sd">    If resolution is None:</span>
<span class="sd">    - `splines.resolution` is used to split Bezier segments</span>
<span class="sd">    - poly lines are left unchanged</span>

<span class="sd">    If resolution is not None, all splines are resampled using this value</span>

<span class="sd">    Arguments:</span>
<span class="sd">    ---------</span>
<span class="sd">        resolution (int):          Poly resolution, use spline resolution for Bezier if None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">resolution</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">resolution</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>

    <span class="n">attr_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">transdom_names</span>
    <span class="n">attr_names</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;tilt&#39;</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_to_poly</span><span class="p">(</span><span class="n">curve</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">loop_total</span><span class="p">,</span> <span class="n">is_cyclic</span><span class="p">,</span> <span class="n">resol</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">resolution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ctype</span> <span class="o">==</span> <span class="n">POLY</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">curve</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

            <span class="n">r</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">resol</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">is_cyclic</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loop_total</span><span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bfloat</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">loop_total</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bfloat</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ctype</span> <span class="o">==</span> <span class="n">POLY</span> <span class="ow">and</span> <span class="n">resolution</span> <span class="o">==</span> <span class="n">loop_total</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">curve</span><span class="o">.</span><span class="n">no_view</span><span class="p">()</span>

            <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="ow">not</span> <span class="n">is_cyclic</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bfloat</span><span class="p">)</span>

        <span class="n">pos</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">curve</span><span class="o">.</span><span class="n">sample_attributes</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">attr_names</span><span class="p">,</span> <span class="n">cubic</span><span class="o">=</span><span class="n">ctype</span><span class="o">==</span><span class="n">BEZIER</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">field_shape</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">get_field_shape</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">field_shape</span> <span class="o">==</span> <span class="p">():</span>
                <span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,)</span> <span class="o">+</span> <span class="n">field_shape</span><span class="p">)</span>

        <span class="n">points</span> <span class="o">=</span> <span class="n">ControlPoint</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">attr_from</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
        <span class="n">splines</span> <span class="o">=</span> <span class="n">Spline</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="p">)</span>
        <span class="n">splines</span><span class="o">.</span><span class="n">curve_type</span> <span class="o">=</span> <span class="n">POLY</span>
        <span class="n">splines</span><span class="o">.</span><span class="n">loop_total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">splines</span><span class="o">.</span><span class="n">update_loop_start</span><span class="p">()</span>

        <span class="n">new_curve</span> <span class="o">=</span> <span class="n">Curve</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">points</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="n">splines</span><span class="p">)</span>
        <span class="n">new_curve</span><span class="o">.</span><span class="n">is_view</span><span class="o">=</span><span class="kc">False</span>
        <span class="k">return</span> <span class="n">new_curve</span>

    <span class="n">new_curve</span> <span class="o">=</span> <span class="n">Curve</span><span class="p">(</span><span class="n">materials</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">for_each_bucket</span><span class="p">(</span><span class="n">_to_poly</span><span class="p">):</span>
        <span class="n">new_curve</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">splines</span><span class="p">)</span>
        <span class="n">new_curve</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>

    <span class="n">new_curve</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">update_loop_start</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">new_curve</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="npblender.Edge" class="doc doc-heading">
            <code>Edge</code>


<a href="#npblender.Edge" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="npblender.domain.Domain">Domain</span></code></p>


        <p>Edge domain.</p>
<h4 id="npblender.Edge--attributes">Attributes<a class="headerlink" href="#npblender.Edge--attributes" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code>- vertex0 (int) : index of the first vertex
- vertex1 (int) : index of the second vertex
</code></pre></div>








              <details class="quote">
                <summary>Source code in <code>npblender/domain.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Edge</span><span class="p">(</span><span class="n">Domain</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Edge domain.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ---------</span>
<span class="sd">        - vertex0 (int) : index of the first vertex</span>
<span class="sd">        - vertex1 (int) : index of the second vertex</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">domain_name</span> <span class="o">=</span> <span class="s1">&#39;EDGE&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">declare_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_int</span><span class="p">(</span><span class="s1">&#39;vertex0&#39;</span><span class="p">,</span> <span class="n">transfer</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">transdom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_int</span><span class="p">(</span><span class="s1">&#39;vertex1&#39;</span><span class="p">,</span> <span class="n">transfer</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">transdom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="nd">@vertices</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span><span class="p">,):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertex0</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertex1</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertex0</span> <span class="o">=</span> <span class="n">value</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertex1</span> <span class="o">=</span> <span class="n">value</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">halt</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">count</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">count</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Edge domain contains vertex index out of range: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex0</span><span class="p">)</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex0</span><span class="p">)</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">count</span><span class="si">=}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">halt</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex0</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex1</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Some edges use the same vertex ! </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex0</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">vertex1</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">halt</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>


    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Remove edges belonging to faces</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_face_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_edges</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">face_edges</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">face_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">face_edges</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">u_verts</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">view</span><span class="p">([(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">vertices</span><span class="o">.</span><span class="n">dtype</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">u_faces</span> <span class="o">=</span> <span class="n">face_edges</span><span class="o">.</span><span class="n">view</span><span class="p">([(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">face_edges</span><span class="o">.</span><span class="n">dtype</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">u_verts</span><span class="p">,</span> <span class="n">u_faces</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Compute attribute on points</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_attribute_on_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>

        <span class="nd">@njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">_to_points</span><span class="p">(</span><span class="n">vertex0</span><span class="p">,</span> <span class="n">vertex1</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span>
            <span class="n">npoints</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">nedges</span> <span class="o">=</span> <span class="n">vertex0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npoints</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">iedge</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nedges</span><span class="p">):</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="n">iedge</span><span class="p">]</span>

                <span class="n">ipoint</span> <span class="o">=</span> <span class="n">vertex0</span><span class="p">[</span><span class="n">iedge</span><span class="p">]</span>
                <span class="n">res</span><span class="p">[</span><span class="n">ipoint</span><span class="p">]</span> <span class="o">+=</span> <span class="n">s</span>
                <span class="n">count</span><span class="p">[</span><span class="n">ipoint</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">ipoint</span> <span class="o">=</span> <span class="n">vertex1</span><span class="p">[</span><span class="n">iedge</span><span class="p">]</span>
                <span class="n">res</span><span class="p">[</span><span class="n">ipoint</span><span class="p">]</span> <span class="o">+=</span> <span class="n">s</span>
                <span class="n">count</span><span class="p">[</span><span class="n">ipoint</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">trailing</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">ndim</span><span class="p">):</span>
                <span class="n">trailing</span> <span class="o">*=</span> <span class="n">res</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>

            <span class="n">R2</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">npoints</span><span class="p">,</span> <span class="n">trailing</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">ipoint</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npoints</span><span class="p">):</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">count</span><span class="p">[</span><span class="n">ipoint</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">inv</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">c</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trailing</span><span class="p">):</span>
                        <span class="n">R2</span><span class="p">[</span><span class="n">ipoint</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*=</span> <span class="n">inv</span>

            <span class="k">return</span> <span class="n">res</span>  

        <span class="n">attr</span><span class="p">,</span> <span class="n">item_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_attribute_to_compute</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">),)</span> <span class="o">+</span> <span class="n">item_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">attr</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_to_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex1</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>                
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="npblender.Face" class="doc doc-heading">
            <code>Face</code>


<a href="#npblender.Face" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="npblender.domain.FaceSplineDomain">FaceSplineDomain</span></code></p>









              <details class="quote">
                <summary>Source code in <code>npblender/domain.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Face</span><span class="p">(</span><span class="n">FaceSplineDomain</span><span class="p">):</span>

    <span class="n">domain_name</span> <span class="o">=</span> <span class="s1">&#39;FACE&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">declare_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">declare_attributes</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">new_bool</span><span class="p">(</span><span class="s1">&#39;sharp_face&#39;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transdom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Delete loops</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_loops</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="p">,</span> <span class="n">corners</span><span class="p">):</span>
        <span class="n">corner_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span><span class="o">.</span><span class="n">get_corner_indices</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>
        <span class="n">vert_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">corners</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">[</span><span class="n">corner_indices</span><span class="p">])</span>
        <span class="n">corners</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">corner_indices</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">vert_indices</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Get edges</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Get the edges per face as start, count arrays</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_face_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corners</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return edge couples with ordered vertex indices par face.</span>

<span class="sd">        The face edge couples can be accessed via loop_start and loop_total</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nd">@njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">_get_edges</span><span class="p">(</span><span class="n">loop_start</span><span class="p">,</span> <span class="n">loop_total</span><span class="p">,</span> <span class="n">vertex_index</span><span class="p">):</span>

            <span class="n">ncorners</span> <span class="o">=</span> <span class="n">vertex_index</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">edges</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">ncorners</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

            <span class="n">nfaces</span> <span class="o">=</span> <span class="n">loop_start</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">iedge</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">iface</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nfaces</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">loop_start</span><span class="p">[</span><span class="n">iface</span><span class="p">]</span>
                <span class="n">total</span> <span class="o">=</span> <span class="n">loop_total</span><span class="p">[</span><span class="n">iface</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">icorner</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">start</span> <span class="o">+</span> <span class="n">total</span><span class="p">):</span>
                    <span class="n">ipoint</span> <span class="o">=</span> <span class="n">vertex_index</span><span class="p">[</span><span class="n">icorner</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">icorner</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">iprec</span> <span class="o">=</span> <span class="n">vertex_index</span><span class="p">[</span><span class="n">start</span> <span class="o">+</span> <span class="n">total</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">iprec</span> <span class="o">=</span> <span class="n">vertex_index</span><span class="p">[</span><span class="n">ipoint</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">iprec</span> <span class="o">&lt;</span> <span class="n">ipoint</span><span class="p">:</span>
                        <span class="n">edges</span><span class="p">[</span><span class="n">iedge</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">iprec</span>
                        <span class="n">edges</span><span class="p">[</span><span class="n">iedge</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ipoint</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">edges</span><span class="p">[</span><span class="n">iedge</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ipoint</span>
                        <span class="n">edges</span><span class="p">[</span><span class="n">iedge</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">iprec</span>
                    <span class="n">iedge</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">return</span> <span class="n">edges</span>

        <span class="k">return</span> <span class="n">_get_edges</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop_total</span><span class="p">,</span> <span class="n">corners</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">)</span>


    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Get all the edges as ordered couples</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corners</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Get all the edge couples of the faces.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face_edges</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Get position</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corners</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">points</span><span class="o">.</span><span class="n">compute_attribute_on_faces</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">,</span> <span class="n">corners</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Surfaces and normals</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="c1"># Surface is computed by cross products of triangle. This also gives</span>
    <span class="c1"># the normal to the face. The vector normal the length of which is the surface</span>
    <span class="c1"># is called the &quot;surface vector&quot;.</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">area_vect</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">return_vector</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">sv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span>
                    <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span>
                    <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>

        <span class="k">elif</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">sv</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span>
                        <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span>
                        <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
                    <span class="p">)</span> <span class="o">+</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span>
                        <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:],</span>
                        <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>
                    <span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">sv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">vs</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="o">-</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">sv</span> <span class="o">+=</span> <span class="n">Face</span><span class="o">.</span><span class="n">surf_vect</span><span class="p">(</span><span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span> <span class="p">:],</span> <span class="mi">3</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">return_vector</span> <span class="o">==</span> <span class="s1">&#39;AREA&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">sv</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

        <span class="k">elif</span> <span class="n">return_vector</span> <span class="o">==</span> <span class="s1">&#39;NORMAL&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sv</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">sv</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sv</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">area_vectors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corners</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Compute the surfaces vectors</span>

<span class="sd">        The surfaces are computed by cross products of triangles.</span>
<span class="sd">        This also gives the normal to the face.</span>
<span class="sd">        The normal vector normal the length of which is the surface</span>
<span class="sd">        is called the *surface vector*.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - faces (int or array of ints = None) : the faces</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - array of vectors of floats: The surfaces normals</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Less efficient</span>
        <span class="k">if</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">USE_JIT</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">area_vectors_jit</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop_total</span><span class="p">)</span>

        <span class="c1"># ---------------------------------------------------------------------------</span>
        <span class="c1"># Compute the surface for faces of the same size</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">surf_vect</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span>
                        <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">,:],</span>
                        <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">,:])</span>

            <span class="k">elif</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span>
                            <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span>
                            <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">3</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
                        <span class="p">)</span> <span class="o">+</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span>
                            <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">3</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:],</span>
                            <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>
                        <span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">sv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">vs</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="o">-</span><span class="mi">2</span><span class="p">):</span>
                    <span class="n">sv</span> <span class="o">+=</span> <span class="n">surf_vect</span><span class="p">(</span><span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span> <span class="p">:],</span> <span class="mi">3</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">sv</span>

        <span class="c1"># ---------------------------------------------------------------------------</span>
        <span class="c1"># The surfaces</span>

        <span class="n">area_vectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">size</span><span class="p">,</span> <span class="n">fcs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_size</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="n">f_ind</span> <span class="o">=</span> <span class="n">fcs</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span>
            <span class="n">c_ind</span> <span class="o">=</span> <span class="n">fcs</span><span class="p">[</span><span class="s1">&#39;loop_index&#39;</span><span class="p">]</span>

            <span class="n">verts</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">corners</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">[</span><span class="n">c_ind</span><span class="p">]]</span>

            <span class="n">area_vectors</span><span class="p">[</span><span class="n">f_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">surf_vect</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">area_vectors</span>

    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="c1"># Surfaces : norm of the perpendicular vectors</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">area</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corners</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Faces areas</span>

<span class="sd">        Args:</span>
<span class="sd">            verts (array (:, 3) of floats): The vertices</span>

<span class="sd">        Returns:</span>
<span class="sd">            array (len(self)) of floats: The surfaces</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">area_vectors</span><span class="p">(</span><span class="n">corners</span><span class="p">,</span> <span class="n">points</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="c1"># Normals : normalized surface vectors</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">normal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corners</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Compute the normals</span>

<span class="sd">        Args:</span>
<span class="sd">            verts (array (:, 3) of floats): The vertices</span>

<span class="sd">        Returns:</span>
<span class="sd">            array (len(self), 3) of floats: The normals</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_vectors</span><span class="p">(</span><span class="n">corners</span><span class="p">,</span> <span class="n">points</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sv</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">sv</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>

    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="c1"># Centers of the faces</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corners</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Centers of the faces</span>

<span class="sd">        Args:</span>
<span class="sd">            verts (array (:, 3) of floats): The vertices</span>

<span class="sd">        Returns:</span>
<span class="sd">            array (len(self), 3) of floats: The centers</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">centers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">size</span><span class="p">,</span> <span class="n">fcs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sized_items</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="n">f_ind</span> <span class="o">=</span> <span class="n">fcs</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span>
            <span class="n">c_ind</span> <span class="o">=</span> <span class="n">fcs</span><span class="p">[</span><span class="s1">&#39;loop_index&#39;</span><span class="p">]</span>

            <span class="n">verts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">c_ind</span><span class="p">]</span>

            <span class="n">centers</span><span class="p">[</span><span class="n">f_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">centers</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Get surface as a dict</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_surface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corners</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>

        <span class="n">svs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_vectors</span><span class="p">(</span><span class="n">corners</span><span class="p">,</span> <span class="n">points</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">svs</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="n">areas2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">svs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">surf</span>  <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;normals&#39;</span><span class="p">:</span> <span class="n">svs</span><span class="o">/</span><span class="n">areas2</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span> <span class="s1">&#39;areas&#39;</span><span class="p">:</span> <span class="n">areas2</span><span class="o">/</span><span class="mi">2</span><span class="p">}</span>
        <span class="n">surf</span><span class="p">[</span><span class="s1">&#39;sizes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop_total</span>
        <span class="n">surf</span><span class="p">[</span><span class="s1">&#39;verts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">position</span>

        <span class="k">return</span> <span class="n">surf</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># As a list of sequences</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corners</span><span class="p">):</span>
        <span class="n">inds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">corners</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">inds</span><span class="p">[</span><span class="n">lstart</span><span class="p">:</span><span class="n">lstart</span><span class="o">+</span><span class="n">ltotal</span><span class="p">]</span> <span class="k">for</span> <span class="p">(</span><span class="n">lstart</span><span class="p">,</span> <span class="n">ltotal</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop_total</span><span class="p">)]</span>     

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Compute attribute on points</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_attribute_on_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">corners</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>

        <span class="nd">@njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">_to_points</span><span class="p">(</span><span class="n">loop_start</span><span class="p">,</span> <span class="n">loop_total</span><span class="p">,</span> <span class="n">vertex_index</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span>
            <span class="n">npoints</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">nfaces</span> <span class="o">=</span> <span class="n">loop_start</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npoints</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">iface</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nfaces</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">loop_start</span><span class="p">[</span><span class="n">iface</span><span class="p">]</span>
                <span class="n">total</span> <span class="o">=</span> <span class="n">loop_total</span><span class="p">[</span><span class="n">iface</span><span class="p">]</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="n">iface</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">icorner</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">start</span> <span class="o">+</span> <span class="n">total</span><span class="p">):</span>
                    <span class="n">ipoint</span> <span class="o">=</span> <span class="n">vertex_index</span><span class="p">[</span><span class="n">icorner</span><span class="p">]</span>
                    <span class="n">res</span><span class="p">[</span><span class="n">ipoint</span><span class="p">]</span> <span class="o">+=</span> <span class="n">s</span>
                    <span class="n">count</span><span class="p">[</span><span class="n">ipoint</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">trailing</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">ndim</span><span class="p">):</span>
                <span class="n">trailing</span> <span class="o">*=</span> <span class="n">res</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>

            <span class="n">R2</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">npoints</span><span class="p">,</span> <span class="n">trailing</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">ipoint</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npoints</span><span class="p">):</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">count</span><span class="p">[</span><span class="n">ipoint</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">inv</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">c</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trailing</span><span class="p">):</span>
                        <span class="n">R2</span><span class="p">[</span><span class="n">ipoint</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*=</span> <span class="n">inv</span>

            <span class="k">return</span> <span class="n">res</span>  

        <span class="n">attr</span><span class="p">,</span> <span class="n">item_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_attribute_to_compute</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">),)</span> <span class="o">+</span> <span class="n">item_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">attr</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_to_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop_total</span><span class="p">,</span> <span class="n">corners</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>                
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="npblender.Face.area" class="doc doc-heading">
            <code class=" language-python"><span class="n">area</span><span class="p">(</span><span class="n">corners</span><span class="p">,</span> <span class="n">points</span><span class="p">)</span></code>

<a href="#npblender.Face.area" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Faces areas</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>verts</code>
            </td>
            <td>
                  <code><span title="array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>, 3) of floats): The vertices</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>array (len(self)) of floats: The surfaces</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>npblender/domain.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">area</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corners</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Faces areas</span>

<span class="sd">    Args:</span>
<span class="sd">        verts (array (:, 3) of floats): The vertices</span>

<span class="sd">    Returns:</span>
<span class="sd">        array (len(self)) of floats: The surfaces</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">area_vectors</span><span class="p">(</span><span class="n">corners</span><span class="p">,</span> <span class="n">points</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Face.area_vectors" class="doc doc-heading">
            <code class=" language-python"><span class="n">area_vectors</span><span class="p">(</span><span class="n">corners</span><span class="p">,</span> <span class="n">points</span><span class="p">)</span></code>

<a href="#npblender.Face.area_vectors" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute the surfaces vectors</p>
<p>The surfaces are computed by cross products of triangles.
This also gives the normal to the face.
The normal vector normal the length of which is the surface
is called the <em>surface vector</em>.</p>
<h5 id="npblender.Face.area_vectors--arguments">Arguments<a class="headerlink" href="#npblender.Face.area_vectors--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- faces (int or array of ints = None) : the faces
</code></pre></div>

<h5 id="npblender.Face.area_vectors--returns">Returns<a class="headerlink" href="#npblender.Face.area_vectors--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- array of vectors of floats: The surfaces normals
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/domain.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">area_vectors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corners</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Compute the surfaces vectors</span>

<span class="sd">    The surfaces are computed by cross products of triangles.</span>
<span class="sd">    This also gives the normal to the face.</span>
<span class="sd">    The normal vector normal the length of which is the surface</span>
<span class="sd">    is called the *surface vector*.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - faces (int or array of ints = None) : the faces</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - array of vectors of floats: The surfaces normals</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Less efficient</span>
    <span class="k">if</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">USE_JIT</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">area_vectors_jit</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop_total</span><span class="p">)</span>

    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="c1"># Compute the surface for faces of the same size</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">surf_vect</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span>
                    <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">,:],</span>
                    <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">,:])</span>

        <span class="k">elif</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span>
                        <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span>
                        <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">3</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
                    <span class="p">)</span> <span class="o">+</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span>
                        <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">3</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:],</span>
                        <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>
                    <span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">sv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">vs</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="o">-</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">sv</span> <span class="o">+=</span> <span class="n">surf_vect</span><span class="p">(</span><span class="n">vs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span> <span class="p">:],</span> <span class="mi">3</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">sv</span>

    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="c1"># The surfaces</span>

    <span class="n">area_vectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">size</span><span class="p">,</span> <span class="n">fcs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_size</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

        <span class="n">f_ind</span> <span class="o">=</span> <span class="n">fcs</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span>
        <span class="n">c_ind</span> <span class="o">=</span> <span class="n">fcs</span><span class="p">[</span><span class="s1">&#39;loop_index&#39;</span><span class="p">]</span>

        <span class="n">verts</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">corners</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">[</span><span class="n">c_ind</span><span class="p">]]</span>

        <span class="n">area_vectors</span><span class="p">[</span><span class="n">f_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">surf_vect</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">area_vectors</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Face.get_edges" class="doc doc-heading">
            <code class=" language-python"><span class="n">get_edges</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span></code>

<a href="#npblender.Face.get_edges" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get all the edge couples of the faces.</p>


            <details class="quote">
              <summary>Source code in <code>npblender/domain.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corners</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Get all the edge couples of the faces.</span>
<span class="sd">    &quot;&quot;&quot;</span>        
    <span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face_edges</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Face.get_face_edges" class="doc doc-heading">
            <code class=" language-python"><span class="n">get_face_edges</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span></code>

<a href="#npblender.Face.get_face_edges" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Return edge couples with ordered vertex indices par face.</p>
<p>The face edge couples can be accessed via loop_start and loop_total</p>


            <details class="quote">
              <summary>Source code in <code>npblender/domain.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_face_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corners</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Return edge couples with ordered vertex indices par face.</span>

<span class="sd">    The face edge couples can be accessed via loop_start and loop_total</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_edges</span><span class="p">(</span><span class="n">loop_start</span><span class="p">,</span> <span class="n">loop_total</span><span class="p">,</span> <span class="n">vertex_index</span><span class="p">):</span>

        <span class="n">ncorners</span> <span class="o">=</span> <span class="n">vertex_index</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">edges</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">ncorners</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

        <span class="n">nfaces</span> <span class="o">=</span> <span class="n">loop_start</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">iedge</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">iface</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nfaces</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">loop_start</span><span class="p">[</span><span class="n">iface</span><span class="p">]</span>
            <span class="n">total</span> <span class="o">=</span> <span class="n">loop_total</span><span class="p">[</span><span class="n">iface</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">icorner</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">start</span> <span class="o">+</span> <span class="n">total</span><span class="p">):</span>
                <span class="n">ipoint</span> <span class="o">=</span> <span class="n">vertex_index</span><span class="p">[</span><span class="n">icorner</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">icorner</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">iprec</span> <span class="o">=</span> <span class="n">vertex_index</span><span class="p">[</span><span class="n">start</span> <span class="o">+</span> <span class="n">total</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">iprec</span> <span class="o">=</span> <span class="n">vertex_index</span><span class="p">[</span><span class="n">ipoint</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">iprec</span> <span class="o">&lt;</span> <span class="n">ipoint</span><span class="p">:</span>
                    <span class="n">edges</span><span class="p">[</span><span class="n">iedge</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">iprec</span>
                    <span class="n">edges</span><span class="p">[</span><span class="n">iedge</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ipoint</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">edges</span><span class="p">[</span><span class="n">iedge</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ipoint</span>
                    <span class="n">edges</span><span class="p">[</span><span class="n">iedge</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">iprec</span>
                <span class="n">iedge</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">edges</span>

    <span class="k">return</span> <span class="n">_get_edges</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop_total</span><span class="p">,</span> <span class="n">corners</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Face.normal" class="doc doc-heading">
            <code class=" language-python"><span class="n">normal</span><span class="p">(</span><span class="n">corners</span><span class="p">,</span> <span class="n">points</span><span class="p">)</span></code>

<a href="#npblender.Face.normal" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute the normals</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>verts</code>
            </td>
            <td>
                  <code><span title="array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>, 3) of floats): The vertices</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>array (len(self), 3) of floats: The normals</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>npblender/domain.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">normal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corners</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Compute the normals</span>

<span class="sd">    Args:</span>
<span class="sd">        verts (array (:, 3) of floats): The vertices</span>

<span class="sd">    Returns:</span>
<span class="sd">        array (len(self), 3) of floats: The normals</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">sv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_vectors</span><span class="p">(</span><span class="n">corners</span><span class="p">,</span> <span class="n">points</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sv</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">sv</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Face.position" class="doc doc-heading">
            <code class=" language-python"><span class="n">position</span><span class="p">(</span><span class="n">corners</span><span class="p">,</span> <span class="n">points</span><span class="p">)</span></code>

<a href="#npblender.Face.position" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Centers of the faces</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>verts</code>
            </td>
            <td>
                  <code><span title="array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>, 3) of floats): The vertices</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>array (len(self), 3) of floats: The centers</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>npblender/domain.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corners</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Centers of the faces</span>

<span class="sd">    Args:</span>
<span class="sd">        verts (array (:, 3) of floats): The vertices</span>

<span class="sd">    Returns:</span>
<span class="sd">        array (len(self), 3) of floats: The centers</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">centers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">size</span><span class="p">,</span> <span class="n">fcs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sized_items</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

        <span class="n">f_ind</span> <span class="o">=</span> <span class="n">fcs</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span>
        <span class="n">c_ind</span> <span class="o">=</span> <span class="n">fcs</span><span class="p">[</span><span class="s1">&#39;loop_index&#39;</span><span class="p">]</span>

        <span class="n">verts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">c_ind</span><span class="p">]</span>

        <span class="n">centers</span><span class="p">[</span><span class="n">f_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">centers</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="npblender.FieldArray" class="doc doc-heading">
            <code>FieldArray</code>


<a href="#npblender.FieldArray" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="object">object</span></code></p>


        <p>Dynamic structured array</p>
<p>A structured array with cache management to optimize record appending.</p>








              <details class="quote">
                <summary>Source code in <code>npblender/fieldarray.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  33</span>
<span class="normal">  34</span>
<span class="normal">  35</span>
<span class="normal">  36</span>
<span class="normal">  37</span>
<span class="normal">  38</span>
<span class="normal">  39</span>
<span class="normal">  40</span>
<span class="normal">  41</span>
<span class="normal">  42</span>
<span class="normal">  43</span>
<span class="normal">  44</span>
<span class="normal">  45</span>
<span class="normal">  46</span>
<span class="normal">  47</span>
<span class="normal">  48</span>
<span class="normal">  49</span>
<span class="normal">  50</span>
<span class="normal">  51</span>
<span class="normal">  52</span>
<span class="normal">  53</span>
<span class="normal">  54</span>
<span class="normal">  55</span>
<span class="normal">  56</span>
<span class="normal">  57</span>
<span class="normal">  58</span>
<span class="normal">  59</span>
<span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FieldArray</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot; Dynamic structured array</span>

<span class="sd">    A structured array with cache management to optimize record appending.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;_data&#39;</span><span class="p">,</span> <span class="s1">&#39;_length&#39;</span><span class="p">,</span> <span class="s1">&#39;_infos&#39;</span><span class="p">)</span>

    <span class="c1"># Used by __setattr__</span>
    <span class="c1"># Be sure to update this class property in child classes</span>
    <span class="c1"># _slots = FieldArray._slots + (x, y, ...)</span>
    <span class="n">_slots</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;_data&#39;</span><span class="p">,</span> <span class="s1">&#39;_length&#39;</span><span class="p">,</span> <span class="s1">&#39;_infos&#39;</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Initialization</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;COPY&#39;</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Initialize the array with another array</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        - a (array or FieldArray) : the array to initialize from</span>
<span class="sd">        - mode (str in &#39;COPY&#39;, &#39;CAPTURE&#39;, &#39;EMPTY&#39;) : copy the content</span>
<span class="sd">        - selector (Any = None) : a selector on data </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_infos&#39;</span><span class="p">,</span>  <span class="p">{})</span>
        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_length&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_data&#39;</span><span class="p">,</span>   <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="c1"># Make sure it is an array</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

            <span class="c1"># If we have a selector, we apply it in case names would be removed</span>
            <span class="k">if</span> <span class="n">selector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">selector</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> init&gt; invalid selector(</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span><span class="si">}</span><span class="s2">), </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">void</span><span class="p">):</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Make sure we have names</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> init&gt; input must be a structured array (selector=</span><span class="si">{</span><span class="n">selector</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

            <span class="c1"># Mode</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;COPY&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;CAPTURE&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;EMPTY&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> init&gt; mode must be in (&#39;COPY&#39;, &#39;CAPTURE&#39;, &#39;EMPTY&#39;), not &#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

            <span class="c1"># Data can be a scalar with shape ()</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>

            <span class="c1"># Build infos</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">FieldArray</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="p">{</span><span class="o">**</span><span class="n">info</span><span class="p">}</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">_infos</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                    <span class="n">shape</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
                    <span class="k">if</span> <span class="n">shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">shape</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">:</span> <span class="n">shape</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;optional&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>


    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Clone with another array</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">fa</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)()</span>
        <span class="n">fa</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="n">fa</span><span class="o">.</span><span class="n">_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span>
        <span class="n">fa</span><span class="o">.</span><span class="n">_infos</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fa</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Shape management</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_shaped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_no_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Operation&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_shaped</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> can not be applied to a shaped array </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_shaped</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">():</span>
            <span class="k">return</span> <span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">,)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">no_scalar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_scalar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_data_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_shaped</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">]</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Utilities</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> &gt; data is None.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> &gt; data is scalar.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_view</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_scalar</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Impossible to iterate on a scalar array.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_view</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__array__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Allow implicit conversion to np.ndarray&quot;&quot;&quot;</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_view</span>    
        <span class="k">return</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span> <span class="k">if</span> <span class="n">dtype</span> <span class="k">else</span> <span class="n">arr</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> None&gt;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_shaped</span><span class="p">:</span>
            <span class="n">sh_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;shape </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sh_str</span> <span class="o">=</span> <span class="s2">&quot;scalar&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_scalar</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: names: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">all_names</span><span class="si">}</span><span class="s2">, len: </span><span class="si">{</span><span class="n">sh_str</span><span class="si">}</span><span class="s2"> &gt;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&lt;{type(self).__name__}: empty&gt;&quot;</span>

        <span class="c1"># Compute max length of original field names for alignment</span>
        <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: len=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="si">}</span><span class="s2">, fields=[&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">],</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">]</span>
            <span class="n">type_str</span> <span class="o">=</span> <span class="n">FieldArray</span><span class="o">.</span><span class="n">_dtype_name</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>

            <span class="c1"># Shape display</span>
            <span class="k">if</span> <span class="n">shape</span><span class="p">:</span>
                <span class="n">type_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">shape</span><span class="p">))</span><span class="si">}</span><span class="s2">]&quot;</span>

            <span class="c1"># Extra info (e.g., default value)</span>
            <span class="n">default</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">default_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;, default=</span><span class="si">{</span><span class="n">default</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

            <span class="n">opt</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;optional&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">opt_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;O &quot;</span> <span class="k">if</span> <span class="n">opt</span> <span class="k">else</span> <span class="s2">&quot;  &quot;</span>

            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">:</span><span class="s2">&lt;</span><span class="si">{</span><span class="n">max_len</span><span class="si">}}</span><span class="s2">&#39; </span><span class="si">{</span><span class="n">opt_str</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">type_str</span><span class="si">}{</span><span class="n">default_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;]&gt;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Fields</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_dtype_name</span><span class="p">(</span><span class="n">dtype</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">dtype</span><span class="o">.</span><span class="n">name</span>  <span class="c1"># &#39;float32&#39;, &#39;int64&#39;, etc.</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s1">&#39;__name__&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">dtype</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_normalize_shape</span><span class="p">(</span><span class="n">shape</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">shape</span><span class="p">,)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">shape</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shape must be int, tuple, list or None, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Array structured dtype</span>

<span class="sd">        Returns the dtype property of the structured array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">dtype</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">all_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Column names.</span>

<span class="sd">        Returns all the field names, including optional ones.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">actual_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Column names.</span>

<span class="sd">        Returns the actual field names, excluding optional fields.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span>
        <span class="c1">#return s[name for name, infos in self._infos.items() if not infos.get(&#39;optional&#39;, False)]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">field_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_names</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_field_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_names</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;shape&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attribute name &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; not found in </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_field_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_field_shape</span><span class="p">(</span><span class="n">name</span><span class="p">)))</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Buffer management</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_buffer_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;=</span> <span class="n">size</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">new_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">:</span>
            <span class="n">new_data</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">new_data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_data_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_length</span><span class="p">):</span>
        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">size</span>
        <span class="k">if</span> <span class="n">new_length</span> <span class="o">&gt;</span> <span class="n">size</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_buffer_size</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">1.5</span><span class="o">*</span><span class="n">new_length</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Resize</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)):</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">shape</span><span class="p">,)</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_shaped</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_data_check</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">:</span>

            <span class="c1"># Fill with default is current length is null</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;optional&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">:</span><span class="n">length</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="c1"># Duplicate current content</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">reps</span> <span class="o">=</span> <span class="p">(</span><span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span>
                <span class="k">assert</span><span class="p">((</span><span class="n">reps</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">&gt;=</span> <span class="n">length</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">:</span><span class="n">length</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">],</span> <span class="n">reps</span><span class="p">)[:</span><span class="n">length</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">=</span> <span class="n">length</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Reshape</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">reshape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">shape</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">shape</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A shape can contain only one -1, not </span><span class="si">{</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">known_size</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">shape</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;All shape dimensions must be int, not </span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">s</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Shape dimensions must be -1 or &gt; 0, not </span><span class="si">{s}</span><span class="s2"> in </span><span class="si">{shape}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">s</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">known_size</span> <span class="o">*=</span> <span class="n">s</span>

        <span class="n">ok</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">shape</span><span class="p">:</span>
            <span class="n">ok</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">%</span> <span class="n">known_size</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ok</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">==</span> <span class="n">known_size</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Impossible to reshape array of length </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="si">}</span><span class="s2"> to shape </span><span class="si">{</span><span class="n">shape</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Ravel and flatten</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">ravel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_shaped</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">flatten</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_shaped</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Items</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Get attribute by name.</span>

<span class="sd">        If name is not an actual field, return default value.</span>
<span class="sd">        Name can be an array.</span>
<span class="sd">        ``` python</span>
<span class="sd">        pos = field_array.get(&quot;position&quot;, (0, 0, 1))</span>
<span class="sd">        pos = field_array.get([[0, 0, 1], [0, 0, 0]])</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>

        <span class="c1"># ---------------------------------------------------------------------------</span>
        <span class="c1"># Index is a string, we return the array of the full content</span>
        <span class="c1"># ---------------------------------------------------------------------------</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_optional_field</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">():</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_view</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="c1"># ---------------------------------------------------------------------------</span>
        <span class="c1"># Otherwise we return a FieldArray on the selection</span>
        <span class="c1"># ---------------------------------------------------------------------------</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_view</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">arr</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;CAPTURE&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_optional_field</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_view</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Names as attributes</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_optional_field</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

            <span class="c1"># Should never happen, but just in case...</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_view</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&gt; impossible to create the field &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">_infos: </span><span class="si">{</span><span class="p">[(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;optional&#39;</span><span class="p">])</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">_data: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">_data_view: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_view</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_view</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&gt; no field named &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slots</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_optional_field</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_scalar</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data_view</span><span class="p">[</span><span class="n">name</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&gt; no field named &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;. Valid names are </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">all_names</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Note that you can&#39;t use &#39;field_array[selection].</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> = ...&#39; when optional field is not created yet.&quot;</span>
                <span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Sub‑selection</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">filtered</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a FieldArray containing only the selected records.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        selector : array‑like, slice or int</span>
<span class="sd">            Any valid NumPy 1‑D index: boolean mask, integer index/array, or slice.</span>
<span class="sd">            It is applied to the current valid part of the buffer</span>
<span class="sd">            (``self._data[:self._length]``).</span>

<span class="sd">        copy : bool, optional</span>
<span class="sd">            - False    (default) =&gt; the new array shares the same memory</span>
<span class="sd">                                     (changes propagate both ways).</span>
<span class="sd">            - True           =&gt; the data are physically copied.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        FieldArray</span>
<span class="sd">            A new instance holding exactly ``len(selector)`` records and</span>
<span class="sd">            inheriting the current field‑infos.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">selector</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Nothing to select – return an empty compatible array</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="s1">&#39;EMPTY&#39;</span><span class="p">)</span>

        <span class="c1"># Apply the selector on the valid slice</span>
        <span class="c1">#selected = self._data[:self._length][selector]</span>

        <span class="c1"># Choose copy mode</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;COPY&#39;</span> <span class="k">if</span> <span class="n">copy</span> <span class="k">else</span> <span class="s1">&#39;CAPTURE&#39;</span>

        <span class="c1"># Build the new instance</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_view</span><span class="p">[</span><span class="n">selector</span><span class="p">]</span>

        <span class="n">fa</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="s1">&#39;EMPTY&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
            <span class="n">fa</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fa</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">return</span> <span class="n">fa</span>

        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="n">selector</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Create fields</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;check&quot;</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;optional&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Attribute &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; is optional but exists in _data.&quot;</span> 
                <span class="k">break</span>

            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Attribute &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; doesn&#39;t exist in _data.&quot;</span>
                <span class="k">break</span>

            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_view</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Attribute &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; doesn&#39;t exist in _data_view.&quot;</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">msg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FieldArray fields checking ok (</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in FieldArray fields checking (</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">) : </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_reserved_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slots</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">has_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------    </span>
    <span class="c1"># Create a new field in _data</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_field_in_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Add actueally a field to the structured array.</span>

<span class="sd">        The name argument must be a valid key in _infos</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - name (str) : field name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">infos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">infos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;new_field &gt; &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; is not in _infos.&quot;</span><span class="p">)</span>

        <span class="c1"># Field dtype</span>
        <span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="n">infos</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">],</span> <span class="n">infos</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">],</span> <span class="n">infos</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span>
        <span class="n">field_type</span> <span class="o">=</span> <span class="p">[(</span><span class="n">name</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span> <span class="k">if</span> <span class="n">shape</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="p">)]</span>

        <span class="c1"># Array new dtype</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_dtype</span> <span class="o">=</span> <span class="n">field_type</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">descr</span> <span class="o">+</span> <span class="n">field_type</span>

        <span class="c1"># New data</span>
        <span class="n">length</span> <span class="o">=</span> <span class="mi">10</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>

        <span class="n">new_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">new_dtype</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">new_data</span><span class="p">[</span><span class="n">name</span><span class="p">][:</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">]</span> <span class="o">=</span> <span class="n">default</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;new_field &gt; impossible to set default value </span><span class="si">{</span><span class="n">default</span><span class="si">}</span><span class="s2"> to field &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># Copy existing data in new_data</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                <span class="n">new_data</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

        <span class="c1"># Switch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">new_data</span>

        <span class="c1"># Update optional</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;optional&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------    </span>
    <span class="c1"># Declare a new field and create it if not optional</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">new_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">infos</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Add a field to the structured array.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - name (str) : field name</span>
<span class="sd">            - dtype (type) : a valid numpy dtype</span>
<span class="sd">            - shape (tuple = None) : the shape of the field</span>
<span class="sd">            - default (any = 0) : default value</span>
<span class="sd">            - optional (bool = False) : the field is created only when accessed</span>
<span class="sd">            - infos (dict) : field infos</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Reserved name</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_reserved_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;new_field &gt; &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; is a reserved name.&quot;</span><span class="p">)</span>

        <span class="c1"># Already exists</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">dtype</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="ow">or</span>
                <span class="n">shape</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;shape&#39;</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;new_field &gt; &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; is already defined.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Declare in infos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;dtype&#39;</span>    <span class="p">:</span> <span class="n">dtype</span><span class="p">,</span>
            <span class="s1">&#39;shape&#39;</span>    <span class="p">:</span> <span class="n">FieldArray</span><span class="o">.</span><span class="n">_normalize_shape</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span>
            <span class="s1">&#39;default&#39;</span>  <span class="p">:</span> <span class="n">default</span><span class="p">,</span>
            <span class="s1">&#39;optional&#39;</span> <span class="p">:</span> <span class="n">optional</span><span class="p">,</span>
            <span class="o">**</span><span class="n">infos</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="c1"># Create if not optional</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">optional</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_field_in_data</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------    </span>
    <span class="c1"># Dynamically create optional field</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_ensure_optional_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FieldArray has no field named </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;optional&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_field_in_data</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Field &#39;</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&#39; is not in _data. &quot;</span>
                    <span class="s2">&quot;make sure not to create an optional field in a selection, or a ravel() view.&quot;</span>
                    <span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------    </span>
    <span class="c1"># Copy an existing field</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------    </span>

    <span class="k">def</span><span class="w"> </span><span class="nf">copy_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">infos</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Duplicate an existing field under a new name, with optional metadata overrides.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        field_name : str</span>
<span class="sd">            The name of the existing field to copy.</span>

<span class="sd">        new_name : str</span>
<span class="sd">            The name of the new field to create.</span>

<span class="sd">        infos : keyword arguments</span>
<span class="sd">            Optional metadata (e.g. default, unit, description...) to override</span>
<span class="sd">            or supplement the original field&#39;s metadata.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        KeyError</span>
<span class="sd">            If the source field does not exist.</span>

<span class="sd">        ValueError</span>
<span class="sd">            If the target name already exists or is reserved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># --- Validation -----------------------------------------------------</span>
        <span class="k">if</span> <span class="n">field_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_names</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;copy_field &gt; unknown field &#39;</span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">new_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_names</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;copy_field &gt; &#39;</span><span class="si">{</span><span class="n">new_name</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_reserved_name</span><span class="p">(</span><span class="n">new_name</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;copy_field &gt; &#39;</span><span class="si">{</span><span class="n">new_name</span><span class="si">}</span><span class="s2">&#39; is a reserved name&quot;</span><span class="p">)</span>

        <span class="c1"># --- Duplicate infos and create -------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">new_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">field_name</span><span class="p">]}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">new_name</span><span class="p">][</span><span class="s1">&#39;optional&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_field_in_data</span><span class="p">(</span><span class="n">new_name</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------    </span>
    <span class="c1"># Join fields from another FielArray</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------    </span>

    <span class="k">def</span><span class="w"> </span><span class="nf">join_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add all missing fields from another FieldArray.</span>

<span class="sd">        For every field in `other` that is not present in `self`, a new field is created</span>
<span class="sd">        with the same dtype and shape, and initialized with its default value across all existing records.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : FieldArray</span>
<span class="sd">            Another FieldArray instance whose fields will be checked for missing fields.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">FieldArray</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">_infos</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">other</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">name</span><span class="p">]}</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;optional&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_create_field_in_data</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">new_field</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">other</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">other</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># add &amp; append</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="o">**</span><span class="n">fields</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Add count records</span>

<span class="sd">        New records are set with default values or values provided by the user in fields dict.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        count : int</span>
<span class="sd">            Number of records to add.</span>
<span class="sd">        fields : dict</span>
<span class="sd">            Keyword arguments mapping field names to values.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_no_shape</span><span class="p">(</span><span class="s2">&quot;Add records&quot;</span><span class="p">)</span>

        <span class="n">old_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">+</span> <span class="n">count</span><span class="p">)</span>
        <span class="n">sl</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">old_length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_optional_field</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">sl</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attribute name &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; not found in </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">sl</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">fields</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Append values to the structured array.</span>

<span class="sd">        The number of records to append is determined by the number of fields provided in the fields</span>
<span class="sd">        dictionary. The values of the fields are copied to the new records.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fields : dict</span>
<span class="sd">            Keyword arguments mapping field names to values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_no_shape</span><span class="p">(</span><span class="s2">&quot;Append&quot;</span><span class="p">)</span>

        <span class="c1"># Determine the number of items to append</span>
        <span class="n">count</span>  <span class="o">=</span> <span class="mi">0</span>
        <span class="n">arrays</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.append &gt; Invalid field name: &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; not in </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_optional_field</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

            <span class="c1"># Argument is a scalar: can be broadcasted to whatever field</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="p">():</span>
                <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="c1"># Argument is not scalar</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Target item shape</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>

                <span class="c1"># The argument is a single item value</span>
                <span class="k">if</span> <span class="n">shape</span> <span class="o">==</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="c1"># The target shape is a scalar</span>
                <span class="c1"># The argument must be (n,)</span>
                <span class="k">elif</span> <span class="n">shape</span> <span class="o">==</span> <span class="p">():</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.append &gt; Invalid shape for scalar field &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="si">}</span><span class="s2"> is not a 1D array&quot;</span><span class="p">)</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

                <span class="c1"># The target shape is not a scalar</span>
                <span class="c1"># The argument must be (n,) + shape</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.append &gt; Invalid shape for field &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="si">}</span><span class="s2"> is not </span><span class="si">{</span><span class="nb">str</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;n&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> 

                <span class="c1"># The target shape is a scalar</span>
                <span class="c1"># The argument shape is (n,) + shape</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

            <span class="n">arrays</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="n">count</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">n</span>

        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="c1"># Ensure the internal buffer is large enough</span>
        <span class="n">new_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">+</span> <span class="n">count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_check</span><span class="p">(</span><span class="n">new_length</span><span class="p">)</span>

        <span class="c1"># Assign values to the provided fields</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">arrays</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">:</span><span class="n">new_length</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>

        <span class="c1"># Fill missing fields with default value</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">:</span><span class="n">new_length</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>      

        <span class="c1"># To be returned</span>
        <span class="n">new_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">,</span> <span class="n">new_length</span><span class="p">)</span>

        <span class="c1"># Update current length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">=</span> <span class="n">new_length</span>

        <span class="c1"># Return the indices of records appended</span>
        <span class="k">return</span> <span class="n">new_indices</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Extend</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">join_fields</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Append multiple records from another array or FieldArray.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : FieldArray or structured np.ndarray</span>
<span class="sd">            The array of records to append. Must have named fields matching</span>
<span class="sd">            a subset of the current array&#39;s fields.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_no_shape</span><span class="p">(</span><span class="s2">&quot;Extend&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Accept both FieldArray and structured np.ndarray</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

        <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># No names</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.extend&gt; input must have named fields&quot;</span><span class="p">)</span>

        <span class="c1"># Join fields if required</span>
        <span class="k">if</span> <span class="n">join_fields</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">join_fields</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

        <span class="c1"># Ensure all fields in &#39;data&#39; are valid for this array</span>
        <span class="n">invalid</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_names</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">invalid</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;extend &gt; input contains unknown field(s): </span><span class="si">{</span><span class="n">invalid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Resize buffer</span>
        <span class="n">new_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">+</span> <span class="n">count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_check</span><span class="p">(</span><span class="n">new_length</span><span class="p">)</span>

        <span class="c1"># Copy data field by field</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_optional_field</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">:</span><span class="n">new_length</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

        <span class="c1"># Fill missing fields with default value</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actual_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">:</span><span class="n">new_length</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">=</span> <span class="n">new_length</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Multiply</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Duplicate the current records `count` times.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        count : int</span>
<span class="sd">            Number of times to repeat the current records.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This duplicates the current valid records (up to self._length).</span>
<span class="sd">        If the array is empty or count &lt;= 1, nothing happens.</span>

<span class="sd">        Example:</span>
<span class="sd">        --------</span>
<span class="sd">        If the array has 3 records and count == 4, the result will be:</span>

<span class="sd">        [rec0, rec1, rec2, rec0, rec1, rec2, rec0, rec1, rec2, rec0, rec1, rec2]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">count</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">count</span><span class="p">,)</span> <span class="o">+</span> <span class="n">shape</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Delete items</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete a selection of items from the array.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index : int, slice, or array-like</span>
<span class="sd">            The indices of the elements to delete from the current data.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This operates only on the valid range `[0:self._length]`.</span>
<span class="sd">        The internal buffer is preserved (no reallocation).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_no_shape</span><span class="p">(</span><span class="s2">&quot;Delete&quot;</span><span class="p">)</span>

        <span class="c1"># Normalize the index to a boolean mask</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">mask</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># mark items to keep</span>

        <span class="n">kept</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kept</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">:</span>
            <span class="k">return</span>  <span class="c1"># nothing deleted</span>
        <span class="k">elif</span> <span class="n">kept</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span>

        <span class="c1"># Compact the buffer in-place</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">name</span><span class="p">][:</span><span class="n">kept</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">name</span><span class="p">][:</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">=</span> <span class="n">kept</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Serialization</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">copy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">with_infos</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert the array to a dictionary of fields or (field, infos) pairs.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        copy : bool, default=True</span>
<span class="sd">            Whether to copy the arrays.</span>

<span class="sd">        with_infos : bool, default=True</span>
<span class="sd">            If True, return (array, infos) for each field.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict[str, array or (array, dict)]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">valid_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;optional&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">valid_slice</span><span class="p">]</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">copy</span> <span class="k">else</span> <span class="n">arr</span>

            <span class="n">result</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">info</span><span class="p">))</span> <span class="k">if</span> <span class="n">with_infos</span> <span class="k">else</span> <span class="n">arr</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build a FieldArray from a dictionary with field data and optional metadata.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : dict[str, array-like or (array, dict)]</span>
<span class="sd">            Mapping field names to arrays or (array, infos). Infos must include NAME.</span>

<span class="sd">        copy : bool, optional</span>
<span class="sd">            Whether to copy the data. Default: True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        FieldArray</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;from_dict &gt; input dictionary is empty&quot;</span><span class="p">)</span>

        <span class="n">arrays</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">infos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">arr</span><span class="p">,</span> <span class="n">arr_infos</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="n">arr_infos</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">arr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">arr_infos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;from_dict &gt; field &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; has no array, nor infos&quot;</span><span class="p">)</span>

                <span class="n">arr_infos</span><span class="p">[</span><span class="s1">&#39;optional&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">arr_infos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">arr_infos</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">:</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;optional&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
                <span class="n">arrays</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span>
                <span class="n">lengths</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">infos</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr_infos</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;from_dict &gt; all fields must have the same number of records&quot;</span><span class="p">)</span>

        <span class="n">n</span> <span class="o">=</span> <span class="n">lengths</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">descr</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">str</span><span class="p">,</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">str</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">arrays</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">]</span>

        <span class="n">structured</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">descr</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">arrays</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">structured</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span>

        <span class="n">fa</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">structured</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;CAPTURE&#39;</span><span class="p">)</span>
        <span class="n">fa</span><span class="o">.</span><span class="n">_infos</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">infos</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fa</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Utility : as  kwargs arguments</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">as_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a dictionary of field values formatted as kwargs.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        selector : slice, int, list, or mask</span>
<span class="sd">            Optional selection of elements to extract.</span>

<span class="sd">        include : list[str], optional</span>
<span class="sd">            List of field names (original or python names) to include.</span>

<span class="sd">        exclude : list[str], optional</span>
<span class="sd">            List of field names (original or python names) to exclude.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Mapping from python-safe field names to array values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">exclude</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">exclude</span> <span class="ow">or</span> <span class="p">[])</span>
        <span class="n">include</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">include</span><span class="p">)</span> <span class="k">if</span> <span class="n">include</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="n">base</span> <span class="o">=</span> <span class="n">FieldArray</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">selector</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;CAPTURE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">with_infos</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">base</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">include</span> <span class="ow">and</span> <span class="p">(</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">include</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">result</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="npblender.FieldArray.actual_names" class="doc doc-heading">
            <code class=" language-python"><span class="n">actual_names</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#npblender.FieldArray.actual_names" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Column names.</p>
<p>Returns the actual field names, excluding optional fields.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="npblender.FieldArray.all_names" class="doc doc-heading">
            <code class=" language-python"><span class="n">all_names</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#npblender.FieldArray.all_names" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Column names.</p>
<p>Returns all the field names, including optional ones.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="npblender.FieldArray.dtype" class="doc doc-heading">
            <code class=" language-python"><span class="n">dtype</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#npblender.FieldArray.dtype" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Array structured dtype</p>
<p>Returns the dtype property of the structured array.</p>

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="npblender.FieldArray.__array__" class="doc doc-heading">
            <code class=" language-python"><span class="n">__array__</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#npblender.FieldArray.__array__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Allow implicit conversion to np.ndarray</p>


            <details class="quote">
              <summary>Source code in <code>npblender/fieldarray.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__array__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Allow implicit conversion to np.ndarray&quot;&quot;&quot;</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_view</span>    
    <span class="k">return</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span> <span class="k">if</span> <span class="n">dtype</span> <span class="k">else</span> <span class="n">arr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.FieldArray.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;COPY&#39;</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#npblender.FieldArray.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize the array with another array</p>
<h5 id="npblender.FieldArray.__init__--arguments">Arguments<a class="headerlink" href="#npblender.FieldArray.__init__--arguments" title="Permanent link">&para;</a></h5>
<ul>
<li>a (array or FieldArray) : the array to initialize from</li>
<li>mode (str in 'COPY', 'CAPTURE', 'EMPTY') : copy the content</li>
<li>selector (Any = None) : a selector on data</li>
</ul>


            <details class="quote">
              <summary>Source code in <code>npblender/fieldarray.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;COPY&#39;</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Initialize the array with another array</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    - a (array or FieldArray) : the array to initialize from</span>
<span class="sd">    - mode (str in &#39;COPY&#39;, &#39;CAPTURE&#39;, &#39;EMPTY&#39;) : copy the content</span>
<span class="sd">    - selector (Any = None) : a selector on data </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_infos&#39;</span><span class="p">,</span>  <span class="p">{})</span>
    <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_length&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_data&#39;</span><span class="p">,</span>   <span class="kc">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

        <span class="c1"># Make sure it is an array</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

        <span class="c1"># If we have a selector, we apply it in case names would be removed</span>
        <span class="k">if</span> <span class="n">selector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">selector</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> init&gt; invalid selector(</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span><span class="si">}</span><span class="s2">), </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">void</span><span class="p">):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Make sure we have names</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> init&gt; input must be a structured array (selector=</span><span class="si">{</span><span class="n">selector</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

        <span class="c1"># Mode</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;COPY&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;CAPTURE&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;EMPTY&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> init&gt; mode must be in (&#39;COPY&#39;, &#39;CAPTURE&#39;, &#39;EMPTY&#39;), not &#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># Data can be a scalar with shape ()</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>

        <span class="c1"># Build infos</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">FieldArray</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="p">{</span><span class="o">**</span><span class="n">info</span><span class="p">}</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">_infos</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
                <span class="k">if</span> <span class="n">shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">shape</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">:</span> <span class="n">shape</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;optional&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.FieldArray.add" class="doc doc-heading">
            <code class=" language-python"><span class="n">add</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="o">**</span><span class="n">fields</span><span class="p">)</span></code>

<a href="#npblender.FieldArray.add" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Add count records</p>
<p>New records are set with default values or values provided by the user in fields dict.</p>
<h5 id="npblender.FieldArray.add--parameters">Parameters<a class="headerlink" href="#npblender.FieldArray.add--parameters" title="Permanent link">&para;</a></h5>
<p>count : int
    Number of records to add.
fields : dict
    Keyword arguments mapping field names to values.</p>


            <details class="quote">
              <summary>Source code in <code>npblender/fieldarray.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="o">**</span><span class="n">fields</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Add count records</span>

<span class="sd">    New records are set with default values or values provided by the user in fields dict.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    count : int</span>
<span class="sd">        Number of records to add.</span>
<span class="sd">    fields : dict</span>
<span class="sd">        Keyword arguments mapping field names to values.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_check_no_shape</span><span class="p">(</span><span class="s2">&quot;Add records&quot;</span><span class="p">)</span>

    <span class="n">old_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">+</span> <span class="n">count</span><span class="p">)</span>
    <span class="n">sl</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">old_length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_optional_field</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">sl</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attribute name &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; not found in </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">sl</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.FieldArray.append" class="doc doc-heading">
            <code class=" language-python"><span class="n">append</span><span class="p">(</span><span class="o">**</span><span class="n">fields</span><span class="p">)</span></code>

<a href="#npblender.FieldArray.append" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Append values to the structured array.</p>
<p>The number of records to append is determined by the number of fields provided in the fields
dictionary. The values of the fields are copied to the new records.</p>
<h5 id="npblender.FieldArray.append--parameters">Parameters<a class="headerlink" href="#npblender.FieldArray.append--parameters" title="Permanent link">&para;</a></h5>
<p>fields : dict
    Keyword arguments mapping field names to values.</p>


            <details class="quote">
              <summary>Source code in <code>npblender/fieldarray.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">fields</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Append values to the structured array.</span>

<span class="sd">    The number of records to append is determined by the number of fields provided in the fields</span>
<span class="sd">    dictionary. The values of the fields are copied to the new records.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fields : dict</span>
<span class="sd">        Keyword arguments mapping field names to values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_no_shape</span><span class="p">(</span><span class="s2">&quot;Append&quot;</span><span class="p">)</span>

    <span class="c1"># Determine the number of items to append</span>
    <span class="n">count</span>  <span class="o">=</span> <span class="mi">0</span>
    <span class="n">arrays</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.append &gt; Invalid field name: &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; not in </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_optional_field</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="c1"># Argument is a scalar: can be broadcasted to whatever field</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="p">():</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Argument is not scalar</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Target item shape</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>

            <span class="c1"># The argument is a single item value</span>
            <span class="k">if</span> <span class="n">shape</span> <span class="o">==</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="c1"># The target shape is a scalar</span>
            <span class="c1"># The argument must be (n,)</span>
            <span class="k">elif</span> <span class="n">shape</span> <span class="o">==</span> <span class="p">():</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.append &gt; Invalid shape for scalar field &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="si">}</span><span class="s2"> is not a 1D array&quot;</span><span class="p">)</span>
                <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

            <span class="c1"># The target shape is not a scalar</span>
            <span class="c1"># The argument must be (n,) + shape</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.append &gt; Invalid shape for field &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="si">}</span><span class="s2"> is not </span><span class="si">{</span><span class="nb">str</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;n&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> 

            <span class="c1"># The target shape is a scalar</span>
            <span class="c1"># The argument shape is (n,) + shape</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

        <span class="n">arrays</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="n">count</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">n</span>

    <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="c1"># Ensure the internal buffer is large enough</span>
    <span class="n">new_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">+</span> <span class="n">count</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_data_check</span><span class="p">(</span><span class="n">new_length</span><span class="p">)</span>

    <span class="c1"># Assign values to the provided fields</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">arrays</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">:</span><span class="n">new_length</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>

    <span class="c1"># Fill missing fields with default value</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">:</span><span class="n">new_length</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>      

    <span class="c1"># To be returned</span>
    <span class="n">new_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">,</span> <span class="n">new_length</span><span class="p">)</span>

    <span class="c1"># Update current length</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">=</span> <span class="n">new_length</span>

    <span class="c1"># Return the indices of records appended</span>
    <span class="k">return</span> <span class="n">new_indices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.FieldArray.as_kwargs" class="doc doc-heading">
            <code class=" language-python"><span class="n">as_kwargs</span><span class="p">(</span><span class="n">selector</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#npblender.FieldArray.as_kwargs" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Return a dictionary of field values formatted as kwargs.</p>
<h5 id="npblender.FieldArray.as_kwargs--parameters">Parameters<a class="headerlink" href="#npblender.FieldArray.as_kwargs--parameters" title="Permanent link">&para;</a></h5>
<p>selector : slice, int, list, or mask
    Optional selection of elements to extract.</p>


<details class="include-" open>
  <summary>list[str], optional</summary>
  <p>List of field names (original or python names) to include.</p>
</details>

<details class="exclude-" open>
  <summary>list[str], optional</summary>
  <p>List of field names (original or python names) to exclude.</p>
</details>        <h5 id="npblender.FieldArray.as_kwargs--returns">Returns<a class="headerlink" href="#npblender.FieldArray.as_kwargs--returns" title="Permanent link">&para;</a></h5>
<p>dict
    Mapping from python-safe field names to array values.</p>


            <details class="quote">
              <summary>Source code in <code>npblender/fieldarray.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">as_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a dictionary of field values formatted as kwargs.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    selector : slice, int, list, or mask</span>
<span class="sd">        Optional selection of elements to extract.</span>

<span class="sd">    include : list[str], optional</span>
<span class="sd">        List of field names (original or python names) to include.</span>

<span class="sd">    exclude : list[str], optional</span>
<span class="sd">        List of field names (original or python names) to exclude.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        Mapping from python-safe field names to array values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">exclude</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">exclude</span> <span class="ow">or</span> <span class="p">[])</span>
    <span class="n">include</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">include</span><span class="p">)</span> <span class="k">if</span> <span class="n">include</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="n">base</span> <span class="o">=</span> <span class="n">FieldArray</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">selector</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;CAPTURE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">with_infos</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">base</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">include</span> <span class="ow">and</span> <span class="p">(</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">include</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">result</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.FieldArray.copy_field" class="doc doc-heading">
            <code class=" language-python"><span class="n">copy_field</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">new_name</span><span class="p">,</span> <span class="o">**</span><span class="n">infos</span><span class="p">)</span></code>

<a href="#npblender.FieldArray.copy_field" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Duplicate an existing field under a new name, with optional metadata overrides.</p>
<h5 id="npblender.FieldArray.copy_field--parameters">Parameters<a class="headerlink" href="#npblender.FieldArray.copy_field--parameters" title="Permanent link">&para;</a></h5>
<p>field_name : str
    The name of the existing field to copy.</p>


<details class="new_name-" open>
  <summary>str</summary>
  <p>The name of the new field to create.</p>
</details>

<details class="infos-" open>
  <summary>keyword arguments</summary>
  <p>Optional metadata (e.g. default, unit, description...) to override
or supplement the original field's metadata.</p>
</details>        <h5 id="npblender.FieldArray.copy_field--raises">Raises<a class="headerlink" href="#npblender.FieldArray.copy_field--raises" title="Permanent link">&para;</a></h5>
<p>KeyError
    If the source field does not exist.</p>
<p>ValueError
    If the target name already exists or is reserved.</p>


            <details class="quote">
              <summary>Source code in <code>npblender/fieldarray.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">copy_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">infos</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Duplicate an existing field under a new name, with optional metadata overrides.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    field_name : str</span>
<span class="sd">        The name of the existing field to copy.</span>

<span class="sd">    new_name : str</span>
<span class="sd">        The name of the new field to create.</span>

<span class="sd">    infos : keyword arguments</span>
<span class="sd">        Optional metadata (e.g. default, unit, description...) to override</span>
<span class="sd">        or supplement the original field&#39;s metadata.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    KeyError</span>
<span class="sd">        If the source field does not exist.</span>

<span class="sd">    ValueError</span>
<span class="sd">        If the target name already exists or is reserved.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># --- Validation -----------------------------------------------------</span>
    <span class="k">if</span> <span class="n">field_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_names</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;copy_field &gt; unknown field &#39;</span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">new_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_names</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;copy_field &gt; &#39;</span><span class="si">{</span><span class="n">new_name</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_reserved_name</span><span class="p">(</span><span class="n">new_name</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;copy_field &gt; &#39;</span><span class="si">{</span><span class="n">new_name</span><span class="si">}</span><span class="s2">&#39; is a reserved name&quot;</span><span class="p">)</span>

    <span class="c1"># --- Duplicate infos and create -------------------------------------</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">new_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">field_name</span><span class="p">]}</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">new_name</span><span class="p">][</span><span class="s1">&#39;optional&#39;</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_field_in_data</span><span class="p">(</span><span class="n">new_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.FieldArray.delete" class="doc doc-heading">
            <code class=" language-python"><span class="n">delete</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></code>

<a href="#npblender.FieldArray.delete" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Delete a selection of items from the array.</p>
<h5 id="npblender.FieldArray.delete--parameters">Parameters<a class="headerlink" href="#npblender.FieldArray.delete--parameters" title="Permanent link">&para;</a></h5>
<p>index : int, slice, or array-like
    The indices of the elements to delete from the current data.</p>
<h5 id="npblender.FieldArray.delete--notes">Notes<a class="headerlink" href="#npblender.FieldArray.delete--notes" title="Permanent link">&para;</a></h5>
<p>This operates only on the valid range <code>[0:self._length]</code>.
The internal buffer is preserved (no reallocation).</p>


            <details class="quote">
              <summary>Source code in <code>npblender/fieldarray.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete a selection of items from the array.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    index : int, slice, or array-like</span>
<span class="sd">        The indices of the elements to delete from the current data.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This operates only on the valid range `[0:self._length]`.</span>
<span class="sd">    The internal buffer is preserved (no reallocation).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_no_shape</span><span class="p">(</span><span class="s2">&quot;Delete&quot;</span><span class="p">)</span>

    <span class="c1"># Normalize the index to a boolean mask</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">mask</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># mark items to keep</span>

    <span class="n">kept</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kept</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">:</span>
        <span class="k">return</span>  <span class="c1"># nothing deleted</span>
    <span class="k">elif</span> <span class="n">kept</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span>

    <span class="c1"># Compact the buffer in-place</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">name</span><span class="p">][:</span><span class="n">kept</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">name</span><span class="p">][:</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">=</span> <span class="n">kept</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.FieldArray.extend" class="doc doc-heading">
            <code class=" language-python"><span class="n">extend</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">join_fields</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#npblender.FieldArray.extend" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Append multiple records from another array or FieldArray.</p>
<h5 id="npblender.FieldArray.extend--parameters">Parameters<a class="headerlink" href="#npblender.FieldArray.extend--parameters" title="Permanent link">&para;</a></h5>
<p>other : FieldArray or structured np.ndarray
    The array of records to append. Must have named fields matching
    a subset of the current array's fields.</p>


            <details class="quote">
              <summary>Source code in <code>npblender/fieldarray.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">join_fields</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Append multiple records from another array or FieldArray.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    other : FieldArray or structured np.ndarray</span>
<span class="sd">        The array of records to append. Must have named fields matching</span>
<span class="sd">        a subset of the current array&#39;s fields.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_no_shape</span><span class="p">(</span><span class="s2">&quot;Extend&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># Accept both FieldArray and structured np.ndarray</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># No names</span>
    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.extend&gt; input must have named fields&quot;</span><span class="p">)</span>

    <span class="c1"># Join fields if required</span>
    <span class="k">if</span> <span class="n">join_fields</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">join_fields</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="c1"># Ensure all fields in &#39;data&#39; are valid for this array</span>
    <span class="n">invalid</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_names</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">invalid</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;extend &gt; input contains unknown field(s): </span><span class="si">{</span><span class="n">invalid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Resize buffer</span>
    <span class="n">new_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">+</span> <span class="n">count</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_data_check</span><span class="p">(</span><span class="n">new_length</span><span class="p">)</span>

    <span class="c1"># Copy data field by field</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_optional_field</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">:</span><span class="n">new_length</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="c1"># Fill missing fields with default value</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actual_names</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">:</span><span class="n">new_length</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">=</span> <span class="n">new_length</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.FieldArray.filtered" class="doc doc-heading">
            <code class=" language-python"><span class="n">filtered</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#npblender.FieldArray.filtered" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Return a FieldArray containing only the selected records.</p>
<h5 id="npblender.FieldArray.filtered--parameters">Parameters<a class="headerlink" href="#npblender.FieldArray.filtered--parameters" title="Permanent link">&para;</a></h5>
<p>selector : array‑like, slice or int
    Any valid NumPy 1‑D index: boolean mask, integer index/array, or slice.
    It is applied to the current valid part of the buffer
    (<code>self._data[:self._length]</code>).</p>


<details class="copy-" open>
  <summary>bool, optional</summary>
  <ul>
<li>False    (default) =&gt; the new array shares the same memory
                         (changes propagate both ways).</li>
<li>True           =&gt; the data are physically copied.</li>
</ul>
</details>        <h5 id="npblender.FieldArray.filtered--returns">Returns<a class="headerlink" href="#npblender.FieldArray.filtered--returns" title="Permanent link">&para;</a></h5>
<p>FieldArray
    A new instance holding exactly <code>len(selector)</code> records and
    inheriting the current field‑infos.</p>


            <details class="quote">
              <summary>Source code in <code>npblender/fieldarray.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">filtered</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a FieldArray containing only the selected records.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    selector : array‑like, slice or int</span>
<span class="sd">        Any valid NumPy 1‑D index: boolean mask, integer index/array, or slice.</span>
<span class="sd">        It is applied to the current valid part of the buffer</span>
<span class="sd">        (``self._data[:self._length]``).</span>

<span class="sd">    copy : bool, optional</span>
<span class="sd">        - False    (default) =&gt; the new array shares the same memory</span>
<span class="sd">                                 (changes propagate both ways).</span>
<span class="sd">        - True           =&gt; the data are physically copied.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    FieldArray</span>
<span class="sd">        A new instance holding exactly ``len(selector)`` records and</span>
<span class="sd">        inheriting the current field‑infos.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">selector</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Nothing to select – return an empty compatible array</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="s1">&#39;EMPTY&#39;</span><span class="p">)</span>

    <span class="c1"># Apply the selector on the valid slice</span>
    <span class="c1">#selected = self._data[:self._length][selector]</span>

    <span class="c1"># Choose copy mode</span>
    <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;COPY&#39;</span> <span class="k">if</span> <span class="n">copy</span> <span class="k">else</span> <span class="s1">&#39;CAPTURE&#39;</span>

    <span class="c1"># Build the new instance</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_view</span><span class="p">[</span><span class="n">selector</span><span class="p">]</span>

    <span class="n">fa</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="s1">&#39;EMPTY&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
        <span class="n">fa</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fa</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">return</span> <span class="n">fa</span>

    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="n">selector</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.FieldArray.from_dict" class="doc doc-heading">
            <code class=" language-python"><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#npblender.FieldArray.from_dict" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Build a FieldArray from a dictionary with field data and optional metadata.</p>
<h5 id="npblender.FieldArray.from_dict--parameters">Parameters<a class="headerlink" href="#npblender.FieldArray.from_dict--parameters" title="Permanent link">&para;</a></h5>
<p>data : dict[str, array-like or (array, dict)]
    Mapping field names to arrays or (array, infos). Infos must include NAME.</p>


<details class="copy-" open>
  <summary>bool, optional</summary>
  <p>Whether to copy the data. Default: True.</p>
</details>        <h5 id="npblender.FieldArray.from_dict--returns">Returns<a class="headerlink" href="#npblender.FieldArray.from_dict--returns" title="Permanent link">&para;</a></h5>
<p>FieldArray</p>


            <details class="quote">
              <summary>Source code in <code>npblender/fieldarray.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build a FieldArray from a dictionary with field data and optional metadata.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : dict[str, array-like or (array, dict)]</span>
<span class="sd">        Mapping field names to arrays or (array, infos). Infos must include NAME.</span>

<span class="sd">    copy : bool, optional</span>
<span class="sd">        Whether to copy the data. Default: True.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    FieldArray</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;from_dict &gt; input dictionary is empty&quot;</span><span class="p">)</span>

    <span class="n">arrays</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">infos</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">lengths</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">arr</span><span class="p">,</span> <span class="n">arr_infos</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">arr_infos</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">arr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">arr_infos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;from_dict &gt; field &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; has no array, nor infos&quot;</span><span class="p">)</span>

            <span class="n">arr_infos</span><span class="p">[</span><span class="s1">&#39;optional&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">arr_infos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">arr_infos</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">:</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;optional&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
            <span class="n">arrays</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span>
            <span class="n">lengths</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">infos</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr_infos</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;from_dict &gt; all fields must have the same number of records&quot;</span><span class="p">)</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">lengths</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="n">descr</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">str</span><span class="p">,</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">str</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">arrays</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">]</span>

    <span class="n">structured</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">descr</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">arrays</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">structured</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span>

    <span class="n">fa</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">structured</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;CAPTURE&#39;</span><span class="p">)</span>
    <span class="n">fa</span><span class="o">.</span><span class="n">_infos</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">infos</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fa</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.FieldArray.get" class="doc doc-heading">
            <code class=" language-python"><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#npblender.FieldArray.get" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get attribute by name.</p>
<p>If name is not an actual field, return default value.
Name can be an array.</p>
<div class="codehilite"><pre><span></span><code><span class="n">pos</span> <span class="o">=</span> <span class="n">field_array</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">field_array</span><span class="o">.</span><span class="n">get</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/fieldarray.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Get attribute by name.</span>

<span class="sd">    If name is not an actual field, return default value.</span>
<span class="sd">    Name can be an array.</span>
<span class="sd">    ``` python</span>
<span class="sd">    pos = field_array.get(&quot;position&quot;, (0, 0, 1))</span>
<span class="sd">    pos = field_array.get([[0, 0, 1], [0, 0, 0]])</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.FieldArray.join_fields" class="doc doc-heading">
            <code class=" language-python"><span class="n">join_fields</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#npblender.FieldArray.join_fields" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Add all missing fields from another FieldArray.</p>
<p>For every field in <code>other</code> that is not present in <code>self</code>, a new field is created
with the same dtype and shape, and initialized with its default value across all existing records.</p>
<h5 id="npblender.FieldArray.join_fields--parameters">Parameters<a class="headerlink" href="#npblender.FieldArray.join_fields--parameters" title="Permanent link">&para;</a></h5>
<p>other : FieldArray
    Another FieldArray instance whose fields will be checked for missing fields.</p>
<h5 id="npblender.FieldArray.join_fields--returns">Returns<a class="headerlink" href="#npblender.FieldArray.join_fields--returns" title="Permanent link">&para;</a></h5>
<p>self</p>


            <details class="quote">
              <summary>Source code in <code>npblender/fieldarray.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">join_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add all missing fields from another FieldArray.</span>

<span class="sd">    For every field in `other` that is not present in `self`, a new field is created</span>
<span class="sd">    with the same dtype and shape, and initialized with its default value across all existing records.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    other : FieldArray</span>
<span class="sd">        Another FieldArray instance whose fields will be checked for missing fields.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    self        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">FieldArray</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">_infos</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">other</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">name</span><span class="p">]}</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;optional&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_create_field_in_data</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">new_field</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">other</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">other</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.FieldArray.multiply" class="doc doc-heading">
            <code class=" language-python"><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">)</span></code>

<a href="#npblender.FieldArray.multiply" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Duplicate the current records <code>count</code> times.</p>
<h5 id="npblender.FieldArray.multiply--parameters">Parameters<a class="headerlink" href="#npblender.FieldArray.multiply--parameters" title="Permanent link">&para;</a></h5>
<p>count : int
    Number of times to repeat the current records.</p>
<h5 id="npblender.FieldArray.multiply--notes">Notes<a class="headerlink" href="#npblender.FieldArray.multiply--notes" title="Permanent link">&para;</a></h5>
<p>This duplicates the current valid records (up to self._length).
If the array is empty or count &lt;= 1, nothing happens.</p>
<h5 id="npblender.FieldArray.multiply--example">Example:<a class="headerlink" href="#npblender.FieldArray.multiply--example" title="Permanent link">&para;</a></h5>
<p>If the array has 3 records and count == 4, the result will be:</p>
<p>[rec0, rec1, rec2, rec0, rec1, rec2, rec0, rec1, rec2, rec0, rec1, rec2]</p>


            <details class="quote">
              <summary>Source code in <code>npblender/fieldarray.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Duplicate the current records `count` times.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    count : int</span>
<span class="sd">        Number of times to repeat the current records.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This duplicates the current valid records (up to self._length).</span>
<span class="sd">    If the array is empty or count &lt;= 1, nothing happens.</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    If the array has 3 records and count == 4, the result will be:</span>

<span class="sd">    [rec0, rec1, rec2, rec0, rec1, rec2, rec0, rec1, rec2, rec0, rec1, rec2]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">count</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">count</span><span class="p">,)</span> <span class="o">+</span> <span class="n">shape</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.FieldArray.new_field" class="doc doc-heading">
            <code class=" language-python"><span class="n">new_field</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">infos</span><span class="p">)</span></code>

<a href="#npblender.FieldArray.new_field" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Add a field to the structured array.</p>
<h5 id="npblender.FieldArray.new_field--arguments">Arguments<a class="headerlink" href="#npblender.FieldArray.new_field--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="p">(</span><span class="nx">str</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">field</span><span class="w"> </span><span class="nx">name</span>
<span class="o">-</span><span class="w"> </span><span class="nx">dtype</span><span class="w"> </span><span class="p">(</span><span class="k">type</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">valid</span><span class="w"> </span><span class="nx">numpy</span><span class="w"> </span><span class="nx">dtype</span>
<span class="o">-</span><span class="w"> </span><span class="nx">shape</span><span class="w"> </span><span class="p">(</span><span class="nx">tuple</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">None</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">shape</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">field</span>
<span class="o">-</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="p">(</span><span class="nx">any</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">value</span>
<span class="o">-</span><span class="w"> </span><span class="nx">optional</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">False</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">field</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">created</span><span class="w"> </span><span class="nx">only</span><span class="w"> </span><span class="nx">when</span><span class="w"> </span><span class="nx">accessed</span>
<span class="o">-</span><span class="w"> </span><span class="nx">infos</span><span class="w"> </span><span class="p">(</span><span class="nx">dict</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">field</span><span class="w"> </span><span class="nx">infos</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/fieldarray.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">new_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">infos</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Add a field to the structured array.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - name (str) : field name</span>
<span class="sd">        - dtype (type) : a valid numpy dtype</span>
<span class="sd">        - shape (tuple = None) : the shape of the field</span>
<span class="sd">        - default (any = 0) : default value</span>
<span class="sd">        - optional (bool = False) : the field is created only when accessed</span>
<span class="sd">        - infos (dict) : field infos</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Reserved name</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_reserved_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;new_field &gt; &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; is a reserved name.&quot;</span><span class="p">)</span>

    <span class="c1"># Already exists</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dtype</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="ow">or</span>
            <span class="n">shape</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;shape&#39;</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;new_field &gt; &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; is already defined.&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Declare in infos</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;dtype&#39;</span>    <span class="p">:</span> <span class="n">dtype</span><span class="p">,</span>
        <span class="s1">&#39;shape&#39;</span>    <span class="p">:</span> <span class="n">FieldArray</span><span class="o">.</span><span class="n">_normalize_shape</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span>
        <span class="s1">&#39;default&#39;</span>  <span class="p">:</span> <span class="n">default</span><span class="p">,</span>
        <span class="s1">&#39;optional&#39;</span> <span class="p">:</span> <span class="n">optional</span><span class="p">,</span>
        <span class="o">**</span><span class="n">infos</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="c1"># Create if not optional</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">optional</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_field_in_data</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.FieldArray.to_dict" class="doc doc-heading">
            <code class=" language-python"><span class="n">to_dict</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_infos</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#npblender.FieldArray.to_dict" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Convert the array to a dictionary of fields or (field, infos) pairs.</p>
<h5 id="npblender.FieldArray.to_dict--parameters">Parameters<a class="headerlink" href="#npblender.FieldArray.to_dict--parameters" title="Permanent link">&para;</a></h5>
<p>copy : bool, default=True
    Whether to copy the arrays.</p>


<details class="with_infos-" open>
  <summary>bool, default=True</summary>
  <p>If True, return (array, infos) for each field.</p>
</details>        <h5 id="npblender.FieldArray.to_dict--returns">Returns<a class="headerlink" href="#npblender.FieldArray.to_dict--returns" title="Permanent link">&para;</a></h5>
<p>dict[str, array or (array, dict)]</p>


            <details class="quote">
              <summary>Source code in <code>npblender/fieldarray.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">copy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">with_infos</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert the array to a dictionary of fields or (field, infos) pairs.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    copy : bool, default=True</span>
<span class="sd">        Whether to copy the arrays.</span>

<span class="sd">    with_infos : bool, default=True</span>
<span class="sd">        If True, return (array, infos) for each field.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict[str, array or (array, dict)]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">valid_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;optional&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">valid_slice</span><span class="p">]</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">copy</span> <span class="k">else</span> <span class="n">arr</span>

        <span class="n">result</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">info</span><span class="p">))</span> <span class="k">if</span> <span class="n">with_infos</span> <span class="k">else</span> <span class="n">arr</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="npblender.Geometry" class="doc doc-heading">
            <code>Geometry</code>


<a href="#npblender.Geometry" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">









              <details class="quote">
                <summary>Source code in <code>npblender/geometry.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Geometry</span><span class="p">:</span>

    <span class="c1"># Overriden by Mesh and Curve</span>
    <span class="n">domain_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># From a dict</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.mesh</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mesh</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.curve</span><span class="w"> </span><span class="kn">import</span> <span class="n">Curve</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.cloud</span><span class="w"> </span><span class="kn">import</span> <span class="n">Cloud</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.instances</span><span class="w"> </span><span class="kn">import</span> <span class="n">Instances</span><span class="p">,</span> <span class="n">Meshes</span>

        <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Mesh&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Curve&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Curve</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Cloud&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Cloud</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Instances&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Instances</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Meshes&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Meshes</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown geometry </span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Copy attributes definition</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">join_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Capture the attributes from another geometry.</span>

<span class="sd">        Other can be a different geometry, in that case, only domains with the same name are captured.</span>
<span class="sd">        kwargs allows to filter the domains to capture:</span>

<span class="sd">        ```python</span>
<span class="sd">        mesh.join_attributes(other_mesh, faces=False)</span>
<span class="sd">        mesh.join_attributes(curve)</span>
<span class="sd">        ```</span>

<span class="sd">        Returns:</span>
<span class="sd">            - self</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">domain_names</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">join_fields</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Compute an attribute of a domain to another domain</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_attribute_on_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain_from</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">domain_to</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">domain_from</span> <span class="o">==</span> <span class="n">domain_to</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">attr</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">domain_from</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_names</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">domain_to</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_names</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The geometry &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; doesn&#39;t have domains &#39;</span><span class="si">{</span><span class="n">domain_from</span><span class="si">}</span><span class="s2">&#39; and &#39;</span><span class="si">{</span><span class="n">domain_to</span><span class="si">}</span><span class="s2">&#39;.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Valid domains are: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_names</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">domain_from</span> <span class="o">==</span> <span class="s1">&#39;points&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">domain_to</span> <span class="o">==</span> <span class="s1">&#39;faces&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">compute_attribute_on_faces</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">domain_to</span> <span class="o">==</span> <span class="s1">&#39;edges&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">compute_attribute_on_edges</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">domain_to</span> <span class="o">==</span> <span class="s1">&#39;corners&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">compute_attribute_on_corners</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">domain_to</span> <span class="o">==</span> <span class="s1">&#39;splines&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">compute_attribute_on_splines</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">domain_from</span> <span class="o">==</span> <span class="s1">&#39;faces&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">domain_to</span> <span class="o">==</span> <span class="s1">&#39;points&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">compute_attribute_on_points</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">domain_to</span> <span class="o">==</span> <span class="s1">&#39;edges&#39;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">domain_to</span> <span class="o">==</span> <span class="s1">&#39;corners&#39;</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">elif</span> <span class="n">domain_from</span> <span class="o">==</span> <span class="s1">&#39;edges&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">domain_to</span> <span class="o">==</span> <span class="s1">&#39;points&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">compute_attribute_on_points</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">domain_to</span> <span class="o">==</span> <span class="s1">&#39;faces&#39;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">domain_to</span> <span class="o">==</span> <span class="s1">&#39;corners&#39;</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">elif</span> <span class="n">domain_from</span> <span class="o">==</span> <span class="s1">&#39;corners&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">domain_to</span> <span class="o">==</span> <span class="s1">&#39;points&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">compute_attribute_on_points</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">domain_to</span> <span class="o">==</span> <span class="s1">&#39;faces&#39;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">domain_to</span> <span class="o">==</span> <span class="s1">&#39;edges&#39;</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">elif</span> <span class="n">domain_from</span> <span class="o">==</span> <span class="s1">&#39;splines&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">domain_to</span> <span class="o">==</span> <span class="s1">&#39;points&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">compute_attribute_on_points</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>

        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Sorry, computing attribue from &#39;</span><span class="si">{</span><span class="n">domain_from</span><span class="si">}</span><span class="s2">&#39; to &#39;</span><span class="si">{</span><span class="n">domain_to</span><span class="si">}</span><span class="s2">&#39; is not implemented yet.&quot;</span><span class="p">)</span>



    <span class="k">def</span><span class="w"> </span><span class="nf">compute_attribute_on_domain_OLD</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">domain_name</span><span class="p">):</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">numba</span><span class="w"> </span><span class="kn">import</span> <span class="n">njit</span><span class="p">,</span> <span class="n">prange</span>

        <span class="c1"># ---------------------------------------------------------------------------</span>
        <span class="c1"># Faces to points</span>

        <span class="nd">@njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">_faces_to_points</span><span class="p">(</span><span class="n">loop_start</span><span class="p">,</span> <span class="n">loop_total</span><span class="p">,</span> <span class="n">vertex_index</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span>
            <span class="n">V</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">F</span> <span class="o">=</span> <span class="n">loop_start</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">F</span><span class="p">):</span>
                <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">loop_start</span><span class="p">[</span><span class="n">f</span><span class="p">],</span> <span class="n">loop_total</span><span class="p">[</span><span class="n">f</span><span class="p">],</span> <span class="n">source</span><span class="p">[</span><span class="n">f</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">vertex_index</span><span class="p">[</span><span class="n">s</span> <span class="o">+</span> <span class="n">k</span><span class="p">]</span>
                    <span class="n">res</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">+=</span> <span class="n">val</span>
                    <span class="n">count</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">trailing</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">ndim</span><span class="p">):</span>
                <span class="n">trailing</span> <span class="o">*=</span> <span class="n">res</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>

            <span class="n">R2</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">V</span><span class="p">,</span> <span class="n">trailing</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">V</span><span class="p">):</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">count</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">inv</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">c</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trailing</span><span class="p">):</span>
                        <span class="n">R2</span><span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*=</span> <span class="n">inv</span>

            <span class="k">return</span> <span class="n">res</span>

        <span class="c1"># ---------------------------------------------------------------------------</span>
        <span class="c1"># Points to faces</span>

        <span class="nd">@njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">_points_to_faces</span><span class="p">(</span><span class="n">loop_start</span><span class="p">,</span> <span class="n">loop_total</span><span class="p">,</span> <span class="n">vertex_index</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span>
            <span class="n">F</span> <span class="o">=</span> <span class="n">loop_start</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">F</span><span class="p">):</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">loop_start</span><span class="p">[</span><span class="n">f</span><span class="p">]</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">loop_total</span><span class="p">[</span><span class="n">f</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">vertex_index</span><span class="p">[</span><span class="n">s</span> <span class="o">+</span> <span class="n">k</span><span class="p">]</span>
                    <span class="n">res</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">+=</span> <span class="n">source</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
                <span class="n">inv</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">t</span>
                <span class="n">res</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">*=</span> <span class="n">inv</span>

            <span class="k">return</span> <span class="n">res</span>

        <span class="c1"># ---------------------------------------------------------------------------</span>
        <span class="c1"># Get the source domain for attribute</span>
        <span class="c1"># ---------------------------------------------------------------------------</span>

        <span class="n">source_domain_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_names</span><span class="p">:</span>
            <span class="n">source_domain</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="n">source_domain</span><span class="o">.</span><span class="n">_infos</span><span class="p">:</span>
                <span class="n">source_domain_name</span> <span class="o">=</span> <span class="n">name</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">source_domain_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No domain has an attribute named &#39;</span><span class="si">{</span><span class="n">attr_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># ---------------------------------------------------------------------------</span>
        <span class="c1"># Prepare</span>
        <span class="c1"># ---------------------------------------------------------------------------</span>

        <span class="n">domain_name</span> <span class="o">=</span> <span class="n">domain_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="n">source</span> <span class="o">=</span> <span class="n">source_domain</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span>

        <span class="c1"># Source = Target domain</span>
        <span class="k">if</span> <span class="n">domain_name</span> <span class="o">==</span> <span class="n">source_domain_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">source</span>

        <span class="c1"># Resulting array</span>
        <span class="n">item_shape</span> <span class="o">=</span> <span class="n">source_domain</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">attr_name</span><span class="p">][</span><span class="s1">&#39;shape&#39;</span><span class="p">]</span>
        <span class="n">target_domain</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain_name</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">target_domain</span><span class="p">),)</span> <span class="o">+</span> <span class="n">item_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">source</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># ---------------------------------------------------------------------------</span>
        <span class="c1"># Different cases</span>
        <span class="c1"># ---------------------------------------------------------------------------</span>

        <span class="c1"># Faces to points</span>
        <span class="k">if</span> <span class="n">source_domain_name</span> <span class="o">==</span> <span class="s1">&#39;faces&#39;</span> <span class="ow">and</span> <span class="n">domain_name</span> <span class="o">==</span> <span class="s1">&#39;points&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">_faces_to_points</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">loop_start</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">loop_total</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">source</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">res</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span>
                <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target_domain</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">loop_start</span><span class="p">,</span> <span class="n">loop_total</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">loop_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">loop_total</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
                    <span class="n">corners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">[</span><span class="n">loop_start</span><span class="p">:</span><span class="n">loop_start</span><span class="o">+</span><span class="n">loop_total</span><span class="p">]</span>
                    <span class="n">res</span><span class="p">[</span><span class="n">corners</span><span class="p">]</span> <span class="o">+=</span> <span class="n">val</span>
                    <span class="n">count</span><span class="p">[</span><span class="n">corners</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Points to faces</span>
        <span class="k">elif</span> <span class="n">source_domain_name</span> <span class="o">==</span> <span class="s1">&#39;points&#39;</span> <span class="ow">and</span> <span class="n">domain_name</span> <span class="o">==</span> <span class="s1">&#39;faces&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">_points_to_faces</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">loop_start</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">loop_total</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">source</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">res</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i_face</span><span class="p">,</span> <span class="p">(</span><span class="n">loop_start</span><span class="p">,</span> <span class="n">loop_total</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">loop_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">loop_total</span><span class="p">)):</span>
                    <span class="n">corners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">[</span><span class="n">loop_start</span><span class="p">:</span><span class="n">loop_start</span><span class="o">+</span><span class="n">loop_total</span><span class="p">]</span>
                    <span class="n">res</span><span class="p">[</span><span class="n">i_face</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="n">corners</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Edges to points</span>
        <span class="k">elif</span> <span class="n">source_domain_name</span> <span class="o">==</span> <span class="s1">&#39;edges&#39;</span> <span class="ow">and</span> <span class="n">domain_name</span> <span class="o">==</span> <span class="s1">&#39;points&#39;</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target_domain</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">v0</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">vertex0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">vertex1</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
                <span class="n">res</span><span class="p">[</span><span class="n">v0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span>
                <span class="n">res</span><span class="p">[</span><span class="n">v1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span>
                <span class="n">count</span><span class="p">[</span><span class="n">v0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">count</span><span class="p">[</span><span class="n">v1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Points to edges</span>
        <span class="k">elif</span> <span class="n">source_domain_name</span> <span class="o">==</span> <span class="s1">&#39;points&#39;</span> <span class="ow">and</span> <span class="n">domain_name</span> <span class="o">==</span> <span class="s1">&#39;edges&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i_edge</span><span class="p">,</span> <span class="p">(</span><span class="n">v0</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">vertex0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">vertex1</span><span class="p">)):</span>
                <span class="n">res</span><span class="p">[</span><span class="n">i_edge</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="n">v0</span><span class="p">]</span> <span class="o">+</span> <span class="n">source</span><span class="p">[</span><span class="n">v1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>

        <span class="c1"># Splines to points</span>
        <span class="k">elif</span> <span class="n">source_domain_name</span> <span class="o">==</span> <span class="s1">&#39;splines&#39;</span> <span class="ow">and</span> <span class="n">domain_name</span> <span class="o">==</span> <span class="s1">&#39;points&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">loop_start</span><span class="p">,</span> <span class="n">loop_total</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">loop_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">loop_total</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
                <span class="n">res</span><span class="p">[</span><span class="n">loop_start</span><span class="p">:</span><span class="n">loop_start</span><span class="o">+</span><span class="n">loop_total</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

        <span class="c1"># Points to splines</span>
        <span class="k">elif</span> <span class="n">source_domain_name</span> <span class="o">==</span> <span class="s1">&#39;points&#39;</span> <span class="ow">and</span> <span class="n">domain_name</span> <span class="o">==</span> <span class="s1">&#39;splines&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i_spline</span><span class="p">,</span> <span class="p">(</span><span class="n">loop_start</span><span class="p">,</span> <span class="n">loop_total</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">loop_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">loop_total</span><span class="p">)):</span>
                <span class="n">res</span><span class="p">[</span><span class="n">i_spline</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="n">loop_start</span><span class="p">:</span><span class="n">loop_start</span><span class="o">+</span><span class="n">loop_total</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Not implemented</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sorry: compute_attribute from &#39;</span><span class="si">{</span><span class="n">source_domain_name</span><span class="si">}</span><span class="s2">&#39; to &#39;</span><span class="si">{</span><span class="n">domain_name</span><span class="si">}</span><span class="s2">&#39; domains is not implemented yet.&quot;</span><span class="p">)</span>

        <span class="c1"># ---------------------------------------------------------------------------</span>
        <span class="c1"># Finalization</span>
        <span class="c1"># ---------------------------------------------------------------------------</span>

        <span class="k">if</span> <span class="n">count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">item_shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">count</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">item_shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">count</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

            <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">/</span><span class="n">count</span>

        <span class="k">return</span> <span class="n">res</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Check geometry consistency</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Geometry Check&quot;</span><span class="p">,</span> <span class="n">halt</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Load a Mesh or a Curve</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_object</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Load a Blender object and returns either a Mesh or a Curve.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - name (str or bpy.types.Object) : the object to load</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - Mesh or Curve</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">.mesh</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mesh</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.curve</span><span class="w"> </span><span class="kn">import</span> <span class="n">Curve</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">getobject</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Mesh</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Curve</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Curve</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Geometry.load_object error: impossible to load the objet &#39;</span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; of type &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Load a Mesh or a Curve</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_models</span><span class="p">(</span><span class="o">*</span><span class="n">specs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Load a geometry or geometries from specifications.</span>

<span class="sd">        The specs can be:</span>
<span class="sd">            - a Blender collection</span>
<span class="sd">            - a Blender object</span>
<span class="sd">            - a Geometry</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - specs (list of objects / collections) : the models to load</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - list of geometries</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">.mesh</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mesh</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.curve</span><span class="w"> </span><span class="kn">import</span> <span class="n">Curve</span>

        <span class="n">models</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">specs</span><span class="p">:</span>
            <span class="c1"># A list</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="n">models</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">Geometry</span><span class="o">.</span><span class="n">load_models</span><span class="p">(</span><span class="o">*</span><span class="n">spec</span><span class="p">))</span>
                <span class="k">continue</span>

            <span class="c1"># A collection</span>
            <span class="n">coll</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">halt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">coll</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">coll</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
                    <span class="n">geo</span> <span class="o">=</span> <span class="n">Geometry</span><span class="o">.</span><span class="n">load_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geo</span><span class="p">,</span> <span class="p">(</span><span class="n">Mesh</span><span class="p">,</span> <span class="n">Curve</span><span class="p">)):</span>
                        <span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geo</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># An object</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">halt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">geo</span> <span class="o">=</span> <span class="n">Geometry</span><span class="o">.</span><span class="n">load_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geo</span><span class="p">,</span> <span class="p">(</span><span class="n">Mesh</span><span class="p">,</span> <span class="n">Curve</span><span class="p">)):</span>
                    <span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geo</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># A valid geometry</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Mesh&#39;</span><span class="p">,</span> <span class="s1">&#39;Curve&#39;</span><span class="p">]:</span>
                <span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown model (type &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;): </span><span class="si">{</span><span class="n">spec</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">models</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Object edition</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="nd">@contextmanager</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="kn">import</span><span class="w"> </span><span class="nn">bpy</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">blender</span>

        <span class="n">temp_name</span> <span class="o">=</span> <span class="n">index</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;BPBL Temp </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">ctx</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span>

        <span class="n">old_sel</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">select_get</span><span class="p">()]</span>
        <span class="n">old_active</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">active</span>
        <span class="k">if</span> <span class="n">old_active</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">old_active_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">old_active_name</span> <span class="o">=</span> <span class="n">old_active</span><span class="o">.</span><span class="n">name</span>

        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">select_all</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;DESELECT&#39;</span><span class="p">)</span>        

        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_object</span><span class="p">(</span><span class="n">temp_name</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">select_set</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">obj</span>        

        <span class="k">yield</span> <span class="n">obj</span>

        <span class="c1"># ===== Returns from context</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">readonly</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>

        <span class="n">blender</span><span class="o">.</span><span class="n">delete_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">select_all</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;DESELECT&#39;</span><span class="p">)</span>        
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">old_sel</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">select_set</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">old_active_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">old_active_name</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Material</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Index from material name</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_material_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mat_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the index of a material name.</span>

<span class="sd">        If the material doesn&#39;t exist, it is created</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - mat_name (str) : material name</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - int : index of the material name in the materials list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">mat_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">mat_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mat_name</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Add a material or a list of materials</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_materials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">materials</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Add a materials list to the existing one.</span>

<span class="sd">        If a material already exist, it is not added another time.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - materials (list of strs) : the list of materials to append.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">materials</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">materials</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">materials</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Transformation</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_points_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_transformation_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t_shape</span><span class="p">,</span> <span class="n">npoints</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Transformation&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">t_shape</span> <span class="o">==</span> <span class="p">():</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">npoints</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">npoints</span><span class="p">]:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">npoints</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">t_shape</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">npoints</span> <span class="o">%</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">t_shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> shape </span><span class="si">{</span><span class="n">t_shape</span><span class="si">}</span><span class="s2"> is not valid to transform </span><span class="si">{</span><span class="n">npoints</span><span class="si">}</span><span class="s2"> points.&quot;</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Apply one or more basic transformation</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">transformation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">translation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pivot</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="c1"># Curve splines can be a subset of the points </span>
        <span class="n">pts_sel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_points_selection</span><span class="p">()</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">pts_sel</span><span class="p">]</span>
        <span class="n">npoints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="n">all_vecs</span> <span class="o">=</span> <span class="p">[</span><span class="n">pos</span><span class="p">]</span>

        <span class="n">has_handles</span> <span class="o">=</span> <span class="s2">&quot;handle_left&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">actual_names</span>
        <span class="k">if</span> <span class="n">has_handles</span><span class="p">:</span>
            <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">handle_left</span><span class="p">[</span><span class="n">pts_sel</span><span class="p">]</span>
            <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">handle_right</span><span class="p">[</span><span class="n">pts_sel</span><span class="p">]</span>
            <span class="n">all_vecs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">])</span>

        <span class="c1"># First pivot</span>
        <span class="k">if</span> <span class="n">pivot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pivot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pivot</span><span class="p">)</span>
            <span class="n">pivot_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_transformation_shape</span><span class="p">(</span><span class="n">pivot</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">npoints</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Pivot&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">all_vecs</span><span class="p">:</span>
                <span class="n">v</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">pivot_shape</span><span class="p">)[:]</span> <span class="o">-=</span> <span class="n">pivot</span>

        <span class="c1"># Scale</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
            <span class="n">scale_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_transformation_shape</span><span class="p">(</span><span class="n">scale</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">npoints</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Scale&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">all_vecs</span><span class="p">:</span>
                <span class="n">v</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">scale_shape</span><span class="p">)[:]</span> <span class="o">*=</span> <span class="n">scale</span>

        <span class="c1"># Rotation</span>
        <span class="k">if</span> <span class="n">rotation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rot_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_transformation_shape</span><span class="p">(</span><span class="n">rotation</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">npoints</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Rotation&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">all_vecs</span><span class="p">:</span>
                <span class="n">v</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">rot_shape</span><span class="p">)[:]</span> <span class="o">=</span> <span class="n">rotation</span> <span class="o">@</span> <span class="n">v</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">rot_shape</span><span class="p">)</span>

        <span class="c1"># Pivot back</span>
        <span class="k">if</span> <span class="n">pivot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">all_vecs</span><span class="p">:</span>
                <span class="n">v</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">pivot_shape</span><span class="p">)[:]</span> <span class="o">+=</span> <span class="n">pivot</span>

        <span class="c1"># Translation</span>
        <span class="k">if</span> <span class="n">translation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">translation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">translation</span><span class="p">)</span>
            <span class="n">tr_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_transformation_shape</span><span class="p">(</span><span class="n">translation</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">npoints</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Pivot&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">all_vecs</span><span class="p">:</span>
                <span class="n">v</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">tr_shape</span><span class="p">)[:]</span> <span class="o">+=</span> <span class="n">translation</span>

        <span class="c1"># Back</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">pts_sel</span><span class="p">]</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="k">if</span> <span class="n">has_handles</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">pts_sel</span><span class="p">]</span><span class="o">.</span><span class="n">handle_left</span> <span class="o">=</span> <span class="n">all_vecs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">pts_sel</span><span class="p">]</span><span class="o">.</span><span class="n">handle_right</span> <span class="o">=</span> <span class="n">all_vecs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">translation</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformation</span><span class="p">(</span><span class="n">translation</span><span class="o">=</span><span class="n">translation</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">pivot</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformation</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">pivot</span><span class="o">=</span><span class="n">pivot</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rotation</span><span class="p">,</span> <span class="n">pivot</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformation</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="n">rotation</span><span class="p">,</span> <span class="n">pivot</span><span class="o">=</span><span class="n">pivot</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transformation</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformation</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="n">transformation</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Envelop</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bounding_box</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bounding_box_dims</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">v0</span><span class="p">,</span> <span class="n">v1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounding_box</span>
        <span class="k">return</span> <span class="n">v1</span> <span class="o">-</span> <span class="n">v0</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">max_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bounding_box_dims</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_cubic_envelop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.</span> <span class="n">mesh</span> <span class="kn">import</span><span class="w"> </span><span class="nn">Mesh</span>

        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounding_box_dims</span>
        <span class="k">return</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">cube</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;materials&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="npblender.Geometry.add_materials" class="doc doc-heading">
            <code class=" language-python"><span class="n">add_materials</span><span class="p">(</span><span class="n">materials</span><span class="p">)</span></code>

<a href="#npblender.Geometry.add_materials" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Add a materials list to the existing one.</p>
<p>If a material already exist, it is not added another time.</p>
<h5 id="npblender.Geometry.add_materials--arguments">Arguments<a class="headerlink" href="#npblender.Geometry.add_materials--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- materials (list of strs) : the list of materials to append.
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/geometry.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_materials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">materials</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Add a materials list to the existing one.</span>

<span class="sd">    If a material already exist, it is not added another time.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - materials (list of strs) : the list of materials to append.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">materials</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">materials</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">materials</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Geometry.get_material_index" class="doc doc-heading">
            <code class=" language-python"><span class="n">get_material_index</span><span class="p">(</span><span class="n">mat_name</span><span class="p">)</span></code>

<a href="#npblender.Geometry.get_material_index" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Return the index of a material name.</p>
<p>If the material doesn't exist, it is created</p>
<h5 id="npblender.Geometry.get_material_index--arguments">Arguments<a class="headerlink" href="#npblender.Geometry.get_material_index--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="k">-</span> mat_name (str) : material name
</code></pre></div>

<h5 id="npblender.Geometry.get_material_index--returns">Returns<a class="headerlink" href="#npblender.Geometry.get_material_index--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- int : index of the material name in the materials list
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/geometry.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_material_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mat_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Return the index of a material name.</span>

<span class="sd">    If the material doesn&#39;t exist, it is created</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - mat_name (str) : material name</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - int : index of the material name in the materials list</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">mat_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">mat_name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mat_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Geometry.join_attributes" class="doc doc-heading">
            <code class=" language-python"><span class="n">join_attributes</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#npblender.Geometry.join_attributes" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Capture the attributes from another geometry.</p>
<p>Other can be a different geometry, in that case, only domains with the same name are captured.
kwargs allows to filter the domains to capture:</p>
<div class="codehilite"><pre><span></span><code><span class="n">mesh</span><span class="o">.</span><span class="n">join_attributes</span><span class="p">(</span><span class="n">other_mesh</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">join_attributes</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span>
</code></pre></div>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>self</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>npblender/geometry.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">join_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Capture the attributes from another geometry.</span>

<span class="sd">    Other can be a different geometry, in that case, only domains with the same name are captured.</span>
<span class="sd">    kwargs allows to filter the domains to capture:</span>

<span class="sd">    ```python</span>
<span class="sd">    mesh.join_attributes(other_mesh, faces=False)</span>
<span class="sd">    mesh.join_attributes(curve)</span>
<span class="sd">    ```</span>

<span class="sd">    Returns:</span>
<span class="sd">        - self</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_names</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">domain_names</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">join_fields</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Geometry.load_models" class="doc doc-heading">
            <code class=" language-python"><span class="n">load_models</span><span class="p">(</span><span class="o">*</span><span class="n">specs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#npblender.Geometry.load_models" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Load a geometry or geometries from specifications.</p>


<details class="the-specs-can-be" open>
  <summary>The specs can be</summary>
  <ul>
<li>a Blender collection</li>
<li>a Blender object</li>
<li>a Geometry</li>
</ul>
</details>        <h5 id="npblender.Geometry.load_models--arguments">Arguments<a class="headerlink" href="#npblender.Geometry.load_models--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="n">specs</span><span class="w"> </span><span class="p">(</span><span class="n">list</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">objects</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">collections</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">models</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="nb">load</span>
</code></pre></div>

<h5 id="npblender.Geometry.load_models--returns">Returns<a class="headerlink" href="#npblender.Geometry.load_models--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- list of geometries
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/geometry.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">load_models</span><span class="p">(</span><span class="o">*</span><span class="n">specs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Load a geometry or geometries from specifications.</span>

<span class="sd">    The specs can be:</span>
<span class="sd">        - a Blender collection</span>
<span class="sd">        - a Blender object</span>
<span class="sd">        - a Geometry</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - specs (list of objects / collections) : the models to load</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - list of geometries</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">.mesh</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mesh</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.curve</span><span class="w"> </span><span class="kn">import</span> <span class="n">Curve</span>

    <span class="n">models</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">specs</span><span class="p">:</span>
        <span class="c1"># A list</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">models</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">Geometry</span><span class="o">.</span><span class="n">load_models</span><span class="p">(</span><span class="o">*</span><span class="n">spec</span><span class="p">))</span>
            <span class="k">continue</span>

        <span class="c1"># A collection</span>
        <span class="n">coll</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">halt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">coll</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">coll</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
                <span class="n">geo</span> <span class="o">=</span> <span class="n">Geometry</span><span class="o">.</span><span class="n">load_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geo</span><span class="p">,</span> <span class="p">(</span><span class="n">Mesh</span><span class="p">,</span> <span class="n">Curve</span><span class="p">)):</span>
                    <span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geo</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="c1"># An object</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">halt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">geo</span> <span class="o">=</span> <span class="n">Geometry</span><span class="o">.</span><span class="n">load_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geo</span><span class="p">,</span> <span class="p">(</span><span class="n">Mesh</span><span class="p">,</span> <span class="n">Curve</span><span class="p">)):</span>
                <span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geo</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="c1"># A valid geometry</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Mesh&#39;</span><span class="p">,</span> <span class="s1">&#39;Curve&#39;</span><span class="p">]:</span>
            <span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown model (type &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;): </span><span class="si">{</span><span class="n">spec</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">models</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Geometry.load_object" class="doc doc-heading">
            <code class=" language-python"><span class="n">load_object</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#npblender.Geometry.load_object" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Load a Blender object and returns either a Mesh or a Curve.</p>
<h5 id="npblender.Geometry.load_object--arguments">Arguments<a class="headerlink" href="#npblender.Geometry.load_object--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">(</span><span class="nb">str</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Object</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="nb">load</span>
</code></pre></div>

<h5 id="npblender.Geometry.load_object--returns">Returns<a class="headerlink" href="#npblender.Geometry.load_object--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- Mesh or Curve
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/geometry.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">load_object</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Load a Blender object and returns either a Mesh or a Curve.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - name (str or bpy.types.Object) : the object to load</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - Mesh or Curve</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">.mesh</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mesh</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.curve</span><span class="w"> </span><span class="kn">import</span> <span class="n">Curve</span>

    <span class="n">obj</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">getobject</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Mesh</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Curve</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Curve</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Geometry.load_object error: impossible to load the objet &#39;</span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; of type &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="npblender.Instances" class="doc doc-heading">
            <code>Instances</code>


<a href="#npblender.Instances" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Geometry (npblender.geometry.Geometry)" href="#npblender.Geometry">Geometry</a></code></p>









              <details class="quote">
                <summary>Source code in <code>npblender/instances.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Instances</span><span class="p">(</span><span class="n">Geometry</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">models</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model_index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attr_from</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create new instances.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - points (array of vectors = None) : instances locations</span>
<span class="sd">            - models (geometry or list of geometries = None) : the geometries to instantiate</span>
<span class="sd">            - model_index (int = 0) : model index of instances</span>
<span class="sd">            - **attributes (dict) : other geometry attributes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span>  <span class="o">=</span> <span class="n">Point</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">join_attributes</span><span class="p">(</span><span class="n">attr_from</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">models</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_models</span><span class="p">(</span><span class="n">models</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">low_resols</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">points</span><span class="p">,</span> <span class="n">model_index</span><span class="o">=</span><span class="n">model_index</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Instances Check&quot;</span><span class="p">,</span> <span class="n">halt</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">model_index</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model index </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> greater than the number </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">)</span><span class="si">}</span><span class="s2"> of models.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">halt</span><span class="p">:</span>
                <span class="k">assert</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;Instances: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">, models: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">)</span><span class="si">}</span><span class="s2">&gt;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>

    <span class="c1"># =============================================================================================================================</span>
    <span class="c1"># Serialization</span>
    <span class="c1"># =============================================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;geometry&#39;</span><span class="p">:</span>   <span class="s1">&#39;Instances&#39;</span><span class="p">,</span>
            <span class="s1">&#39;points&#39;</span><span class="p">:</span>     <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
            <span class="s1">&#39;models&#39;</span><span class="p">:</span>     <span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">],</span>
            <span class="s1">&#39;low_resols&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="n">lr</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">lr</span> <span class="ow">in</span> <span class="n">low_resol</span><span class="p">]</span> <span class="k">for</span> <span class="n">low_resol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">low_resols</span><span class="p">]</span>
            <span class="p">}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="n">insts</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">insts</span><span class="o">.</span><span class="n">points</span>     <span class="o">=</span> <span class="n">Point</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">])</span>
        <span class="n">insts</span><span class="o">.</span><span class="n">models</span>     <span class="o">=</span> <span class="p">[</span><span class="n">Geometry</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">model</span><span class="p">)</span> <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;models&#39;</span><span class="p">]]</span>
        <span class="n">insts</span><span class="o">.</span><span class="n">low_resols</span> <span class="o">=</span> <span class="p">[[</span><span class="n">Geometry</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">lrd</span><span class="p">)</span> <span class="k">for</span> <span class="n">lrd</span> <span class="ow">in</span> <span class="n">low_resol_dict</span><span class="p">]</span> <span class="k">for</span> <span class="n">low_resol_dict</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;low_resols&#39;</span><span class="p">]]</span>

        <span class="k">return</span> <span class="n">insts</span>    

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Low scale models</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_low_resol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">models</span><span class="p">):</span>

        <span class="n">ls_models</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_models</span><span class="p">(</span><span class="n">models</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls_models</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Instances.add_low_resol: the number of low scale models (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ls_models</span><span class="p">)</span><span class="si">}</span><span class="s2">) &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;is not equal to the number of models (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">low_resols</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;dist&quot;</span><span class="p">:</span> <span class="n">dist</span><span class="p">,</span> <span class="s2">&quot;models&quot;</span><span class="p">:</span> <span class="n">ls_models</span><span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_low_resols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_scale</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">.8</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">.camera</span><span class="w"> </span><span class="kn">import</span> <span class="n">Camera</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.mesh</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mesh</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.curve</span><span class="w"> </span><span class="kn">import</span> <span class="n">Curve</span>

        <span class="n">cam</span> <span class="o">=</span> <span class="n">Camera</span><span class="p">()</span>

        <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="mf">.01</span><span class="p">,</span> <span class="mf">.99</span><span class="p">)</span>

        <span class="c1"># Start scale</span>
        <span class="n">cur_scale</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start_scale</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">max_count</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">min_dist</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">ls_models</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">:</span>
                <span class="n">d</span><span class="p">,</span> <span class="n">ps</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">distance_for_scale</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">max_size</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">cur_scale</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">min_dist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">min_dist</span> <span class="o">=</span> <span class="n">d</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">min_dist</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">min_dist</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">Mesh</span><span class="p">):</span>
                    <span class="n">ls_models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">simplified</span><span class="p">(</span><span class="n">cur_scale</span><span class="p">,</span> <span class="n">ps</span><span class="o">/</span><span class="n">detail</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">max_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">max_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls_models</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">max_count</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_count</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls_models</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">points</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ls_models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Curve</span><span class="o">.</span><span class="n">from_curve</span><span class="p">(</span><span class="n">model</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_low_resol</span><span class="p">(</span><span class="n">min_dist</span><span class="p">,</span> <span class="n">ls_models</span><span class="p">)</span>
            <span class="n">cur_scale</span> <span class="o">*=</span> <span class="n">scale</span>

            <span class="k">if</span> <span class="n">max_count</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">max_count</span> <span class="o">&lt;=</span> <span class="mi">8</span><span class="p">:</span>
                <span class="k">break</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_sort_low_resols</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">low_resols</span><span class="p">])</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">dist</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">dist</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">low_resols</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;models&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">s</span><span class="p">]</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># To Blender objects</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Realize as Mesh and Curve</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">realize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">camera_culling</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">.</span> <span class="n">mesh</span> <span class="kn">import</span><span class="w"> </span><span class="nn">Mesh</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.</span> <span class="n">curve</span> <span class="kn">import</span><span class="w"> </span><span class="nn">Curve</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.</span> <span class="n">camera</span> <span class="kn">import</span><span class="w"> </span><span class="nn">Camera</span>

        <span class="c1"># ---------------------------------------------------------------------------</span>
        <span class="c1"># Camera</span>
        <span class="c1"># ---------------------------------------------------------------------------</span>

        <span class="k">if</span> <span class="n">camera_culling</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">camera</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">camera</span> <span class="o">=</span> <span class="n">Camera</span><span class="p">(</span><span class="n">camera_culling</span><span class="p">)</span>
            <span class="n">camera_culling</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">camera_culling</span><span class="p">:</span>
            <span class="n">mdl_radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">),</span> <span class="n">bfloat</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">):</span>
                <span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">mdl_radius</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">vmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">vmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">vmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vmax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">vmin</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

            <span class="n">vis</span><span class="p">,</span> <span class="n">dist</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">visible_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">mdl_radius</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">model_index</span><span class="p">])</span>

            <span class="n">vis</span> <span class="o">=</span> <span class="n">vis</span><span class="p">[:,</span> <span class="n">camera</span><span class="o">.</span><span class="n">VISIBLE</span><span class="p">]</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[:,</span> <span class="n">camera</span><span class="o">.</span><span class="n">DISTANCE</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">low_resols</span><span class="p">):</span>
                <span class="n">ls_dist</span><span class="p">,</span> <span class="n">ls_all_models</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_low_resols</span><span class="p">()</span>

        <span class="n">mesh</span>  <span class="o">=</span> <span class="n">Mesh</span><span class="p">()</span>
        <span class="n">curve</span> <span class="o">=</span> <span class="n">Curve</span><span class="p">()</span>
        <span class="n">insts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span>

        <span class="c1"># ---------------------------------------------------------------------------</span>
        <span class="c1"># Add a model on a selection</span>
        <span class="c1"># ---------------------------------------------------------------------------</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_add_model</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>

            <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="c1"># --------------------------------------------------</span>
            <span class="c1"># Instantiate the model</span>
            <span class="c1"># --------------------------------------------------</span>

            <span class="n">geo</span> <span class="o">=</span> <span class="n">model</span><span class="o">*</span><span class="n">n</span>

            <span class="c1"># --------------------------------------------------</span>
            <span class="c1"># Transformation</span>
            <span class="c1"># --------------------------------------------------</span>

            <span class="n">pts</span> <span class="o">=</span> <span class="n">insts</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span>

            <span class="k">if</span> <span class="s2">&quot;scale&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">actual_names</span><span class="p">:</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">scale</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">has_rotation</span><span class="p">:</span>
                <span class="n">rot</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">rotation</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rot</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">geo</span><span class="o">.</span><span class="n">transformation</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="n">rot</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">translation</span><span class="o">=</span><span class="n">pts</span><span class="o">.</span><span class="n">position</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span>

            <span class="c1"># --------------------------------------------------</span>
            <span class="c1"># Add to realized geometry</span>
            <span class="c1"># --------------------------------------------------</span>

            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;Mesh&#39;</span><span class="p">:</span>
                <span class="n">mesh</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">geo</span><span class="p">)</span>

            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;Curve&#39;</span><span class="p">:</span>
                <span class="n">curve</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">geo</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Instances.realize&gt; Unsupported model type: &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># ---------------------------------------------------------------------------</span>
        <span class="c1"># Loop on models</span>
        <span class="c1"># ---------------------------------------------------------------------------</span>

        <span class="k">for</span> <span class="n">model_index</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">):</span>

            <span class="c1"># Selection on instances of the current model</span>
            <span class="n">sel</span> <span class="o">=</span> <span class="n">insts</span><span class="o">.</span><span class="n">model_index</span> <span class="o">==</span> <span class="n">model_index</span>

            <span class="c1"># Visible instances</span>
            <span class="k">if</span> <span class="n">camera_culling</span><span class="p">:</span>
                <span class="n">sel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">vis</span><span class="p">)</span>

            <span class="c1"># Low scale</span>
            <span class="k">if</span> <span class="n">camera_culling</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">low_resols</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">ls_models</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ls_dist</span><span class="p">,</span> <span class="n">ls_all_models</span><span class="p">):</span>
                    <span class="n">sel_dist</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">&gt;</span> <span class="n">d</span>
                    <span class="n">ls_sel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">sel_dist</span><span class="p">)</span>
                    <span class="n">_add_model</span><span class="p">(</span><span class="n">ls_sel</span><span class="p">,</span> <span class="n">ls_models</span><span class="p">[</span><span class="n">model_index</span><span class="p">])</span>
                    <span class="n">sel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">sel_dist</span><span class="p">))</span>

            <span class="c1"># Normal scale</span>
            <span class="n">_add_model</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;mesh&#39;</span><span class="p">:</span> <span class="n">mesh</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;curve&#39;</span><span class="p">:</span> <span class="n">curve</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">points</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">}</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># To object</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">caps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_radius</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shade_smooth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">camera_culling</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="c1"># Realize to mesh and curve</span>
        <span class="n">geos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">realize</span><span class="p">(</span><span class="n">camera_culling</span><span class="o">=</span><span class="n">camera_culling</span><span class="p">)</span>

        <span class="c1"># Curve to mesh</span>
        <span class="k">if</span> <span class="n">geos</span><span class="p">[</span><span class="s1">&#39;curve&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">((</span><span class="n">profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">camera_culling</span><span class="p">):</span>
            <span class="n">meshed</span> <span class="o">=</span> <span class="n">geos</span><span class="p">[</span><span class="s1">&#39;curve&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_mesh</span><span class="p">(</span><span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="n">caps</span><span class="o">=</span><span class="n">caps</span><span class="p">,</span> <span class="n">use_radius</span><span class="o">=</span><span class="n">use_radius</span><span class="p">,</span> <span class="n">camera_culling</span><span class="o">=</span><span class="n">camera_culling</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">geos</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">geos</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meshed</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">geos</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">meshed</span><span class="p">)</span>
            <span class="n">geos</span><span class="p">[</span><span class="s1">&#39;curve&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Geometries to objects</span>
        <span class="n">both</span> <span class="o">=</span> <span class="p">(</span><span class="n">geos</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">geos</span><span class="p">[</span><span class="s1">&#39;curve&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">objects</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">geos</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot; - (M)&quot;</span> <span class="k">if</span> <span class="n">both</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="n">objects</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geos</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_object</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">shade_smooth</span><span class="o">=</span><span class="n">shade_smooth</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">geos</span><span class="p">[</span><span class="s1">&#39;curve&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">both</span><span class="p">:</span>
                <span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot; - (C)&quot;</span> <span class="k">if</span> <span class="n">both</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="n">objects</span><span class="p">[</span><span class="s1">&#39;curve&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geos</span><span class="p">[</span><span class="s1">&#39;curve&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_object</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">objects</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Dump </span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">models_to_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Models&quot;</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.mesh</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mesh</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.curve</span><span class="w"> </span><span class="kn">import</span> <span class="n">Curve</span>

        <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">low_resols</span><span class="p">):</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">lr_all_models</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_low_resols</span><span class="p">()</span>

        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">for</span> <span class="n">i_model</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">):</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">bounding_box_dims</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">Mesh</span><span class="p">):</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_mesh</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to_mesh</span><span class="p">()</span>

            <span class="n">m</span><span class="o">.</span><span class="n">translate</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

            <span class="c1"># ----- Low resols</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">low_resols</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">z</span> <span class="o">=</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lr_all_models</span><span class="p">))):</span>
                <span class="n">mdl</span> <span class="o">=</span> <span class="n">lr_all_models</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i_model</span><span class="p">]</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span> <span class="n">Mesh</span><span class="p">):</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_mesh</span><span class="p">(</span><span class="n">mdl</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">to_mesh</span><span class="p">()</span>

                <span class="n">m</span><span class="o">.</span><span class="n">translate</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
                <span class="n">mesh</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                <span class="n">z</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

            <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


        <span class="k">return</span> <span class="n">mesh</span><span class="o">.</span><span class="n">to_object</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">shade_smooth</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Joining instances</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">others</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">others</span><span class="p">:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Instances</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Instances can be joined with Instances only, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="n">insts_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
            <span class="n">models_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">models</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">join_fields</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">insts_count</span><span class="p">:]</span> <span class="o">+=</span> <span class="n">models_count</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Multiply</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="n">count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">attr_from</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">in_place</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">attr_from</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">mmultiply</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Operations</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clear_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="npblender.Instances.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">models</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model_index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attr_from</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">)</span></code>

<a href="#npblender.Instances.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create new instances.</p>
<h5 id="npblender.Instances.__init__--arguments">Arguments<a class="headerlink" href="#npblender.Instances.__init__--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="k">-</span> points (array of vectors = None) : instances locations
<span class="k">-</span> models (geometry or list of geometries = None) : the geometries to instantiate
<span class="k">-</span> model_index (int = 0) : model index of instances
<span class="k">-</span> **attributes (dict) : other geometry attributes
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/instances.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">models</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model_index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attr_from</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create new instances.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - points (array of vectors = None) : instances locations</span>
<span class="sd">        - models (geometry or list of geometries = None) : the geometries to instantiate</span>
<span class="sd">        - model_index (int = 0) : model index of instances</span>
<span class="sd">        - **attributes (dict) : other geometry attributes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">points</span>  <span class="o">=</span> <span class="n">Point</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">join_attributes</span><span class="p">(</span><span class="n">attr_from</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">models</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_models</span><span class="p">(</span><span class="n">models</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">low_resols</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">points</span><span class="p">,</span> <span class="n">model_index</span><span class="o">=</span><span class="n">model_index</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="npblender.Mesh" class="doc doc-heading">
            <code>Mesh</code>


<a href="#npblender.Mesh" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Geometry (npblender.geometry.Geometry)" href="#npblender.Geometry">Geometry</a></code></p>









              <details class="quote">
                <summary>Source code in <code>npblender/mesh.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  45</span>
<span class="normal">  46</span>
<span class="normal">  47</span>
<span class="normal">  48</span>
<span class="normal">  49</span>
<span class="normal">  50</span>
<span class="normal">  51</span>
<span class="normal">  52</span>
<span class="normal">  53</span>
<span class="normal">  54</span>
<span class="normal">  55</span>
<span class="normal">  56</span>
<span class="normal">  57</span>
<span class="normal">  58</span>
<span class="normal">  59</span>
<span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span>
<span class="normal">2288</span>
<span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span>
<span class="normal">2295</span>
<span class="normal">2296</span>
<span class="normal">2297</span>
<span class="normal">2298</span>
<span class="normal">2299</span>
<span class="normal">2300</span>
<span class="normal">2301</span>
<span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span>
<span class="normal">2316</span>
<span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span>
<span class="normal">2326</span>
<span class="normal">2327</span>
<span class="normal">2328</span>
<span class="normal">2329</span>
<span class="normal">2330</span>
<span class="normal">2331</span>
<span class="normal">2332</span>
<span class="normal">2333</span>
<span class="normal">2334</span>
<span class="normal">2335</span>
<span class="normal">2336</span>
<span class="normal">2337</span>
<span class="normal">2338</span>
<span class="normal">2339</span>
<span class="normal">2340</span>
<span class="normal">2341</span>
<span class="normal">2342</span>
<span class="normal">2343</span>
<span class="normal">2344</span>
<span class="normal">2345</span>
<span class="normal">2346</span>
<span class="normal">2347</span>
<span class="normal">2348</span>
<span class="normal">2349</span>
<span class="normal">2350</span>
<span class="normal">2351</span>
<span class="normal">2352</span>
<span class="normal">2353</span>
<span class="normal">2354</span>
<span class="normal">2355</span>
<span class="normal">2356</span>
<span class="normal">2357</span>
<span class="normal">2358</span>
<span class="normal">2359</span>
<span class="normal">2360</span>
<span class="normal">2361</span>
<span class="normal">2362</span>
<span class="normal">2363</span>
<span class="normal">2364</span>
<span class="normal">2365</span>
<span class="normal">2366</span>
<span class="normal">2367</span>
<span class="normal">2368</span>
<span class="normal">2369</span>
<span class="normal">2370</span>
<span class="normal">2371</span>
<span class="normal">2372</span>
<span class="normal">2373</span>
<span class="normal">2374</span>
<span class="normal">2375</span>
<span class="normal">2376</span>
<span class="normal">2377</span>
<span class="normal">2378</span>
<span class="normal">2379</span>
<span class="normal">2380</span>
<span class="normal">2381</span>
<span class="normal">2382</span>
<span class="normal">2383</span>
<span class="normal">2384</span>
<span class="normal">2385</span>
<span class="normal">2386</span>
<span class="normal">2387</span>
<span class="normal">2388</span>
<span class="normal">2389</span>
<span class="normal">2390</span>
<span class="normal">2391</span>
<span class="normal">2392</span>
<span class="normal">2393</span>
<span class="normal">2394</span>
<span class="normal">2395</span>
<span class="normal">2396</span>
<span class="normal">2397</span>
<span class="normal">2398</span>
<span class="normal">2399</span>
<span class="normal">2400</span>
<span class="normal">2401</span>
<span class="normal">2402</span>
<span class="normal">2403</span>
<span class="normal">2404</span>
<span class="normal">2405</span>
<span class="normal">2406</span>
<span class="normal">2407</span>
<span class="normal">2408</span>
<span class="normal">2409</span>
<span class="normal">2410</span>
<span class="normal">2411</span>
<span class="normal">2412</span>
<span class="normal">2413</span>
<span class="normal">2414</span>
<span class="normal">2415</span>
<span class="normal">2416</span>
<span class="normal">2417</span>
<span class="normal">2418</span>
<span class="normal">2419</span>
<span class="normal">2420</span>
<span class="normal">2421</span>
<span class="normal">2422</span>
<span class="normal">2423</span>
<span class="normal">2424</span>
<span class="normal">2425</span>
<span class="normal">2426</span>
<span class="normal">2427</span>
<span class="normal">2428</span>
<span class="normal">2429</span>
<span class="normal">2430</span>
<span class="normal">2431</span>
<span class="normal">2432</span>
<span class="normal">2433</span>
<span class="normal">2434</span>
<span class="normal">2435</span>
<span class="normal">2436</span>
<span class="normal">2437</span>
<span class="normal">2438</span>
<span class="normal">2439</span>
<span class="normal">2440</span>
<span class="normal">2441</span>
<span class="normal">2442</span>
<span class="normal">2443</span>
<span class="normal">2444</span>
<span class="normal">2445</span>
<span class="normal">2446</span>
<span class="normal">2447</span>
<span class="normal">2448</span>
<span class="normal">2449</span>
<span class="normal">2450</span>
<span class="normal">2451</span>
<span class="normal">2452</span>
<span class="normal">2453</span>
<span class="normal">2454</span>
<span class="normal">2455</span>
<span class="normal">2456</span>
<span class="normal">2457</span>
<span class="normal">2458</span>
<span class="normal">2459</span>
<span class="normal">2460</span>
<span class="normal">2461</span>
<span class="normal">2462</span>
<span class="normal">2463</span>
<span class="normal">2464</span>
<span class="normal">2465</span>
<span class="normal">2466</span>
<span class="normal">2467</span>
<span class="normal">2468</span>
<span class="normal">2469</span>
<span class="normal">2470</span>
<span class="normal">2471</span>
<span class="normal">2472</span>
<span class="normal">2473</span>
<span class="normal">2474</span>
<span class="normal">2475</span>
<span class="normal">2476</span>
<span class="normal">2477</span>
<span class="normal">2478</span>
<span class="normal">2479</span>
<span class="normal">2480</span>
<span class="normal">2481</span>
<span class="normal">2482</span>
<span class="normal">2483</span>
<span class="normal">2484</span>
<span class="normal">2485</span>
<span class="normal">2486</span>
<span class="normal">2487</span>
<span class="normal">2488</span>
<span class="normal">2489</span>
<span class="normal">2490</span>
<span class="normal">2491</span>
<span class="normal">2492</span>
<span class="normal">2493</span>
<span class="normal">2494</span>
<span class="normal">2495</span>
<span class="normal">2496</span>
<span class="normal">2497</span>
<span class="normal">2498</span>
<span class="normal">2499</span>
<span class="normal">2500</span>
<span class="normal">2501</span>
<span class="normal">2502</span>
<span class="normal">2503</span>
<span class="normal">2504</span>
<span class="normal">2505</span>
<span class="normal">2506</span>
<span class="normal">2507</span>
<span class="normal">2508</span>
<span class="normal">2509</span>
<span class="normal">2510</span>
<span class="normal">2511</span>
<span class="normal">2512</span>
<span class="normal">2513</span>
<span class="normal">2514</span>
<span class="normal">2515</span>
<span class="normal">2516</span>
<span class="normal">2517</span>
<span class="normal">2518</span>
<span class="normal">2519</span>
<span class="normal">2520</span>
<span class="normal">2521</span>
<span class="normal">2522</span>
<span class="normal">2523</span>
<span class="normal">2524</span>
<span class="normal">2525</span>
<span class="normal">2526</span>
<span class="normal">2527</span>
<span class="normal">2528</span>
<span class="normal">2529</span>
<span class="normal">2530</span>
<span class="normal">2531</span>
<span class="normal">2532</span>
<span class="normal">2533</span>
<span class="normal">2534</span>
<span class="normal">2535</span>
<span class="normal">2536</span>
<span class="normal">2537</span>
<span class="normal">2538</span>
<span class="normal">2539</span>
<span class="normal">2540</span>
<span class="normal">2541</span>
<span class="normal">2542</span>
<span class="normal">2543</span>
<span class="normal">2544</span>
<span class="normal">2545</span>
<span class="normal">2546</span>
<span class="normal">2547</span>
<span class="normal">2548</span>
<span class="normal">2549</span>
<span class="normal">2550</span>
<span class="normal">2551</span>
<span class="normal">2552</span>
<span class="normal">2553</span>
<span class="normal">2554</span>
<span class="normal">2555</span>
<span class="normal">2556</span>
<span class="normal">2557</span>
<span class="normal">2558</span>
<span class="normal">2559</span>
<span class="normal">2560</span>
<span class="normal">2561</span>
<span class="normal">2562</span>
<span class="normal">2563</span>
<span class="normal">2564</span>
<span class="normal">2565</span>
<span class="normal">2566</span>
<span class="normal">2567</span>
<span class="normal">2568</span>
<span class="normal">2569</span>
<span class="normal">2570</span>
<span class="normal">2571</span>
<span class="normal">2572</span>
<span class="normal">2573</span>
<span class="normal">2574</span>
<span class="normal">2575</span>
<span class="normal">2576</span>
<span class="normal">2577</span>
<span class="normal">2578</span>
<span class="normal">2579</span>
<span class="normal">2580</span>
<span class="normal">2581</span>
<span class="normal">2582</span>
<span class="normal">2583</span>
<span class="normal">2584</span>
<span class="normal">2585</span>
<span class="normal">2586</span>
<span class="normal">2587</span>
<span class="normal">2588</span>
<span class="normal">2589</span>
<span class="normal">2590</span>
<span class="normal">2591</span>
<span class="normal">2592</span>
<span class="normal">2593</span>
<span class="normal">2594</span>
<span class="normal">2595</span>
<span class="normal">2596</span>
<span class="normal">2597</span>
<span class="normal">2598</span>
<span class="normal">2599</span>
<span class="normal">2600</span>
<span class="normal">2601</span>
<span class="normal">2602</span>
<span class="normal">2603</span>
<span class="normal">2604</span>
<span class="normal">2605</span>
<span class="normal">2606</span>
<span class="normal">2607</span>
<span class="normal">2608</span>
<span class="normal">2609</span>
<span class="normal">2610</span>
<span class="normal">2611</span>
<span class="normal">2612</span>
<span class="normal">2613</span>
<span class="normal">2614</span>
<span class="normal">2615</span>
<span class="normal">2616</span>
<span class="normal">2617</span>
<span class="normal">2618</span>
<span class="normal">2619</span>
<span class="normal">2620</span>
<span class="normal">2621</span>
<span class="normal">2622</span>
<span class="normal">2623</span>
<span class="normal">2624</span>
<span class="normal">2625</span>
<span class="normal">2626</span>
<span class="normal">2627</span>
<span class="normal">2628</span>
<span class="normal">2629</span>
<span class="normal">2630</span>
<span class="normal">2631</span>
<span class="normal">2632</span>
<span class="normal">2633</span>
<span class="normal">2634</span>
<span class="normal">2635</span>
<span class="normal">2636</span>
<span class="normal">2637</span>
<span class="normal">2638</span>
<span class="normal">2639</span>
<span class="normal">2640</span>
<span class="normal">2641</span>
<span class="normal">2642</span>
<span class="normal">2643</span>
<span class="normal">2644</span>
<span class="normal">2645</span>
<span class="normal">2646</span>
<span class="normal">2647</span>
<span class="normal">2648</span>
<span class="normal">2649</span>
<span class="normal">2650</span>
<span class="normal">2651</span>
<span class="normal">2652</span>
<span class="normal">2653</span>
<span class="normal">2654</span>
<span class="normal">2655</span>
<span class="normal">2656</span>
<span class="normal">2657</span>
<span class="normal">2658</span>
<span class="normal">2659</span>
<span class="normal">2660</span>
<span class="normal">2661</span>
<span class="normal">2662</span>
<span class="normal">2663</span>
<span class="normal">2664</span>
<span class="normal">2665</span>
<span class="normal">2666</span>
<span class="normal">2667</span>
<span class="normal">2668</span>
<span class="normal">2669</span>
<span class="normal">2670</span>
<span class="normal">2671</span>
<span class="normal">2672</span>
<span class="normal">2673</span>
<span class="normal">2674</span>
<span class="normal">2675</span>
<span class="normal">2676</span>
<span class="normal">2677</span>
<span class="normal">2678</span>
<span class="normal">2679</span>
<span class="normal">2680</span>
<span class="normal">2681</span>
<span class="normal">2682</span>
<span class="normal">2683</span>
<span class="normal">2684</span>
<span class="normal">2685</span>
<span class="normal">2686</span>
<span class="normal">2687</span>
<span class="normal">2688</span>
<span class="normal">2689</span>
<span class="normal">2690</span>
<span class="normal">2691</span>
<span class="normal">2692</span>
<span class="normal">2693</span>
<span class="normal">2694</span>
<span class="normal">2695</span>
<span class="normal">2696</span>
<span class="normal">2697</span>
<span class="normal">2698</span>
<span class="normal">2699</span>
<span class="normal">2700</span>
<span class="normal">2701</span>
<span class="normal">2702</span>
<span class="normal">2703</span>
<span class="normal">2704</span>
<span class="normal">2705</span>
<span class="normal">2706</span>
<span class="normal">2707</span>
<span class="normal">2708</span>
<span class="normal">2709</span>
<span class="normal">2710</span>
<span class="normal">2711</span>
<span class="normal">2712</span>
<span class="normal">2713</span>
<span class="normal">2714</span>
<span class="normal">2715</span>
<span class="normal">2716</span>
<span class="normal">2717</span>
<span class="normal">2718</span>
<span class="normal">2719</span>
<span class="normal">2720</span>
<span class="normal">2721</span>
<span class="normal">2722</span>
<span class="normal">2723</span>
<span class="normal">2724</span>
<span class="normal">2725</span>
<span class="normal">2726</span>
<span class="normal">2727</span>
<span class="normal">2728</span>
<span class="normal">2729</span>
<span class="normal">2730</span>
<span class="normal">2731</span>
<span class="normal">2732</span>
<span class="normal">2733</span>
<span class="normal">2734</span>
<span class="normal">2735</span>
<span class="normal">2736</span>
<span class="normal">2737</span>
<span class="normal">2738</span>
<span class="normal">2739</span>
<span class="normal">2740</span>
<span class="normal">2741</span>
<span class="normal">2742</span>
<span class="normal">2743</span>
<span class="normal">2744</span>
<span class="normal">2745</span>
<span class="normal">2746</span>
<span class="normal">2747</span>
<span class="normal">2748</span>
<span class="normal">2749</span>
<span class="normal">2750</span>
<span class="normal">2751</span>
<span class="normal">2752</span>
<span class="normal">2753</span>
<span class="normal">2754</span>
<span class="normal">2755</span>
<span class="normal">2756</span>
<span class="normal">2757</span>
<span class="normal">2758</span>
<span class="normal">2759</span>
<span class="normal">2760</span>
<span class="normal">2761</span>
<span class="normal">2762</span>
<span class="normal">2763</span>
<span class="normal">2764</span>
<span class="normal">2765</span>
<span class="normal">2766</span>
<span class="normal">2767</span>
<span class="normal">2768</span>
<span class="normal">2769</span>
<span class="normal">2770</span>
<span class="normal">2771</span>
<span class="normal">2772</span>
<span class="normal">2773</span>
<span class="normal">2774</span>
<span class="normal">2775</span>
<span class="normal">2776</span>
<span class="normal">2777</span>
<span class="normal">2778</span>
<span class="normal">2779</span>
<span class="normal">2780</span>
<span class="normal">2781</span>
<span class="normal">2782</span>
<span class="normal">2783</span>
<span class="normal">2784</span>
<span class="normal">2785</span>
<span class="normal">2786</span>
<span class="normal">2787</span>
<span class="normal">2788</span>
<span class="normal">2789</span>
<span class="normal">2790</span>
<span class="normal">2791</span>
<span class="normal">2792</span>
<span class="normal">2793</span>
<span class="normal">2794</span>
<span class="normal">2795</span>
<span class="normal">2796</span>
<span class="normal">2797</span>
<span class="normal">2798</span>
<span class="normal">2799</span>
<span class="normal">2800</span>
<span class="normal">2801</span>
<span class="normal">2802</span>
<span class="normal">2803</span>
<span class="normal">2804</span>
<span class="normal">2805</span>
<span class="normal">2806</span>
<span class="normal">2807</span>
<span class="normal">2808</span>
<span class="normal">2809</span>
<span class="normal">2810</span>
<span class="normal">2811</span>
<span class="normal">2812</span>
<span class="normal">2813</span>
<span class="normal">2814</span>
<span class="normal">2815</span>
<span class="normal">2816</span>
<span class="normal">2817</span>
<span class="normal">2818</span>
<span class="normal">2819</span>
<span class="normal">2820</span>
<span class="normal">2821</span>
<span class="normal">2822</span>
<span class="normal">2823</span>
<span class="normal">2824</span>
<span class="normal">2825</span>
<span class="normal">2826</span>
<span class="normal">2827</span>
<span class="normal">2828</span>
<span class="normal">2829</span>
<span class="normal">2830</span>
<span class="normal">2831</span>
<span class="normal">2832</span>
<span class="normal">2833</span>
<span class="normal">2834</span>
<span class="normal">2835</span>
<span class="normal">2836</span>
<span class="normal">2837</span>
<span class="normal">2838</span>
<span class="normal">2839</span>
<span class="normal">2840</span>
<span class="normal">2841</span>
<span class="normal">2842</span>
<span class="normal">2843</span>
<span class="normal">2844</span>
<span class="normal">2845</span>
<span class="normal">2846</span>
<span class="normal">2847</span>
<span class="normal">2848</span>
<span class="normal">2849</span>
<span class="normal">2850</span>
<span class="normal">2851</span>
<span class="normal">2852</span>
<span class="normal">2853</span>
<span class="normal">2854</span>
<span class="normal">2855</span>
<span class="normal">2856</span>
<span class="normal">2857</span>
<span class="normal">2858</span>
<span class="normal">2859</span>
<span class="normal">2860</span>
<span class="normal">2861</span>
<span class="normal">2862</span>
<span class="normal">2863</span>
<span class="normal">2864</span>
<span class="normal">2865</span>
<span class="normal">2866</span>
<span class="normal">2867</span>
<span class="normal">2868</span>
<span class="normal">2869</span>
<span class="normal">2870</span>
<span class="normal">2871</span>
<span class="normal">2872</span>
<span class="normal">2873</span>
<span class="normal">2874</span>
<span class="normal">2875</span>
<span class="normal">2876</span>
<span class="normal">2877</span>
<span class="normal">2878</span>
<span class="normal">2879</span>
<span class="normal">2880</span>
<span class="normal">2881</span>
<span class="normal">2882</span>
<span class="normal">2883</span>
<span class="normal">2884</span>
<span class="normal">2885</span>
<span class="normal">2886</span>
<span class="normal">2887</span>
<span class="normal">2888</span>
<span class="normal">2889</span>
<span class="normal">2890</span>
<span class="normal">2891</span>
<span class="normal">2892</span>
<span class="normal">2893</span>
<span class="normal">2894</span>
<span class="normal">2895</span>
<span class="normal">2896</span>
<span class="normal">2897</span>
<span class="normal">2898</span>
<span class="normal">2899</span>
<span class="normal">2900</span>
<span class="normal">2901</span>
<span class="normal">2902</span>
<span class="normal">2903</span>
<span class="normal">2904</span>
<span class="normal">2905</span>
<span class="normal">2906</span>
<span class="normal">2907</span>
<span class="normal">2908</span>
<span class="normal">2909</span>
<span class="normal">2910</span>
<span class="normal">2911</span>
<span class="normal">2912</span>
<span class="normal">2913</span>
<span class="normal">2914</span>
<span class="normal">2915</span>
<span class="normal">2916</span>
<span class="normal">2917</span>
<span class="normal">2918</span>
<span class="normal">2919</span>
<span class="normal">2920</span>
<span class="normal">2921</span>
<span class="normal">2922</span>
<span class="normal">2923</span>
<span class="normal">2924</span>
<span class="normal">2925</span>
<span class="normal">2926</span>
<span class="normal">2927</span>
<span class="normal">2928</span>
<span class="normal">2929</span>
<span class="normal">2930</span>
<span class="normal">2931</span>
<span class="normal">2932</span>
<span class="normal">2933</span>
<span class="normal">2934</span>
<span class="normal">2935</span>
<span class="normal">2936</span>
<span class="normal">2937</span>
<span class="normal">2938</span>
<span class="normal">2939</span>
<span class="normal">2940</span>
<span class="normal">2941</span>
<span class="normal">2942</span>
<span class="normal">2943</span>
<span class="normal">2944</span>
<span class="normal">2945</span>
<span class="normal">2946</span>
<span class="normal">2947</span>
<span class="normal">2948</span>
<span class="normal">2949</span>
<span class="normal">2950</span>
<span class="normal">2951</span>
<span class="normal">2952</span>
<span class="normal">2953</span>
<span class="normal">2954</span>
<span class="normal">2955</span>
<span class="normal">2956</span>
<span class="normal">2957</span>
<span class="normal">2958</span>
<span class="normal">2959</span>
<span class="normal">2960</span>
<span class="normal">2961</span>
<span class="normal">2962</span>
<span class="normal">2963</span>
<span class="normal">2964</span>
<span class="normal">2965</span>
<span class="normal">2966</span>
<span class="normal">2967</span>
<span class="normal">2968</span>
<span class="normal">2969</span>
<span class="normal">2970</span>
<span class="normal">2971</span>
<span class="normal">2972</span>
<span class="normal">2973</span>
<span class="normal">2974</span>
<span class="normal">2975</span>
<span class="normal">2976</span>
<span class="normal">2977</span>
<span class="normal">2978</span>
<span class="normal">2979</span>
<span class="normal">2980</span>
<span class="normal">2981</span>
<span class="normal">2982</span>
<span class="normal">2983</span>
<span class="normal">2984</span>
<span class="normal">2985</span>
<span class="normal">2986</span>
<span class="normal">2987</span>
<span class="normal">2988</span>
<span class="normal">2989</span>
<span class="normal">2990</span>
<span class="normal">2991</span>
<span class="normal">2992</span>
<span class="normal">2993</span>
<span class="normal">2994</span>
<span class="normal">2995</span>
<span class="normal">2996</span>
<span class="normal">2997</span>
<span class="normal">2998</span>
<span class="normal">2999</span>
<span class="normal">3000</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Mesh</span><span class="p">(</span><span class="n">Geometry</span><span class="p">):</span>

    <span class="n">domain_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">,</span> <span class="s1">&#39;corners&#39;</span><span class="p">,</span> <span class="s1">&#39;faces&#39;</span><span class="p">,</span> <span class="s1">&#39;edges&#39;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">corners</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attr_from</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Mesh Geometry.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - points (array of vectors = None) : the vertices</span>
<span class="sd">            - corners (array of ints = None) : corners, i.e. indices on the array of points</span>
<span class="sd">            - faces (array of ints = None) : size of the faces, the sum of this array must be equal to the length of the corners array</span>
<span class="sd">            - edges (array of couples of ints = None) : list of edges defined by two vertex indices</span>
<span class="sd">            - materials (str or list of strs = None) : list of materials used in the geometry</span>
<span class="sd">            - attr_from (Geometry) : domain attributes to copy from</span>
<span class="sd">            - **attrs (dict) : other geometry attributes</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># ----- Initialize an empty geometry</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">points</span>  <span class="o">=</span> <span class="n">Vertex</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">corners</span> <span class="o">=</span> <span class="n">Corner</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">faces</span>   <span class="o">=</span> <span class="n">Face</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span>   <span class="o">=</span> <span class="n">Edge</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">join_attributes</span><span class="p">(</span><span class="n">attr_from</span><span class="p">)</span>

        <span class="c1"># ----- The materials</span>

        <span class="k">if</span> <span class="n">materials</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">materials</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">materials</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">materials</span> <span class="o">=</span> <span class="p">[</span><span class="n">materials</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">materials</span> <span class="o">=</span> <span class="p">[</span><span class="n">mat</span> <span class="k">for</span> <span class="n">mat</span> <span class="ow">in</span> <span class="n">materials</span><span class="p">]</span>

        <span class="c1"># ----- Add geometry</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">corners</span><span class="p">,</span> <span class="n">faces</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Utilities</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">dummy</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">points_count</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">corners_count</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">verts</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">points_count</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="k">if</span> <span class="n">points_count</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">corners</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">points_count</span><span class="p">,</span> <span class="n">corners_count</span><span class="p">)</span> <span class="k">if</span> <span class="n">corners_count</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">loops</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">faces</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">corners_count</span> <span class="k">if</span> <span class="n">corners_count</span> <span class="k">else</span> <span class="n">points_count</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">loops</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">//</span><span class="mi">4</span><span class="p">)</span>
                <span class="n">loops</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">loops</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">loops</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">loops</span> <span class="o">=</span> <span class="n">faces</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">verts</span><span class="p">,</span> <span class="n">corners</span><span class="o">=</span><span class="n">corners</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="n">loops</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="n">edges</span><span class="p">,</span><span class="o">**</span><span class="n">attrs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Mesh Check&quot;</span><span class="p">,</span> <span class="n">halt</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">),</span> <span class="n">halt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">),</span> <span class="n">halt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">),</span> <span class="n">halt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">halt</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2"> check failed&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2"> check failed&quot;</span><span class="p">)</span>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;Mesh: points </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span><span class="si">}</span><span class="s2">, corners </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">)</span><span class="si">}</span><span class="s2">, faces </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span><span class="si">}</span><span class="s2">, edges </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span><span class="si">}</span><span class="s2">&gt;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;Mesh:</span><span class="se">\n</span><span class="s2">   &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">)])</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="c1"># =============================================================================================================================</span>
    <span class="c1"># Serialization</span>
    <span class="c1"># =============================================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;geometry&#39;</span><span class="p">:</span>     <span class="s1">&#39;Mesh&#39;</span><span class="p">,</span>
            <span class="s1">&#39;materials&#39;</span> <span class="p">:</span>   <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">,</span>
            <span class="s1">&#39;points&#39;</span><span class="p">:</span>       <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
            <span class="s1">&#39;corners&#39;</span><span class="p">:</span>      <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
            <span class="s1">&#39;faces&#39;</span><span class="p">:</span>        <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
            <span class="s1">&#39;edges&#39;</span><span class="p">:</span>        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
            <span class="p">}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">materials</span>  <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;materials&#39;</span><span class="p">]</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">points</span>     <span class="o">=</span> <span class="n">Vertex</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">])</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">corners</span>    <span class="o">=</span> <span class="n">Corner</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;corners&#39;</span><span class="p">])</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">faces</span>      <span class="o">=</span> <span class="n">Face</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;faces&#39;</span><span class="p">])</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">edges</span>      <span class="o">=</span> <span class="n">Edge</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">mesh</span>

    <span class="c1"># =============================================================================================================================</span>
    <span class="c1"># Clear the geometry</span>
    <span class="c1"># =============================================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clear_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Clear the geometry.</span>

<span class="sd">        Delete all the content.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="c1"># =============================================================================================================================</span>
    <span class="c1"># From another Mesh</span>
    <span class="c1"># =============================================================================================================================</span>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Copy</span>
    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_mesh</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a Mesh from another mesh.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - other (Mesh) : the mesh to copy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - Mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">materials</span><span class="o">=</span><span class="n">other</span><span class="o">.</span><span class="n">materials</span><span class="p">)</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">points</span>  <span class="o">=</span> <span class="n">Vertex</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">points</span><span class="p">,</span>  <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;COPY&#39;</span><span class="p">)</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">corners</span> <span class="o">=</span> <span class="n">Corner</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">corners</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;COPY&#39;</span><span class="p">)</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">faces</span>   <span class="o">=</span> <span class="n">Face</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">faces</span><span class="p">,</span>   <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;COPY&#39;</span><span class="p">)</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">edges</span>   <span class="o">=</span> <span class="n">Edge</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span>    <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;COPY&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">points_mask</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">points_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
            <span class="n">points_mask</span><span class="p">[</span><span class="n">points</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">faces</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">faces_mask</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">faces_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
            <span class="n">faces_mask</span><span class="p">[</span><span class="n">faces</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">edges_mask</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">edges_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">edges</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
            <span class="n">edges_mask</span><span class="p">[</span><span class="n">edges</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">mesh</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">points_mask</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="n">faces_mask</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="n">edges_mask</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mesh</span>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Capture another Mesh</span>
    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">capture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Capture the data of another Mesh.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - other (Mesh) : the mesh to capture</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - self</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">materials</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">materials</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">points</span>  <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">points</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">corners</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">corners</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">faces</span>   <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">faces</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span>   <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">edges</span>

    <span class="c1"># =============================================================================================================================</span>
    <span class="c1"># Blender Interface</span>
    <span class="c1"># =============================================================================================================================</span>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>
    <span class="c1"># From Mesh data</span>
    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_mesh_data</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Initialize the geometry from a Blender Mesh</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - mesh (Blender Mesh instance) : the mesh to load</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">blender</span>

        <span class="n">bl_mesh</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">get_mesh</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">mesh</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>

        <span class="c1"># ----- Materials</span>

        <span class="n">mesh</span><span class="o">.</span><span class="n">materials</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">mat</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">mat</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">mat</span> <span class="ow">in</span> <span class="n">bl_mesh</span><span class="o">.</span><span class="n">materials</span><span class="p">]</span>

        <span class="c1"># ----- Vertices</span>

        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bl_mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Positions will be read as position attribute</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

        <span class="c1"># ----- Corners</span>

        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bl_mesh</span><span class="o">.</span><span class="n">polygons</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bl_mesh</span><span class="o">.</span><span class="n">loops</span><span class="p">),</span> <span class="n">bint</span><span class="p">)</span>
            <span class="n">bl_mesh</span><span class="o">.</span><span class="n">loops</span><span class="o">.</span><span class="n">foreach_get</span><span class="p">(</span><span class="s2">&quot;vertex_index&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vertex_index</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>

            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bl_mesh</span><span class="o">.</span><span class="n">polygons</span><span class="p">),</span> <span class="n">bint</span><span class="p">)</span>
            <span class="n">bl_mesh</span><span class="o">.</span><span class="n">polygons</span><span class="o">.</span><span class="n">foreach_get</span><span class="p">(</span><span class="s2">&quot;loop_total&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">append_sizes</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

            <span class="k">del</span> <span class="n">a</span>

        <span class="c1"># ----- Edges</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bl_mesh</span><span class="o">.</span><span class="n">edges</span><span class="p">):</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bl_mesh</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="n">bint</span><span class="p">)</span>
            <span class="n">bl_mesh</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">foreach_get</span><span class="p">(</span><span class="s2">&quot;vertices&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vertex0</span><span class="o">=</span><span class="n">a</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">vertex1</span><span class="o">=</span><span class="n">a</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

            <span class="k">del</span> <span class="n">a</span>

            <span class="n">mesh</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">remove_face_edges</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">get_edges</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">corners</span><span class="p">))</span>

        <span class="c1"># ----- Attributes</span>

        <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">from_bl_attributes</span><span class="p">(</span><span class="n">bl_mesh</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">from_bl_attributes</span><span class="p">(</span><span class="n">bl_mesh</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">from_bl_attributes</span><span class="p">(</span><span class="n">bl_mesh</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">from_bl_attributes</span><span class="p">(</span><span class="n">bl_mesh</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mesh</span>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>
    <span class="c1"># To Mesh data</span>
    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_mesh_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Write the geometry into a Blender Mesh</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - mesh (Blender Mesh instance) : the mesh to write</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">npblender</span><span class="w"> </span><span class="kn">import</span> <span class="n">blender</span>

        <span class="n">bl_mesh</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">bl_mesh</span><span class="o">.</span><span class="n">clear_geometry</span><span class="p">()</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Materials</span>

        <span class="n">bl_mesh</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">mat_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mat_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">bl_mesh</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mat_name</span><span class="p">))</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Vertices</span>

        <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
            <span class="n">bl_mesh</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">))</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Corners</span>

        <span class="n">corners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">):</span>
            <span class="n">bl_mesh</span><span class="o">.</span><span class="n">loops</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">))</span>
            <span class="n">bl_mesh</span><span class="o">.</span><span class="n">loops</span><span class="o">.</span><span class="n">foreach_set</span><span class="p">(</span><span class="s2">&quot;vertex_index&quot;</span><span class="p">,</span> <span class="n">blender</span><span class="o">.</span><span class="n">int_array</span><span class="p">(</span><span class="n">corners</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">))</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Faces</span>

        <span class="n">faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">faces</span><span class="p">):</span>
            <span class="n">bl_mesh</span><span class="o">.</span><span class="n">polygons</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">faces</span><span class="p">))</span>
            <span class="n">bl_mesh</span><span class="o">.</span><span class="n">polygons</span><span class="o">.</span><span class="n">foreach_set</span><span class="p">(</span><span class="s2">&quot;loop_start&quot;</span><span class="p">,</span> <span class="n">blender</span><span class="o">.</span><span class="n">int_array</span><span class="p">(</span><span class="n">faces</span><span class="o">.</span><span class="n">loop_start</span><span class="p">))</span>
            <span class="n">bl_mesh</span><span class="o">.</span><span class="n">polygons</span><span class="o">.</span><span class="n">foreach_set</span><span class="p">(</span><span class="s2">&quot;loop_total&quot;</span><span class="p">,</span> <span class="n">blender</span><span class="o">.</span><span class="n">int_array</span><span class="p">(</span><span class="n">faces</span><span class="o">.</span><span class="n">loop_total</span><span class="p">))</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Edges</span>

        <span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">):</span>
            <span class="c1"># edges to add</span>
            <span class="n">add_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">vertices</span>

            <span class="c1"># edges have been created by faces</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">faces</span><span class="p">):</span>
                <span class="n">bl_mesh</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

                <span class="n">cur_n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bl_mesh</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cur_n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">cur_n</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bint</span><span class="p">)</span>
                    <span class="n">bl_mesh</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">foreach_get</span><span class="p">(</span><span class="s1">&#39;vertices&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>

                <span class="n">add_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">add_edges</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># add the edges</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>
            <span class="n">bl_mesh</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

            <span class="n">bl_mesh</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">foreach_set</span><span class="p">(</span><span class="s1">&#39;vertices&#39;</span><span class="p">,</span> <span class="n">add_edges</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Attributes</span>

        <span class="n">attributes</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">attributes</span>

        <span class="n">points</span><span class="o">.</span><span class="n">to_bl_attributes</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">corners</span><span class="o">.</span><span class="n">to_bl_attributes</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">faces</span><span class="o">.</span><span class="n">to_bl_attributes</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">edges</span><span class="o">.</span><span class="n">to_bl_attributes</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Update</span>

        <span class="n">bl_mesh</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Initialize from an object</span>
    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_object</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">evaluated</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a Mesh from an existing object.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - obj (str or Blender object) : the object to initialize from</span>
<span class="sd">            - evaluated (bool = False) : object modified by the modifiers if True, raw vertices otherwise</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - Mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">blender</span>

        <span class="k">if</span> <span class="n">evaluated</span><span class="p">:</span>
            <span class="n">depsgraph</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluated_depsgraph_get</span><span class="p">()</span>
            <span class="n">object_eval</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">evaluated_get</span><span class="p">(</span><span class="n">depsgraph</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">FromMeshData</span><span class="p">(</span><span class="n">object_eval</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_mesh_data</span><span class="p">(</span><span class="n">blender</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>
    <span class="c1"># To blender object</span>
    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">shade_smooth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shapekeys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create or update a blender object.</span>

<span class="sd">        The method &#39;to_object&#39; creates the whole geometry. It creates a new object if it doesn&#39;t already exist.</span>
<span class="sd">        If the object exists, it must be a mesh, there is no object type conversion.</span>

<span class="sd">        Once the object is created, use the method &#39;update_object&#39; to change the vertices.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - obj (str or Blender object) : the object the create</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - Blender mesh object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">npblender</span><span class="w"> </span><span class="kn">import</span> <span class="n">blender</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">create_mesh_object</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_mesh_data</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">shade_smooth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">res</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">polygons</span><span class="o">.</span><span class="n">foreach_set</span><span class="p">(</span><span class="s1">&#39;use_smooth&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">shade_smooth</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">polygons</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">shapekeys</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shapekeys</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shapekeys</span><span class="p">,</span> <span class="n">ShapeKeys</span><span class="p">):</span>
                    <span class="n">shapekeys</span><span class="o">.</span><span class="n">to_mesh_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">sks</span> <span class="ow">in</span> <span class="n">shapekeys</span><span class="p">:</span>
                        <span class="n">sks</span><span class="o">.</span><span class="n">to_mesh_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">res</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># bmesh edition</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>
    <span class="c1"># bmesh utility to pass from internal geometry to bmesh</span>
    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_bm_verts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bm</span><span class="p">):</span>
        <span class="n">nverts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="n">verts</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nverts</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">vert</span> <span class="ow">in</span> <span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="p">:</span>
            <span class="n">verts</span><span class="p">[</span><span class="n">vert</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">vert</span>
        <span class="k">return</span> <span class="n">verts</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_bm_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bm</span><span class="p">):</span>
        <span class="n">nedges</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bm</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>
        <span class="n">edges</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">nedges</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
        <span class="n">verts</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">nedges</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bint</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i_edge</span><span class="p">,</span> <span class="n">edge</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bm</span><span class="o">.</span><span class="n">edges</span><span class="p">):</span>
            <span class="n">edges</span><span class="p">[</span><span class="n">i_edge</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge</span>

            <span class="n">i0</span><span class="p">,</span> <span class="n">i1</span> <span class="o">=</span> <span class="n">edge</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">edge</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
            <span class="n">verts</span><span class="p">[</span><span class="n">i_edge</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">)</span> <span class="k">if</span> <span class="n">i0</span> <span class="o">&lt;</span> <span class="n">i1</span> <span class="k">else</span> <span class="p">(</span><span class="n">i1</span><span class="p">,</span> <span class="n">i0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">edges</span><span class="p">,</span> <span class="n">verts</span>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>
    <span class="c1"># bmesh context</span>
    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>

    <span class="nd">@contextmanager</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bmesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Acces to bmesh api.</span>

<span class="sd">        The example below use bmesh to offset the vertices of +1 in the x axis.</span>

<span class="sd">        ``` python</span>
<span class="sd">        mesh = Mesh.Cube()</span>

<span class="sd">        # Move the vertices with bmesh</span>
<span class="sd">        with mesh.bmesh() as bm:</span>
<span class="sd">            for v in bm.verts:</span>
<span class="sd">                v.co.x += 1.0</span>

<span class="sd">        # Move the vertices directy in numpy array</span>
<span class="sd">        mesh.points.position[:, 1] += 1</span>

<span class="sd">        # Cube moved along x and y</span>
<span class="sd">        mesh.to_object(&quot;Cube&quot;)</span>
<span class="sd">        ```</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - readonly (bool=False) : avoid to read back the bmesh if not modications were done</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">meshes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">DATA_TEMP_NAME</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">meshes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">DATA_TEMP_NAME</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_mesh_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">bm</span> <span class="o">=</span> <span class="n">bmesh</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>   <span class="c1"># create an empty BMesh</span>
        <span class="n">bm</span><span class="o">.</span><span class="n">from_mesh</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="c1"># fill it in from a Mesh</span>

        <span class="k">yield</span> <span class="n">bm</span>

        <span class="c1"># ----- Back</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">readonly</span><span class="p">:</span>
            <span class="n">bm</span><span class="o">.</span><span class="n">to_mesh</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="n">Mesh</span><span class="o">.</span><span class="n">from_mesh_data</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

        <span class="n">bm</span><span class="o">.</span><span class="n">free</span><span class="p">()</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Mesh data edition</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="nd">@contextmanager</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">blender_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Acces to Blender Mesh API.</span>

<span class="sd">        Transfer the geometry to a temporay Blender Mesh.</span>
<span class="sd">        The example below use a blender Mesh to get the normals.</span>

<span class="sd">        ``` python</span>
<span class="sd">        mesh = Mesh.Cube()</span>

<span class="sd">        with mesh.blender_data() as data:</span>
<span class="sd">            normals = np.array([poly.normal for poly in data.polygons])</span>

<span class="sd">        print(normals)</span>

<span class="sd">        # &gt; [[-1. -0.  0.]</span>
<span class="sd">        #    [ 0.  1.  0.]</span>
<span class="sd">        #    [ 1. -0.  0.]</span>
<span class="sd">        #    [ 0. -1.  0.]</span>
<span class="sd">        #    [ 0.  0. -1.]</span>
<span class="sd">        #    [ 0. -0.  1.]]</span>
<span class="sd">        ```</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - readonly (bool=False) : don&#39;t read back the geometry if not modified</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - Blender Mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">meshes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">DATA_TEMP_NAME</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">meshes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">DATA_TEMP_NAME</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">to_mesh_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">yield</span> <span class="n">data</span>

        <span class="c1"># ----- Back</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">readonly</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="n">Mesh</span><span class="o">.</span><span class="n">from_mesh_data</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># From something</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_model</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Object</span><span class="p">)):</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">evaluated</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">Mesh</span><span class="p">):</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_mesh</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Mesh</span><span class="p">):</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_mesh_data</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mesh.from_model: &#39;model&#39; type is not valid: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mesh</span>

    <span class="c1"># =============================================================================================================================</span>
    <span class="c1"># Utility</span>
    <span class="c1"># =============================================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_faces_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">selection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>

    <span class="c1"># =============================================================================================================================</span>
    <span class="c1"># Combining</span>
    <span class="c1"># =============================================================================================================================</span>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Join other meshes</span>
    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">others</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Join other Meshes.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - others (Mesh) : the Mesh to append</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">others</span><span class="p">:</span>

            <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
            <span class="c1"># Vertices</span>

            <span class="n">v_ofs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>

            <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
            <span class="c1"># Corners</span>

            <span class="n">c_ofs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">corners</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">[</span><span class="n">c_ofs</span><span class="p">:]</span> <span class="o">+=</span> <span class="n">v_ofs</span>

            <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
            <span class="c1"># Faces</span>

            <span class="n">f_ofs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">loop_start</span><span class="p">[</span><span class="n">f_ofs</span><span class="p">:]</span> <span class="o">+=</span> <span class="n">c_ofs</span>

            <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
            <span class="c1"># Edges</span>

            <span class="n">e_ofs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">vertex0</span><span class="p">[</span><span class="n">e_ofs</span><span class="p">:]</span> <span class="o">+=</span> <span class="n">v_ofs</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">vertex1</span><span class="p">[</span><span class="n">e_ofs</span><span class="p">:]</span> <span class="o">+=</span> <span class="n">v_ofs</span>

            <span class="c1"># ----- Materials</span>

            <span class="n">remap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">get_material_index</span><span class="p">(</span><span class="n">mat_name</span><span class="p">)</span> <span class="k">for</span> <span class="n">mat_name</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">materials</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">remap</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">material_index</span><span class="p">[</span><span class="n">f_ofs</span><span class="p">:]</span> <span class="o">=</span> <span class="n">remap</span><span class="p">[</span><span class="n">other</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">material_index</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Multiply</span>
    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Duplicate the geometry.</span>

<span class="sd">        Multiplying is a way to efficiently duplicate the geometry a great number of times.</span>
<span class="sd">        Once duplicated, the vertices can be reshapped to address each instance individually.</span>

<span class="sd">        ``` python</span>
<span class="sd">        count = 16</span>

<span class="sd">        cube = Mesh.Cube() * count</span>

<span class="sd">        # Shape the points as 16 blocks of 8 vertices</span>
<span class="sd">        points = np.reshape(cube.points.position, (16, 8, 3))</span>

<span class="sd">        # Place the cubes in a circle</span>
<span class="sd">        ags = np.linspace(0, 2*np.pi, count, endpoint=False)</span>
<span class="sd">        points[..., 0] += 6 * np.cos(ags)[:, None]</span>
<span class="sd">        points[..., 1] += 6 * np.sin(ags)[:, None]</span>

<span class="sd">        cube.to_object(&quot;Cubes&quot;)</span>
<span class="sd">        ```</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - count (int=10) : number of instances</span>
<span class="sd">            - attributes (name=value) : value for named attributes</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - Mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Checks and simple cases</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A Mesh can be multiplied only by an int, not &#39;</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">from_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">in_place</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">from_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Vertices</span>

        <span class="n">nverts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Corners</span>

        <span class="n">ncorners</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">vertex_index</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">*</span><span class="n">nverts</span><span class="p">,</span> <span class="n">ncorners</span><span class="p">)</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Faces</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">update_loop_start</span><span class="p">()</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Edges</span>

        <span class="n">nedges</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
        <span class="n">ofs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">*</span><span class="n">nverts</span><span class="p">,</span> <span class="n">nedges</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">vertex0</span> <span class="o">+=</span> <span class="n">ofs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">vertex1</span> <span class="o">+=</span> <span class="n">ofs</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Operators</span>
    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># =============================================================================================================================</span>
    <span class="c1"># Editing</span>
    <span class="c1"># =============================================================================================================================</span>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Extract attributes per domain</span>
    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_attributes_per_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>

        <span class="n">dispatched</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;points&#39;</span>  <span class="p">:</span> <span class="p">{},</span>
            <span class="s1">&#39;corners&#39;</span> <span class="p">:</span> <span class="p">{},</span>
            <span class="s1">&#39;faces&#39;</span>   <span class="p">:</span> <span class="p">{},</span>
            <span class="s1">&#39;edges&#39;</span>   <span class="p">:</span> <span class="p">{},</span>
            <span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">all_names</span><span class="p">:</span>
                <span class="n">dispatched</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">all_names</span><span class="p">:</span>
                <span class="n">dispatched</span><span class="p">[</span><span class="s1">&#39;corners&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">all_names</span><span class="p">:</span>
                <span class="n">dispatched</span><span class="p">[</span><span class="s1">&#39;faces&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">all_names</span><span class="p">:</span>
                <span class="n">dispatched</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown mesh attribute &#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&#39;.</span><span class="se">\n</span><span class="s2">&quot;</span>
                                     <span class="sa">f</span><span class="s2">&quot;- points:  </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">all_names</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                                     <span class="sa">f</span><span class="s2">&quot;- corners: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">all_names</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                                     <span class="sa">f</span><span class="s2">&quot;- faces:   </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">all_names</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                                     <span class="sa">f</span><span class="s2">&quot;- edges:   </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">all_names</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                                     <span class="p">)</span>

            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mesh add_geometry&gt; attribute &#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&#39; is ambigous, it belongs to more than one domain (count).</span><span class="se">\n</span><span class="s2">&quot;</span>
                                     <span class="sa">f</span><span class="s2">&quot;- points:  </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">all_names</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                                     <span class="sa">f</span><span class="s2">&quot;- corners: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">all_names</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                                     <span class="sa">f</span><span class="s2">&quot;- faces:   </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">all_names</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                                     <span class="sa">f</span><span class="s2">&quot;- edges:   </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">all_names</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                                     <span class="p">)</span>
        <span class="k">return</span> <span class="n">dispatched</span>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Add geometry</span>
    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">corners</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">safe_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Add geometry</span>

<span class="sd">        Note that the added geometry can refer to existing vertices. It is appended as is, whithout shifting</span>
<span class="sd">        indices.</span>

<span class="sd">        To add independant geometry, use join_geometry.</span>

<span class="sd">        ``` python</span>
<span class="sd">        cube = Mesh.cube()</span>
<span class="sd">        # add a triangle on existing vertices</span>
<span class="sd">        # corners argument refers to cube vertices</span>
<span class="sd">        cube.add_geometry(corners=[0, 1, 2], faces=3)</span>

<span class="sd">        # add a triangle with additional vertices</span>
<span class="sd">        # corners argument refers to the new vertices</span>
<span class="sd">        cube.join_geometry(points=[[0, 0, 0], [0, 1, 0], [1, 0, 0]], corners=[0, 1, 2], faces=3)</span>
<span class="sd">        ```</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - points (array of vectors = None) : the vertices</span>
<span class="sd">            - corners (array of ints = None) : corners, i.e. indices on the array of points</span>
<span class="sd">            - sizes (array of ints = None) : size of the faces, the sum of this array must be equal to the length of the corners array</span>
<span class="sd">            - materials (str or list of strs = None) : list of materials used in the geometry</span>
<span class="sd">            - **attrs (dict) : other geometry attributes</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - dict : {&#39;points&#39;, &#39;corners&#39;, &#39;faces&#39;, &#39;edges&#39;: added geometry indices}</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">disp_attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes_per_domain</span><span class="p">(</span><span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
        <span class="n">added</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;points&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;corners&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;faces&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;edges&#39;</span><span class="p">:</span> <span class="p">[]}</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Add vertices</span>
        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

        <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">added</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">points</span><span class="p">,</span> <span class="o">**</span><span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">])</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Edges</span>
        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

        <span class="k">if</span> <span class="n">edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span><span class="p">,):</span>
                <span class="n">added</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vertex0</span><span class="o">=</span><span class="n">edges</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vertex1</span><span class="o">=</span><span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">added</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vertex0</span><span class="o">=</span><span class="n">edges</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">vertex1</span><span class="o">=</span><span class="n">edges</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">])</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Corners and Faces</span>
        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

        <span class="c1"># If corners is provided, faces can be:</span>
        <span class="c1"># - None -&gt; single face made of all corners</span>
        <span class="c1"># - int -&gt; faces are all the same size (len(corners) must be a multiplief of faces)</span>
        <span class="c1"># - array like -&gt; face sizes (len(corners) == np.sum(faces))</span>
        <span class="c1">#</span>
        <span class="c1"># If faces is provided, corners can be:</span>
        <span class="c1"># - None -&gt; faces must be an array of arrays, each array being of list of corners</span>
        <span class="c1"># - not None -&gt; see above</span>

        <span class="n">ok_faces</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">corners</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">faces</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ok_faces</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">corners</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">sizes</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">ok</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">faces</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">faces</span><span class="p">:</span>
                        <span class="n">ok</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">faces</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">face</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
                            <span class="k">break</span>
                        <span class="n">corners</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
                        <span class="n">sizes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">face</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mesh add_geometry&gt; when corners is None, faces must be None or an array of arrays, each array being of list of corners.&quot;</span><span class="p">)</span>
                <span class="n">faces</span> <span class="o">=</span> <span class="n">sizes</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">corners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span>
            <span class="n">ncorners</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">faces</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">faces</span> <span class="o">=</span> <span class="p">[</span><span class="n">ncorners</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">faces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">faces</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">faces</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">():</span>
                    <span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">faces</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">ncorners</span> <span class="o">%</span> <span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mesh add_geometry&gt; when faces is a single number </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">, it must divide the number of corners (</span><span class="si">{</span><span class="n">ncorners</span><span class="si">}</span><span class="s2">).&quot;</span><span class="p">)</span>
                    <span class="n">faces</span> <span class="o">=</span> <span class="p">[</span><span class="n">size</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">ncorners</span> <span class="o">//</span> <span class="n">size</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">faces</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ncorners</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mesh add_geometry&gt; the sum of faces (</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">faces</span><span class="p">)</span><span class="si">}</span><span class="s2">) must be equal to the number of corners (</span><span class="si">{</span><span class="n">ncorners</span><span class="si">}</span><span class="s2">).&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ok_faces</span><span class="p">:</span>
            <span class="n">added</span><span class="p">[</span><span class="s1">&#39;corners&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vertex_index</span><span class="o">=</span><span class="n">corners</span><span class="p">,</span> <span class="o">**</span><span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;corners&#39;</span><span class="p">])</span>
            <span class="n">added</span><span class="p">[</span><span class="s1">&#39;faces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">append_sizes</span><span class="p">(</span><span class="n">faces</span><span class="p">,</span> <span class="o">**</span><span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;faces&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="kc">False</span><span class="p">:</span> <span class="c1"># OLD</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">faces</span><span class="p">)</span> <span class="o">==</span> <span class="p">():</span>
                <span class="n">nfaces</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span> <span class="o">//</span> <span class="n">faces</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span> <span class="o">%</span> <span class="n">faces</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mesh add_geometry&gt; when faces is a single number </span><span class="si">{</span><span class="n">faces</span><span class="si">}</span><span class="s2">, it must divide the number of corners (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span><span class="si">}</span><span class="s2">).&quot;</span><span class="p">)</span>
                <span class="n">faces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nfaces</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bint</span><span class="p">)</span><span class="o">*</span><span class="n">faces</span>

            <span class="n">added</span><span class="p">[</span><span class="s1">&#39;corners&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vertex_index</span><span class="o">=</span><span class="n">corners</span><span class="p">,</span> <span class="o">**</span><span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;corners&#39;</span><span class="p">])</span>
            <span class="n">added</span><span class="p">[</span><span class="s1">&#39;faces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">append_sizes</span><span class="p">(</span><span class="n">faces</span><span class="p">,</span> <span class="o">**</span><span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;faces&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">safe_mode</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">added</span>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Join geometry</span>
    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">join_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">corners</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">safe_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Join geometry defined by components.</span>

<span class="sd">        The geometry passed in argument is consistent and doesn&#39;t refer to existing vertices. It is used</span>
<span class="sd">        to build an independant mesh which is then joined.</span>
<span class="sd">        See &#39;add_geometry&#39; which, on the contrary, can refer to existing vertices.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - self</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">attr_from</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span>
            <span class="n">points</span><span class="o">=</span><span class="n">points</span><span class="p">,</span> 
            <span class="n">corners</span><span class="o">=</span><span class="n">corners</span><span class="p">,</span> 
            <span class="n">faces</span><span class="o">=</span><span class="n">faces</span><span class="p">,</span> 
            <span class="n">edges</span><span class="o">=</span><span class="n">edges</span><span class="p">,</span>
            <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Add Vertices</span>
    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span>  <span class="o">**</span><span class="n">attributes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Add vertices.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - points (array of vectors) : the vertices to add</span>
<span class="sd">            - attributes (name=value) : value for named attributes</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - array of ints : indices of the added vertices</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">npoints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">points</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">)</span>

    <span class="c1"># =============================================================================================================================</span>
    <span class="c1"># Split edges</span>
    <span class="c1"># =============================================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">split_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop0</span><span class="p">,</span> <span class="n">loop1</span><span class="p">,</span> <span class="n">cuts</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>

        <span class="n">n0</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">loop0</span><span class="p">)</span> <span class="o">==</span> <span class="p">()</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">loop0</span><span class="p">)</span>
        <span class="n">n1</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">loop1</span><span class="p">)</span> <span class="o">==</span> <span class="p">()</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">loop1</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n0</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
            <span class="n">loop0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">loop0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bint</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">loop0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bint</span><span class="p">)</span><span class="o">*</span><span class="n">loop0</span>

        <span class="k">if</span> <span class="n">n1</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
            <span class="n">loop1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">loop1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bint</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">loop1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bint</span><span class="p">)</span><span class="o">*</span><span class="n">loop1</span>

        <span class="n">to_select</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">loop0</span><span class="p">,</span> <span class="n">loop1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">loop0</span><span class="p">,</span> <span class="n">loop1</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># shape (p, 2)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>

            <span class="n">edges</span><span class="p">,</span> <span class="n">verts_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bm_edges</span><span class="p">(</span><span class="n">bm</span><span class="p">)</span>

            <span class="c1"># select edges in to_select</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">([(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">bint</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">bint</span><span class="p">)])</span>
            <span class="n">edges_view</span> <span class="o">=</span> <span class="n">verts_indices</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
            <span class="n">to_select_view</span> <span class="o">=</span> <span class="n">to_select</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>

            <span class="c1"># selection mask</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">edges_view</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">to_select_view</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>

            <span class="n">edges_to_cut</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">edges_to_cut</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="c1"># Edges subidivision</span>
            <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">subdivide_edges</span><span class="p">(</span>
                <span class="n">bm</span><span class="p">,</span>
                <span class="n">edges</span><span class="o">=</span><span class="n">edges_to_cut</span><span class="p">,</span>
                <span class="n">cuts</span><span class="o">=</span><span class="n">cuts</span><span class="p">,</span>
                <span class="n">use_grid_fill</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>

    <span class="c1"># =============================================================================================================================</span>
    <span class="c1"># Bridge loops</span>
    <span class="c1"># =============================================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">bridge_loops</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop0</span><span class="p">,</span> <span class="n">loop1</span><span class="p">,</span> <span class="n">close</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a grid linking two loops of the same size.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        - loop0 (array of ints) : the first loop</span>
<span class="sd">        - loop1 (array of ints) : the second loop</span>
<span class="sd">        - segments (int = 1) : the number of segments to join the loops</span>
<span class="sd">        - attributes (dict) : attributes to add to the mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">segments</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">segments</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">close</span><span class="p">:</span>
            <span class="n">loop0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loop0</span><span class="p">,</span> <span class="n">loop0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">bint</span><span class="p">)</span>
            <span class="n">loop1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loop1</span><span class="p">,</span> <span class="n">loop1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">bint</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">loop0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">loop0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bint</span><span class="p">)</span>
            <span class="n">loop1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">loop1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bint</span><span class="p">)</span>

        <span class="n">sel0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">loop0</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">loop0</span><span class="p">[</span><span class="mi">1</span><span class="p">:]),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">sel1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">loop1</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">loop1</span><span class="p">[</span><span class="mi">1</span><span class="p">:]),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">sel0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">sel0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">sel1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">sel1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>

            <span class="n">edges</span><span class="p">,</span> <span class="n">verts_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bm_edges</span><span class="p">(</span><span class="n">bm</span><span class="p">)</span>

            <span class="c1"># Prepare edges view</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">([(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">bint</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">bint</span><span class="p">)])</span>
            <span class="n">edges_view</span> <span class="o">=</span> <span class="n">verts_indices</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>

            <span class="c1"># First loop</span>
            <span class="n">sel0_view</span> <span class="o">=</span> <span class="n">sel0</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">edges_view</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">sel0_view</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>

            <span class="n">edges_to_bridge</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>

            <span class="c1"># Second loop</span>
            <span class="n">sel1_view</span> <span class="o">=</span> <span class="n">sel1</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">edges_view</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">sel1_view</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>

            <span class="n">edges_to_bridge</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="n">mask</span><span class="p">]))</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">edges_to_bridge</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="c1"># Bridge</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">bridge_loops</span><span class="p">(</span>
                <span class="n">bm</span><span class="p">,</span> 
                <span class="n">edges</span><span class="o">=</span><span class="n">edges_to_bridge</span><span class="p">,</span>
                <span class="c1">#use_cyclic = close,</span>
                <span class="c1">#segments=segments,</span>
                <span class="p">)</span>

            <span class="c1"># Grid</span>
            <span class="k">if</span> <span class="n">segments</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">subdivide_edges</span><span class="p">(</span>
                    <span class="n">bm</span><span class="p">,</span>
                    <span class="n">edges</span><span class="o">=</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">],</span>
                    <span class="n">cuts</span><span class="o">=</span><span class="n">segments</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">use_grid_fill</span><span class="o">=</span><span class="kc">False</span>
                <span class="p">)</span>

    <span class="c1"># =============================================================================================================================</span>
    <span class="c1"># Fill cap</span>
    <span class="c1"># =============================================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fill_cap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;NGON&#39;</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">clockwise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Fill a cap between an existing loop</span>

<span class="sd">        For NGON mode, center is not required.</span>
<span class="sd">        For FANS mode, a center point is required:</span>
<span class="sd">        - if center is None, it is computed as the center of the loop</span>
<span class="sd">        - if center is an int, it is the index of the point to use</span>
<span class="sd">        - otherwise, the center is considered as the point to use</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        - loop (array of ints) : the circle loop</span>
<span class="sd">        - mode (FillCap = &#39;NGON&#39;) : NGON or FANS</span>
<span class="sd">        - center (point index or point or None) : center of the cap</span>
<span class="sd">        - clockwise (bool = False) : order of the corners in the loop</span>
<span class="sd">        - indexing (str = &#39;ij&#39;) : indexing of the points</span>
<span class="sd">        - attributes (dict) : attributes to add to the mesh (see Geometry.add_geometry(</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;NONE&#39;</span><span class="p">:</span>
            <span class="c1"># To have en empty dict</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;NGON&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">corners</span><span class="o">=</span><span class="n">loop</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span> <span class="n">UVMap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">disk_uv_map</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;NGON&#39;</span><span class="p">,</span> <span class="n">clockwise</span><span class="o">=</span><span class="n">clockwise</span><span class="p">),</span> <span class="o">**</span><span class="n">attributes</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;FANS&#39;</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">center</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">verts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">loop</span><span class="p">]</span>
                <span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">center_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
                <span class="n">cind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_points</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>

            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)):</span>
                <span class="n">center_index</span> <span class="o">=</span> <span class="n">center</span>
                <span class="n">cind</span> <span class="o">=</span> <span class="p">[</span><span class="n">center_index</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">center_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
                <span class="n">cind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_points</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>

            <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="n">center_index</span><span class="p">)</span>

            <span class="n">topo</span> <span class="o">=</span> <span class="n">fans_corners</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span> <span class="n">close</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">clockwise</span><span class="o">=</span><span class="n">clockwise</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

            <span class="n">corners</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">topo</span><span class="p">]</span>
            <span class="n">uv_map</span> <span class="o">=</span> <span class="n">disk_uv_map</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;FANS&#39;</span><span class="p">,</span> <span class="n">clockwise</span><span class="o">=</span><span class="n">clockwise</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

            <span class="n">added</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">corners</span><span class="o">=</span><span class="n">corners</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">UVMap</span><span class="o">=</span><span class="n">uv_map</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">)</span>
            <span class="n">added</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">cind</span><span class="p">)</span>

            <span class="c1"># More than one segments</span>

            <span class="k">if</span> <span class="n">segments</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">split_edges</span><span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="n">center_index</span><span class="p">,</span> <span class="n">cuts</span><span class="o">=</span><span class="n">segments</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">added</span>

        <span class="k">assert</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Deletion</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Delete faces</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Delete only faces.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">delete_loops</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Delete vertices</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete vertices.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            points : array selection, optional</span>
<span class="sd">                Vertex indices to delete directly.</span>
<span class="sd">            faces : array selection, optional</span>
<span class="sd">                Faces owning vertices to delete.</span>
<span class="sd">            edges : array selection, optional</span>
<span class="sd">                Edges owning vertices to delete.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">go</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">p_sel</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">))[</span><span class="n">points</span><span class="p">])</span>
            <span class="n">go</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">faces</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f_sel</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">))[</span><span class="n">faces</span><span class="p">])</span>
            <span class="n">go</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">e_sel</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">))[</span><span class="n">edges</span><span class="p">])</span>
            <span class="n">go</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">go</span><span class="p">:</span>
            <span class="k">return</span> 

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>
            <span class="n">verts_to_delete</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">vert</span> <span class="ow">in</span> <span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vert</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="n">p_sel</span><span class="p">:</span>
                    <span class="n">verts_to_delete</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vert</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">faces</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="n">f_sel</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">vert</span><span class="o">.</span><span class="n">link_faces</span><span class="p">):</span>
                        <span class="n">verts_to_delete</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vert</span><span class="p">)</span>
                        <span class="k">continue</span>

                <span class="k">if</span> <span class="n">edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="n">e_sel</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">vert</span><span class="o">.</span><span class="n">link_edges</span><span class="p">):</span>
                        <span class="n">verts_to_delete</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vert</span><span class="p">)</span>
                        <span class="k">continue</span>

            <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">bm</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">verts_to_delete</span><span class="p">),</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;VERTS&#39;</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================    </span>
    <span class="c1"># Blender primitives</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Grid</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bl_grid</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x_segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y_segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a Grid.</span>

<span class="sd">        Blender constructor for a Grid.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - x_segments (int=1) : number of segments along x axis</span>
<span class="sd">            - y_segments (int=1) : number of segments along y axis</span>
<span class="sd">            - size (float or tuple of floats = 1. : size of the grid</span>
<span class="sd">            - materials (list of strs = None) : materials list</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - Mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mesh</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">mesh</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>
            <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">create_grid</span><span class="p">(</span><span class="n">bm</span><span class="p">,</span> <span class="n">x_segments</span><span class="o">=</span><span class="n">x_segments</span><span class="p">,</span> <span class="n">y_segments</span><span class="o">=</span><span class="n">y_segments</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">calc_uvs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mesh</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Circle</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bl_circle</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fill_tris</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a Circle.</span>

<span class="sd">        Blender constructor for a Circle.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - radius (float=1.) : circle radius</span>
<span class="sd">            - segments (int=16) : number of segments</span>
<span class="sd">            - fill_tris (bool = False) : fill with triangle fans</span>
<span class="sd">            - materials (list of strs = None) : materials list</span>
<span class="sd">            - transformation (Transformations = None) : the transformation to apply</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - Mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mesh</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">mesh</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>
            <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">create_circle</span><span class="p">(</span><span class="n">bm</span><span class="p">,</span> <span class="n">cap_ends</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cap_tris</span><span class="o">=</span><span class="n">fill_tris</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="n">segments</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">calc_uvs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mesh</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Cone</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bl_cone</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">radius1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">radius2</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">side_segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cap_ends</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cap_tris</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a Cone.</span>

<span class="sd">        Blender constructor for a Cone.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - radius1 (float=1.) : base radius</span>
<span class="sd">            - radius2 (float=0.) : top radius</span>
<span class="sd">            - depth (float=2.) : cone height</span>
<span class="sd">            - segments (int=16) : number of segments</span>
<span class="sd">            - cap_ends (bool=True) : fill cap faces</span>
<span class="sd">            - cap_tris (bool = False) : fill with triangle fans</span>
<span class="sd">            - materials (list of strs = None) : materials list</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - Mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mesh</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">mesh</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">create_cone</span><span class="p">(</span><span class="n">bm</span><span class="p">,</span> <span class="n">cap_ends</span><span class="o">=</span><span class="n">cap_ends</span><span class="p">,</span> <span class="n">cap_tris</span><span class="o">=</span><span class="n">cap_tris</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="n">segments</span><span class="p">,</span> <span class="n">radius1</span><span class="o">=</span><span class="n">radius1</span><span class="p">,</span> <span class="n">radius2</span><span class="o">=</span><span class="n">radius2</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span> <span class="n">calc_uvs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">side_segments</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>

                <span class="n">edges_to_cut</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">bm</span><span class="o">.</span><span class="n">edges</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">co</span><span class="o">.</span><span class="n">z</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">co</span><span class="o">.</span><span class="n">z</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">co</span><span class="o">.</span><span class="n">z</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">co</span><span class="o">.</span><span class="n">z</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="p">]</span>

                <span class="c1"># Edges subidivision</span>
                <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">subdivide_edges</span><span class="p">(</span>
                    <span class="n">bm</span><span class="p">,</span>
                    <span class="n">edges</span>         <span class="o">=</span> <span class="n">edges_to_cut</span><span class="p">,</span>
                    <span class="n">cuts</span>          <span class="o">=</span> <span class="n">side_segments</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">use_grid_fill</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">mesh</span>

    <span class="c1"># ====================================================================================================    </span>
    <span class="c1"># Primitives</span>
    <span class="c1"># ====================================================================================================    </span>


    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Points</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">points_cloud</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a mesh with points at the given positions.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - position (shaped array (?, 3)=(0, 0, 0) : position of the points</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - mesh (Mesh) : the mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">points</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">)</span>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Line</span>
    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">line</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a mesh with lines between the given positions.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - start (vertex =(0, 0, 0) : position of the start of the lines</span>
<span class="sd">            - end (vertex=(0, 0, 1) : position of the end of the lines</span>
<span class="sd">            - count (int=2) : number of points in the line</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - mesh (Mesh) : the mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">segments</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">segments</span><span class="p">)</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bfloat</span><span class="p">)</span>
        <span class="n">end</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bfloat</span><span class="p">)</span>

        <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">segments</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># shape (segments, n points, 3)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">edges</span> <span class="o">=</span> <span class="n">border_edges</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">segments</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>
            <span class="n">edges</span> <span class="o">=</span> <span class="n">col_edges</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">pos</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">edges</span><span class="o">=</span><span class="n">edges</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Grid</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">grid</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">size_x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size_y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">vertices_x</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">vertices_y</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a Grid.</span>

<span class="sd">        &gt; [!IMPORTANT]</span>
<span class="sd">        &gt; Grid is created with indexing = &#39;ij&#39;: shape = (resolution x, resolution y)</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - size_x (float=1) : size along x</span>
<span class="sd">            _ size_y (float=1) : size along y</span>
<span class="sd">            - vertices_x (int=3) : number of vertices along x</span>
<span class="sd">            - vertices_y (int=3) : number of vertices along y</span>
<span class="sd">            - materials (list of strs = None) : materials list</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - Mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">vertices_x</span><span class="p">)</span>
        <span class="n">ny</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">vertices_y</span><span class="p">)</span>

        <span class="n">topo</span> <span class="o">=</span> <span class="n">grid_corners</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Base grid for points and uvs</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">size_x</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">size_x</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bfloat</span><span class="p">),</span> 
            <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">size_y</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">size_y</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bfloat</span><span class="p">),</span> 
            <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Let &#39;s build the grid</span>

        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">corners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">))[</span><span class="n">topo</span><span class="p">]</span>
        <span class="n">faces</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">uvmap</span> <span class="o">=</span> <span class="n">grid_uv_map</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">corners</span><span class="p">,</span> <span class="n">faces</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">,</span> <span class="n">UVMap</span><span class="o">=</span><span class="n">uvmap</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Cube</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cube</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a Cube.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - size (float=1.) : size of the cube</span>
<span class="sd">            - materials (list of strs = None) : materials list</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - Mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">verts</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span> <span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">],</span> <span class="p">[</span> <span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span> <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">],</span> <span class="p">[</span> <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">],]</span>
        <span class="n">corners</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
        <span class="n">faces</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="mi">6</span>
        <span class="n">uvs</span>   <span class="o">=</span> <span class="p">[[</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.000</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.000</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.250</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.250</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.250</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.250</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.500</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.500</span><span class="p">],</span>
                 <span class="p">[</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.500</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.500</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.750</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.750</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.750</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.750</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.625</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">],</span>
                 <span class="p">[</span><span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.500</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.500</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.750</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.750</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.500</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.875</span><span class="p">,</span> <span class="mf">0.500</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.875</span><span class="p">,</span> <span class="mf">0.750</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.750</span><span class="p">],</span> <span class="p">]</span>


        <span class="n">mesh</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">verts</span><span class="p">,</span> <span class="n">corners</span><span class="o">=</span><span class="n">corners</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="n">faces</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">,</span> <span class="n">UVMap</span><span class="o">=</span><span class="n">uvs</span><span class="p">)</span>

        <span class="n">size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span> <span class="o">*=</span> <span class="n">size</span><span class="o">/</span><span class="mi">2</span>

        <span class="k">return</span> <span class="n">mesh</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Circle</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">circle</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fill_segments</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cap</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a Circle.</span>

<span class="sd">        &#39;fill_segments&#39; argument gives the number of internal circles to create.</span>
<span class="sd">        If zero, the circle if filled with a polygon.</span>
<span class="sd">        If positive, the circle is filled with triangle fans.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - radius (float=1.) : circle radius</span>
<span class="sd">            - segments (int=16) : number of segments</span>
<span class="sd">            - fill_segments (int = 0) : number of internal segments, polygon is None</span>
<span class="sd">            - materials (list of strs = None) : materials list</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - Mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">segments</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ag</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ag</span><span class="p">)</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cap</span> <span class="o">==</span> <span class="s1">&#39;NONE&#39;</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span>
            <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">shift</span><span class="o">=-</span><span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">points</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="n">edges</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">cap</span> <span class="o">==</span> <span class="s1">&#39;NGON&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
                <span class="n">points</span>      <span class="o">=</span> <span class="n">points</span><span class="p">,</span> 
                <span class="n">corners</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">segments</span><span class="p">),</span> 
                <span class="n">faces</span>       <span class="o">=</span> <span class="n">segments</span><span class="p">,</span>
                <span class="n">UVMap</span>       <span class="o">=</span> <span class="n">disk_uv_map</span><span class="p">(</span><span class="n">segments</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;NGON&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="n">materials</span>   <span class="o">=</span> <span class="n">materials</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="n">cap</span> <span class="o">==</span> <span class="s1">&#39;FANS&#39;</span><span class="p">:</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">topo</span> <span class="o">=</span> <span class="n">fans_corners</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span>

            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
                <span class="n">points</span>      <span class="o">=</span> <span class="n">points</span><span class="p">,</span> 
                <span class="n">corners</span>     <span class="o">=</span> <span class="n">topo</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> 
                <span class="n">faces</span>       <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
                <span class="n">UVMap</span>       <span class="o">=</span> <span class="n">disk_uv_map</span><span class="p">(</span><span class="n">segments</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;FANS&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="n">materials</span>   <span class="o">=</span> <span class="n">materials</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1">#mesh = cls(points=points)</span>
        <span class="c1">#mesh.fill_cap(np.arange(segments), mode=cap, center=segments, clockwise=True)</span>

        <span class="k">assert</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Disk</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">disk</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fill_segments</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cap</span><span class="o">=</span><span class="s1">&#39;NGON&#39;</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a disk.</span>

<span class="sd">        Same as circle but default cap is NGON</span>
<span class="sd">        &quot;&quot;&quot;</span>    
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="n">segments</span><span class="p">,</span> <span class="n">fill_segments</span><span class="o">=</span><span class="n">fill_segments</span><span class="p">,</span> <span class="n">cap</span><span class="o">=</span><span class="n">cap</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Cone</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cone</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">vertices</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">side_segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">radius_top</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">radius_bottom</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fill_type</span><span class="o">=</span><span class="s1">&#39;NGON&#39;</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a Cone.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - vertices (int=16) : number of segments</span>
<span class="sd">            - side_segments (int = 1) : number of vertical segments</span>
<span class="sd">            - fill_segments (int = 1) : number of internal circles on the caps</span>
<span class="sd">            - radius_top (float=0) : top radius</span>
<span class="sd">            - radius_bottom (float=1) : bottom radius</span>
<span class="sd">            - depth (float=2.) : cylinder height</span>
<span class="sd">            - fill_type (str or couple of strs =&#39;NGON&#39; in &#39;NGON&#39;, &#39;FANS&#39;, &#39;NONE&#39;) : cap filling</span>
<span class="sd">            - materials (list of strs = None) : materials list</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - Mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Empty geometry if fhe two radius are null</span>
        <span class="k">if</span> <span class="n">radius_top</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">radius_bottom</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">()</span>

        <span class="n">mesh</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">bl_cone</span><span class="p">(</span>
            <span class="n">radius1</span>       <span class="o">=</span> <span class="n">radius_bottom</span><span class="p">,</span>
            <span class="n">radius2</span>       <span class="o">=</span> <span class="n">radius_top</span><span class="p">,</span>
            <span class="n">segments</span>      <span class="o">=</span> <span class="n">vertices</span><span class="p">,</span>
            <span class="n">side_segments</span> <span class="o">=</span> <span class="n">side_segments</span><span class="p">,</span>
            <span class="n">depth</span>         <span class="o">=</span> <span class="n">depth</span><span class="p">,</span>
            <span class="n">cap_ends</span>      <span class="o">=</span> <span class="n">fill_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;NGON&#39;</span><span class="p">,</span> <span class="s1">&#39;FANS&#39;</span><span class="p">],</span>
            <span class="n">cap_tris</span>      <span class="o">=</span> <span class="n">fill_type</span> <span class="o">==</span> <span class="s1">&#39;FANS&#39;</span><span class="p">,</span>
            <span class="n">materials</span>     <span class="o">=</span> <span class="n">materials</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">mesh</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Cylinder</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cylinder</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">vertices</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">side_segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fill_type</span><span class="o">=</span><span class="s1">&#39;NGON&#39;</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a Cylinder.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - vertices (int=16) : number of segments</span>
<span class="sd">            - side_segments (int = 1) : number of vertical segments</span>
<span class="sd">            - radius (float=1.) : radius</span>
<span class="sd">            - depth (float=2.) : cylinder height</span>
<span class="sd">            - fill_type (str or couple of strs =&#39;NGON&#39; in &#39;NGON&#39;, &#39;TRIANGLE_FAN&#39;, &#39;NONE&#39;) : cap filling</span>
<span class="sd">            - materials (list of strs = None) : materials list</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - Mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">bl_cone</span><span class="p">(</span>
            <span class="n">radius1</span>       <span class="o">=</span> <span class="n">radius</span><span class="p">,</span>
            <span class="n">radius2</span>       <span class="o">=</span> <span class="n">radius</span><span class="p">,</span>
            <span class="n">segments</span>      <span class="o">=</span> <span class="n">vertices</span><span class="p">,</span>
            <span class="n">side_segments</span> <span class="o">=</span> <span class="n">side_segments</span><span class="p">,</span>
            <span class="n">depth</span>         <span class="o">=</span> <span class="n">depth</span><span class="p">,</span>
            <span class="n">cap_ends</span>      <span class="o">=</span> <span class="n">fill_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;NGON&#39;</span><span class="p">,</span> <span class="s1">&#39;FANS&#39;</span><span class="p">],</span>
            <span class="n">cap_tris</span>      <span class="o">=</span> <span class="n">fill_type</span> <span class="o">==</span> <span class="s1">&#39;FANS&#39;</span><span class="p">,</span>
            <span class="n">materials</span>     <span class="o">=</span> <span class="n">materials</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">mesh</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Pyramid</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">pyramid</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a Pyramid.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - size (float=1.) : size</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - Mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cone</span><span class="p">(</span><span class="n">vertices</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">radius_bottom</span><span class="o">=</span><span class="n">size</span><span class="o">*</span><span class="mf">0.8660254037844386</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># UV Sphere</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">uvsphere</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">rings</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a uv sphere.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - segments (int=32) : number of segments</span>
<span class="sd">            - rings (int=16) : number of rings</span>
<span class="sd">            - radius (float=1.) : radius</span>
<span class="sd">            - materials (list of strs = None) : materials list</span>
<span class="sd">            - transformation (Transformations = None) : the transformation to apply</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - Mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">mesh</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>
            <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">create_uvsphere</span><span class="p">(</span><span class="n">bm</span><span class="p">,</span> <span class="n">u_segments</span><span class="o">=</span><span class="n">segments</span><span class="p">,</span> <span class="n">v_segments</span><span class="o">=</span><span class="n">rings</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">calc_uvs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mesh</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># IcoSphere</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">icosphere</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">subdivisions</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a IcoSphere.</span>

<span class="sd">        Blender constructor for a IcoSphere.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - radius (float=1.) : radius</span>
<span class="sd">            - subdivisions (int=2) : number subdivisions</span>
<span class="sd">            - materials (list of strs = None) : materials list</span>
<span class="sd">            - transformation (Transformations = None) : the transformation to apply</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - Mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">subdivisions</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">subdivisions</span><span class="p">)</span>

        <span class="n">mesh</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">mesh</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>
            <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">create_icosphere</span><span class="p">(</span><span class="n">bm</span><span class="p">,</span> <span class="n">subdivisions</span><span class="o">=</span><span class="n">subdivisions</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">calc_uvs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mesh</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Torus</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">torus</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">major_segments</span><span class="o">=</span><span class="mi">48</span><span class="p">,</span> <span class="n">minor_segments</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">major_radius</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">minor_radius</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a Torus.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - major_segments (int=48) : number of segments for the major radius</span>
<span class="sd">            - minor_segments (int=12) : number of segments for the minor radius</span>
<span class="sd">            - major_radius (float=1.) : major radius</span>
<span class="sd">            - minor_radius (float=.25) : minor radius</span>
<span class="sd">            - materials (list of strs = None) : materials list</span>
<span class="sd">            - transformation (Transformations = None) : the transformation to apply</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - Mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Major backbone</span>
        <span class="n">maj_ag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">major_segments</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bfloat</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="c1"># + pi to match blender uv</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">major_radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">maj_ag</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">major_radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">maj_ag</span><span class="p">)</span>
        <span class="n">zeros</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="n">transfos</span> <span class="o">=</span> <span class="n">Transformation</span><span class="o">.</span><span class="n">from_components</span><span class="p">(</span>
            <span class="n">translation</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">zeros</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> 
            <span class="n">rotation</span><span class="o">=</span><span class="n">Rotation</span><span class="o">.</span><span class="n">from_euler</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">zeros</span><span class="p">,</span> <span class="n">zeros</span><span class="p">,</span> <span class="n">maj_ag</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)),</span>
        <span class="p">)</span>

        <span class="c1"># Minor section</span>
        <span class="n">min_ag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">minor_segments</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bfloat</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="c1"># + pi to match blender uv</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">minor_radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">min_ag</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">minor_radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">min_ag</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="n">circle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Transform the circle</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">transfos</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">@</span> <span class="n">circle</span>

        <span class="c1"># Generate the faces</span>
        <span class="n">corners</span> <span class="o">=</span> <span class="n">grid_corners</span><span class="p">(</span><span class="n">major_segments</span><span class="p">,</span> <span class="n">minor_segments</span><span class="p">,</span> <span class="n">close_x</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">close_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Get the uv map</span>
        <span class="n">uvmap</span> <span class="o">=</span> <span class="n">grid_uv_map</span><span class="p">(</span><span class="n">major_segments</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">minor_segments</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">points</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">corners</span><span class="o">=</span><span class="n">corners</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">faces</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">UVMap</span><span class="o">=</span><span class="n">uvmap</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Monkey</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">monkey</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a Monkey.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - materials (list of strs = None) : materials list</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - MeshBuilder</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">mesh</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>
            <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">create_monkey</span><span class="p">(</span><span class="n">bm</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mesh</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Arrow</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">arrow</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">vector</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">radius</span><span class="o">=</span><span class="mf">.05</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mf">24.</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">adjust_norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="n">height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">adjust_norm</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span><span class="p">:</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">adjust_norm</span><span class="p">(</span><span class="n">height</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">adjust_norm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">height</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">adjust_norm</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>

        <span class="n">head_radius</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">radius</span>
        <span class="n">head_height</span> <span class="o">=</span> <span class="n">head_radius</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>

        <span class="n">cyl_height</span> <span class="o">=</span> <span class="n">height</span> <span class="o">-</span> <span class="n">head_height</span><span class="o">*</span><span class="mf">.8</span>

        <span class="c1">#cyl  = cls.cylinder(vertices=segments, side_segments=2, radius=radius, depth=cyl_height, transformation=Transformations(position=(0, 0, cyl_height/2)), materials=materials)</span>
        <span class="n">cyl</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cylinder</span><span class="p">(</span><span class="n">vertices</span><span class="o">=</span><span class="n">segments</span><span class="p">,</span> <span class="n">side_segments</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">cyl_height</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">)</span>
        <span class="n">cyl</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">z</span> <span class="o">+=</span> <span class="n">cyl_height</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">cyl</span><span class="o">.</span><span class="n">points</span><span class="p">[[</span><span class="n">segments</span> <span class="o">+</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">segments</span><span class="p">)]]</span><span class="o">.</span><span class="n">position</span> <span class="o">-=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cyl_height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">.01</span><span class="p">)</span>

        <span class="n">cone</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cone</span><span class="p">(</span><span class="n">vertices</span><span class="o">=</span><span class="n">segments</span><span class="p">,</span> <span class="n">side_segments</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fill_segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">radius_top</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">radius_bottom</span><span class="o">=</span><span class="n">head_radius</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">head_height</span><span class="p">,</span> <span class="n">fill_type</span><span class="o">=</span><span class="s1">&#39;FANS&#39;</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">)</span>
        <span class="n">cone</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">position</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">head_height</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">cone</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="n">head_height</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">arrow</span> <span class="o">=</span> <span class="n">cyl</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cone</span><span class="p">)</span>
        <span class="c1">#arrow.points.position = tracker(vector, track_axis=&#39;Z&#39;) @ arrow.points.position</span>
        <span class="n">arrow</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">Rotation</span><span class="o">.</span><span class="n">look_at</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">vector</span><span class="p">)</span> <span class="o">@</span> <span class="n">arrow</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span>

        <span class="k">return</span> <span class="n">arrow</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Field of vectors</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">vectors_field</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">locations</span><span class="p">,</span> <span class="n">vectors</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">.05</span><span class="p">,</span> <span class="n">scale_length</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mf">24.</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">head</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">adjust_norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create an arrow at each location corresponding to the vectors.</span>

<span class="sd">        The arrow length is equal to the corresponding vector lengths.</span>
<span class="sd">        The arrow radius is constant and equal to the value passe in argument for lengths greater that</span>
<span class="sd">        the argument scale_length. When the length is less than this value, the arrow is scaled down.</span>

<span class="sd">        Use the adjust_norm argument to transform the vector lengths to arrows lengths.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - locations (array of 3-vectors) : vectors locations</span>
<span class="sd">            - vectors (array of 3 vectors) : vectors to visualize</span>
<span class="sd">            - radius (float = .05) : arrow radius</span>
<span class="sd">            - angle (float = 24) : head radius in degrees</span>
<span class="sd">            - segments (int = 8) : number of segments for the section</span>
<span class="sd">            - head (mesh = None) : mesh model for the head. Create a cone if None</span>
<span class="sd">            - adjust_norm (max length or function = None) : max arrow length or function transforming</span>
<span class="sd">                the vector length into arrow length</span>
<span class="sd">            - scale_length (float = 1.) : arrow length below which the arrow radius is scaled</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - Mesh Object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">locations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span>
        <span class="n">vectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">vectors</span><span class="p">)</span>

        <span class="c1"># ---------------------------------------------------------------------------</span>
        <span class="c1"># Vector lengths</span>
        <span class="c1"># ---------------------------------------------------------------------------</span>

        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span>

        <span class="n">lengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vectors</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">is_null</span> <span class="o">=</span> <span class="n">lengths</span> <span class="o">&lt;</span> <span class="mf">.00001</span>
        <span class="n">lengths</span><span class="p">[</span><span class="n">is_null</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">v_dir</span> <span class="o">=</span> <span class="n">vectors</span> <span class="o">/</span> <span class="n">lengths</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">adjust_norm</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span><span class="p">:</span>
            <span class="n">lengths</span> <span class="o">=</span> <span class="n">adjust_norm</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">adjust_norm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">adjust_norm</span><span class="p">,</span> <span class="n">lengths</span><span class="p">)</span>
        <span class="n">lengths</span><span class="p">[</span><span class="n">is_null</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">vectors</span> <span class="o">=</span> <span class="n">v_dir</span><span class="o">*</span><span class="n">lengths</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>

        <span class="c1"># ---------------------------------------------------------------------------</span>
        <span class="c1"># Arrow head</span>
        <span class="c1"># ---------------------------------------------------------------------------</span>

        <span class="n">head_radius</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">radius</span>
        <span class="n">head_height</span> <span class="o">=</span> <span class="n">head_radius</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">head</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cone</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cone</span><span class="p">(</span>
                <span class="n">vertices</span> <span class="o">=</span> <span class="n">segments</span><span class="p">,</span> 
                <span class="n">side_segments</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
                <span class="n">fill_segments</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
                <span class="n">radius_top</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> 
                <span class="n">radius_bottom</span> <span class="o">=</span> <span class="n">head_radius</span><span class="p">,</span> 
                <span class="n">depth</span> <span class="o">=</span> <span class="n">head_height</span><span class="p">,</span> 
                <span class="n">fill_type</span> <span class="o">=</span> <span class="s1">&#39;FANS&#39;</span><span class="p">,</span> 
                <span class="n">materials</span> <span class="o">=</span> <span class="n">materials</span><span class="p">)</span>
            <span class="n">cone</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">z</span> <span class="o">+=</span> <span class="n">head_height</span><span class="o">/</span><span class="mi">10</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cone</span> <span class="o">=</span> <span class="n">head</span>
            <span class="n">head_height</span> <span class="o">=</span> <span class="n">cone</span><span class="o">.</span><span class="n">bounding_box_dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># Head top point is z=0</span>
        <span class="n">v0</span><span class="p">,</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">cone</span><span class="o">.</span><span class="n">bounding_box</span>
        <span class="n">cone</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">z</span> <span class="o">-=</span> <span class="n">v1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># ---------------------------------------------------------------------------</span>
        <span class="c1"># Small arrows: Vectors whose length &lt; min_length</span>
        <span class="c1"># ---------------------------------------------------------------------------</span>

        <span class="c1"># Minimum length</span>
        <span class="c1"># Below this length, the arrow is scaled</span>

        <span class="n">min_length</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">head_height</span>

        <span class="c1"># Small and long arrows if any</span>
        <span class="n">small_arrows</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">long_arrows</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>

        <span class="n">small</span> <span class="o">=</span> <span class="n">lengths</span> <span class="o">&lt;</span> <span class="n">min_length</span>
        <span class="n">nsmalls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">small</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">nsmalls</span><span class="p">:</span>
            <span class="c1"># shaft height = head height</span>
            <span class="n">cyl_height</span> <span class="o">=</span> <span class="n">min_length</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">.01</span>
            <span class="n">arrow</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cylinder</span><span class="p">(</span><span class="n">vertices</span><span class="o">=</span><span class="n">segments</span><span class="p">,</span> <span class="n">side_segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">cyl_height</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">)</span>
            <span class="n">arrow</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">z</span> <span class="o">+=</span> <span class="n">cyl_height</span><span class="o">/</span><span class="mi">2</span>

            <span class="c1"># Join the head</span>
            <span class="n">c</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_mesh</span><span class="p">(</span><span class="n">cone</span><span class="p">)</span>
            <span class="n">c</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">z</span> <span class="o">+=</span> <span class="n">min_length</span>

            <span class="n">arrow</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

            <span class="c1"># Duplicate the geometry            </span>
            <span class="n">small_arrows</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">*</span><span class="n">nsmalls</span>
            <span class="n">small_arrows</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nsmalls</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrow</span><span class="o">.</span><span class="n">points</span><span class="p">))</span>

            <span class="c1"># Rotate, scale and translate</span>
            <span class="n">lg</span> <span class="o">=</span> <span class="n">lengths</span><span class="p">[</span><span class="n">small</span><span class="p">]</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">lg</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">lg</span><span class="p">),</span> <span class="n">lg</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">small_arrows</span><span class="o">.</span><span class="n">transformation</span><span class="p">(</span>
                <span class="n">rotation</span> <span class="o">=</span> <span class="n">Rotation</span><span class="o">.</span><span class="n">look_at</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">vectors</span><span class="p">[</span><span class="n">small</span><span class="p">])[:,</span> <span class="kc">None</span><span class="p">],</span> 
                <span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span> 
                <span class="n">translation</span> <span class="o">=</span> <span class="n">locations</span><span class="p">[</span><span class="n">small</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="n">small_arrows</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>


        <span class="c1"># ---------------------------------------------------------------------------</span>
        <span class="c1"># Long arrows</span>
        <span class="c1"># ---------------------------------------------------------------------------</span>

        <span class="n">long</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">small</span><span class="p">)</span>
        <span class="n">nlongs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span> <span class="o">-</span> <span class="n">nsmalls</span>
        <span class="k">if</span> <span class="n">nlongs</span><span class="p">:</span>

            <span class="c1"># Shaft model with a normalized height = 1</span>
            <span class="n">shaft</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cylinder</span><span class="p">(</span><span class="n">vertices</span><span class="o">=</span><span class="n">segments</span><span class="p">,</span> <span class="n">side_segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">)</span>
            <span class="n">shaft</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">z</span> <span class="o">+=</span> <span class="mf">.5</span>

            <span class="c1"># We duplicate and transform the shafts with a scale long z</span>
            <span class="n">long_arrows</span> <span class="o">=</span> <span class="n">shaft</span><span class="o">*</span><span class="n">nlongs</span>
            <span class="n">long_arrows</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nlongs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">shaft</span><span class="o">.</span><span class="n">points</span><span class="p">))</span>

            <span class="n">lg</span> <span class="o">=</span> <span class="n">lengths</span><span class="p">[</span><span class="n">long</span><span class="p">]</span> <span class="o">-</span> <span class="n">head_height</span> <span class="o">+</span> <span class="mf">.01</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">lg</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">lg</span><span class="p">),</span> <span class="n">lg</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">long_arrows</span><span class="o">.</span><span class="n">transformation</span><span class="p">(</span>
                <span class="n">rotation</span> <span class="o">=</span> <span class="n">Rotation</span><span class="o">.</span><span class="n">look_at</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">vectors</span><span class="p">[</span><span class="n">long</span><span class="p">])[:,</span> <span class="kc">None</span><span class="p">],</span> 
                <span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span> 
                <span class="n">translation</span> <span class="o">=</span> <span class="n">locations</span><span class="p">[</span><span class="n">long</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="n">long_arrows</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># We duplicate and tranform the heads with no scale</span>
            <span class="n">heads</span> <span class="o">=</span> <span class="n">cone</span><span class="o">*</span><span class="n">nlongs</span>
            <span class="n">heads</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nlongs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cone</span><span class="o">.</span><span class="n">points</span><span class="p">))</span>
            <span class="n">heads</span><span class="o">.</span><span class="n">transformation</span><span class="p">(</span>
                <span class="n">rotation</span> <span class="o">=</span> <span class="n">Rotation</span><span class="o">.</span><span class="n">look_at</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">vectors</span><span class="p">[</span><span class="n">long</span><span class="p">])[:,</span> <span class="kc">None</span><span class="p">],</span> 
                <span class="n">translation</span> <span class="o">=</span> <span class="n">locations</span><span class="p">[</span><span class="n">long</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">+</span> <span class="n">vectors</span><span class="p">[</span><span class="n">long</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="n">heads</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">long_arrows</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">heads</span><span class="p">)</span>

        <span class="c1"># Let&#39;s join the result</span>
        <span class="n">arrows</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">arrows</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">small_arrows</span><span class="p">,</span> <span class="n">long_arrows</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">arrows</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Chain Link</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">chain_link</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">major_segments</span><span class="o">=</span><span class="mi">48</span><span class="p">,</span> <span class="n">minor_segments</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">section</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a chain link.</span>

<span class="sd">        ``` python</span>
<span class="sd">        # ----- Some maths</span>

<span class="sd">        # Chain follows a catenary curve</span>
<span class="sd">        def catenary(t):</span>
<span class="sd">            return np.stack((t, np.zeros_like(t), np.cosh(t)), axis=-1)</span>

<span class="sd">        # Orientation is given by the derivative</span>
<span class="sd">        def derivative(t):</span>
<span class="sd">            dt = 1/10000</span>
<span class="sd">            return (catenary(t + dt) - catenary(t - dt))/(2*dt)</span>

<span class="sd">        # Catenary length</span>
<span class="sd">        pts = catenary(np.linspace(-1, 1, 1000))</span>
<span class="sd">        cat_s = np.cumsum(np.linalg.norm(pts[1:] - pts[:-1], axis=-1))</span>
<span class="sd">        cat_len = cat_s[-1]</span>

<span class="sd">        # Catenary inverse : t from length</span>
<span class="sd">        def cat_inverse(l):</span>
<span class="sd">            return 2*np.argmin(np.abs(cat_s - l))/1000 - 1</span>

<span class="sd">        # ----- Let&#39;s build the geometry</span>

<span class="sd">        # One chain link</span>
<span class="sd">        section = .02</span>
<span class="sd">        length  = .15</span>
<span class="sd">        link = MeshBuilder.ChainLink(radius=.04, section=section, length=length)</span>

<span class="sd">        # Link length taking into account the section</span>
<span class="sd">        l = length - 2*section</span>

<span class="sd">        # Number of links</span>
<span class="sd">        count = round(cat_len / l)</span>

<span class="sd">        # The chain</span>
<span class="sd">        chain = link*count</span>

<span class="sd">        # Rotate pi/2 one on two</span>
<span class="sd">        eulers = Eulers(shape=count)</span>
<span class="sd">        eulers[[i % 2 == 1 for i in range(count)]] = (0, np.pi/2, 0)</span>

<span class="sd">        chain.rotate(eulers)</span>
<span class="sd">        chain.rotate_z(np.pi/2)</span>

<span class="sd">        # Location of each link</span>
<span class="sd">        t = np.array([cat_inverse(l*i) for i in range(count)])</span>

<span class="sd">        chain.toward(derivative(t), track_axis=&#39;X&#39;, up_axis=&#39;Z&#39;)</span>
<span class="sd">        chain.translate(catenary(t))</span>

<span class="sd">        # To object</span>
<span class="sd">        chain.to_object(&quot;Catenary&quot;)</span>
<span class="sd">        ```</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - major_segments (int=48) : number of segments for the link</span>
<span class="sd">            - minor_segments (int=12) : number of segments for the section</span>
<span class="sd">            - radius (float=1.) : radius of the link</span>
<span class="sd">            - section (float=.5) : section (diameter)</span>
<span class="sd">            - length (float=4.) : total length of the link</span>
<span class="sd">            - materials (list of strs = None) : materials list</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - MeshBuilder</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">delta</span> <span class="o">=</span> <span class="n">length</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">radius</span>

        <span class="c1"># Starting from a torus</span>
        <span class="n">clink</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">torus</span><span class="p">(</span>
            <span class="n">major_radius</span>    <span class="o">=</span> <span class="n">radius</span><span class="p">,</span> 
            <span class="n">minor_radius</span>    <span class="o">=</span> <span class="n">section</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> 
            <span class="n">major_segments</span>  <span class="o">=</span> <span class="n">major_segments</span><span class="p">,</span> 
            <span class="n">minor_segments</span>  <span class="o">=</span> <span class="n">minor_segments</span><span class="p">,</span> 
            <span class="n">materials</span>       <span class="o">=</span> <span class="n">materials</span>
        <span class="p">)</span>
        <span class="c1"># Nothing else</span>
        <span class="k">if</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="n">radius</span><span class="o">/</span><span class="mi">10</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">clink</span>

        <span class="n">epsilon</span> <span class="o">=</span> <span class="n">radius</span><span class="o">/</span><span class="n">major_segments</span>

        <span class="c1"># Delete half of the points</span>
        <span class="n">clink</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">clink</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">epsilon</span><span class="p">)</span>
        <span class="n">npoints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clink</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
        <span class="n">borders</span> <span class="o">=</span> <span class="n">clink</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">epsilon</span>
        <span class="n">loop0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npoints</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">borders</span><span class="p">,</span> <span class="n">clink</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)]</span>
        <span class="n">loop1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npoints</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">borders</span><span class="p">,</span> <span class="n">clink</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span>
        <span class="n">clink</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">delta</span><span class="o">/</span><span class="mi">2</span>

        <span class="c1"># Duplicate and inverse</span>
        <span class="n">half</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_mesh</span><span class="p">(</span><span class="n">clink</span><span class="p">)</span>
        <span class="n">half</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c1"># Join</span>
        <span class="n">clink</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">half</span><span class="p">)</span>

        <span class="c1"># Bridge</span>
        <span class="n">clink</span><span class="o">.</span><span class="n">bridge_loops</span><span class="p">(</span><span class="n">loop0</span><span class="p">,</span> <span class="n">loop1</span> <span class="o">+</span> <span class="n">npoints</span><span class="p">,</span> <span class="n">close</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">clink</span><span class="o">.</span><span class="n">bridge_loops</span><span class="p">(</span><span class="n">loop1</span><span class="p">,</span> <span class="n">loop0</span> <span class="o">+</span> <span class="n">npoints</span><span class="p">,</span> <span class="n">close</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># UVMap</span>
        <span class="n">nu</span><span class="p">,</span> <span class="n">nv</span> <span class="o">=</span> <span class="n">major_segments</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="n">minor_segments</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">uvmap</span> <span class="o">=</span> <span class="n">grid_uv_map</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">nv</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nu</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nv</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">ratio</span> <span class="o">=</span> <span class="p">(</span><span class="n">length</span> <span class="o">-</span> <span class="n">radius</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">length</span> <span class="o">-</span> <span class="n">radius</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">radius</span><span class="p">)</span>
        <span class="n">dx_side</span> <span class="o">=</span> <span class="n">ratio</span><span class="o">/</span><span class="mi">2</span>

        <span class="n">uvmap</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ratio</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">/</span><span class="n">nu</span><span class="p">)</span>
        <span class="n">uvmap</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,:,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">ratio</span>
        <span class="n">uvmap</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,:,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">ratio</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">uvmap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">ratio</span><span class="o">/</span><span class="mi">2</span>

        <span class="n">clink</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">UVMap</span> <span class="o">=</span> <span class="n">uvmap</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">clink</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Extrusion</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Extrude vertices</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extrude_vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Extrude individual vertices</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - selection (selector) : points selection, all if None</span>
<span class="sd">            - offset (vector or array of vectors) : extrusion vector</span>
<span class="sd">            - attributes (dict) : points attributes</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - dictionnary of the created geometry : vertex indices, face indices</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">selection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">inds</span> <span class="o">=</span> <span class="n">inds</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span>

        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset</span>
        <span class="n">new_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="n">edges_between</span><span class="p">(</span><span class="n">inds</span><span class="p">,</span> <span class="n">new_inds</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="n">edges</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="o">**</span><span class="n">attributes</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Extrude a loop of points</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extrude_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">close</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clockwise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Extrude a loop of vertices.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - loop (array of ints) : vertex indices</span>
<span class="sd">            - offset (float = 1) : multiplicator of the direction vector</span>
<span class="sd">            - direction (vector = None) : extrusion direction, normal if None</span>
<span class="sd">            - clockwise (bool=False) : faces orientation</span>
<span class="sd">            - attributes : attribute for the new geometry</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - dictionnary of the created geometry : vertex indices, face indices</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">loop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">verts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">loop</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new_verts</span> <span class="o">=</span> <span class="n">verts</span> <span class="o">+</span> <span class="n">offset</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Extrude&gt; Offset argument must be a single vector or an array of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span><span class="si">}</span><span class="s2"> vectors, not </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>

        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_verts</span><span class="p">)))</span>
        <span class="n">gc</span> <span class="o">=</span> <span class="n">grid_corners</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">verts</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">row_first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">close_x</span><span class="o">=</span><span class="n">close</span><span class="p">,</span> <span class="n">clockwise</span><span class="o">=</span><span class="n">clockwise</span><span class="p">)</span>
        <span class="n">corners</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">gc</span><span class="o">.</span><span class="n">ravel</span><span class="p">()]</span>
        <span class="n">uvmap</span> <span class="o">=</span> <span class="n">grid_uv_map</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">verts</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">close_x</span><span class="o">=</span><span class="n">close</span><span class="p">,</span> <span class="n">clockwise</span><span class="o">=</span><span class="n">clockwise</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">new_verts</span><span class="p">,</span> <span class="n">corners</span><span class="o">=</span><span class="n">corners</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">UVMap</span><span class="o">=</span><span class="n">uvmap</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Extrude individual faces</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extrude_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Extrude individual faces.</span>

<span class="sd">        If offset is None, faces are extruder along their normal</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - selection : indices of the faces to extrude</span>
<span class="sd">            - offset (vector or array of vectors) : the extrusion vector</span>
<span class="sd">            - scale (float = 1) : scale factor for offsets</span>
<span class="sd">            - dissolve (bool = True) : remove starting faces</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - dictionnary : &#39;top&#39; : extruded faces, &#39;side&#39; : extruded side faces</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Selected faces indices</span>
        <span class="n">faces_sel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">selection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">faces_sel</span> <span class="o">=</span> <span class="n">faces_sel</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span>

        <span class="c1"># bmesh edition</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>
            <span class="c1">#bm.verts.ensure_lookup_table()</span>
            <span class="n">bm</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">ensure_lookup_table</span><span class="p">()</span>

            <span class="c1"># select faces</span>
            <span class="n">start_faces</span> <span class="o">=</span> <span class="p">[</span><span class="n">bm</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">faces_sel</span><span class="p">]</span>

            <span class="n">res</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;top&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;side&#39;</span><span class="p">:</span> <span class="p">[]}</span>

            <span class="c1"># bmesh.ops</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">extrude_discrete_faces</span><span class="p">(</span><span class="n">bm</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="n">start_faces</span><span class="p">)</span>
            <span class="n">new_faces</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;faces&quot;</span><span class="p">]</span>



            <span class="c1"># One direction per face</span>
            <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_shapes</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">offset</span><span class="p">),</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_faces</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>
                <span class="n">offsets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span>

            <span class="c1"># Loop on created faces</span>
            <span class="k">for</span> <span class="n">i_face</span><span class="p">,</span> <span class="n">face</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_faces</span><span class="p">):</span>
                <span class="n">verts</span> <span class="o">=</span> <span class="n">face</span><span class="o">.</span><span class="n">verts</span>
                <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ofs</span> <span class="o">=</span> <span class="n">face</span><span class="o">.</span><span class="n">normal</span><span class="o">*</span><span class="n">scale</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ofs</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="n">i_face</span><span class="p">]</span>

                <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">bm</span><span class="p">,</span> <span class="n">verts</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">verts</span><span class="p">),</span> <span class="n">vec</span><span class="o">=</span><span class="n">ofs</span><span class="p">)</span>

                <span class="n">res</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">face</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">face</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
                    <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">link_faces</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">link_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">face</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                        <span class="n">res</span><span class="p">[</span><span class="s1">&#39;side&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">link_faces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">res</span><span class="p">[</span><span class="s1">&#39;side&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">link_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">res</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Extrude region</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extrude_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dissolve</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Extrude individual faces.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - selection : indices of the faces to extrude</span>
<span class="sd">            - offset (vector = (0, 0, 1)) : the extrusion vector</span>
<span class="sd">            - dissolve (bool = True) : remove starting faces</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - dictionnary : &#39;top&#39; : extruded faces, &#39;side&#39; : extruded side faces</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Selected faces indices</span>
        <span class="n">faces_sel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">selection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">faces_sel</span> <span class="o">=</span> <span class="n">faces_sel</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span>

        <span class="c1"># bmesh edition</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>
            <span class="c1">#bm.verts.ensure_lookup_table()</span>
            <span class="n">bm</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">ensure_lookup_table</span><span class="p">()</span>

            <span class="c1"># select faces</span>
            <span class="n">start_faces</span> <span class="o">=</span> <span class="p">[</span><span class="n">bm</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">faces_sel</span><span class="p">]</span>

            <span class="n">res</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;top&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;side&#39;</span><span class="p">:</span> <span class="p">[]}</span>


            <span class="c1"># Extrusion</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">extrude_face_region</span><span class="p">(</span>
                <span class="n">bm</span><span class="p">,</span> 
                <span class="n">geom</span>                      <span class="o">=</span> <span class="n">start_faces</span><span class="p">,</span>
                <span class="c1">#edges_exclude            = set(),</span>
                <span class="c1">#use_keep_orig            = False,</span>
                <span class="c1">#use_normal_flip          = False,</span>
                <span class="c1">#use_normal_from_adjacent = False,</span>
                <span class="c1">#use_dissolve_ortho_edges = False,</span>
                <span class="c1">#use_select_history       = False,</span>
                <span class="p">)</span>

            <span class="c1"># Move new vectors</span>
            <span class="n">extruded_geom</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;geom&quot;</span><span class="p">]</span>
            <span class="n">new_verts</span> <span class="o">=</span> <span class="p">[</span><span class="n">ele</span> <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">extruded_geom</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ele</span><span class="p">,</span> <span class="n">bmesh</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">BMVert</span><span class="p">)]</span>
            <span class="n">new_faces</span> <span class="o">=</span> <span class="p">[</span><span class="n">ele</span> <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">extruded_geom</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ele</span><span class="p">,</span> <span class="n">bmesh</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">BMFace</span><span class="p">)]</span>

            <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">bm</span><span class="p">,</span> <span class="n">verts</span><span class="o">=</span><span class="n">new_verts</span><span class="p">,</span> <span class="n">vec</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">offset</span><span class="p">))</span>

            <span class="c1"># ===== Result</span>
            <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">new_faces</span><span class="p">:</span>
                <span class="n">res</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">face</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">face</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
                    <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">link_faces</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">link_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">face</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                        <span class="n">res</span><span class="p">[</span><span class="s1">&#39;side&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">link_faces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">res</span><span class="p">[</span><span class="s1">&#39;side&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">link_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

            <span class="c1"># ===== Dissolve extruded faces</span>
            <span class="k">if</span> <span class="n">dissolve</span><span class="p">:</span>
                <span class="n">bm</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">ensure_lookup_table</span><span class="p">()</span>
                <span class="n">del_faces</span> <span class="o">=</span> <span class="p">[</span><span class="n">bm</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">faces_sel</span><span class="p">]</span>

                <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">bm</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="n">del_faces</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;FACES&#39;</span><span class="p">)</span>                   

        <span class="k">return</span> <span class="n">res</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># inset faces</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">inset_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">use_even_offset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_relative_offset</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Extrude individual faces.</span>

<span class="sd">        If offset is None, faces are extruder along their normal</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        selection : selection on faces</span>
<span class="sd">            indices of the faces to inset</span>
<span class="sd">        thickness : float</span>
<span class="sd">            Inset thickness.</span>
<span class="sd">        depth : float</span>
<span class="sd">            Inset depth (extrusion).</span>
<span class="sd">        use_even_offset : bool</span>
<span class="sd">            Keep consistent thickness.</span>
<span class="sd">        use_relative_offset : bool</span>
<span class="sd">            Offset relative to face size.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict with:</span>
<span class="sd">            &#39;faces&#39; : list of new inset faces</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Selected faces indices</span>
        <span class="n">faces_sel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">selection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">faces_sel</span> <span class="o">=</span> <span class="n">faces_sel</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span>

        <span class="c1"># bmesh edition</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>
            <span class="n">bm</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">ensure_lookup_table</span><span class="p">()</span>

            <span class="c1"># select faces</span>
            <span class="n">start_faces</span> <span class="o">=</span> <span class="p">[</span><span class="n">bm</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">faces_sel</span><span class="p">]</span>

            <span class="n">res</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;top&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;side&#39;</span><span class="p">:</span> <span class="p">[]}</span>

            <span class="c1"># bmesh.ops</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">inset_individual</span><span class="p">(</span>
                <span class="n">bm</span><span class="p">,</span>
                <span class="n">faces</span>               <span class="o">=</span> <span class="n">start_faces</span><span class="p">,</span>
                <span class="n">thickness</span>           <span class="o">=</span> <span class="n">thickness</span><span class="p">,</span>
                <span class="n">depth</span>               <span class="o">=</span> <span class="n">depth</span><span class="p">,</span>
                <span class="n">use_even_offset</span>     <span class="o">=</span> <span class="n">use_even_offset</span><span class="p">,</span>
                <span class="n">use_relative_offset</span> <span class="o">=</span> <span class="n">use_relative_offset</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">res</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;top&#39;</span><span class="p">:</span> <span class="n">faces_sel</span><span class="p">,</span>
                <span class="s1">&#39;side&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">face</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;faces&quot;</span><span class="p">]]</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="n">res</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Solidify socle</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">solidify_socle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bottom_material_index</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; The mesh is supposed to be a grid.</span>

<span class="sd">        The socle is buit by extruding the external edges to the value z.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        - shape (tuple of ints) : the grid shade</span>
<span class="sd">        - z (float) : socle base z</span>
<span class="sd">        - bottom_material_index (int = 0) : base face material index</span>
<span class="sd">        - attributes (dict) : attributes to faces</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        - bottom face index (int) : the index of bottom face</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">n</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>

        <span class="n">loop1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">inds</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">loop1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loop1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]))</span>
        <span class="n">loop1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loop1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">0</span><span class="p">]))</span>

        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">loop1</span><span class="p">])</span>
        <span class="n">points</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span>

        <span class="n">loop0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_points</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">corners</span><span class="o">=</span><span class="n">loop0</span><span class="p">)</span> <span class="c1">#, faces=len(loop0))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bridge_loops</span><span class="p">(</span><span class="n">loop0</span><span class="p">,</span> <span class="n">loop1</span><span class="p">,</span> <span class="n">close</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">_ensure_optional_field</span><span class="p">(</span><span class="s2">&quot;material_index&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;faces&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">material_index</span> <span class="o">=</span> <span class="n">bottom_material_index</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Boolean</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">boolean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;DIFFERENCE&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply a boolean operation with another object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : Mesh</span>
<span class="sd">            The object to use as boolean operand.</span>
<span class="sd">        operation : str</span>
<span class="sd">            Boolean operation: &#39;INTERSECT&#39;, &#39;UNION&#39;, or &#39;DIFFERENCE&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="n">other</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">other_obj</span><span class="p">:</span>

            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">as</span> <span class="n">obj</span><span class="p">:</span>
                <span class="n">mod</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Boolean&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;BOOLEAN&#39;</span><span class="p">)</span>
                <span class="n">mod</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">other_obj</span>
                <span class="n">mod</span><span class="o">.</span><span class="n">operation</span> <span class="o">=</span> <span class="n">operation</span>

                <span class="c1"># Apply modifier</span>
                <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifier_apply</span><span class="p">(</span><span class="n">modifier</span><span class="o">=</span><span class="n">mod</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

                <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mesh</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Solidify</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">solidify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mf">.01</span><span class="p">,</span> <span class="n">offset</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Boolean difference with another MeshBuilder.</span>

<span class="sd">        The methods uses the Solidify Modifier</span>

<span class="sd">        ``` python</span>
<span class="sd">        glass = Mesh.Circle(segments=128)</span>
<span class="sd">        glass.extrude_faces(0, -.01)</span>
<span class="sd">        glass.extrude_faces(0, -2)</span>
<span class="sd">        glass.extrude_faces(0, -.01)</span>

<span class="sd">        glass.points.translate((0, 0, 2))</span>

<span class="sd">        glass = glass.solidify(thickness=.1)</span>

<span class="sd">        glass.to_object(&quot;Solidify&quot;, shade_smooth=True)</span>
<span class="sd">        ```</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - thickness (float=.01) : thickness</span>
<span class="sd">            - offset (float=-1) : offset</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - MeshBuilder : the result of the solidify operation</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">()</span> <span class="k">as</span> <span class="n">obj</span><span class="p">:</span>
            <span class="n">mod</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;Solidify&quot;</span><span class="p">,</span> <span class="s1">&#39;SOLIDIFY&#39;</span><span class="p">)</span>

            <span class="n">mod</span><span class="o">.</span><span class="n">thickness</span>       <span class="o">=</span> <span class="n">thickness</span>
            <span class="n">mod</span><span class="o">.</span><span class="n">use_even_offset</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">mod</span><span class="o">.</span><span class="n">offset</span>          <span class="o">=</span> <span class="n">offset</span>

            <span class="c1"># Apply modifier</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifier_apply</span><span class="p">(</span><span class="n">modifier</span><span class="o">=</span><span class="n">mod</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mesh</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Remove doubles</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_doubles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mf">.001</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Remove doubles.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            - dist (float=0.001) : maximum distance between vertices to merge.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>
            <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">remove_doubles</span><span class="p">(</span><span class="n">bm</span><span class="p">,</span> <span class="n">verts</span><span class="o">=</span><span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Triangulate</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">triangulate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="n">faces_sel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">selection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">faces_sel</span> <span class="o">=</span> <span class="n">faces_sel</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">faces_sel</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">copy</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">copy</span><span class="o">.</span><span class="n">bmesh</span><span class="p">(</span><span class="n">readonly</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>
            <span class="n">bm</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">ensure_lookup_table</span><span class="p">()</span>
            <span class="n">faces</span> <span class="o">=</span> <span class="p">[</span><span class="n">bm</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">faces_sel</span><span class="p">]</span>

            <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">triangulate</span><span class="p">(</span><span class="n">bm</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="n">faces</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">copy</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Simplify</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">simplified</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mf">.001</span><span class="p">):</span>

        <span class="n">copy</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">copy</span><span class="o">.</span><span class="n">remove_doubles</span><span class="p">(</span><span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="o">/</span><span class="n">scale</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">points</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cubic_envelop</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">copy</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Faces to islands</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">separate_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Split faces into isolated islands</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        - groups (list of ints):</span>
<span class="sd">            group ids of faces</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">materials</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">)</span>
        <span class="n">attr_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">actual_names</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;loop_total&#39;</span><span class="p">,</span> <span class="s1">&#39;loop_start&#39;</span><span class="p">]]</span>

        <span class="c1"># ---------------------------------------------------------------------------</span>
        <span class="c1"># No group: each face becomes an island</span>
        <span class="c1"># ---------------------------------------------------------------------------</span>

        <span class="k">if</span> <span class="n">groups</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">attr_names</span><span class="p">}</span>
            <span class="k">return</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">attr_from</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">join_geometry</span><span class="p">(</span>
                <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">],</span>
                <span class="n">corners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">)),</span>
                <span class="n">faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">loop_total</span><span class="p">,</span>
                <span class="o">**</span><span class="n">attrs</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># ---------------------------------------------------------------------------</span>
        <span class="c1"># Faces are grouped with groupds IDs</span>
        <span class="c1"># ---------------------------------------------------------------------------</span>

        <span class="n">groups</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">groups</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">),)</span>   <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The &#39;groups&#39; argument must be a index per face with a length of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="n">ugroups</span><span class="p">,</span> <span class="n">rev_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">ugroups</span><span class="p">:</span>
            <span class="n">faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="n">ugroups</span><span class="p">[</span><span class="n">rev_index</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">]</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">faces</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">attr_names</span><span class="p">}</span>

            <span class="n">corners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">[</span><span class="n">faces</span><span class="o">.</span><span class="n">get_corner_indices</span><span class="p">()]</span>
            <span class="n">uniques</span><span class="p">,</span> <span class="n">new_corners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">corners</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Mesh</span><span class="p">(</span><span class="n">attr_from</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">join_geometry</span><span class="p">(</span>
                <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">uniques</span><span class="p">],</span>
                <span class="n">corners</span> <span class="o">=</span> <span class="n">new_corners</span><span class="p">,</span>
                <span class="n">faces</span> <span class="o">=</span> <span class="n">faces</span><span class="o">.</span><span class="n">loop_total</span><span class="p">,</span>
                <span class="o">**</span><span class="n">attrs</span><span class="p">,</span>
            <span class="p">))</span>

        <span class="k">return</span> <span class="n">mesh</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Dual mesh</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">dual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">):</span>

        <span class="n">verts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">corners</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">faces</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>

            <span class="n">bm</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">ensure_lookup_table</span><span class="p">()</span>
            <span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="o">.</span><span class="n">ensure_lookup_table</span><span class="p">()</span>    
            <span class="n">bm</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">ensure_lookup_table</span><span class="p">()</span>    

            <span class="c1"># ---------------------------------------------------------------------------</span>
            <span class="c1"># Faces become points</span>
            <span class="c1"># ---------------------------------------------------------------------------</span>

            <span class="k">if</span> <span class="n">center</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;median&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">bm</span><span class="o">.</span><span class="n">faces</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">calc_center_median</span><span class="p">()</span>
                    <span class="n">verts</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">center</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;bounds&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">bm</span><span class="o">.</span><span class="n">faces</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">calc_center_bounds</span><span class="p">()</span>
                    <span class="n">verts</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">center</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;weighted&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">bm</span><span class="o">.</span><span class="n">faces</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">calc_center_median_weighted</span><span class="p">()</span>
                    <span class="n">verts</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Center must be in (&#39;median&#39;, &#39;bounds&#39;,&#39;weighted&#39;).&quot;</span><span class="p">)</span>

            <span class="c1"># ---------------------------------------------------------------------------</span>
            <span class="c1"># Vertices becom faces</span>
            <span class="c1"># ---------------------------------------------------------------------------</span>

            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="p">:</span>
                <span class="c1"># Faces need to be ordered (link_faces is not good)</span>
                <span class="c1"># Get the edges as couples (face.index, face.index)</span>
                <span class="c1"># then chain the edges</span>

                <span class="n">couples</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">first</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">link_edges</span><span class="p">:</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">edge</span><span class="o">.</span><span class="n">link_faces</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">couples</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">break</span>

                    <span class="c1"># First is used for the order between:</span>
                    <span class="c1"># - face0 then face1</span>
                    <span class="c1"># - face1 then face0</span>
                    <span class="k">if</span> <span class="n">first</span><span class="p">:</span>
                        <span class="n">first</span> <span class="o">=</span> <span class="kc">False</span>

                        <span class="c1"># The edge links two vertices</span>
                        <span class="n">other_index</span> <span class="o">=</span> <span class="n">edge</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span> <span class="k">if</span> <span class="n">edge</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">v</span><span class="o">.</span><span class="n">index</span> <span class="k">else</span> <span class="n">edge</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>

                        <span class="c1"># We select as first face the one where loop is v -&gt; other                </span>
                        <span class="n">face0</span> <span class="o">=</span> <span class="n">edge</span><span class="o">.</span><span class="n">link_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">i_loop</span><span class="p">,</span> <span class="n">lp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">face0</span><span class="o">.</span><span class="n">loops</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">lp</span><span class="o">.</span><span class="n">vert</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">other_index</span><span class="p">:</span>
                                <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_loop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">face0</span><span class="o">.</span><span class="n">loops</span><span class="p">)</span>
                                <span class="n">take0</span> <span class="o">=</span> <span class="n">face0</span><span class="o">.</span><span class="n">loops</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">vert</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">v</span><span class="o">.</span><span class="n">index</span>
                                <span class="k">break</span>

                        <span class="k">if</span> <span class="n">take0</span><span class="p">:</span>
                            <span class="n">loop</span> <span class="o">=</span> <span class="p">[</span><span class="n">edge</span><span class="o">.</span><span class="n">link_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">edge</span><span class="o">.</span><span class="n">link_faces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">loop</span> <span class="o">=</span> <span class="p">[</span><span class="n">edge</span><span class="o">.</span><span class="n">link_faces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">edge</span><span class="o">.</span><span class="n">link_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">couples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">edge</span><span class="o">.</span><span class="n">link_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">edge</span><span class="o">.</span><span class="n">link_faces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">couples</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># Build the other faces by chaing the edges </span>
                <span class="c1"># First loop to consume the edge couples      </span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">couples</span><span class="p">)):</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="c1"># Second loop to find the following edge</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">couples</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">loop</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="n">loop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">elif</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">loop</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="n">loop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="k">break</span>

                    <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
                        <span class="k">del</span> <span class="n">couples</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">loop</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">break</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="n">faces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loop</span><span class="p">))</span>
                <span class="n">corners</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span>

        <span class="c1"># We can build the dual mesh</span>
        <span class="k">return</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">verts</span><span class="p">,</span> <span class="n">corners</span><span class="o">=</span><span class="n">corners</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="n">faces</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Faces neighbors</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">faces_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">neighbors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>           
            <span class="n">bm</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">ensure_lookup_table</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">bm</span><span class="o">.</span><span class="n">faces</span><span class="p">:</span>
                <span class="n">ns</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">face</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
                    <span class="n">ns</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">union</span><span class="p">([</span><span class="n">edge</span><span class="o">.</span><span class="n">link_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">edge</span><span class="o">.</span><span class="n">link_faces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
                <span class="n">ns</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">face</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="n">neighbors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">ns</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">neighbors</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Get islands</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_islands</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Get an island id per face.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">deque</span>

        <span class="n">nfaces</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">nfaces</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">islands</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">nfaces</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">cur_island</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="n">passed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nfaces</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>
            <span class="n">bm</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">ensure_lookup_table</span><span class="p">()</span>
            <span class="n">bm</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">ensure_lookup_table</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">bm</span><span class="o">.</span><span class="n">faces</span><span class="p">:</span>
                <span class="c1"># Already visited</span>
                <span class="k">if</span> <span class="n">islands</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># New island index</span>
                <span class="n">cur_island</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">q</span> <span class="o">=</span> <span class="n">deque</span><span class="p">([</span><span class="n">f</span><span class="p">])</span>
                <span class="k">while</span> <span class="n">q</span><span class="p">:</span>
                    <span class="n">cur</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>

                    <span class="c1"># Part of the current island</span>
                    <span class="n">islands</span><span class="p">[</span><span class="n">cur</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">cur_island</span>

                    <span class="c1"># No infinite loop</span>
                    <span class="n">passed</span><span class="p">[</span><span class="n">cur</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="c1"># Loop on the edges</span>
                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">cur</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>                                               
                        <span class="c1"># Loop on the edge faces</span>
                        <span class="k">for</span> <span class="n">nb</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">link_faces</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">passed</span><span class="p">[</span><span class="n">nb</span><span class="o">.</span><span class="n">index</span><span class="p">]:</span>
                                <span class="k">continue</span>
                            <span class="n">passed</span><span class="p">[</span><span class="n">nb</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                            <span class="k">if</span> <span class="n">islands</span><span class="p">[</span><span class="n">nb</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">q</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nb</span><span class="p">)</span>


        <span class="k">return</span> <span class="n">islands</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># BVHTree</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">bvh_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">BVHTree</span><span class="o">.</span><span class="n">FromPolygons</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">sequences</span><span class="p">(),</span> <span class="n">all_triangles</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">pos</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span>
            <span class="n">pos</span>    <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

            <span class="n">nfaces</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span><span class="o">//</span><span class="n">count</span>
            <span class="n">inds</span>   <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">)</span>
            <span class="n">faces</span>  <span class="o">=</span> <span class="p">[</span><span class="n">inds</span><span class="p">[</span><span class="n">lstart</span><span class="p">:</span><span class="n">lstart</span><span class="o">+</span><span class="n">ltotal</span><span class="p">]</span> <span class="k">for</span> <span class="p">(</span><span class="n">lstart</span><span class="p">,</span> <span class="n">ltotal</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">loop_start</span><span class="p">[:</span><span class="n">nfaces</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">loop_total</span><span class="p">[:</span><span class="n">nfaces</span><span class="p">])]</span>

            <span class="k">return</span> <span class="p">[</span><span class="n">BVHTree</span><span class="o">.</span><span class="n">FromPolygons</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">faces</span><span class="p">,</span> <span class="n">all_triangles</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">)]</span>


    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Tests</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Test the primitives</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_all_primitives</span><span class="p">():</span>

        <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">toobj</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">materials</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Material&quot;</span><span class="p">]</span>   
            <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">mesh</span><span class="o">.</span><span class="n">to_object</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">shade_smooth</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">x</span>

        <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># ----- Points</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">points</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">toobj</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

        <span class="c1"># ----- Lines</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">line</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Mesh</span><span class="o">.</span><span class="n">line</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">segments</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Mesh</span><span class="o">.</span><span class="n">line</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">segments</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">toobj</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

        <span class="c1"># ----- Grid</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span><span class="o">.</span><span class="n">translate</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Mesh</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">toobj</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;grid&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

        <span class="c1"># ----- Cicle</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">circle</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Mesh</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">cap</span><span class="o">=</span><span class="s1">&#39;NGON&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">translate</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">cap</span><span class="o">=</span><span class="s1">&#39;FANS&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">translate</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>      
        <span class="n">x</span> <span class="o">=</span> <span class="n">toobj</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;circle&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

        <span class="c1"># ----- Cone</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">cone</span><span class="p">(</span><span class="n">fill_type</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">Mesh</span><span class="o">.</span><span class="n">cone</span><span class="p">(</span><span class="n">side_segments</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">translate</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
            <span class="n">Mesh</span><span class="o">.</span><span class="n">cone</span><span class="p">(</span><span class="n">fill_type</span><span class="o">=</span><span class="s1">&#39;NGON&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">translate</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)),</span>
            <span class="n">Mesh</span><span class="o">.</span><span class="n">cone</span><span class="p">(</span><span class="n">fill_type</span><span class="o">=</span><span class="s1">&#39;FANS&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">translate</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)),</span>
        <span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">toobj</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;cone&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

        <span class="c1"># ----- Cylinder</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">cylinder</span><span class="p">(</span><span class="n">fill_type</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">Mesh</span><span class="o">.</span><span class="n">cylinder</span><span class="p">(</span><span class="n">side_segments</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">translate</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
            <span class="n">Mesh</span><span class="o">.</span><span class="n">cylinder</span><span class="p">(</span><span class="n">fill_type</span><span class="o">=</span><span class="s1">&#39;NGON&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">translate</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)),</span>
            <span class="n">Mesh</span><span class="o">.</span><span class="n">cylinder</span><span class="p">(</span><span class="n">fill_type</span><span class="o">=</span><span class="s1">&#39;FANS&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">translate</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)),</span>
        <span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">toobj</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;cylinder&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

        <span class="c1"># ----- Arrow</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">Mesh</span><span class="o">.</span><span class="n">arrow</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
            <span class="n">Mesh</span><span class="o">.</span><span class="n">arrow</span><span class="p">((</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
            <span class="n">Mesh</span><span class="o">.</span><span class="n">arrow</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
            <span class="n">Mesh</span><span class="o">.</span><span class="n">arrow</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
            <span class="n">Mesh</span><span class="o">.</span><span class="n">arrow</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)),</span>
            <span class="n">Mesh</span><span class="o">.</span><span class="n">arrow</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">+</span><span class="mi">1</span><span class="p">)),</span>
        <span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">toobj</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;arrow&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

        <span class="c1"># ----- Vectors field</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">ori</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">vectors_field</span><span class="p">(</span>
            <span class="n">pos</span><span class="p">,</span>
            <span class="n">ori</span><span class="p">,</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="mf">.02</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">toobj</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;vectors_field&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

        <span class="c1"># ----- Simple</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;cube&quot;</span><span class="p">,</span> <span class="s2">&quot;pyramid&quot;</span><span class="p">,</span> <span class="s2">&quot;uvsphere&quot;</span><span class="p">,</span> <span class="s2">&quot;icosphere&quot;</span><span class="p">,</span> <span class="s2">&quot;torus&quot;</span><span class="p">,</span> <span class="s2">&quot;chain_link&quot;</span><span class="p">,</span> <span class="s2">&quot;monkey&quot;</span><span class="p">]:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">Mesh</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="n">f</span><span class="p">()</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">toobj</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Test edition</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_test_edition</span><span class="p">():</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># extrude vertices</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">icosphere</span><span class="p">()</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">.5</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">extrude_vertices</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">sel</span><span class="p">])</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">to_object</span><span class="p">(</span><span class="s2">&quot;extrude_vertices&quot;</span><span class="p">,</span> <span class="n">shade_smooth</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># extrude loop of vertices</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">materials</span><span class="o">=</span><span class="s2">&quot;Material&quot;</span><span class="p">)</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">extrude_loop</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="p">)),</span> <span class="n">offset</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">close</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="mi">2</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">to_object</span><span class="p">(</span><span class="s2">&quot;extrude_loop&quot;</span><span class="p">,</span> <span class="n">shade_smooth</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># extrude individualfaces</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">icosphere</span><span class="p">()</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">.5</span>
        <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">))[</span><span class="n">sel</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">extrude_faces</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">.3</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">inset_faces</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">])</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">extrude_faces</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">],</span> <span class="n">scale</span><span class="o">=-</span><span class="mf">.1</span><span class="p">)</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="mi">4</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">to_object</span><span class="p">(</span><span class="s2">&quot;extrude_faces&quot;</span><span class="p">,</span> <span class="n">shade_smooth</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># extrude region</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="p">[</span><span class="mi">23</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">45</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">extrude_region</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dissolve</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">extrude_region</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">],</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">.5</span><span class="p">),</span> <span class="n">dissolve</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="mi">7</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">to_object</span><span class="p">(</span><span class="s2">&quot;extrude_region&quot;</span><span class="p">,</span> <span class="n">shade_smooth</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># solidify socle</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.6</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">.5</span> <span class="o">+</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">.05</span><span class="p">,</span> <span class="mf">.05</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="p">))</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="mi">10</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">solidify_socle</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">to_object</span><span class="p">(</span><span class="s2">&quot;solidify_socle&quot;</span><span class="p">,</span> <span class="n">shade_smooth</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># boolean</span>
        <span class="n">cube</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">cube</span><span class="p">()</span>
        <span class="n">cyl</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">cylinder</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">depth</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">cube</span><span class="o">.</span><span class="n">boolean</span><span class="p">(</span><span class="n">cyl</span><span class="p">)</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="mi">13</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">to_object</span><span class="p">(</span><span class="s2">&quot;boolean difference&quot;</span><span class="p">,</span> <span class="n">shade_smooth</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># solidify</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span><span class="o">.</span><span class="n">solidify</span><span class="p">(</span><span class="n">thickness</span><span class="o">=</span><span class="mf">.2</span><span class="p">)</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="mi">16</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">to_object</span><span class="p">(</span><span class="s2">&quot;solidify&quot;</span><span class="p">,</span> <span class="n">shade_smooth</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># triangulate</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">cube</span><span class="p">()</span><span class="o">.</span><span class="n">triangulate</span><span class="p">()</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="mi">19</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">to_object</span><span class="p">(</span><span class="s2">&quot;triangulate&quot;</span><span class="p">,</span> <span class="n">shade_smooth</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>



















    <span class="c1"># =============================================================================================================================</span>
    <span class="c1"># To curve</span>
    <span class="c1"># =============================================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_curve_REVIEW</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; &gt; Convert mesh to curve</span>

<span class="sd">        Simple conversion when edges domain is defined</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">npblender</span><span class="w"> </span><span class="kn">import</span> <span class="n">Curve</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">splines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
            <span class="n">v0</span><span class="p">,</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">edge</span><span class="o">.</span><span class="n">vertex0</span><span class="p">,</span> <span class="n">edge</span><span class="o">.</span><span class="n">vertex1</span>

            <span class="n">ok</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">spline</span> <span class="ow">in</span> <span class="n">splines</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">spline</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">spline</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">v0</span> <span class="o">==</span> <span class="n">spline</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">spline</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span>
                    <span class="n">ok</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">v0</span> <span class="o">==</span> <span class="n">spline</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">spline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
                    <span class="n">ok</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">elif</span> <span class="n">v1</span> <span class="o">==</span> <span class="n">spline</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">spline</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">v0</span><span class="p">)</span>
                    <span class="n">ok</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">v1</span> <span class="o">==</span> <span class="n">spline</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">spline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v0</span><span class="p">)</span>
                    <span class="n">ok</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
                <span class="n">splines</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">v0</span><span class="p">,</span> <span class="n">v1</span><span class="p">])</span>

        <span class="n">curve</span> <span class="o">=</span> <span class="n">Curve</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">spline</span> <span class="ow">in</span> <span class="n">splines</span><span class="p">:</span>
            <span class="n">cyclic</span> <span class="o">=</span> <span class="n">spline</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">spline</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">cyclic</span><span class="p">:</span>
                <span class="n">spline</span> <span class="o">=</span> <span class="n">spline</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">curve</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">spline</span><span class="p">],</span> <span class="n">curve_type</span><span class="o">=</span><span class="s1">&#39;POLY&#39;</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="n">cyclic</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">curve</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">corners</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attr_from</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span></code>

<a href="#npblender.Mesh.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Mesh Geometry.</p>
<h5 id="npblender.Mesh.__init__--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.__init__--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="k">-</span> points (array of vectors = None) : the vertices
<span class="k">-</span> corners (array of ints = None) : corners, i.e. indices on the array of points
<span class="k">-</span> faces (array of ints = None) : size of the faces, the sum of this array must be equal to the length of the corners array
<span class="k">-</span> edges (array of couples of ints = None) : list of edges defined by two vertex indices
<span class="k">-</span> materials (str or list of strs = None) : list of materials used in the geometry
<span class="k">-</span> attr_from (Geometry) : domain attributes to copy from
<span class="k">-</span> **attrs (dict) : other geometry attributes
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">corners</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attr_from</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Mesh Geometry.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - points (array of vectors = None) : the vertices</span>
<span class="sd">        - corners (array of ints = None) : corners, i.e. indices on the array of points</span>
<span class="sd">        - faces (array of ints = None) : size of the faces, the sum of this array must be equal to the length of the corners array</span>
<span class="sd">        - edges (array of couples of ints = None) : list of edges defined by two vertex indices</span>
<span class="sd">        - materials (str or list of strs = None) : list of materials used in the geometry</span>
<span class="sd">        - attr_from (Geometry) : domain attributes to copy from</span>
<span class="sd">        - **attrs (dict) : other geometry attributes</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># ----- Initialize an empty geometry</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">points</span>  <span class="o">=</span> <span class="n">Vertex</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">corners</span> <span class="o">=</span> <span class="n">Corner</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">faces</span>   <span class="o">=</span> <span class="n">Face</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">edges</span>   <span class="o">=</span> <span class="n">Edge</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">join_attributes</span><span class="p">(</span><span class="n">attr_from</span><span class="p">)</span>

    <span class="c1"># ----- The materials</span>

    <span class="k">if</span> <span class="n">materials</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materials</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">materials</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materials</span> <span class="o">=</span> <span class="p">[</span><span class="n">materials</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materials</span> <span class="o">=</span> <span class="p">[</span><span class="n">mat</span> <span class="k">for</span> <span class="n">mat</span> <span class="ow">in</span> <span class="n">materials</span><span class="p">]</span>

    <span class="c1"># ----- Add geometry</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">corners</span><span class="p">,</span> <span class="n">faces</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.add_geometry" class="doc doc-heading">
            <code class=" language-python"><span class="n">add_geometry</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">corners</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">safe_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span></code>

<a href="#npblender.Mesh.add_geometry" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Add geometry</p>
<p>Note that the added geometry can refer to existing vertices. It is appended as is, whithout shifting
indices.</p>
<p>To add independant geometry, use join_geometry.</p>
<div class="codehilite"><pre><span></span><code><span class="n">cube</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">cube</span><span class="p">()</span>
<span class="c1"># add a triangle on existing vertices</span>
<span class="c1"># corners argument refers to cube vertices</span>
<span class="n">cube</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">corners</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">faces</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># add a triangle with additional vertices</span>
<span class="c1"># corners argument refers to the new vertices</span>
<span class="n">cube</span><span class="o">.</span><span class="n">join_geometry</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="n">corners</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">faces</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>

<h5 id="npblender.Mesh.add_geometry--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.add_geometry--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="k">-</span> points (array of vectors = None) : the vertices
<span class="k">-</span> corners (array of ints = None) : corners, i.e. indices on the array of points
<span class="k">-</span> sizes (array of ints = None) : size of the faces, the sum of this array must be equal to the length of the corners array
<span class="k">-</span> materials (str or list of strs = None) : list of materials used in the geometry
<span class="k">-</span> **attrs (dict) : other geometry attributes
</code></pre></div>

<h5 id="npblender.Mesh.add_geometry--returns">Returns<a class="headerlink" href="#npblender.Mesh.add_geometry--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- dict : {&#39;points&#39;, &#39;corners&#39;, &#39;faces&#39;, &#39;edges&#39;: added geometry indices}
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">corners</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">safe_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Add geometry</span>

<span class="sd">    Note that the added geometry can refer to existing vertices. It is appended as is, whithout shifting</span>
<span class="sd">    indices.</span>

<span class="sd">    To add independant geometry, use join_geometry.</span>

<span class="sd">    ``` python</span>
<span class="sd">    cube = Mesh.cube()</span>
<span class="sd">    # add a triangle on existing vertices</span>
<span class="sd">    # corners argument refers to cube vertices</span>
<span class="sd">    cube.add_geometry(corners=[0, 1, 2], faces=3)</span>

<span class="sd">    # add a triangle with additional vertices</span>
<span class="sd">    # corners argument refers to the new vertices</span>
<span class="sd">    cube.join_geometry(points=[[0, 0, 0], [0, 1, 0], [1, 0, 0]], corners=[0, 1, 2], faces=3)</span>
<span class="sd">    ```</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - points (array of vectors = None) : the vertices</span>
<span class="sd">        - corners (array of ints = None) : corners, i.e. indices on the array of points</span>
<span class="sd">        - sizes (array of ints = None) : size of the faces, the sum of this array must be equal to the length of the corners array</span>
<span class="sd">        - materials (str or list of strs = None) : list of materials used in the geometry</span>
<span class="sd">        - **attrs (dict) : other geometry attributes</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - dict : {&#39;points&#39;, &#39;corners&#39;, &#39;faces&#39;, &#39;edges&#39;: added geometry indices}</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">disp_attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes_per_domain</span><span class="p">(</span><span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
    <span class="n">added</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;points&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;corners&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;faces&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;edges&#39;</span><span class="p">:</span> <span class="p">[]}</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Add vertices</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">added</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">points</span><span class="p">,</span> <span class="o">**</span><span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">])</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Edges</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">if</span> <span class="n">edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span><span class="p">,):</span>
            <span class="n">added</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vertex0</span><span class="o">=</span><span class="n">edges</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vertex1</span><span class="o">=</span><span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">added</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vertex0</span><span class="o">=</span><span class="n">edges</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">vertex1</span><span class="o">=</span><span class="n">edges</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">])</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Corners and Faces</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="c1"># If corners is provided, faces can be:</span>
    <span class="c1"># - None -&gt; single face made of all corners</span>
    <span class="c1"># - int -&gt; faces are all the same size (len(corners) must be a multiplief of faces)</span>
    <span class="c1"># - array like -&gt; face sizes (len(corners) == np.sum(faces))</span>
    <span class="c1">#</span>
    <span class="c1"># If faces is provided, corners can be:</span>
    <span class="c1"># - None -&gt; faces must be an array of arrays, each array being of list of corners</span>
    <span class="c1"># - not None -&gt; see above</span>

    <span class="n">ok_faces</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">corners</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">faces</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ok_faces</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">corners</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">sizes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">ok</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">faces</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">faces</span><span class="p">:</span>
                    <span class="n">ok</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">faces</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">face</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">corners</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
                    <span class="n">sizes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">face</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mesh add_geometry&gt; when corners is None, faces must be None or an array of arrays, each array being of list of corners.&quot;</span><span class="p">)</span>
            <span class="n">faces</span> <span class="o">=</span> <span class="n">sizes</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">corners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span>
        <span class="n">ncorners</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">faces</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">faces</span> <span class="o">=</span> <span class="p">[</span><span class="n">ncorners</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">faces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">faces</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">faces</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">():</span>
                <span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">faces</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ncorners</span> <span class="o">%</span> <span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mesh add_geometry&gt; when faces is a single number </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">, it must divide the number of corners (</span><span class="si">{</span><span class="n">ncorners</span><span class="si">}</span><span class="s2">).&quot;</span><span class="p">)</span>
                <span class="n">faces</span> <span class="o">=</span> <span class="p">[</span><span class="n">size</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">ncorners</span> <span class="o">//</span> <span class="n">size</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">faces</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ncorners</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mesh add_geometry&gt; the sum of faces (</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">faces</span><span class="p">)</span><span class="si">}</span><span class="s2">) must be equal to the number of corners (</span><span class="si">{</span><span class="n">ncorners</span><span class="si">}</span><span class="s2">).&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ok_faces</span><span class="p">:</span>
        <span class="n">added</span><span class="p">[</span><span class="s1">&#39;corners&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vertex_index</span><span class="o">=</span><span class="n">corners</span><span class="p">,</span> <span class="o">**</span><span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;corners&#39;</span><span class="p">])</span>
        <span class="n">added</span><span class="p">[</span><span class="s1">&#39;faces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">append_sizes</span><span class="p">(</span><span class="n">faces</span><span class="p">,</span> <span class="o">**</span><span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;faces&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="kc">False</span><span class="p">:</span> <span class="c1"># OLD</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">faces</span><span class="p">)</span> <span class="o">==</span> <span class="p">():</span>
            <span class="n">nfaces</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span> <span class="o">//</span> <span class="n">faces</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span> <span class="o">%</span> <span class="n">faces</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mesh add_geometry&gt; when faces is a single number </span><span class="si">{</span><span class="n">faces</span><span class="si">}</span><span class="s2">, it must divide the number of corners (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span><span class="si">}</span><span class="s2">).&quot;</span><span class="p">)</span>
            <span class="n">faces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nfaces</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bint</span><span class="p">)</span><span class="o">*</span><span class="n">faces</span>

        <span class="n">added</span><span class="p">[</span><span class="s1">&#39;corners&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vertex_index</span><span class="o">=</span><span class="n">corners</span><span class="p">,</span> <span class="o">**</span><span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;corners&#39;</span><span class="p">])</span>
        <span class="n">added</span><span class="p">[</span><span class="s1">&#39;faces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">append_sizes</span><span class="p">(</span><span class="n">faces</span><span class="p">,</span> <span class="o">**</span><span class="n">disp_attrs</span><span class="p">[</span><span class="s1">&#39;faces&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">safe_mode</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">added</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.add_points" class="doc doc-heading">
            <code class=" language-python"><span class="n">add_points</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">)</span></code>

<a href="#npblender.Mesh.add_points" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Add vertices.</p>
<h5 id="npblender.Mesh.add_points--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.add_points--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="nv">points</span><span class="w"> </span><span class="ss">(</span><span class="nv">array</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">vectors</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">vertices</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">add</span>
<span class="o">-</span><span class="w"> </span><span class="nv">attributes</span><span class="w"> </span><span class="ss">(</span><span class="nv">name</span><span class="o">=</span><span class="nv">value</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">named</span><span class="w"> </span><span class="nv">attributes</span>
</code></pre></div>

<h5 id="npblender.Mesh.add_points--returns">Returns<a class="headerlink" href="#npblender.Mesh.add_points--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- array of ints : indices of the added vertices
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span>
<span class="normal">988</span>
<span class="normal">989</span>
<span class="normal">990</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span>  <span class="o">**</span><span class="n">attributes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Add vertices.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - points (array of vectors) : the vertices to add</span>
<span class="sd">        - attributes (name=value) : value for named attributes</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - array of ints : indices of the added vertices</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">npoints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">points</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.bl_circle" class="doc doc-heading">
            <code class=" language-python"><span class="n">bl_circle</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fill_tris</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#npblender.Mesh.bl_circle" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a Circle.</p>
<p>Blender constructor for a Circle.</p>
<h5 id="npblender.Mesh.bl_circle--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.bl_circle--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="k">-</span> radius (float=1.) : circle radius
<span class="k">-</span> segments (int=16) : number of segments
<span class="k">-</span> fill_tris (bool = False) : fill with triangle fans
<span class="k">-</span> materials (list of strs = None) : materials list
<span class="k">-</span> transformation (Transformations = None) : the transformation to apply
</code></pre></div>

<h5 id="npblender.Mesh.bl_circle--returns">Returns<a class="headerlink" href="#npblender.Mesh.bl_circle--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- Mesh
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">bl_circle</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fill_tris</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create a Circle.</span>

<span class="sd">    Blender constructor for a Circle.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - radius (float=1.) : circle radius</span>
<span class="sd">        - segments (int=16) : number of segments</span>
<span class="sd">        - fill_tris (bool = False) : fill with triangle fans</span>
<span class="sd">        - materials (list of strs = None) : materials list</span>
<span class="sd">        - transformation (Transformations = None) : the transformation to apply</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - Mesh</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mesh</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">mesh</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>
        <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">create_circle</span><span class="p">(</span><span class="n">bm</span><span class="p">,</span> <span class="n">cap_ends</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cap_tris</span><span class="o">=</span><span class="n">fill_tris</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="n">segments</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">calc_uvs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mesh</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.bl_cone" class="doc doc-heading">
            <code class=" language-python"><span class="n">bl_cone</span><span class="p">(</span><span class="n">radius1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">radius2</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">side_segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cap_ends</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cap_tris</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#npblender.Mesh.bl_cone" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a Cone.</p>
<p>Blender constructor for a Cone.</p>
<h5 id="npblender.Mesh.bl_cone--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.bl_cone--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="k">-</span> radius1 (float=1.) : base radius
<span class="k">-</span> radius2 (float=0.) : top radius
<span class="k">-</span> depth (float=2.) : cone height
<span class="k">-</span> segments (int=16) : number of segments
<span class="k">-</span> cap_ends (bool=True) : fill cap faces
<span class="k">-</span> cap_tris (bool = False) : fill with triangle fans
<span class="k">-</span> materials (list of strs = None) : materials list
</code></pre></div>

<h5 id="npblender.Mesh.bl_cone--returns">Returns<a class="headerlink" href="#npblender.Mesh.bl_cone--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- Mesh
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">bl_cone</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">radius1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">radius2</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">side_segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cap_ends</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cap_tris</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create a Cone.</span>

<span class="sd">    Blender constructor for a Cone.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - radius1 (float=1.) : base radius</span>
<span class="sd">        - radius2 (float=0.) : top radius</span>
<span class="sd">        - depth (float=2.) : cone height</span>
<span class="sd">        - segments (int=16) : number of segments</span>
<span class="sd">        - cap_ends (bool=True) : fill cap faces</span>
<span class="sd">        - cap_tris (bool = False) : fill with triangle fans</span>
<span class="sd">        - materials (list of strs = None) : materials list</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - Mesh</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mesh</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">mesh</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">create_cone</span><span class="p">(</span><span class="n">bm</span><span class="p">,</span> <span class="n">cap_ends</span><span class="o">=</span><span class="n">cap_ends</span><span class="p">,</span> <span class="n">cap_tris</span><span class="o">=</span><span class="n">cap_tris</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="n">segments</span><span class="p">,</span> <span class="n">radius1</span><span class="o">=</span><span class="n">radius1</span><span class="p">,</span> <span class="n">radius2</span><span class="o">=</span><span class="n">radius2</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span> <span class="n">calc_uvs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">side_segments</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>

            <span class="n">edges_to_cut</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">bm</span><span class="o">.</span><span class="n">edges</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">co</span><span class="o">.</span><span class="n">z</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">co</span><span class="o">.</span><span class="n">z</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="ow">or</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">co</span><span class="o">.</span><span class="n">z</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">verts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">co</span><span class="o">.</span><span class="n">z</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">]</span>

            <span class="c1"># Edges subidivision</span>
            <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">subdivide_edges</span><span class="p">(</span>
                <span class="n">bm</span><span class="p">,</span>
                <span class="n">edges</span>         <span class="o">=</span> <span class="n">edges_to_cut</span><span class="p">,</span>
                <span class="n">cuts</span>          <span class="o">=</span> <span class="n">side_segments</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">use_grid_fill</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">mesh</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.bl_grid" class="doc doc-heading">
            <code class=" language-python"><span class="n">bl_grid</span><span class="p">(</span><span class="n">x_segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y_segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#npblender.Mesh.bl_grid" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a Grid.</p>
<p>Blender constructor for a Grid.</p>
<h5 id="npblender.Mesh.bl_grid--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.bl_grid--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="k">-</span> x_segments (int=1) : number of segments along x axis
<span class="k">-</span> y_segments (int=1) : number of segments along y axis
<span class="k">-</span> size (float or tuple of floats = 1. : size of the grid
<span class="k">-</span> materials (list of strs = None) : materials list
</code></pre></div>

<h5 id="npblender.Mesh.bl_grid--returns">Returns<a class="headerlink" href="#npblender.Mesh.bl_grid--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- Mesh
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">bl_grid</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x_segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y_segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create a Grid.</span>

<span class="sd">    Blender constructor for a Grid.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - x_segments (int=1) : number of segments along x axis</span>
<span class="sd">        - y_segments (int=1) : number of segments along y axis</span>
<span class="sd">        - size (float or tuple of floats = 1. : size of the grid</span>
<span class="sd">        - materials (list of strs = None) : materials list</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - Mesh</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mesh</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">mesh</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>
        <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">create_grid</span><span class="p">(</span><span class="n">bm</span><span class="p">,</span> <span class="n">x_segments</span><span class="o">=</span><span class="n">x_segments</span><span class="p">,</span> <span class="n">y_segments</span><span class="o">=</span><span class="n">y_segments</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">calc_uvs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mesh</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.blender_data" class="doc doc-heading">
            <code class=" language-python"><span class="n">blender_data</span><span class="p">(</span><span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#npblender.Mesh.blender_data" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Acces to Blender Mesh API.</p>
<p>Transfer the geometry to a temporay Blender Mesh.
The example below use a blender Mesh to get the normals.</p>
<div class="codehilite"><pre><span></span><code><span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">Cube</span><span class="p">()</span>

<span class="k">with</span> <span class="n">mesh</span><span class="o">.</span><span class="n">blender_data</span><span class="p">()</span> <span class="k">as</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">normals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">poly</span><span class="o">.</span><span class="n">normal</span> <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">polygons</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">normals</span><span class="p">)</span>

<span class="c1"># &gt; [[-1. -0.  0.]</span>
<span class="c1">#    [ 0.  1.  0.]</span>
<span class="c1">#    [ 1. -0.  0.]</span>
<span class="c1">#    [ 0. -1.  0.]</span>
<span class="c1">#    [ 0.  0. -1.]</span>
<span class="c1">#    [ 0. -0.  1.]]</span>
</code></pre></div>

<h5 id="npblender.Mesh.blender_data--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.blender_data--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="nv">readonly</span><span class="w"> </span><span class="ss">(</span><span class="nv">bool</span><span class="o">=</span><span class="nv">False</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">don</span><span class="err">&#39;t read back the geometry if not modified</span>
</code></pre></div>

<h5 id="npblender.Mesh.blender_data--returns">Returns<a class="headerlink" href="#npblender.Mesh.blender_data--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- Blender Mesh
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@contextmanager</span>
<span class="k">def</span><span class="w"> </span><span class="nf">blender_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Acces to Blender Mesh API.</span>

<span class="sd">    Transfer the geometry to a temporay Blender Mesh.</span>
<span class="sd">    The example below use a blender Mesh to get the normals.</span>

<span class="sd">    ``` python</span>
<span class="sd">    mesh = Mesh.Cube()</span>

<span class="sd">    with mesh.blender_data() as data:</span>
<span class="sd">        normals = np.array([poly.normal for poly in data.polygons])</span>

<span class="sd">    print(normals)</span>

<span class="sd">    # &gt; [[-1. -0.  0.]</span>
<span class="sd">    #    [ 0.  1.  0.]</span>
<span class="sd">    #    [ 1. -0.  0.]</span>
<span class="sd">    #    [ 0. -1.  0.]</span>
<span class="sd">    #    [ 0.  0. -1.]</span>
<span class="sd">    #    [ 0. -0.  1.]]</span>
<span class="sd">    ```</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - readonly (bool=False) : don&#39;t read back the geometry if not modified</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - Blender Mesh</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">meshes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">DATA_TEMP_NAME</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">meshes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">DATA_TEMP_NAME</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">to_mesh_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">yield</span> <span class="n">data</span>

    <span class="c1"># ----- Back</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">readonly</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="n">Mesh</span><span class="o">.</span><span class="n">from_mesh_data</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.bmesh" class="doc doc-heading">
            <code class=" language-python"><span class="n">bmesh</span><span class="p">(</span><span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#npblender.Mesh.bmesh" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Acces to bmesh api.</p>
<p>The example below use bmesh to offset the vertices of +1 in the x axis.</p>
<div class="codehilite"><pre><span></span><code><span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">Cube</span><span class="p">()</span>

<span class="c1"># Move the vertices with bmesh</span>
<span class="k">with</span> <span class="n">mesh</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="p">:</span>
        <span class="n">v</span><span class="o">.</span><span class="n">co</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="mf">1.0</span>

<span class="c1"># Move the vertices directy in numpy array</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="c1"># Cube moved along x and y</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">to_object</span><span class="p">(</span><span class="s2">&quot;Cube&quot;</span><span class="p">)</span>
</code></pre></div>

<h5 id="npblender.Mesh.bmesh--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.bmesh--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="nv">readonly</span><span class="w"> </span><span class="ss">(</span><span class="nv">bool</span><span class="o">=</span><span class="nv">False</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">avoid</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">read</span><span class="w"> </span><span class="nv">back</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">bmesh</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">modications</span><span class="w"> </span><span class="nv">were</span><span class="w"> </span><span class="nv">done</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@contextmanager</span>
<span class="k">def</span><span class="w"> </span><span class="nf">bmesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Acces to bmesh api.</span>

<span class="sd">    The example below use bmesh to offset the vertices of +1 in the x axis.</span>

<span class="sd">    ``` python</span>
<span class="sd">    mesh = Mesh.Cube()</span>

<span class="sd">    # Move the vertices with bmesh</span>
<span class="sd">    with mesh.bmesh() as bm:</span>
<span class="sd">        for v in bm.verts:</span>
<span class="sd">            v.co.x += 1.0</span>

<span class="sd">    # Move the vertices directy in numpy array</span>
<span class="sd">    mesh.points.position[:, 1] += 1</span>

<span class="sd">    # Cube moved along x and y</span>
<span class="sd">    mesh.to_object(&quot;Cube&quot;)</span>
<span class="sd">    ```</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - readonly (bool=False) : avoid to read back the bmesh if not modications were done</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">meshes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">DATA_TEMP_NAME</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">meshes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">DATA_TEMP_NAME</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">to_mesh_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">bm</span> <span class="o">=</span> <span class="n">bmesh</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>   <span class="c1"># create an empty BMesh</span>
    <span class="n">bm</span><span class="o">.</span><span class="n">from_mesh</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="c1"># fill it in from a Mesh</span>

    <span class="k">yield</span> <span class="n">bm</span>

    <span class="c1"># ----- Back</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">readonly</span><span class="p">:</span>
        <span class="n">bm</span><span class="o">.</span><span class="n">to_mesh</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="n">Mesh</span><span class="o">.</span><span class="n">from_mesh_data</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

    <span class="n">bm</span><span class="o">.</span><span class="n">free</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.boolean" class="doc doc-heading">
            <code class=" language-python"><span class="n">boolean</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;DIFFERENCE&#39;</span><span class="p">)</span></code>

<a href="#npblender.Mesh.boolean" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Apply a boolean operation with another object.</p>
<h5 id="npblender.Mesh.boolean--parameters">Parameters<a class="headerlink" href="#npblender.Mesh.boolean--parameters" title="Permanent link">&para;</a></h5>
<p>other : Mesh
    The object to use as boolean operand.
operation : str
    Boolean operation: 'INTERSECT', 'UNION', or 'DIFFERENCE'.</p>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2401</span>
<span class="normal">2402</span>
<span class="normal">2403</span>
<span class="normal">2404</span>
<span class="normal">2405</span>
<span class="normal">2406</span>
<span class="normal">2407</span>
<span class="normal">2408</span>
<span class="normal">2409</span>
<span class="normal">2410</span>
<span class="normal">2411</span>
<span class="normal">2412</span>
<span class="normal">2413</span>
<span class="normal">2414</span>
<span class="normal">2415</span>
<span class="normal">2416</span>
<span class="normal">2417</span>
<span class="normal">2418</span>
<span class="normal">2419</span>
<span class="normal">2420</span>
<span class="normal">2421</span>
<span class="normal">2422</span>
<span class="normal">2423</span>
<span class="normal">2424</span>
<span class="normal">2425</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">boolean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;DIFFERENCE&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply a boolean operation with another object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    other : Mesh</span>
<span class="sd">        The object to use as boolean operand.</span>
<span class="sd">    operation : str</span>
<span class="sd">        Boolean operation: &#39;INTERSECT&#39;, &#39;UNION&#39;, or &#39;DIFFERENCE&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="n">other</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">other_obj</span><span class="p">:</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">as</span> <span class="n">obj</span><span class="p">:</span>
            <span class="n">mod</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Boolean&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;BOOLEAN&#39;</span><span class="p">)</span>
            <span class="n">mod</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">other_obj</span>
            <span class="n">mod</span><span class="o">.</span><span class="n">operation</span> <span class="o">=</span> <span class="n">operation</span>

            <span class="c1"># Apply modifier</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifier_apply</span><span class="p">(</span><span class="n">modifier</span><span class="o">=</span><span class="n">mod</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mesh</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.bridge_loops" class="doc doc-heading">
            <code class=" language-python"><span class="n">bridge_loops</span><span class="p">(</span><span class="n">loop0</span><span class="p">,</span> <span class="n">loop1</span><span class="p">,</span> <span class="n">close</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">)</span></code>

<a href="#npblender.Mesh.bridge_loops" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a grid linking two loops of the same size.</p>
<h5 id="npblender.Mesh.bridge_loops--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.bridge_loops--arguments" title="Permanent link">&para;</a></h5>
<ul>
<li>loop0 (array of ints) : the first loop</li>
<li>loop1 (array of ints) : the second loop</li>
<li>segments (int = 1) : the number of segments to join the loops</li>
<li>attributes (dict) : attributes to add to the mesh</li>
</ul>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bridge_loops</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop0</span><span class="p">,</span> <span class="n">loop1</span><span class="p">,</span> <span class="n">close</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create a grid linking two loops of the same size.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    - loop0 (array of ints) : the first loop</span>
<span class="sd">    - loop1 (array of ints) : the second loop</span>
<span class="sd">    - segments (int = 1) : the number of segments to join the loops</span>
<span class="sd">    - attributes (dict) : attributes to add to the mesh</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">segments</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">segments</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">close</span><span class="p">:</span>
        <span class="n">loop0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loop0</span><span class="p">,</span> <span class="n">loop0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">bint</span><span class="p">)</span>
        <span class="n">loop1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loop1</span><span class="p">,</span> <span class="n">loop1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">bint</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">loop0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">loop0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bint</span><span class="p">)</span>
        <span class="n">loop1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">loop1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bint</span><span class="p">)</span>

    <span class="n">sel0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">loop0</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">loop0</span><span class="p">[</span><span class="mi">1</span><span class="p">:]),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">sel1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">loop1</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">loop1</span><span class="p">[</span><span class="mi">1</span><span class="p">:]),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">sel0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">sel0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">sel1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">sel1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>

        <span class="n">edges</span><span class="p">,</span> <span class="n">verts_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bm_edges</span><span class="p">(</span><span class="n">bm</span><span class="p">)</span>

        <span class="c1"># Prepare edges view</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">([(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">bint</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">bint</span><span class="p">)])</span>
        <span class="n">edges_view</span> <span class="o">=</span> <span class="n">verts_indices</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>

        <span class="c1"># First loop</span>
        <span class="n">sel0_view</span> <span class="o">=</span> <span class="n">sel0</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">edges_view</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">sel0_view</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>

        <span class="n">edges_to_bridge</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>

        <span class="c1"># Second loop</span>
        <span class="n">sel1_view</span> <span class="o">=</span> <span class="n">sel1</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">edges_view</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">sel1_view</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>

        <span class="n">edges_to_bridge</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="n">mask</span><span class="p">]))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">edges_to_bridge</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Bridge</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">bridge_loops</span><span class="p">(</span>
            <span class="n">bm</span><span class="p">,</span> 
            <span class="n">edges</span><span class="o">=</span><span class="n">edges_to_bridge</span><span class="p">,</span>
            <span class="c1">#use_cyclic = close,</span>
            <span class="c1">#segments=segments,</span>
            <span class="p">)</span>

        <span class="c1"># Grid</span>
        <span class="k">if</span> <span class="n">segments</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">subdivide_edges</span><span class="p">(</span>
                <span class="n">bm</span><span class="p">,</span>
                <span class="n">edges</span><span class="o">=</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">],</span>
                <span class="n">cuts</span><span class="o">=</span><span class="n">segments</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">use_grid_fill</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.capture" class="doc doc-heading">
            <code class=" language-python"><span class="n">capture</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></code>

<a href="#npblender.Mesh.capture" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Capture the data of another Mesh.</p>
<h5 id="npblender.Mesh.capture--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.capture--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- other (Mesh) : the mesh to capture
</code></pre></div>

<h5 id="npblender.Mesh.capture--returns">Returns<a class="headerlink" href="#npblender.Mesh.capture--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- self
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">capture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Capture the data of another Mesh.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - other (Mesh) : the mesh to capture</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - self</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">materials</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">materials</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">points</span>  <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">points</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">corners</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">corners</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">faces</span>   <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">faces</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">edges</span>   <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">edges</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.chain_link" class="doc doc-heading">
            <code class=" language-python"><span class="n">chain_link</span><span class="p">(</span><span class="n">major_segments</span><span class="o">=</span><span class="mi">48</span><span class="p">,</span> <span class="n">minor_segments</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">section</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#npblender.Mesh.chain_link" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a chain link.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># ----- Some maths</span>

<span class="c1"># Chain follows a catenary curve</span>
<span class="k">def</span><span class="w"> </span><span class="nf">catenary</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">(</span><span class="n">t</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Orientation is given by the derivative</span>
<span class="k">def</span><span class="w"> </span><span class="nf">derivative</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">10000</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">catenary</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">dt</span><span class="p">)</span> <span class="o">-</span> <span class="n">catenary</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">dt</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span>

<span class="c1"># Catenary length</span>
<span class="n">pts</span> <span class="o">=</span> <span class="n">catenary</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
<span class="n">cat_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">pts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
<span class="n">cat_len</span> <span class="o">=</span> <span class="n">cat_s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Catenary inverse : t from length</span>
<span class="k">def</span><span class="w"> </span><span class="nf">cat_inverse</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cat_s</span> <span class="o">-</span> <span class="n">l</span><span class="p">))</span><span class="o">/</span><span class="mi">1000</span> <span class="o">-</span> <span class="mi">1</span>

<span class="c1"># ----- Let&#39;s build the geometry</span>

<span class="c1"># One chain link</span>
<span class="n">section</span> <span class="o">=</span> <span class="mf">.02</span>
<span class="n">length</span>  <span class="o">=</span> <span class="mf">.15</span>
<span class="n">link</span> <span class="o">=</span> <span class="n">MeshBuilder</span><span class="o">.</span><span class="n">ChainLink</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mf">.04</span><span class="p">,</span> <span class="n">section</span><span class="o">=</span><span class="n">section</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">length</span><span class="p">)</span>

<span class="c1"># Link length taking into account the section</span>
<span class="n">l</span> <span class="o">=</span> <span class="n">length</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">section</span>

<span class="c1"># Number of links</span>
<span class="n">count</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">cat_len</span> <span class="o">/</span> <span class="n">l</span><span class="p">)</span>

<span class="c1"># The chain</span>
<span class="n">chain</span> <span class="o">=</span> <span class="n">link</span><span class="o">*</span><span class="n">count</span>

<span class="c1"># Rotate pi/2 one on two</span>
<span class="n">eulers</span> <span class="o">=</span> <span class="n">Eulers</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>
<span class="n">eulers</span><span class="p">[[</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">)]]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">chain</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">eulers</span><span class="p">)</span>
<span class="n">chain</span><span class="o">.</span><span class="n">rotate_z</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Location of each link</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cat_inverse</span><span class="p">(</span><span class="n">l</span><span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">)])</span>

<span class="n">chain</span><span class="o">.</span><span class="n">toward</span><span class="p">(</span><span class="n">derivative</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">track_axis</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">up_axis</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
<span class="n">chain</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">catenary</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>

<span class="c1"># To object</span>
<span class="n">chain</span><span class="o">.</span><span class="n">to_object</span><span class="p">(</span><span class="s2">&quot;Catenary&quot;</span><span class="p">)</span>
</code></pre></div>

<h5 id="npblender.Mesh.chain_link--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.chain_link--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="k">-</span> major_segments (int=48) : number of segments for the link
<span class="k">-</span> minor_segments (int=12) : number of segments for the section
<span class="k">-</span> radius (float=1.) : radius of the link
<span class="k">-</span> section (float=.5) : section (diameter)
<span class="k">-</span> length (float=4.) : total length of the link
<span class="k">-</span> materials (list of strs = None) : materials list
</code></pre></div>

<h5 id="npblender.Mesh.chain_link--returns">Returns<a class="headerlink" href="#npblender.Mesh.chain_link--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- MeshBuilder
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">chain_link</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">major_segments</span><span class="o">=</span><span class="mi">48</span><span class="p">,</span> <span class="n">minor_segments</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">section</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create a chain link.</span>

<span class="sd">    ``` python</span>
<span class="sd">    # ----- Some maths</span>

<span class="sd">    # Chain follows a catenary curve</span>
<span class="sd">    def catenary(t):</span>
<span class="sd">        return np.stack((t, np.zeros_like(t), np.cosh(t)), axis=-1)</span>

<span class="sd">    # Orientation is given by the derivative</span>
<span class="sd">    def derivative(t):</span>
<span class="sd">        dt = 1/10000</span>
<span class="sd">        return (catenary(t + dt) - catenary(t - dt))/(2*dt)</span>

<span class="sd">    # Catenary length</span>
<span class="sd">    pts = catenary(np.linspace(-1, 1, 1000))</span>
<span class="sd">    cat_s = np.cumsum(np.linalg.norm(pts[1:] - pts[:-1], axis=-1))</span>
<span class="sd">    cat_len = cat_s[-1]</span>

<span class="sd">    # Catenary inverse : t from length</span>
<span class="sd">    def cat_inverse(l):</span>
<span class="sd">        return 2*np.argmin(np.abs(cat_s - l))/1000 - 1</span>

<span class="sd">    # ----- Let&#39;s build the geometry</span>

<span class="sd">    # One chain link</span>
<span class="sd">    section = .02</span>
<span class="sd">    length  = .15</span>
<span class="sd">    link = MeshBuilder.ChainLink(radius=.04, section=section, length=length)</span>

<span class="sd">    # Link length taking into account the section</span>
<span class="sd">    l = length - 2*section</span>

<span class="sd">    # Number of links</span>
<span class="sd">    count = round(cat_len / l)</span>

<span class="sd">    # The chain</span>
<span class="sd">    chain = link*count</span>

<span class="sd">    # Rotate pi/2 one on two</span>
<span class="sd">    eulers = Eulers(shape=count)</span>
<span class="sd">    eulers[[i % 2 == 1 for i in range(count)]] = (0, np.pi/2, 0)</span>

<span class="sd">    chain.rotate(eulers)</span>
<span class="sd">    chain.rotate_z(np.pi/2)</span>

<span class="sd">    # Location of each link</span>
<span class="sd">    t = np.array([cat_inverse(l*i) for i in range(count)])</span>

<span class="sd">    chain.toward(derivative(t), track_axis=&#39;X&#39;, up_axis=&#39;Z&#39;)</span>
<span class="sd">    chain.translate(catenary(t))</span>

<span class="sd">    # To object</span>
<span class="sd">    chain.to_object(&quot;Catenary&quot;)</span>
<span class="sd">    ```</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - major_segments (int=48) : number of segments for the link</span>
<span class="sd">        - minor_segments (int=12) : number of segments for the section</span>
<span class="sd">        - radius (float=1.) : radius of the link</span>
<span class="sd">        - section (float=.5) : section (diameter)</span>
<span class="sd">        - length (float=4.) : total length of the link</span>
<span class="sd">        - materials (list of strs = None) : materials list</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - MeshBuilder</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">delta</span> <span class="o">=</span> <span class="n">length</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">radius</span>

    <span class="c1"># Starting from a torus</span>
    <span class="n">clink</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">torus</span><span class="p">(</span>
        <span class="n">major_radius</span>    <span class="o">=</span> <span class="n">radius</span><span class="p">,</span> 
        <span class="n">minor_radius</span>    <span class="o">=</span> <span class="n">section</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> 
        <span class="n">major_segments</span>  <span class="o">=</span> <span class="n">major_segments</span><span class="p">,</span> 
        <span class="n">minor_segments</span>  <span class="o">=</span> <span class="n">minor_segments</span><span class="p">,</span> 
        <span class="n">materials</span>       <span class="o">=</span> <span class="n">materials</span>
    <span class="p">)</span>
    <span class="c1"># Nothing else</span>
    <span class="k">if</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="n">radius</span><span class="o">/</span><span class="mi">10</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">clink</span>

    <span class="n">epsilon</span> <span class="o">=</span> <span class="n">radius</span><span class="o">/</span><span class="n">major_segments</span>

    <span class="c1"># Delete half of the points</span>
    <span class="n">clink</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">clink</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">epsilon</span><span class="p">)</span>
    <span class="n">npoints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clink</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
    <span class="n">borders</span> <span class="o">=</span> <span class="n">clink</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">epsilon</span>
    <span class="n">loop0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npoints</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">borders</span><span class="p">,</span> <span class="n">clink</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)]</span>
    <span class="n">loop1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npoints</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">borders</span><span class="p">,</span> <span class="n">clink</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span>
    <span class="n">clink</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">delta</span><span class="o">/</span><span class="mi">2</span>

    <span class="c1"># Duplicate and inverse</span>
    <span class="n">half</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_mesh</span><span class="p">(</span><span class="n">clink</span><span class="p">)</span>
    <span class="n">half</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="c1"># Join</span>
    <span class="n">clink</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">half</span><span class="p">)</span>

    <span class="c1"># Bridge</span>
    <span class="n">clink</span><span class="o">.</span><span class="n">bridge_loops</span><span class="p">(</span><span class="n">loop0</span><span class="p">,</span> <span class="n">loop1</span> <span class="o">+</span> <span class="n">npoints</span><span class="p">,</span> <span class="n">close</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">clink</span><span class="o">.</span><span class="n">bridge_loops</span><span class="p">(</span><span class="n">loop1</span><span class="p">,</span> <span class="n">loop0</span> <span class="o">+</span> <span class="n">npoints</span><span class="p">,</span> <span class="n">close</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># UVMap</span>
    <span class="n">nu</span><span class="p">,</span> <span class="n">nv</span> <span class="o">=</span> <span class="n">major_segments</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="n">minor_segments</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">uvmap</span> <span class="o">=</span> <span class="n">grid_uv_map</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">nv</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nu</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nv</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">ratio</span> <span class="o">=</span> <span class="p">(</span><span class="n">length</span> <span class="o">-</span> <span class="n">radius</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">length</span> <span class="o">-</span> <span class="n">radius</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">radius</span><span class="p">)</span>
    <span class="n">dx_side</span> <span class="o">=</span> <span class="n">ratio</span><span class="o">/</span><span class="mi">2</span>

    <span class="n">uvmap</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ratio</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">/</span><span class="n">nu</span><span class="p">)</span>
    <span class="n">uvmap</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,:,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">ratio</span>
    <span class="n">uvmap</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,:,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">ratio</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">uvmap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">ratio</span><span class="o">/</span><span class="mi">2</span>

    <span class="n">clink</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">UVMap</span> <span class="o">=</span> <span class="n">uvmap</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">clink</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.circle" class="doc doc-heading">
            <code class=" language-python"><span class="n">circle</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fill_segments</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cap</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#npblender.Mesh.circle" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a Circle.</p>
<p>'fill_segments' argument gives the number of internal circles to create.
If zero, the circle if filled with a polygon.
If positive, the circle is filled with triangle fans.</p>
<h5 id="npblender.Mesh.circle--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.circle--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="k">-</span> radius (float=1.) : circle radius
<span class="k">-</span> segments (int=16) : number of segments
<span class="k">-</span> fill_segments (int = 0) : number of internal segments, polygon is None
<span class="k">-</span> materials (list of strs = None) : materials list
</code></pre></div>

<h5 id="npblender.Mesh.circle--returns">Returns<a class="headerlink" href="#npblender.Mesh.circle--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- Mesh
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">circle</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fill_segments</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cap</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create a Circle.</span>

<span class="sd">    &#39;fill_segments&#39; argument gives the number of internal circles to create.</span>
<span class="sd">    If zero, the circle if filled with a polygon.</span>
<span class="sd">    If positive, the circle is filled with triangle fans.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - radius (float=1.) : circle radius</span>
<span class="sd">        - segments (int=16) : number of segments</span>
<span class="sd">        - fill_segments (int = 0) : number of internal segments, polygon is None</span>
<span class="sd">        - materials (list of strs = None) : materials list</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - Mesh</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">segments</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ag</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ag</span><span class="p">)</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cap</span> <span class="o">==</span> <span class="s1">&#39;NONE&#39;</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">shift</span><span class="o">=-</span><span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">points</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="n">edges</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">cap</span> <span class="o">==</span> <span class="s1">&#39;NGON&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">points</span>      <span class="o">=</span> <span class="n">points</span><span class="p">,</span> 
            <span class="n">corners</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">segments</span><span class="p">),</span> 
            <span class="n">faces</span>       <span class="o">=</span> <span class="n">segments</span><span class="p">,</span>
            <span class="n">UVMap</span>       <span class="o">=</span> <span class="n">disk_uv_map</span><span class="p">(</span><span class="n">segments</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;NGON&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="n">materials</span>   <span class="o">=</span> <span class="n">materials</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">cap</span> <span class="o">==</span> <span class="s1">&#39;FANS&#39;</span><span class="p">:</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">topo</span> <span class="o">=</span> <span class="n">fans_corners</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">points</span>      <span class="o">=</span> <span class="n">points</span><span class="p">,</span> 
            <span class="n">corners</span>     <span class="o">=</span> <span class="n">topo</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> 
            <span class="n">faces</span>       <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
            <span class="n">UVMap</span>       <span class="o">=</span> <span class="n">disk_uv_map</span><span class="p">(</span><span class="n">segments</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;FANS&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="n">materials</span>   <span class="o">=</span> <span class="n">materials</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1">#mesh = cls(points=points)</span>
    <span class="c1">#mesh.fill_cap(np.arange(segments), mode=cap, center=segments, clockwise=True)</span>

    <span class="k">assert</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.clear_geometry" class="doc doc-heading">
            <code class=" language-python"><span class="n">clear_geometry</span><span class="p">()</span></code>

<a href="#npblender.Mesh.clear_geometry" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Clear the geometry.</p>
<p>Delete all the content.</p>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">clear_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Clear the geometry.</span>

<span class="sd">    Delete all the content.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.cone" class="doc doc-heading">
            <code class=" language-python"><span class="n">cone</span><span class="p">(</span><span class="n">vertices</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">side_segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">radius_top</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">radius_bottom</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fill_type</span><span class="o">=</span><span class="s1">&#39;NGON&#39;</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#npblender.Mesh.cone" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a Cone.</p>
<h5 id="npblender.Mesh.cone--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.cone--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="nx">vertices</span><span class="w"> </span><span class="p">(</span><span class="nx">int</span><span class="p">=</span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">number</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">segments</span>
<span class="o">-</span><span class="w"> </span><span class="nx">side_segments</span><span class="w"> </span><span class="p">(</span><span class="nx">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">number</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">vertical</span><span class="w"> </span><span class="nx">segments</span>
<span class="o">-</span><span class="w"> </span><span class="nx">fill_segments</span><span class="w"> </span><span class="p">(</span><span class="nx">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">number</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">internal</span><span class="w"> </span><span class="nx">circles</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">caps</span>
<span class="o">-</span><span class="w"> </span><span class="nx">radius_top</span><span class="w"> </span><span class="p">(</span><span class="nx">float</span><span class="p">=</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">top</span><span class="w"> </span><span class="nx">radius</span>
<span class="o">-</span><span class="w"> </span><span class="nx">radius_bottom</span><span class="w"> </span><span class="p">(</span><span class="nx">float</span><span class="p">=</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">bottom</span><span class="w"> </span><span class="nx">radius</span>
<span class="o">-</span><span class="w"> </span><span class="nx">depth</span><span class="w"> </span><span class="p">(</span><span class="nx">float</span><span class="p">=</span><span class="mi">2</span><span class="p">.)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">cylinder</span><span class="w"> </span><span class="nx">height</span>
<span class="o">-</span><span class="w"> </span><span class="nx">fill_type</span><span class="w"> </span><span class="p">(</span><span class="nx">str</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="nx">couple</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">strs</span><span class="w"> </span><span class="p">=</span><span class="err">&#39;</span><span class="nx">NGON</span><span class="err">&#39;</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">NGON</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">FANS</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">NONE</span><span class="err">&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">cap</span><span class="w"> </span><span class="nx">filling</span>
<span class="o">-</span><span class="w"> </span><span class="nx">materials</span><span class="w"> </span><span class="p">(</span><span class="nx">list</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">strs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">None</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">materials</span><span class="w"> </span><span class="nx">list</span>
</code></pre></div>

<h5 id="npblender.Mesh.cone--returns">Returns<a class="headerlink" href="#npblender.Mesh.cone--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- Mesh
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">cone</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">vertices</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">side_segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">radius_top</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">radius_bottom</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fill_type</span><span class="o">=</span><span class="s1">&#39;NGON&#39;</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create a Cone.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - vertices (int=16) : number of segments</span>
<span class="sd">        - side_segments (int = 1) : number of vertical segments</span>
<span class="sd">        - fill_segments (int = 1) : number of internal circles on the caps</span>
<span class="sd">        - radius_top (float=0) : top radius</span>
<span class="sd">        - radius_bottom (float=1) : bottom radius</span>
<span class="sd">        - depth (float=2.) : cylinder height</span>
<span class="sd">        - fill_type (str or couple of strs =&#39;NGON&#39; in &#39;NGON&#39;, &#39;FANS&#39;, &#39;NONE&#39;) : cap filling</span>
<span class="sd">        - materials (list of strs = None) : materials list</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - Mesh</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Empty geometry if fhe two radius are null</span>
    <span class="k">if</span> <span class="n">radius_top</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">radius_bottom</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">()</span>

    <span class="n">mesh</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">bl_cone</span><span class="p">(</span>
        <span class="n">radius1</span>       <span class="o">=</span> <span class="n">radius_bottom</span><span class="p">,</span>
        <span class="n">radius2</span>       <span class="o">=</span> <span class="n">radius_top</span><span class="p">,</span>
        <span class="n">segments</span>      <span class="o">=</span> <span class="n">vertices</span><span class="p">,</span>
        <span class="n">side_segments</span> <span class="o">=</span> <span class="n">side_segments</span><span class="p">,</span>
        <span class="n">depth</span>         <span class="o">=</span> <span class="n">depth</span><span class="p">,</span>
        <span class="n">cap_ends</span>      <span class="o">=</span> <span class="n">fill_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;NGON&#39;</span><span class="p">,</span> <span class="s1">&#39;FANS&#39;</span><span class="p">],</span>
        <span class="n">cap_tris</span>      <span class="o">=</span> <span class="n">fill_type</span> <span class="o">==</span> <span class="s1">&#39;FANS&#39;</span><span class="p">,</span>
        <span class="n">materials</span>     <span class="o">=</span> <span class="n">materials</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">mesh</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.cube" class="doc doc-heading">
            <code class=" language-python"><span class="n">cube</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#npblender.Mesh.cube" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a Cube.</p>
<h5 id="npblender.Mesh.cube--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.cube--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- size (float=1.) : size of the cube
- materials (list of strs = None) : materials list
</code></pre></div>

<h5 id="npblender.Mesh.cube--returns">Returns<a class="headerlink" href="#npblender.Mesh.cube--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- Mesh
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">cube</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create a Cube.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - size (float=1.) : size of the cube</span>
<span class="sd">        - materials (list of strs = None) : materials list</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - Mesh</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">verts</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span> <span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">],</span> <span class="p">[</span> <span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span> <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">],</span> <span class="p">[</span> <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">,</span>  <span class="mf">1.</span><span class="p">],]</span>
    <span class="n">corners</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
    <span class="n">faces</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="mi">6</span>
    <span class="n">uvs</span>   <span class="o">=</span> <span class="p">[[</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.000</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.000</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.250</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.250</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.250</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.250</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.500</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.500</span><span class="p">],</span>
             <span class="p">[</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.500</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.500</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.750</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.750</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.750</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.750</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.625</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">],</span>
             <span class="p">[</span><span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.500</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.500</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.750</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.750</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.500</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.875</span><span class="p">,</span> <span class="mf">0.500</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.875</span><span class="p">,</span> <span class="mf">0.750</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.750</span><span class="p">],</span> <span class="p">]</span>


    <span class="n">mesh</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">verts</span><span class="p">,</span> <span class="n">corners</span><span class="o">=</span><span class="n">corners</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="n">faces</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">,</span> <span class="n">UVMap</span><span class="o">=</span><span class="n">uvs</span><span class="p">)</span>

    <span class="n">size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span> <span class="o">*=</span> <span class="n">size</span><span class="o">/</span><span class="mi">2</span>

    <span class="k">return</span> <span class="n">mesh</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.cylinder" class="doc doc-heading">
            <code class=" language-python"><span class="n">cylinder</span><span class="p">(</span><span class="n">vertices</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">side_segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fill_type</span><span class="o">=</span><span class="s1">&#39;NGON&#39;</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#npblender.Mesh.cylinder" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a Cylinder.</p>
<h5 id="npblender.Mesh.cylinder--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.cylinder--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="nx">vertices</span><span class="w"> </span><span class="p">(</span><span class="nx">int</span><span class="p">=</span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">number</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">segments</span>
<span class="o">-</span><span class="w"> </span><span class="nx">side_segments</span><span class="w"> </span><span class="p">(</span><span class="nx">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">number</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">vertical</span><span class="w"> </span><span class="nx">segments</span>
<span class="o">-</span><span class="w"> </span><span class="nx">radius</span><span class="w"> </span><span class="p">(</span><span class="nx">float</span><span class="p">=</span><span class="mi">1</span><span class="p">.)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">radius</span>
<span class="o">-</span><span class="w"> </span><span class="nx">depth</span><span class="w"> </span><span class="p">(</span><span class="nx">float</span><span class="p">=</span><span class="mi">2</span><span class="p">.)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">cylinder</span><span class="w"> </span><span class="nx">height</span>
<span class="o">-</span><span class="w"> </span><span class="nx">fill_type</span><span class="w"> </span><span class="p">(</span><span class="nx">str</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="nx">couple</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">strs</span><span class="w"> </span><span class="p">=</span><span class="err">&#39;</span><span class="nx">NGON</span><span class="err">&#39;</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">NGON</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">TRIANGLE_FAN</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">NONE</span><span class="err">&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">cap</span><span class="w"> </span><span class="nx">filling</span>
<span class="o">-</span><span class="w"> </span><span class="nx">materials</span><span class="w"> </span><span class="p">(</span><span class="nx">list</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">strs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">None</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">materials</span><span class="w"> </span><span class="nx">list</span>
</code></pre></div>

<h5 id="npblender.Mesh.cylinder--returns">Returns<a class="headerlink" href="#npblender.Mesh.cylinder--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- Mesh
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">cylinder</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">vertices</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">side_segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fill_type</span><span class="o">=</span><span class="s1">&#39;NGON&#39;</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create a Cylinder.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - vertices (int=16) : number of segments</span>
<span class="sd">        - side_segments (int = 1) : number of vertical segments</span>
<span class="sd">        - radius (float=1.) : radius</span>
<span class="sd">        - depth (float=2.) : cylinder height</span>
<span class="sd">        - fill_type (str or couple of strs =&#39;NGON&#39; in &#39;NGON&#39;, &#39;TRIANGLE_FAN&#39;, &#39;NONE&#39;) : cap filling</span>
<span class="sd">        - materials (list of strs = None) : materials list</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - Mesh</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">bl_cone</span><span class="p">(</span>
        <span class="n">radius1</span>       <span class="o">=</span> <span class="n">radius</span><span class="p">,</span>
        <span class="n">radius2</span>       <span class="o">=</span> <span class="n">radius</span><span class="p">,</span>
        <span class="n">segments</span>      <span class="o">=</span> <span class="n">vertices</span><span class="p">,</span>
        <span class="n">side_segments</span> <span class="o">=</span> <span class="n">side_segments</span><span class="p">,</span>
        <span class="n">depth</span>         <span class="o">=</span> <span class="n">depth</span><span class="p">,</span>
        <span class="n">cap_ends</span>      <span class="o">=</span> <span class="n">fill_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;NGON&#39;</span><span class="p">,</span> <span class="s1">&#39;FANS&#39;</span><span class="p">],</span>
        <span class="n">cap_tris</span>      <span class="o">=</span> <span class="n">fill_type</span> <span class="o">==</span> <span class="s1">&#39;FANS&#39;</span><span class="p">,</span>
        <span class="n">materials</span>     <span class="o">=</span> <span class="n">materials</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">mesh</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.delete_faces" class="doc doc-heading">
            <code class=" language-python"><span class="n">delete_faces</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span></code>

<a href="#npblender.Mesh.delete_faces" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Delete only faces.</p>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Delete only faces.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">delete_loops</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.delete_vertices" class="doc doc-heading">
            <code class=" language-python"><span class="n">delete_vertices</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#npblender.Mesh.delete_vertices" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Delete vertices.</p>
<h5 id="npblender.Mesh.delete_vertices--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.delete_vertices--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="n">points</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="n">selection</span><span class="o">,</span><span class="w"> </span><span class="n">optional</span>
<span class="w">    </span><span class="n">Vertex</span><span class="w"> </span><span class="n">indices</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">delete</span><span class="w"> </span><span class="n">directly</span><span class="o">.</span>
<span class="n">faces</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="n">selection</span><span class="o">,</span><span class="w"> </span><span class="n">optional</span>
<span class="w">    </span><span class="n">Faces</span><span class="w"> </span><span class="n">owning</span><span class="w"> </span><span class="n">vertices</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">delete</span><span class="o">.</span>
<span class="n">edges</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="n">selection</span><span class="o">,</span><span class="w"> </span><span class="n">optional</span>
<span class="w">    </span><span class="n">Edges</span><span class="w"> </span><span class="n">owning</span><span class="w"> </span><span class="n">vertices</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">delete</span><span class="o">.</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete vertices.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        points : array selection, optional</span>
<span class="sd">            Vertex indices to delete directly.</span>
<span class="sd">        faces : array selection, optional</span>
<span class="sd">            Faces owning vertices to delete.</span>
<span class="sd">        edges : array selection, optional</span>
<span class="sd">            Edges owning vertices to delete.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">go</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">p_sel</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">))[</span><span class="n">points</span><span class="p">])</span>
        <span class="n">go</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">faces</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">f_sel</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">))[</span><span class="n">faces</span><span class="p">])</span>
        <span class="n">go</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">e_sel</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">))[</span><span class="n">edges</span><span class="p">])</span>
        <span class="n">go</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">go</span><span class="p">:</span>
        <span class="k">return</span> 

    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>
        <span class="n">verts_to_delete</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">vert</span> <span class="ow">in</span> <span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vert</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="n">p_sel</span><span class="p">:</span>
                <span class="n">verts_to_delete</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vert</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">faces</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="n">f_sel</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">vert</span><span class="o">.</span><span class="n">link_faces</span><span class="p">):</span>
                    <span class="n">verts_to_delete</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vert</span><span class="p">)</span>
                    <span class="k">continue</span>

            <span class="k">if</span> <span class="n">edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="n">e_sel</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">vert</span><span class="o">.</span><span class="n">link_edges</span><span class="p">):</span>
                    <span class="n">verts_to_delete</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vert</span><span class="p">)</span>
                    <span class="k">continue</span>

        <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">bm</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">verts_to_delete</span><span class="p">),</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;VERTS&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.disk" class="doc doc-heading">
            <code class=" language-python"><span class="n">disk</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fill_segments</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cap</span><span class="o">=</span><span class="s1">&#39;NGON&#39;</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#npblender.Mesh.disk" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a disk.</p>
<p>Same as circle but default cap is NGON</p>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">disk</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fill_segments</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cap</span><span class="o">=</span><span class="s1">&#39;NGON&#39;</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create a disk.</span>

<span class="sd">    Same as circle but default cap is NGON</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="n">segments</span><span class="p">,</span> <span class="n">fill_segments</span><span class="o">=</span><span class="n">fill_segments</span><span class="p">,</span> <span class="n">cap</span><span class="o">=</span><span class="n">cap</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.extrude_faces" class="doc doc-heading">
            <code class=" language-python"><span class="n">extrude_faces</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span></code>

<a href="#npblender.Mesh.extrude_faces" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Extrude individual faces.</p>
<p>If offset is None, faces are extruder along their normal</p>
<h5 id="npblender.Mesh.extrude_faces--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.extrude_faces--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="nv">selection</span><span class="w"> </span>:<span class="w"> </span><span class="nv">indices</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">faces</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">extrude</span>
<span class="o">-</span><span class="w"> </span><span class="nv">offset</span><span class="w"> </span><span class="ss">(</span><span class="nv">vector</span><span class="w"> </span><span class="nv">or</span><span class="w"> </span><span class="nv">array</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">vectors</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">extrusion</span><span class="w"> </span><span class="nv">vector</span>
<span class="o">-</span><span class="w"> </span><span class="nv">scale</span><span class="w"> </span><span class="ss">(</span><span class="nv">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">scale</span><span class="w"> </span><span class="nv">factor</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">offsets</span>
<span class="o">-</span><span class="w"> </span><span class="nv">dissolve</span><span class="w"> </span><span class="ss">(</span><span class="nv">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">True</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">remove</span><span class="w"> </span><span class="nv">starting</span><span class="w"> </span><span class="nv">faces</span>
</code></pre></div>

<h5 id="npblender.Mesh.extrude_faces--returns">Returns<a class="headerlink" href="#npblender.Mesh.extrude_faces--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- dictionnary : &#39;top&#39; : extruded faces, &#39;side&#39; : extruded side faces
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extrude_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Extrude individual faces.</span>

<span class="sd">    If offset is None, faces are extruder along their normal</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - selection : indices of the faces to extrude</span>
<span class="sd">        - offset (vector or array of vectors) : the extrusion vector</span>
<span class="sd">        - scale (float = 1) : scale factor for offsets</span>
<span class="sd">        - dissolve (bool = True) : remove starting faces</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - dictionnary : &#39;top&#39; : extruded faces, &#39;side&#39; : extruded side faces</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Selected faces indices</span>
    <span class="n">faces_sel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">selection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">faces_sel</span> <span class="o">=</span> <span class="n">faces_sel</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span>

    <span class="c1"># bmesh edition</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>
        <span class="c1">#bm.verts.ensure_lookup_table()</span>
        <span class="n">bm</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">ensure_lookup_table</span><span class="p">()</span>

        <span class="c1"># select faces</span>
        <span class="n">start_faces</span> <span class="o">=</span> <span class="p">[</span><span class="n">bm</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">faces_sel</span><span class="p">]</span>

        <span class="n">res</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;top&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;side&#39;</span><span class="p">:</span> <span class="p">[]}</span>

        <span class="c1"># bmesh.ops</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">extrude_discrete_faces</span><span class="p">(</span><span class="n">bm</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="n">start_faces</span><span class="p">)</span>
        <span class="n">new_faces</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;faces&quot;</span><span class="p">]</span>



        <span class="c1"># One direction per face</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_shapes</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">offset</span><span class="p">),</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_faces</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">offsets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span>

        <span class="c1"># Loop on created faces</span>
        <span class="k">for</span> <span class="n">i_face</span><span class="p">,</span> <span class="n">face</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_faces</span><span class="p">):</span>
            <span class="n">verts</span> <span class="o">=</span> <span class="n">face</span><span class="o">.</span><span class="n">verts</span>
            <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ofs</span> <span class="o">=</span> <span class="n">face</span><span class="o">.</span><span class="n">normal</span><span class="o">*</span><span class="n">scale</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ofs</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="n">i_face</span><span class="p">]</span>

            <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">bm</span><span class="p">,</span> <span class="n">verts</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">verts</span><span class="p">),</span> <span class="n">vec</span><span class="o">=</span><span class="n">ofs</span><span class="p">)</span>

            <span class="n">res</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">face</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">face</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
                <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">link_faces</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">link_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">face</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                    <span class="n">res</span><span class="p">[</span><span class="s1">&#39;side&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">link_faces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">res</span><span class="p">[</span><span class="s1">&#39;side&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">link_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">res</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.extrude_loop" class="doc doc-heading">
            <code class=" language-python"><span class="n">extrude_loop</span><span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">close</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clockwise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">)</span></code>

<a href="#npblender.Mesh.extrude_loop" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Extrude a loop of vertices.</p>
<h5 id="npblender.Mesh.extrude_loop--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.extrude_loop--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="k">loop</span><span class="w"> </span><span class="ss">(</span><span class="nv">array</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">ints</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">vertex</span><span class="w"> </span><span class="nv">indices</span>
<span class="o">-</span><span class="w"> </span><span class="nv">offset</span><span class="w"> </span><span class="ss">(</span><span class="nv">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">multiplicator</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">direction</span><span class="w"> </span><span class="nv">vector</span>
<span class="o">-</span><span class="w"> </span><span class="nv">direction</span><span class="w"> </span><span class="ss">(</span><span class="nv">vector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">None</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">extrusion</span><span class="w"> </span><span class="nv">direction</span>,<span class="w"> </span><span class="nv">normal</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">None</span>
<span class="o">-</span><span class="w"> </span><span class="nv">clockwise</span><span class="w"> </span><span class="ss">(</span><span class="nv">bool</span><span class="o">=</span><span class="nv">False</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">faces</span><span class="w"> </span><span class="nv">orientation</span>
<span class="o">-</span><span class="w"> </span><span class="nv">attributes</span><span class="w"> </span>:<span class="w"> </span><span class="nv">attribute</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">geometry</span>
</code></pre></div>

<h5 id="npblender.Mesh.extrude_loop--returns">Returns<a class="headerlink" href="#npblender.Mesh.extrude_loop--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- dictionnary of the created geometry : vertex indices, face indices
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extrude_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">close</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clockwise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Extrude a loop of vertices.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - loop (array of ints) : vertex indices</span>
<span class="sd">        - offset (float = 1) : multiplicator of the direction vector</span>
<span class="sd">        - direction (vector = None) : extrusion direction, normal if None</span>
<span class="sd">        - clockwise (bool=False) : faces orientation</span>
<span class="sd">        - attributes : attribute for the new geometry</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - dictionnary of the created geometry : vertex indices, face indices</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">loop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">verts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">loop</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">new_verts</span> <span class="o">=</span> <span class="n">verts</span> <span class="o">+</span> <span class="n">offset</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Extrude&gt; Offset argument must be a single vector or an array of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span><span class="si">}</span><span class="s2"> vectors, not </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_verts</span><span class="p">)))</span>
    <span class="n">gc</span> <span class="o">=</span> <span class="n">grid_corners</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">verts</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">row_first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">close_x</span><span class="o">=</span><span class="n">close</span><span class="p">,</span> <span class="n">clockwise</span><span class="o">=</span><span class="n">clockwise</span><span class="p">)</span>
    <span class="n">corners</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">gc</span><span class="o">.</span><span class="n">ravel</span><span class="p">()]</span>
    <span class="n">uvmap</span> <span class="o">=</span> <span class="n">grid_uv_map</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">verts</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">close_x</span><span class="o">=</span><span class="n">close</span><span class="p">,</span> <span class="n">clockwise</span><span class="o">=</span><span class="n">clockwise</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">new_verts</span><span class="p">,</span> <span class="n">corners</span><span class="o">=</span><span class="n">corners</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">UVMap</span><span class="o">=</span><span class="n">uvmap</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.extrude_region" class="doc doc-heading">
            <code class=" language-python"><span class="n">extrude_region</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dissolve</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#npblender.Mesh.extrude_region" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Extrude individual faces.</p>
<h5 id="npblender.Mesh.extrude_region--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.extrude_region--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- selection : indices of the faces to extrude
- offset (vector = (0, 0, 1)) : the extrusion vector
- dissolve (bool = True) : remove starting faces
</code></pre></div>

<h5 id="npblender.Mesh.extrude_region--returns">Returns<a class="headerlink" href="#npblender.Mesh.extrude_region--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- dictionnary : &#39;top&#39; : extruded faces, &#39;side&#39; : extruded side faces
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span>
<span class="normal">2288</span>
<span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span>
<span class="normal">2295</span>
<span class="normal">2296</span>
<span class="normal">2297</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extrude_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dissolve</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Extrude individual faces.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - selection : indices of the faces to extrude</span>
<span class="sd">        - offset (vector = (0, 0, 1)) : the extrusion vector</span>
<span class="sd">        - dissolve (bool = True) : remove starting faces</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - dictionnary : &#39;top&#39; : extruded faces, &#39;side&#39; : extruded side faces</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Selected faces indices</span>
    <span class="n">faces_sel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">selection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">faces_sel</span> <span class="o">=</span> <span class="n">faces_sel</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span>

    <span class="c1"># bmesh edition</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>
        <span class="c1">#bm.verts.ensure_lookup_table()</span>
        <span class="n">bm</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">ensure_lookup_table</span><span class="p">()</span>

        <span class="c1"># select faces</span>
        <span class="n">start_faces</span> <span class="o">=</span> <span class="p">[</span><span class="n">bm</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">faces_sel</span><span class="p">]</span>

        <span class="n">res</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;top&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;side&#39;</span><span class="p">:</span> <span class="p">[]}</span>


        <span class="c1"># Extrusion</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">extrude_face_region</span><span class="p">(</span>
            <span class="n">bm</span><span class="p">,</span> 
            <span class="n">geom</span>                      <span class="o">=</span> <span class="n">start_faces</span><span class="p">,</span>
            <span class="c1">#edges_exclude            = set(),</span>
            <span class="c1">#use_keep_orig            = False,</span>
            <span class="c1">#use_normal_flip          = False,</span>
            <span class="c1">#use_normal_from_adjacent = False,</span>
            <span class="c1">#use_dissolve_ortho_edges = False,</span>
            <span class="c1">#use_select_history       = False,</span>
            <span class="p">)</span>

        <span class="c1"># Move new vectors</span>
        <span class="n">extruded_geom</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;geom&quot;</span><span class="p">]</span>
        <span class="n">new_verts</span> <span class="o">=</span> <span class="p">[</span><span class="n">ele</span> <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">extruded_geom</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ele</span><span class="p">,</span> <span class="n">bmesh</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">BMVert</span><span class="p">)]</span>
        <span class="n">new_faces</span> <span class="o">=</span> <span class="p">[</span><span class="n">ele</span> <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">extruded_geom</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ele</span><span class="p">,</span> <span class="n">bmesh</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">BMFace</span><span class="p">)]</span>

        <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">bm</span><span class="p">,</span> <span class="n">verts</span><span class="o">=</span><span class="n">new_verts</span><span class="p">,</span> <span class="n">vec</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">offset</span><span class="p">))</span>

        <span class="c1"># ===== Result</span>
        <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">new_faces</span><span class="p">:</span>
            <span class="n">res</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">face</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">face</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
                <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">link_faces</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">link_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">face</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                    <span class="n">res</span><span class="p">[</span><span class="s1">&#39;side&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">link_faces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">res</span><span class="p">[</span><span class="s1">&#39;side&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">link_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="c1"># ===== Dissolve extruded faces</span>
        <span class="k">if</span> <span class="n">dissolve</span><span class="p">:</span>
            <span class="n">bm</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">ensure_lookup_table</span><span class="p">()</span>
            <span class="n">del_faces</span> <span class="o">=</span> <span class="p">[</span><span class="n">bm</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">faces_sel</span><span class="p">]</span>

            <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">bm</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="n">del_faces</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;FACES&#39;</span><span class="p">)</span>                   

    <span class="k">return</span> <span class="n">res</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.extrude_vertices" class="doc doc-heading">
            <code class=" language-python"><span class="n">extrude_vertices</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">)</span></code>

<a href="#npblender.Mesh.extrude_vertices" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Extrude individual vertices</p>
<h5 id="npblender.Mesh.extrude_vertices--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.extrude_vertices--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="nv">selection</span><span class="w"> </span><span class="ss">(</span><span class="nv">selector</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">points</span><span class="w"> </span><span class="nv">selection</span>,<span class="w"> </span><span class="nv">all</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">None</span>
<span class="o">-</span><span class="w"> </span><span class="nv">offset</span><span class="w"> </span><span class="ss">(</span><span class="nv">vector</span><span class="w"> </span><span class="nv">or</span><span class="w"> </span><span class="nv">array</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">vectors</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">extrusion</span><span class="w"> </span><span class="nv">vector</span>
<span class="o">-</span><span class="w"> </span><span class="nv">attributes</span><span class="w"> </span><span class="ss">(</span><span class="nv">dict</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">points</span><span class="w"> </span><span class="nv">attributes</span>
</code></pre></div>

<h5 id="npblender.Mesh.extrude_vertices--returns">Returns<a class="headerlink" href="#npblender.Mesh.extrude_vertices--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- dictionnary of the created geometry : vertex indices, face indices
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extrude_vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Extrude individual vertices</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - selection (selector) : points selection, all if None</span>
<span class="sd">        - offset (vector or array of vectors) : extrusion vector</span>
<span class="sd">        - attributes (dict) : points attributes</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - dictionnary of the created geometry : vertex indices, face indices</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">selection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">inds</span> <span class="o">=</span> <span class="n">inds</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span>

    <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset</span>
    <span class="n">new_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">edges_between</span><span class="p">(</span><span class="n">inds</span><span class="p">,</span> <span class="n">new_inds</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="n">edges</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="o">**</span><span class="n">attributes</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.fill_cap" class="doc doc-heading">
            <code class=" language-python"><span class="n">fill_cap</span><span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;NGON&#39;</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">clockwise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">)</span></code>

<a href="#npblender.Mesh.fill_cap" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Fill a cap between an existing loop</p>
<p>For NGON mode, center is not required.
For FANS mode, a center point is required:
- if center is None, it is computed as the center of the loop
- if center is an int, it is the index of the point to use
- otherwise, the center is considered as the point to use</p>
<h5 id="npblender.Mesh.fill_cap--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.fill_cap--arguments" title="Permanent link">&para;</a></h5>
<ul>
<li>loop (array of ints) : the circle loop</li>
<li>mode (FillCap = 'NGON') : NGON or FANS</li>
<li>center (point index or point or None) : center of the cap</li>
<li>clockwise (bool = False) : order of the corners in the loop</li>
<li>indexing (str = 'ij') : indexing of the points</li>
<li>attributes (dict) : attributes to add to the mesh (see Geometry.add_geometry(</li>
</ul>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fill_cap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;NGON&#39;</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">clockwise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Fill a cap between an existing loop</span>

<span class="sd">    For NGON mode, center is not required.</span>
<span class="sd">    For FANS mode, a center point is required:</span>
<span class="sd">    - if center is None, it is computed as the center of the loop</span>
<span class="sd">    - if center is an int, it is the index of the point to use</span>
<span class="sd">    - otherwise, the center is considered as the point to use</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    - loop (array of ints) : the circle loop</span>
<span class="sd">    - mode (FillCap = &#39;NGON&#39;) : NGON or FANS</span>
<span class="sd">    - center (point index or point or None) : center of the cap</span>
<span class="sd">    - clockwise (bool = False) : order of the corners in the loop</span>
<span class="sd">    - indexing (str = &#39;ij&#39;) : indexing of the points</span>
<span class="sd">    - attributes (dict) : attributes to add to the mesh (see Geometry.add_geometry(</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;NONE&#39;</span><span class="p">:</span>
        <span class="c1"># To have en empty dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;NGON&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">corners</span><span class="o">=</span><span class="n">loop</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span> <span class="n">UVMap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">disk_uv_map</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;NGON&#39;</span><span class="p">,</span> <span class="n">clockwise</span><span class="o">=</span><span class="n">clockwise</span><span class="p">),</span> <span class="o">**</span><span class="n">attributes</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;FANS&#39;</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">center</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">verts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">loop</span><span class="p">]</span>
            <span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">center_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
            <span class="n">cind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_points</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)):</span>
            <span class="n">center_index</span> <span class="o">=</span> <span class="n">center</span>
            <span class="n">cind</span> <span class="o">=</span> <span class="p">[</span><span class="n">center_index</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">center_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
            <span class="n">cind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_points</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>

        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="n">center_index</span><span class="p">)</span>

        <span class="n">topo</span> <span class="o">=</span> <span class="n">fans_corners</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span> <span class="n">close</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">clockwise</span><span class="o">=</span><span class="n">clockwise</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="n">corners</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">topo</span><span class="p">]</span>
        <span class="n">uv_map</span> <span class="o">=</span> <span class="n">disk_uv_map</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;FANS&#39;</span><span class="p">,</span> <span class="n">clockwise</span><span class="o">=</span><span class="n">clockwise</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">added</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">corners</span><span class="o">=</span><span class="n">corners</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">UVMap</span><span class="o">=</span><span class="n">uv_map</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">)</span>
        <span class="n">added</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">cind</span><span class="p">)</span>

        <span class="c1"># More than one segments</span>

        <span class="k">if</span> <span class="n">segments</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">split_edges</span><span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="n">center_index</span><span class="p">,</span> <span class="n">cuts</span><span class="o">=</span><span class="n">segments</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">added</span>

    <span class="k">assert</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.from_mesh" class="doc doc-heading">
            <code class=" language-python"><span class="n">from_mesh</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#npblender.Mesh.from_mesh" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a Mesh from another mesh.</p>
<h5 id="npblender.Mesh.from_mesh--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.from_mesh--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- other (Mesh) : the mesh to copy
</code></pre></div>

<h5 id="npblender.Mesh.from_mesh--returns">Returns<a class="headerlink" href="#npblender.Mesh.from_mesh--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- Mesh
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_mesh</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create a Mesh from another mesh.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - other (Mesh) : the mesh to copy</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - Mesh</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">materials</span><span class="o">=</span><span class="n">other</span><span class="o">.</span><span class="n">materials</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">points</span>  <span class="o">=</span> <span class="n">Vertex</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">points</span><span class="p">,</span>  <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;COPY&#39;</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">corners</span> <span class="o">=</span> <span class="n">Corner</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">corners</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;COPY&#39;</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">faces</span>   <span class="o">=</span> <span class="n">Face</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">faces</span><span class="p">,</span>   <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;COPY&#39;</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">edges</span>   <span class="o">=</span> <span class="n">Edge</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span>    <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;COPY&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">points_mask</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">points_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">points_mask</span><span class="p">[</span><span class="n">points</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">faces</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">faces_mask</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">faces_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">faces_mask</span><span class="p">[</span><span class="n">faces</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">edges_mask</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">edges_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">edges</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">edges_mask</span><span class="p">[</span><span class="n">edges</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">mesh</span><span class="o">.</span><span class="n">delete_vertices</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">points_mask</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="n">faces_mask</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="n">edges_mask</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mesh</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.from_mesh_data" class="doc doc-heading">
            <code class=" language-python"><span class="n">from_mesh_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#npblender.Mesh.from_mesh_data" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize the geometry from a Blender Mesh</p>
<h5 id="npblender.Mesh.from_mesh_data--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.from_mesh_data--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="n">mesh</span><span class="w"> </span><span class="p">(</span><span class="n">Blender</span><span class="w"> </span><span class="n">Mesh</span><span class="w"> </span><span class="n">instance</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">mesh</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="nb">load</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_mesh_data</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Initialize the geometry from a Blender Mesh</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - mesh (Blender Mesh instance) : the mesh to load</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">blender</span>

    <span class="n">bl_mesh</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">get_mesh</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">mesh</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>

    <span class="c1"># ----- Materials</span>

    <span class="n">mesh</span><span class="o">.</span><span class="n">materials</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">mat</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">mat</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">mat</span> <span class="ow">in</span> <span class="n">bl_mesh</span><span class="o">.</span><span class="n">materials</span><span class="p">]</span>

    <span class="c1"># ----- Vertices</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bl_mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Positions will be read as position attribute</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    <span class="c1"># ----- Corners</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bl_mesh</span><span class="o">.</span><span class="n">polygons</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bl_mesh</span><span class="o">.</span><span class="n">loops</span><span class="p">),</span> <span class="n">bint</span><span class="p">)</span>
        <span class="n">bl_mesh</span><span class="o">.</span><span class="n">loops</span><span class="o">.</span><span class="n">foreach_get</span><span class="p">(</span><span class="s2">&quot;vertex_index&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vertex_index</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bl_mesh</span><span class="o">.</span><span class="n">polygons</span><span class="p">),</span> <span class="n">bint</span><span class="p">)</span>
        <span class="n">bl_mesh</span><span class="o">.</span><span class="n">polygons</span><span class="o">.</span><span class="n">foreach_get</span><span class="p">(</span><span class="s2">&quot;loop_total&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">append_sizes</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

        <span class="k">del</span> <span class="n">a</span>

    <span class="c1"># ----- Edges</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bl_mesh</span><span class="o">.</span><span class="n">edges</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bl_mesh</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="n">bint</span><span class="p">)</span>
        <span class="n">bl_mesh</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">foreach_get</span><span class="p">(</span><span class="s2">&quot;vertices&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vertex0</span><span class="o">=</span><span class="n">a</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">vertex1</span><span class="o">=</span><span class="n">a</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="k">del</span> <span class="n">a</span>

        <span class="n">mesh</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">remove_face_edges</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">get_edges</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">corners</span><span class="p">))</span>

    <span class="c1"># ----- Attributes</span>

    <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">from_bl_attributes</span><span class="p">(</span><span class="n">bl_mesh</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">from_bl_attributes</span><span class="p">(</span><span class="n">bl_mesh</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">from_bl_attributes</span><span class="p">(</span><span class="n">bl_mesh</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">from_bl_attributes</span><span class="p">(</span><span class="n">bl_mesh</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mesh</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.from_object" class="doc doc-heading">
            <code class=" language-python"><span class="n">from_object</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">evaluated</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#npblender.Mesh.from_object" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a Mesh from an existing object.</p>
<h5 id="npblender.Mesh.from_object--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.from_object--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="nv">obj</span><span class="w"> </span><span class="ss">(</span><span class="nv">str</span><span class="w"> </span><span class="nv">or</span><span class="w"> </span><span class="nv">Blender</span><span class="w"> </span><span class="nv">object</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">object</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">initialize</span><span class="w"> </span><span class="nv">from</span>
<span class="o">-</span><span class="w"> </span><span class="nv">evaluated</span><span class="w"> </span><span class="ss">(</span><span class="nv">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">False</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">object</span><span class="w"> </span><span class="nv">modified</span><span class="w"> </span><span class="nv">by</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">modifiers</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">True</span>,<span class="w"> </span><span class="nv">raw</span><span class="w"> </span><span class="nv">vertices</span><span class="w"> </span><span class="nv">otherwise</span>
</code></pre></div>

<h5 id="npblender.Mesh.from_object--returns">Returns<a class="headerlink" href="#npblender.Mesh.from_object--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- Mesh
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_object</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">evaluated</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create a Mesh from an existing object.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - obj (str or Blender object) : the object to initialize from</span>
<span class="sd">        - evaluated (bool = False) : object modified by the modifiers if True, raw vertices otherwise</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - Mesh</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">blender</span>

    <span class="k">if</span> <span class="n">evaluated</span><span class="p">:</span>
        <span class="n">depsgraph</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">evaluated_depsgraph_get</span><span class="p">()</span>
        <span class="n">object_eval</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">evaluated_get</span><span class="p">(</span><span class="n">depsgraph</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">FromMeshData</span><span class="p">(</span><span class="n">object_eval</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_mesh_data</span><span class="p">(</span><span class="n">blender</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.get_islands" class="doc doc-heading">
            <code class=" language-python"><span class="n">get_islands</span><span class="p">()</span></code>

<a href="#npblender.Mesh.get_islands" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get an island id per face.</p>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2717</span>
<span class="normal">2718</span>
<span class="normal">2719</span>
<span class="normal">2720</span>
<span class="normal">2721</span>
<span class="normal">2722</span>
<span class="normal">2723</span>
<span class="normal">2724</span>
<span class="normal">2725</span>
<span class="normal">2726</span>
<span class="normal">2727</span>
<span class="normal">2728</span>
<span class="normal">2729</span>
<span class="normal">2730</span>
<span class="normal">2731</span>
<span class="normal">2732</span>
<span class="normal">2733</span>
<span class="normal">2734</span>
<span class="normal">2735</span>
<span class="normal">2736</span>
<span class="normal">2737</span>
<span class="normal">2738</span>
<span class="normal">2739</span>
<span class="normal">2740</span>
<span class="normal">2741</span>
<span class="normal">2742</span>
<span class="normal">2743</span>
<span class="normal">2744</span>
<span class="normal">2745</span>
<span class="normal">2746</span>
<span class="normal">2747</span>
<span class="normal">2748</span>
<span class="normal">2749</span>
<span class="normal">2750</span>
<span class="normal">2751</span>
<span class="normal">2752</span>
<span class="normal">2753</span>
<span class="normal">2754</span>
<span class="normal">2755</span>
<span class="normal">2756</span>
<span class="normal">2757</span>
<span class="normal">2758</span>
<span class="normal">2759</span>
<span class="normal">2760</span>
<span class="normal">2761</span>
<span class="normal">2762</span>
<span class="normal">2763</span>
<span class="normal">2764</span>
<span class="normal">2765</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_islands</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Get an island id per face.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">deque</span>

    <span class="n">nfaces</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">nfaces</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">islands</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">nfaces</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">cur_island</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="n">passed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nfaces</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>
        <span class="n">bm</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">ensure_lookup_table</span><span class="p">()</span>
        <span class="n">bm</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">ensure_lookup_table</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">bm</span><span class="o">.</span><span class="n">faces</span><span class="p">:</span>
            <span class="c1"># Already visited</span>
            <span class="k">if</span> <span class="n">islands</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># New island index</span>
            <span class="n">cur_island</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">q</span> <span class="o">=</span> <span class="n">deque</span><span class="p">([</span><span class="n">f</span><span class="p">])</span>
            <span class="k">while</span> <span class="n">q</span><span class="p">:</span>
                <span class="n">cur</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>

                <span class="c1"># Part of the current island</span>
                <span class="n">islands</span><span class="p">[</span><span class="n">cur</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">cur_island</span>

                <span class="c1"># No infinite loop</span>
                <span class="n">passed</span><span class="p">[</span><span class="n">cur</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># Loop on the edges</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">cur</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>                                               
                    <span class="c1"># Loop on the edge faces</span>
                    <span class="k">for</span> <span class="n">nb</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">link_faces</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">passed</span><span class="p">[</span><span class="n">nb</span><span class="o">.</span><span class="n">index</span><span class="p">]:</span>
                            <span class="k">continue</span>
                        <span class="n">passed</span><span class="p">[</span><span class="n">nb</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                        <span class="k">if</span> <span class="n">islands</span><span class="p">[</span><span class="n">nb</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">q</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nb</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">islands</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.grid" class="doc doc-heading">
            <code class=" language-python"><span class="n">grid</span><span class="p">(</span><span class="n">size_x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size_y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">vertices_x</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">vertices_y</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#npblender.Mesh.grid" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a Grid.</p>
<blockquote>
<p>[!IMPORTANT]
Grid is created with indexing = 'ij': shape = (resolution x, resolution y)</p>
</blockquote>
<h5 id="npblender.Mesh.grid--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.grid--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="k">-</span> size_x (float=1) : size along x
_ size_y (float=1) : size along y
<span class="k">-</span> vertices_x (int=3) : number of vertices along x
<span class="k">-</span> vertices_y (int=3) : number of vertices along y
<span class="k">-</span> materials (list of strs = None) : materials list
</code></pre></div>

<h5 id="npblender.Mesh.grid--returns">Returns<a class="headerlink" href="#npblender.Mesh.grid--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- Mesh
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">grid</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">size_x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size_y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">vertices_x</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">vertices_y</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create a Grid.</span>

<span class="sd">    &gt; [!IMPORTANT]</span>
<span class="sd">    &gt; Grid is created with indexing = &#39;ij&#39;: shape = (resolution x, resolution y)</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - size_x (float=1) : size along x</span>
<span class="sd">        _ size_y (float=1) : size along y</span>
<span class="sd">        - vertices_x (int=3) : number of vertices along x</span>
<span class="sd">        - vertices_y (int=3) : number of vertices along y</span>
<span class="sd">        - materials (list of strs = None) : materials list</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - Mesh</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">nx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">vertices_x</span><span class="p">)</span>
    <span class="n">ny</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">vertices_y</span><span class="p">)</span>

    <span class="n">topo</span> <span class="o">=</span> <span class="n">grid_corners</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Base grid for points and uvs</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">size_x</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">size_x</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bfloat</span><span class="p">),</span> 
        <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">size_y</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">size_y</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bfloat</span><span class="p">),</span> 
        <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Let &#39;s build the grid</span>

    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">corners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">))[</span><span class="n">topo</span><span class="p">]</span>
    <span class="n">faces</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">uvmap</span> <span class="o">=</span> <span class="n">grid_uv_map</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">corners</span><span class="p">,</span> <span class="n">faces</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">,</span> <span class="n">UVMap</span><span class="o">=</span><span class="n">uvmap</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.icosphere" class="doc doc-heading">
            <code class=" language-python"><span class="n">icosphere</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">subdivisions</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#npblender.Mesh.icosphere" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a IcoSphere.</p>
<p>Blender constructor for a IcoSphere.</p>
<h5 id="npblender.Mesh.icosphere--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.icosphere--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- radius (float=1.) : radius
- subdivisions (int=2) : number subdivisions
- materials (list of strs = None) : materials list
- transformation (Transformations = None) : the transformation to apply
</code></pre></div>

<h5 id="npblender.Mesh.icosphere--returns">Returns<a class="headerlink" href="#npblender.Mesh.icosphere--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- Mesh
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">icosphere</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">subdivisions</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create a IcoSphere.</span>

<span class="sd">    Blender constructor for a IcoSphere.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - radius (float=1.) : radius</span>
<span class="sd">        - subdivisions (int=2) : number subdivisions</span>
<span class="sd">        - materials (list of strs = None) : materials list</span>
<span class="sd">        - transformation (Transformations = None) : the transformation to apply</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - Mesh</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">subdivisions</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">subdivisions</span><span class="p">)</span>

    <span class="n">mesh</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">mesh</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>
        <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">create_icosphere</span><span class="p">(</span><span class="n">bm</span><span class="p">,</span> <span class="n">subdivisions</span><span class="o">=</span><span class="n">subdivisions</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">calc_uvs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mesh</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.inset_faces" class="doc doc-heading">
            <code class=" language-python"><span class="n">inset_faces</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">use_even_offset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_relative_offset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#npblender.Mesh.inset_faces" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Extrude individual faces.</p>
<p>If offset is None, faces are extruder along their normal</p>
<h5 id="npblender.Mesh.inset_faces--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.inset_faces--arguments" title="Permanent link">&para;</a></h5>
<p>selection : selection on faces
    indices of the faces to inset
thickness : float
    Inset thickness.
depth : float
    Inset depth (extrusion).
use_even_offset : bool
    Keep consistent thickness.
use_relative_offset : bool
    Offset relative to face size.</p>
<h5 id="npblender.Mesh.inset_faces--returns">Returns<a class="headerlink" href="#npblender.Mesh.inset_faces--returns" title="Permanent link">&para;</a></h5>
<p>dict with:
    'faces' : list of new inset faces</p>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span>
<span class="normal">2316</span>
<span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span>
<span class="normal">2326</span>
<span class="normal">2327</span>
<span class="normal">2328</span>
<span class="normal">2329</span>
<span class="normal">2330</span>
<span class="normal">2331</span>
<span class="normal">2332</span>
<span class="normal">2333</span>
<span class="normal">2334</span>
<span class="normal">2335</span>
<span class="normal">2336</span>
<span class="normal">2337</span>
<span class="normal">2338</span>
<span class="normal">2339</span>
<span class="normal">2340</span>
<span class="normal">2341</span>
<span class="normal">2342</span>
<span class="normal">2343</span>
<span class="normal">2344</span>
<span class="normal">2345</span>
<span class="normal">2346</span>
<span class="normal">2347</span>
<span class="normal">2348</span>
<span class="normal">2349</span>
<span class="normal">2350</span>
<span class="normal">2351</span>
<span class="normal">2352</span>
<span class="normal">2353</span>
<span class="normal">2354</span>
<span class="normal">2355</span>
<span class="normal">2356</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">inset_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">use_even_offset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_relative_offset</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Extrude individual faces.</span>

<span class="sd">    If offset is None, faces are extruder along their normal</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    selection : selection on faces</span>
<span class="sd">        indices of the faces to inset</span>
<span class="sd">    thickness : float</span>
<span class="sd">        Inset thickness.</span>
<span class="sd">    depth : float</span>
<span class="sd">        Inset depth (extrusion).</span>
<span class="sd">    use_even_offset : bool</span>
<span class="sd">        Keep consistent thickness.</span>
<span class="sd">    use_relative_offset : bool</span>
<span class="sd">        Offset relative to face size.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict with:</span>
<span class="sd">        &#39;faces&#39; : list of new inset faces</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Selected faces indices</span>
    <span class="n">faces_sel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">selection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">faces_sel</span> <span class="o">=</span> <span class="n">faces_sel</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span>

    <span class="c1"># bmesh edition</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>
        <span class="n">bm</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">ensure_lookup_table</span><span class="p">()</span>

        <span class="c1"># select faces</span>
        <span class="n">start_faces</span> <span class="o">=</span> <span class="p">[</span><span class="n">bm</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">faces_sel</span><span class="p">]</span>

        <span class="n">res</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;top&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;side&#39;</span><span class="p">:</span> <span class="p">[]}</span>

        <span class="c1"># bmesh.ops</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">inset_individual</span><span class="p">(</span>
            <span class="n">bm</span><span class="p">,</span>
            <span class="n">faces</span>               <span class="o">=</span> <span class="n">start_faces</span><span class="p">,</span>
            <span class="n">thickness</span>           <span class="o">=</span> <span class="n">thickness</span><span class="p">,</span>
            <span class="n">depth</span>               <span class="o">=</span> <span class="n">depth</span><span class="p">,</span>
            <span class="n">use_even_offset</span>     <span class="o">=</span> <span class="n">use_even_offset</span><span class="p">,</span>
            <span class="n">use_relative_offset</span> <span class="o">=</span> <span class="n">use_relative_offset</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">res</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;top&#39;</span><span class="p">:</span> <span class="n">faces_sel</span><span class="p">,</span>
            <span class="s1">&#39;side&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">face</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;faces&quot;</span><span class="p">]]</span>
        <span class="p">}</span>

    <span class="k">return</span> <span class="n">res</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.join" class="doc doc-heading">
            <code class=" language-python"><span class="n">join</span><span class="p">(</span><span class="o">*</span><span class="n">others</span><span class="p">)</span></code>

<a href="#npblender.Mesh.join" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Join other Meshes.</p>
<h5 id="npblender.Mesh.join--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.join--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- others (Mesh) : the Mesh to append
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">others</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Join other Meshes.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - others (Mesh) : the Mesh to append</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">others</span><span class="p">:</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Vertices</span>

        <span class="n">v_ofs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Corners</span>

        <span class="n">c_ofs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">corners</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">[</span><span class="n">c_ofs</span><span class="p">:]</span> <span class="o">+=</span> <span class="n">v_ofs</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Faces</span>

        <span class="n">f_ofs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">loop_start</span><span class="p">[</span><span class="n">f_ofs</span><span class="p">:]</span> <span class="o">+=</span> <span class="n">c_ofs</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Edges</span>

        <span class="n">e_ofs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">vertex0</span><span class="p">[</span><span class="n">e_ofs</span><span class="p">:]</span> <span class="o">+=</span> <span class="n">v_ofs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">vertex1</span><span class="p">[</span><span class="n">e_ofs</span><span class="p">:]</span> <span class="o">+=</span> <span class="n">v_ofs</span>

        <span class="c1"># ----- Materials</span>

        <span class="n">remap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">get_material_index</span><span class="p">(</span><span class="n">mat_name</span><span class="p">)</span> <span class="k">for</span> <span class="n">mat_name</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">materials</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">remap</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">material_index</span><span class="p">[</span><span class="n">f_ofs</span><span class="p">:]</span> <span class="o">=</span> <span class="n">remap</span><span class="p">[</span><span class="n">other</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">material_index</span><span class="p">]</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.join_geometry" class="doc doc-heading">
            <code class=" language-python"><span class="n">join_geometry</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">corners</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">safe_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span></code>

<a href="#npblender.Mesh.join_geometry" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Join geometry defined by components.</p>
<p>The geometry passed in argument is consistent and doesn't refer to existing vertices. It is used
to build an independant mesh which is then joined.
See 'add_geometry' which, on the contrary, can refer to existing vertices.</p>
<h5 id="npblender.Mesh.join_geometry--returns">Returns<a class="headerlink" href="#npblender.Mesh.join_geometry--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- self
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">join_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">corners</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">safe_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Join geometry defined by components.</span>

<span class="sd">    The geometry passed in argument is consistent and doesn&#39;t refer to existing vertices. It is used</span>
<span class="sd">    to build an independant mesh which is then joined.</span>
<span class="sd">    See &#39;add_geometry&#39; which, on the contrary, can refer to existing vertices.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - self</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">attr_from</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span>
        <span class="n">points</span><span class="o">=</span><span class="n">points</span><span class="p">,</span> 
        <span class="n">corners</span><span class="o">=</span><span class="n">corners</span><span class="p">,</span> 
        <span class="n">faces</span><span class="o">=</span><span class="n">faces</span><span class="p">,</span> 
        <span class="n">edges</span><span class="o">=</span><span class="n">edges</span><span class="p">,</span>
        <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.line" class="doc doc-heading">
            <code class=" language-python"><span class="n">line</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#npblender.Mesh.line" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a mesh with lines between the given positions.</p>
<h5 id="npblender.Mesh.line--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.line--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="nv">start</span><span class="w"> </span><span class="ss">(</span><span class="nv">vertex</span><span class="w"> </span><span class="o">=</span><span class="ss">(</span><span class="mi">0</span>,<span class="w"> </span><span class="mi">0</span>,<span class="w"> </span><span class="mi">0</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">position</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">start</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">lines</span>
<span class="o">-</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="ss">(</span><span class="nv">vertex</span><span class="o">=</span><span class="ss">(</span><span class="mi">0</span>,<span class="w"> </span><span class="mi">0</span>,<span class="w"> </span><span class="mi">1</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">position</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">lines</span>
<span class="o">-</span><span class="w"> </span><span class="nv">count</span><span class="w"> </span><span class="ss">(</span><span class="nv">int</span><span class="o">=</span><span class="mi">2</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">number</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">points</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">line</span>
</code></pre></div>

<h5 id="npblender.Mesh.line--returns">Returns<a class="headerlink" href="#npblender.Mesh.line--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- mesh (Mesh) : the mesh
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">line</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create a mesh with lines between the given positions.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - start (vertex =(0, 0, 0) : position of the start of the lines</span>
<span class="sd">        - end (vertex=(0, 0, 1) : position of the end of the lines</span>
<span class="sd">        - count (int=2) : number of points in the line</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - mesh (Mesh) : the mesh</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">segments</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">segments</span><span class="p">)</span>

    <span class="n">start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bfloat</span><span class="p">)</span>
    <span class="n">end</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bfloat</span><span class="p">)</span>

    <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">segments</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># shape (segments, n points, 3)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="n">border_edges</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">segments</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="n">col_edges</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>

    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">pos</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">edges</span><span class="o">=</span><span class="n">edges</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.monkey" class="doc doc-heading">
            <code class=" language-python"><span class="n">monkey</span><span class="p">(</span><span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#npblender.Mesh.monkey" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a Monkey.</p>
<h5 id="npblender.Mesh.monkey--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.monkey--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- materials (list of strs = None) : materials list
</code></pre></div>

<h5 id="npblender.Mesh.monkey--returns">Returns<a class="headerlink" href="#npblender.Mesh.monkey--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- MeshBuilder
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">monkey</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create a Monkey.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - materials (list of strs = None) : materials list</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - MeshBuilder</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">mesh</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>
        <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">create_monkey</span><span class="p">(</span><span class="n">bm</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mesh</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.multiply" class="doc doc-heading">
            <code class=" language-python"><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#npblender.Mesh.multiply" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Duplicate the geometry.</p>
<p>Multiplying is a way to efficiently duplicate the geometry a great number of times.
Once duplicated, the vertices can be reshapped to address each instance individually.</p>
<div class="codehilite"><pre><span></span><code><span class="n">count</span> <span class="o">=</span> <span class="mi">16</span>

<span class="n">cube</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">Cube</span><span class="p">()</span> <span class="o">*</span> <span class="n">count</span>

<span class="c1"># Shape the points as 16 blocks of 8 vertices</span>
<span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">cube</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="c1"># Place the cubes in a circle</span>
<span class="n">ags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">points</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ags</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">points</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ags</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>

<span class="n">cube</span><span class="o">.</span><span class="n">to_object</span><span class="p">(</span><span class="s2">&quot;Cubes&quot;</span><span class="p">)</span>
</code></pre></div>

<h5 id="npblender.Mesh.multiply--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.multiply--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="nv">count</span><span class="w"> </span><span class="ss">(</span><span class="nv">int</span><span class="o">=</span><span class="mi">10</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">number</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">instances</span>
<span class="o">-</span><span class="w"> </span><span class="nv">attributes</span><span class="w"> </span><span class="ss">(</span><span class="nv">name</span><span class="o">=</span><span class="nv">value</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">named</span><span class="w"> </span><span class="nv">attributes</span>
</code></pre></div>

<h5 id="npblender.Mesh.multiply--returns">Returns<a class="headerlink" href="#npblender.Mesh.multiply--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- Mesh
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Duplicate the geometry.</span>

<span class="sd">    Multiplying is a way to efficiently duplicate the geometry a great number of times.</span>
<span class="sd">    Once duplicated, the vertices can be reshapped to address each instance individually.</span>

<span class="sd">    ``` python</span>
<span class="sd">    count = 16</span>

<span class="sd">    cube = Mesh.Cube() * count</span>

<span class="sd">    # Shape the points as 16 blocks of 8 vertices</span>
<span class="sd">    points = np.reshape(cube.points.position, (16, 8, 3))</span>

<span class="sd">    # Place the cubes in a circle</span>
<span class="sd">    ags = np.linspace(0, 2*np.pi, count, endpoint=False)</span>
<span class="sd">    points[..., 0] += 6 * np.cos(ags)[:, None]</span>
<span class="sd">    points[..., 1] += 6 * np.sin(ags)[:, None]</span>

<span class="sd">    cube.to_object(&quot;Cubes&quot;)</span>
<span class="sd">    ```</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - count (int=10) : number of instances</span>
<span class="sd">        - attributes (name=value) : value for named attributes</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - Mesh</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Checks and simple cases</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A Mesh can be multiplied only by an int, not &#39;</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">from_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">in_place</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">from_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Vertices</span>

    <span class="n">nverts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Corners</span>

    <span class="n">ncorners</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">vertex_index</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">*</span><span class="n">nverts</span><span class="p">,</span> <span class="n">ncorners</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Faces</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">update_loop_start</span><span class="p">()</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Edges</span>

    <span class="n">nedges</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
    <span class="n">ofs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">*</span><span class="n">nverts</span><span class="p">,</span> <span class="n">nedges</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">vertex0</span> <span class="o">+=</span> <span class="n">ofs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">vertex1</span> <span class="o">+=</span> <span class="n">ofs</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.points_cloud" class="doc doc-heading">
            <code class=" language-python"><span class="n">points_cloud</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#npblender.Mesh.points_cloud" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a mesh with points at the given positions.</p>
<h5 id="npblender.Mesh.points_cloud--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.points_cloud--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- position (shaped array (?, 3)=(0, 0, 0) : position of the points
</code></pre></div>

<h5 id="npblender.Mesh.points_cloud--returns">Returns<a class="headerlink" href="#npblender.Mesh.points_cloud--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- mesh (Mesh) : the mesh
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">points_cloud</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create a mesh with points at the given positions.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - position (shaped array (?, 3)=(0, 0, 0) : position of the points</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - mesh (Mesh) : the mesh</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">points</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.pyramid" class="doc doc-heading">
            <code class=" language-python"><span class="n">pyramid</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#npblender.Mesh.pyramid" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a Pyramid.</p>
<h5 id="npblender.Mesh.pyramid--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.pyramid--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- size (float=1.) : size
</code></pre></div>

<h5 id="npblender.Mesh.pyramid--returns">Returns<a class="headerlink" href="#npblender.Mesh.pyramid--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- Mesh
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">pyramid</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create a Pyramid.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - size (float=1.) : size</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - Mesh</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cone</span><span class="p">(</span><span class="n">vertices</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">radius_bottom</span><span class="o">=</span><span class="n">size</span><span class="o">*</span><span class="mf">0.8660254037844386</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.remove_doubles" class="doc doc-heading">
            <code class=" language-python"><span class="n">remove_doubles</span><span class="p">(</span><span class="n">dist</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span></code>

<a href="#npblender.Mesh.remove_doubles" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Remove doubles.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>-</code>
            </td>
            <td>
                  <code><span title="dist">dist</span>(float=0.001)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>maximum distance between vertices to merge.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2477</span>
<span class="normal">2478</span>
<span class="normal">2479</span>
<span class="normal">2480</span>
<span class="normal">2481</span>
<span class="normal">2482</span>
<span class="normal">2483</span>
<span class="normal">2484</span>
<span class="normal">2485</span>
<span class="normal">2486</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_doubles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mf">.001</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Remove doubles.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        - dist (float=0.001) : maximum distance between vertices to merge.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>
        <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">remove_doubles</span><span class="p">(</span><span class="n">bm</span><span class="p">,</span> <span class="n">verts</span><span class="o">=</span><span class="n">bm</span><span class="o">.</span><span class="n">verts</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.separate_faces" class="doc doc-heading">
            <code class=" language-python"><span class="n">separate_faces</span><span class="p">(</span><span class="n">groups</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#npblender.Mesh.separate_faces" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Split faces into isolated islands</p>
<h5 id="npblender.Mesh.separate_faces--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.separate_faces--arguments" title="Permanent link">&para;</a></h5>
<ul>
<li>groups (list of ints):
    group ids of faces</li>
</ul>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2529</span>
<span class="normal">2530</span>
<span class="normal">2531</span>
<span class="normal">2532</span>
<span class="normal">2533</span>
<span class="normal">2534</span>
<span class="normal">2535</span>
<span class="normal">2536</span>
<span class="normal">2537</span>
<span class="normal">2538</span>
<span class="normal">2539</span>
<span class="normal">2540</span>
<span class="normal">2541</span>
<span class="normal">2542</span>
<span class="normal">2543</span>
<span class="normal">2544</span>
<span class="normal">2545</span>
<span class="normal">2546</span>
<span class="normal">2547</span>
<span class="normal">2548</span>
<span class="normal">2549</span>
<span class="normal">2550</span>
<span class="normal">2551</span>
<span class="normal">2552</span>
<span class="normal">2553</span>
<span class="normal">2554</span>
<span class="normal">2555</span>
<span class="normal">2556</span>
<span class="normal">2557</span>
<span class="normal">2558</span>
<span class="normal">2559</span>
<span class="normal">2560</span>
<span class="normal">2561</span>
<span class="normal">2562</span>
<span class="normal">2563</span>
<span class="normal">2564</span>
<span class="normal">2565</span>
<span class="normal">2566</span>
<span class="normal">2567</span>
<span class="normal">2568</span>
<span class="normal">2569</span>
<span class="normal">2570</span>
<span class="normal">2571</span>
<span class="normal">2572</span>
<span class="normal">2573</span>
<span class="normal">2574</span>
<span class="normal">2575</span>
<span class="normal">2576</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">separate_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Split faces into isolated islands</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    - groups (list of ints):</span>
<span class="sd">        group ids of faces</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">materials</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">)</span>
    <span class="n">attr_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">actual_names</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;loop_total&#39;</span><span class="p">,</span> <span class="s1">&#39;loop_start&#39;</span><span class="p">]]</span>

    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="c1"># No group: each face becomes an island</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>

    <span class="k">if</span> <span class="n">groups</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">attr_names</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">attr_from</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">join_geometry</span><span class="p">(</span>
            <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">],</span>
            <span class="n">corners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">)),</span>
            <span class="n">faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">loop_total</span><span class="p">,</span>
            <span class="o">**</span><span class="n">attrs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="c1"># Faces are grouped with groupds IDs</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>

    <span class="n">groups</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">groups</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">),)</span>   <span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The &#39;groups&#39; argument must be a index per face with a length of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="n">ugroups</span><span class="p">,</span> <span class="n">rev_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">ugroups</span><span class="p">:</span>
        <span class="n">faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="n">ugroups</span><span class="p">[</span><span class="n">rev_index</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">]</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">faces</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">attr_names</span><span class="p">}</span>

        <span class="n">corners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">[</span><span class="n">faces</span><span class="o">.</span><span class="n">get_corner_indices</span><span class="p">()]</span>
        <span class="n">uniques</span><span class="p">,</span> <span class="n">new_corners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">corners</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Mesh</span><span class="p">(</span><span class="n">attr_from</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">join_geometry</span><span class="p">(</span>
            <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">uniques</span><span class="p">],</span>
            <span class="n">corners</span> <span class="o">=</span> <span class="n">new_corners</span><span class="p">,</span>
            <span class="n">faces</span> <span class="o">=</span> <span class="n">faces</span><span class="o">.</span><span class="n">loop_total</span><span class="p">,</span>
            <span class="o">**</span><span class="n">attrs</span><span class="p">,</span>
        <span class="p">))</span>

    <span class="k">return</span> <span class="n">mesh</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.solidify" class="doc doc-heading">
            <code class=" language-python"><span class="n">solidify</span><span class="p">(</span><span class="n">thickness</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">offset</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>

<a href="#npblender.Mesh.solidify" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Boolean difference with another MeshBuilder.</p>
<p>The methods uses the Solidify Modifier</p>
<div class="codehilite"><pre><span></span><code><span class="n">glass</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="n">segments</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
<span class="n">glass</span><span class="o">.</span><span class="n">extrude_faces</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">.01</span><span class="p">)</span>
<span class="n">glass</span><span class="o">.</span><span class="n">extrude_faces</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<span class="n">glass</span><span class="o">.</span><span class="n">extrude_faces</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">.01</span><span class="p">)</span>

<span class="n">glass</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">translate</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="n">glass</span> <span class="o">=</span> <span class="n">glass</span><span class="o">.</span><span class="n">solidify</span><span class="p">(</span><span class="n">thickness</span><span class="o">=</span><span class="mf">.1</span><span class="p">)</span>

<span class="n">glass</span><span class="o">.</span><span class="n">to_object</span><span class="p">(</span><span class="s2">&quot;Solidify&quot;</span><span class="p">,</span> <span class="n">shade_smooth</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<h5 id="npblender.Mesh.solidify--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.solidify--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- thickness (float=.01) : thickness
- offset (float=-1) : offset
</code></pre></div>

<h5 id="npblender.Mesh.solidify--returns">Returns<a class="headerlink" href="#npblender.Mesh.solidify--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- MeshBuilder : the result of the solidify operation
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2431</span>
<span class="normal">2432</span>
<span class="normal">2433</span>
<span class="normal">2434</span>
<span class="normal">2435</span>
<span class="normal">2436</span>
<span class="normal">2437</span>
<span class="normal">2438</span>
<span class="normal">2439</span>
<span class="normal">2440</span>
<span class="normal">2441</span>
<span class="normal">2442</span>
<span class="normal">2443</span>
<span class="normal">2444</span>
<span class="normal">2445</span>
<span class="normal">2446</span>
<span class="normal">2447</span>
<span class="normal">2448</span>
<span class="normal">2449</span>
<span class="normal">2450</span>
<span class="normal">2451</span>
<span class="normal">2452</span>
<span class="normal">2453</span>
<span class="normal">2454</span>
<span class="normal">2455</span>
<span class="normal">2456</span>
<span class="normal">2457</span>
<span class="normal">2458</span>
<span class="normal">2459</span>
<span class="normal">2460</span>
<span class="normal">2461</span>
<span class="normal">2462</span>
<span class="normal">2463</span>
<span class="normal">2464</span>
<span class="normal">2465</span>
<span class="normal">2466</span>
<span class="normal">2467</span>
<span class="normal">2468</span>
<span class="normal">2469</span>
<span class="normal">2470</span>
<span class="normal">2471</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">solidify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mf">.01</span><span class="p">,</span> <span class="n">offset</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Boolean difference with another MeshBuilder.</span>

<span class="sd">    The methods uses the Solidify Modifier</span>

<span class="sd">    ``` python</span>
<span class="sd">    glass = Mesh.Circle(segments=128)</span>
<span class="sd">    glass.extrude_faces(0, -.01)</span>
<span class="sd">    glass.extrude_faces(0, -2)</span>
<span class="sd">    glass.extrude_faces(0, -.01)</span>

<span class="sd">    glass.points.translate((0, 0, 2))</span>

<span class="sd">    glass = glass.solidify(thickness=.1)</span>

<span class="sd">    glass.to_object(&quot;Solidify&quot;, shade_smooth=True)</span>
<span class="sd">    ```</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - thickness (float=.01) : thickness</span>
<span class="sd">        - offset (float=-1) : offset</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - MeshBuilder : the result of the solidify operation</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">()</span> <span class="k">as</span> <span class="n">obj</span><span class="p">:</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;Solidify&quot;</span><span class="p">,</span> <span class="s1">&#39;SOLIDIFY&#39;</span><span class="p">)</span>

        <span class="n">mod</span><span class="o">.</span><span class="n">thickness</span>       <span class="o">=</span> <span class="n">thickness</span>
        <span class="n">mod</span><span class="o">.</span><span class="n">use_even_offset</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">mod</span><span class="o">.</span><span class="n">offset</span>          <span class="o">=</span> <span class="n">offset</span>

        <span class="c1"># Apply modifier</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">modifier_apply</span><span class="p">(</span><span class="n">modifier</span><span class="o">=</span><span class="n">mod</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mesh</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.solidify_socle" class="doc doc-heading">
            <code class=" language-python"><span class="n">solidify_socle</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bottom_material_index</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

<a href="#npblender.Mesh.solidify_socle" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>The mesh is supposed to be a grid.</p>
<p>The socle is buit by extruding the external edges to the value z.</p>
<h5 id="npblender.Mesh.solidify_socle--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.solidify_socle--arguments" title="Permanent link">&para;</a></h5>
<ul>
<li>shape (tuple of ints) : the grid shade</li>
<li>z (float) : socle base z</li>
<li>bottom_material_index (int = 0) : base face material index</li>
<li>attributes (dict) : attributes to faces</li>
</ul>
<h5 id="npblender.Mesh.solidify_socle--returns">Returns<a class="headerlink" href="#npblender.Mesh.solidify_socle--returns" title="Permanent link">&para;</a></h5>
<ul>
<li>bottom face index (int) : the index of bottom face</li>
</ul>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2362</span>
<span class="normal">2363</span>
<span class="normal">2364</span>
<span class="normal">2365</span>
<span class="normal">2366</span>
<span class="normal">2367</span>
<span class="normal">2368</span>
<span class="normal">2369</span>
<span class="normal">2370</span>
<span class="normal">2371</span>
<span class="normal">2372</span>
<span class="normal">2373</span>
<span class="normal">2374</span>
<span class="normal">2375</span>
<span class="normal">2376</span>
<span class="normal">2377</span>
<span class="normal">2378</span>
<span class="normal">2379</span>
<span class="normal">2380</span>
<span class="normal">2381</span>
<span class="normal">2382</span>
<span class="normal">2383</span>
<span class="normal">2384</span>
<span class="normal">2385</span>
<span class="normal">2386</span>
<span class="normal">2387</span>
<span class="normal">2388</span>
<span class="normal">2389</span>
<span class="normal">2390</span>
<span class="normal">2391</span>
<span class="normal">2392</span>
<span class="normal">2393</span>
<span class="normal">2394</span>
<span class="normal">2395</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">solidify_socle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bottom_material_index</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; The mesh is supposed to be a grid.</span>

<span class="sd">    The socle is buit by extruding the external edges to the value z.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    - shape (tuple of ints) : the grid shade</span>
<span class="sd">    - z (float) : socle base z</span>
<span class="sd">    - bottom_material_index (int = 0) : base face material index</span>
<span class="sd">    - attributes (dict) : attributes to faces</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    - bottom face index (int) : the index of bottom face</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>

    <span class="n">loop1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">inds</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">loop1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loop1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]))</span>
    <span class="n">loop1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loop1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">0</span><span class="p">]))</span>

    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">loop1</span><span class="p">])</span>
    <span class="n">points</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span>

    <span class="n">loop0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_points</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">corners</span><span class="o">=</span><span class="n">loop0</span><span class="p">)</span> <span class="c1">#, faces=len(loop0))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">bridge_loops</span><span class="p">(</span><span class="n">loop0</span><span class="p">,</span> <span class="n">loop1</span><span class="p">,</span> <span class="n">close</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">_ensure_optional_field</span><span class="p">(</span><span class="s2">&quot;material_index&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;faces&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">material_index</span> <span class="o">=</span> <span class="n">bottom_material_index</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.to_curve_REVIEW" class="doc doc-heading">
            <code class=" language-python"><span class="n">to_curve_REVIEW</span><span class="p">()</span></code>

<a href="#npblender.Mesh.to_curve_REVIEW" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <blockquote>
<p>Convert mesh to curve</p>
</blockquote>
<p>Simple conversion when edges domain is defined</p>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2955</span>
<span class="normal">2956</span>
<span class="normal">2957</span>
<span class="normal">2958</span>
<span class="normal">2959</span>
<span class="normal">2960</span>
<span class="normal">2961</span>
<span class="normal">2962</span>
<span class="normal">2963</span>
<span class="normal">2964</span>
<span class="normal">2965</span>
<span class="normal">2966</span>
<span class="normal">2967</span>
<span class="normal">2968</span>
<span class="normal">2969</span>
<span class="normal">2970</span>
<span class="normal">2971</span>
<span class="normal">2972</span>
<span class="normal">2973</span>
<span class="normal">2974</span>
<span class="normal">2975</span>
<span class="normal">2976</span>
<span class="normal">2977</span>
<span class="normal">2978</span>
<span class="normal">2979</span>
<span class="normal">2980</span>
<span class="normal">2981</span>
<span class="normal">2982</span>
<span class="normal">2983</span>
<span class="normal">2984</span>
<span class="normal">2985</span>
<span class="normal">2986</span>
<span class="normal">2987</span>
<span class="normal">2988</span>
<span class="normal">2989</span>
<span class="normal">2990</span>
<span class="normal">2991</span>
<span class="normal">2992</span>
<span class="normal">2993</span>
<span class="normal">2994</span>
<span class="normal">2995</span>
<span class="normal">2996</span>
<span class="normal">2997</span>
<span class="normal">2998</span>
<span class="normal">2999</span>
<span class="normal">3000</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_curve_REVIEW</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; &gt; Convert mesh to curve</span>

<span class="sd">    Simple conversion when edges domain is defined</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">npblender</span><span class="w"> </span><span class="kn">import</span> <span class="n">Curve</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">splines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
        <span class="n">v0</span><span class="p">,</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">edge</span><span class="o">.</span><span class="n">vertex0</span><span class="p">,</span> <span class="n">edge</span><span class="o">.</span><span class="n">vertex1</span>

        <span class="n">ok</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">spline</span> <span class="ow">in</span> <span class="n">splines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">spline</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">spline</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">v0</span> <span class="o">==</span> <span class="n">spline</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">spline</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span>
                <span class="n">ok</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">v0</span> <span class="o">==</span> <span class="n">spline</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">spline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
                <span class="n">ok</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="n">v1</span> <span class="o">==</span> <span class="n">spline</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">spline</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">v0</span><span class="p">)</span>
                <span class="n">ok</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">v1</span> <span class="o">==</span> <span class="n">spline</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">spline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v0</span><span class="p">)</span>
                <span class="n">ok</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
            <span class="n">splines</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">v0</span><span class="p">,</span> <span class="n">v1</span><span class="p">])</span>

    <span class="n">curve</span> <span class="o">=</span> <span class="n">Curve</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">spline</span> <span class="ow">in</span> <span class="n">splines</span><span class="p">:</span>
        <span class="n">cyclic</span> <span class="o">=</span> <span class="n">spline</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">spline</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">cyclic</span><span class="p">:</span>
            <span class="n">spline</span> <span class="o">=</span> <span class="n">spline</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">curve</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">spline</span><span class="p">],</span> <span class="n">curve_type</span><span class="o">=</span><span class="s1">&#39;POLY&#39;</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="n">cyclic</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">curve</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.to_mesh_data" class="doc doc-heading">
            <code class=" language-python"><span class="n">to_mesh_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

<a href="#npblender.Mesh.to_mesh_data" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Write the geometry into a Blender Mesh</p>
<h5 id="npblender.Mesh.to_mesh_data--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.to_mesh_data--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- mesh (Blender Mesh instance) : the mesh to write
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_mesh_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Write the geometry into a Blender Mesh</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - mesh (Blender Mesh instance) : the mesh to write</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">npblender</span><span class="w"> </span><span class="kn">import</span> <span class="n">blender</span>

    <span class="n">bl_mesh</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">bl_mesh</span><span class="o">.</span><span class="n">clear_geometry</span><span class="p">()</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Materials</span>

    <span class="n">bl_mesh</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">mat_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mat_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bl_mesh</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mat_name</span><span class="p">))</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Vertices</span>

    <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
        <span class="n">bl_mesh</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">))</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Corners</span>

    <span class="n">corners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">):</span>
        <span class="n">bl_mesh</span><span class="o">.</span><span class="n">loops</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">))</span>
        <span class="n">bl_mesh</span><span class="o">.</span><span class="n">loops</span><span class="o">.</span><span class="n">foreach_set</span><span class="p">(</span><span class="s2">&quot;vertex_index&quot;</span><span class="p">,</span> <span class="n">blender</span><span class="o">.</span><span class="n">int_array</span><span class="p">(</span><span class="n">corners</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">))</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Faces</span>

    <span class="n">faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">faces</span><span class="p">):</span>
        <span class="n">bl_mesh</span><span class="o">.</span><span class="n">polygons</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">faces</span><span class="p">))</span>
        <span class="n">bl_mesh</span><span class="o">.</span><span class="n">polygons</span><span class="o">.</span><span class="n">foreach_set</span><span class="p">(</span><span class="s2">&quot;loop_start&quot;</span><span class="p">,</span> <span class="n">blender</span><span class="o">.</span><span class="n">int_array</span><span class="p">(</span><span class="n">faces</span><span class="o">.</span><span class="n">loop_start</span><span class="p">))</span>
        <span class="n">bl_mesh</span><span class="o">.</span><span class="n">polygons</span><span class="o">.</span><span class="n">foreach_set</span><span class="p">(</span><span class="s2">&quot;loop_total&quot;</span><span class="p">,</span> <span class="n">blender</span><span class="o">.</span><span class="n">int_array</span><span class="p">(</span><span class="n">faces</span><span class="o">.</span><span class="n">loop_total</span><span class="p">))</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Edges</span>

    <span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">):</span>
        <span class="c1"># edges to add</span>
        <span class="n">add_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">vertices</span>

        <span class="c1"># edges have been created by faces</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">faces</span><span class="p">):</span>
            <span class="n">bl_mesh</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

            <span class="n">cur_n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bl_mesh</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cur_n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">cur_n</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bint</span><span class="p">)</span>
                <span class="n">bl_mesh</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">foreach_get</span><span class="p">(</span><span class="s1">&#39;vertices&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>

            <span class="n">add_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">add_edges</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># add the edges</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>
        <span class="n">bl_mesh</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

        <span class="n">bl_mesh</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">foreach_set</span><span class="p">(</span><span class="s1">&#39;vertices&#39;</span><span class="p">,</span> <span class="n">add_edges</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Attributes</span>

    <span class="n">attributes</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">attributes</span>

    <span class="n">points</span><span class="o">.</span><span class="n">to_bl_attributes</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">corners</span><span class="o">.</span><span class="n">to_bl_attributes</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">faces</span><span class="o">.</span><span class="n">to_bl_attributes</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">edges</span><span class="o">.</span><span class="n">to_bl_attributes</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Update</span>

    <span class="n">bl_mesh</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.to_object" class="doc doc-heading">
            <code class=" language-python"><span class="n">to_object</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">shade_smooth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shapekeys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#npblender.Mesh.to_object" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create or update a blender object.</p>
<p>The method 'to_object' creates the whole geometry. It creates a new object if it doesn't already exist.
If the object exists, it must be a mesh, there is no object type conversion.</p>
<p>Once the object is created, use the method 'update_object' to change the vertices.</p>
<h5 id="npblender.Mesh.to_object--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.to_object--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- obj (str or Blender object) : the object the create
</code></pre></div>

<h5 id="npblender.Mesh.to_object--returns">Returns<a class="headerlink" href="#npblender.Mesh.to_object--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- Blender mesh object
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">shade_smooth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shapekeys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create or update a blender object.</span>

<span class="sd">    The method &#39;to_object&#39; creates the whole geometry. It creates a new object if it doesn&#39;t already exist.</span>
<span class="sd">    If the object exists, it must be a mesh, there is no object type conversion.</span>

<span class="sd">    Once the object is created, use the method &#39;update_object&#39; to change the vertices.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - obj (str or Blender object) : the object the create</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - Blender mesh object</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">npblender</span><span class="w"> </span><span class="kn">import</span> <span class="n">blender</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">create_mesh_object</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">to_mesh_data</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">shade_smooth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">res</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">polygons</span><span class="o">.</span><span class="n">foreach_set</span><span class="p">(</span><span class="s1">&#39;use_smooth&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">shade_smooth</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">polygons</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">shapekeys</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">shapekeys</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shapekeys</span><span class="p">,</span> <span class="n">ShapeKeys</span><span class="p">):</span>
                <span class="n">shapekeys</span><span class="o">.</span><span class="n">to_mesh_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">sks</span> <span class="ow">in</span> <span class="n">shapekeys</span><span class="p">:</span>
                    <span class="n">sks</span><span class="o">.</span><span class="n">to_mesh_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">res</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.torus" class="doc doc-heading">
            <code class=" language-python"><span class="n">torus</span><span class="p">(</span><span class="n">major_segments</span><span class="o">=</span><span class="mi">48</span><span class="p">,</span> <span class="n">minor_segments</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">major_radius</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">minor_radius</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#npblender.Mesh.torus" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a Torus.</p>
<h5 id="npblender.Mesh.torus--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.torus--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="k">-</span> major_segments (int=48) : number of segments for the major radius
<span class="k">-</span> minor_segments (int=12) : number of segments for the minor radius
<span class="k">-</span> major_radius (float=1.) : major radius
<span class="k">-</span> minor_radius (float=.25) : minor radius
<span class="k">-</span> materials (list of strs = None) : materials list
<span class="k">-</span> transformation (Transformations = None) : the transformation to apply
</code></pre></div>

<h5 id="npblender.Mesh.torus--returns">Returns<a class="headerlink" href="#npblender.Mesh.torus--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- Mesh
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">torus</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">major_segments</span><span class="o">=</span><span class="mi">48</span><span class="p">,</span> <span class="n">minor_segments</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">major_radius</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">minor_radius</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create a Torus.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - major_segments (int=48) : number of segments for the major radius</span>
<span class="sd">        - minor_segments (int=12) : number of segments for the minor radius</span>
<span class="sd">        - major_radius (float=1.) : major radius</span>
<span class="sd">        - minor_radius (float=.25) : minor radius</span>
<span class="sd">        - materials (list of strs = None) : materials list</span>
<span class="sd">        - transformation (Transformations = None) : the transformation to apply</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - Mesh</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Major backbone</span>
    <span class="n">maj_ag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">major_segments</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bfloat</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="c1"># + pi to match blender uv</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">major_radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">maj_ag</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">major_radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">maj_ag</span><span class="p">)</span>
    <span class="n">zeros</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="n">transfos</span> <span class="o">=</span> <span class="n">Transformation</span><span class="o">.</span><span class="n">from_components</span><span class="p">(</span>
        <span class="n">translation</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">zeros</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> 
        <span class="n">rotation</span><span class="o">=</span><span class="n">Rotation</span><span class="o">.</span><span class="n">from_euler</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">zeros</span><span class="p">,</span> <span class="n">zeros</span><span class="p">,</span> <span class="n">maj_ag</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="c1"># Minor section</span>
    <span class="n">min_ag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">minor_segments</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bfloat</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="c1"># + pi to match blender uv</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">minor_radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">min_ag</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">minor_radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">min_ag</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="n">circle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Transform the circle</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">transfos</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">@</span> <span class="n">circle</span>

    <span class="c1"># Generate the faces</span>
    <span class="n">corners</span> <span class="o">=</span> <span class="n">grid_corners</span><span class="p">(</span><span class="n">major_segments</span><span class="p">,</span> <span class="n">minor_segments</span><span class="p">,</span> <span class="n">close_x</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">close_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Get the uv map</span>
    <span class="n">uvmap</span> <span class="o">=</span> <span class="n">grid_uv_map</span><span class="p">(</span><span class="n">major_segments</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">minor_segments</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">points</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">corners</span><span class="o">=</span><span class="n">corners</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">faces</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">UVMap</span><span class="o">=</span><span class="n">uvmap</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.uvsphere" class="doc doc-heading">
            <code class=" language-python"><span class="n">uvsphere</span><span class="p">(</span><span class="n">segments</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">rings</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#npblender.Mesh.uvsphere" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a uv sphere.</p>
<h5 id="npblender.Mesh.uvsphere--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.uvsphere--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- segments (int=32) : number of segments
- rings (int=16) : number of rings
- radius (float=1.) : radius
- materials (list of strs = None) : materials list
- transformation (Transformations = None) : the transformation to apply
</code></pre></div>

<h5 id="npblender.Mesh.uvsphere--returns">Returns<a class="headerlink" href="#npblender.Mesh.uvsphere--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- Mesh
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">uvsphere</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">rings</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create a uv sphere.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - segments (int=32) : number of segments</span>
<span class="sd">        - rings (int=16) : number of rings</span>
<span class="sd">        - radius (float=1.) : radius</span>
<span class="sd">        - materials (list of strs = None) : materials list</span>
<span class="sd">        - transformation (Transformations = None) : the transformation to apply</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - Mesh</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">mesh</span><span class="o">.</span><span class="n">bmesh</span><span class="p">()</span> <span class="k">as</span> <span class="n">bm</span><span class="p">:</span>
        <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">create_uvsphere</span><span class="p">(</span><span class="n">bm</span><span class="p">,</span> <span class="n">u_segments</span><span class="o">=</span><span class="n">segments</span><span class="p">,</span> <span class="n">v_segments</span><span class="o">=</span><span class="n">rings</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">calc_uvs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mesh</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Mesh.vectors_field" class="doc doc-heading">
            <code class=" language-python"><span class="n">vectors_field</span><span class="p">(</span><span class="n">locations</span><span class="p">,</span> <span class="n">vectors</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">scale_length</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mf">24.0</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">head</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">adjust_norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#npblender.Mesh.vectors_field" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create an arrow at each location corresponding to the vectors.</p>
<p>The arrow length is equal to the corresponding vector lengths.
The arrow radius is constant and equal to the value passe in argument for lengths greater that
the argument scale_length. When the length is less than this value, the arrow is scaled down.</p>
<p>Use the adjust_norm argument to transform the vector lengths to arrows lengths.</p>
<h5 id="npblender.Mesh.vectors_field--arguments">Arguments<a class="headerlink" href="#npblender.Mesh.vectors_field--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="k">-</span> locations (array of 3-vectors) : vectors locations
<span class="k">-</span> vectors (array of 3 vectors) : vectors to visualize
<span class="k">-</span> radius (float = .05) : arrow radius
<span class="k">-</span> angle (float = 24) : head radius in degrees
<span class="k">-</span> segments (int = 8) : number of segments for the section
<span class="k">-</span> head (mesh = None) : mesh model for the head. Create a cone if None
<span class="k">-</span> adjust_norm (max length or function = None) : max arrow length or function transforming
    the vector length into arrow length
<span class="k">-</span> scale_length (float = 1.) : arrow length below which the arrow radius is scaled
</code></pre></div>

<h5 id="npblender.Mesh.vectors_field--returns">Returns<a class="headerlink" href="#npblender.Mesh.vectors_field--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- Mesh Object
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/mesh.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">vectors_field</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">locations</span><span class="p">,</span> <span class="n">vectors</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">.05</span><span class="p">,</span> <span class="n">scale_length</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mf">24.</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">head</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">adjust_norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create an arrow at each location corresponding to the vectors.</span>

<span class="sd">    The arrow length is equal to the corresponding vector lengths.</span>
<span class="sd">    The arrow radius is constant and equal to the value passe in argument for lengths greater that</span>
<span class="sd">    the argument scale_length. When the length is less than this value, the arrow is scaled down.</span>

<span class="sd">    Use the adjust_norm argument to transform the vector lengths to arrows lengths.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - locations (array of 3-vectors) : vectors locations</span>
<span class="sd">        - vectors (array of 3 vectors) : vectors to visualize</span>
<span class="sd">        - radius (float = .05) : arrow radius</span>
<span class="sd">        - angle (float = 24) : head radius in degrees</span>
<span class="sd">        - segments (int = 8) : number of segments for the section</span>
<span class="sd">        - head (mesh = None) : mesh model for the head. Create a cone if None</span>
<span class="sd">        - adjust_norm (max length or function = None) : max arrow length or function transforming</span>
<span class="sd">            the vector length into arrow length</span>
<span class="sd">        - scale_length (float = 1.) : arrow length below which the arrow radius is scaled</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - Mesh Object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">locations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span>
    <span class="n">vectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">vectors</span><span class="p">)</span>

    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="c1"># Vector lengths</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span>

    <span class="n">lengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vectors</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">is_null</span> <span class="o">=</span> <span class="n">lengths</span> <span class="o">&lt;</span> <span class="mf">.00001</span>
    <span class="n">lengths</span><span class="p">[</span><span class="n">is_null</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">v_dir</span> <span class="o">=</span> <span class="n">vectors</span> <span class="o">/</span> <span class="n">lengths</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">adjust_norm</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span><span class="p">:</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="n">adjust_norm</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">adjust_norm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">adjust_norm</span><span class="p">,</span> <span class="n">lengths</span><span class="p">)</span>
    <span class="n">lengths</span><span class="p">[</span><span class="n">is_null</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vectors</span> <span class="o">=</span> <span class="n">v_dir</span><span class="o">*</span><span class="n">lengths</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>

    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="c1"># Arrow head</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>

    <span class="n">head_radius</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">radius</span>
    <span class="n">head_height</span> <span class="o">=</span> <span class="n">head_radius</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">head</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cone</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cone</span><span class="p">(</span>
            <span class="n">vertices</span> <span class="o">=</span> <span class="n">segments</span><span class="p">,</span> 
            <span class="n">side_segments</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
            <span class="n">fill_segments</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
            <span class="n">radius_top</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> 
            <span class="n">radius_bottom</span> <span class="o">=</span> <span class="n">head_radius</span><span class="p">,</span> 
            <span class="n">depth</span> <span class="o">=</span> <span class="n">head_height</span><span class="p">,</span> 
            <span class="n">fill_type</span> <span class="o">=</span> <span class="s1">&#39;FANS&#39;</span><span class="p">,</span> 
            <span class="n">materials</span> <span class="o">=</span> <span class="n">materials</span><span class="p">)</span>
        <span class="n">cone</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">z</span> <span class="o">+=</span> <span class="n">head_height</span><span class="o">/</span><span class="mi">10</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cone</span> <span class="o">=</span> <span class="n">head</span>
        <span class="n">head_height</span> <span class="o">=</span> <span class="n">cone</span><span class="o">.</span><span class="n">bounding_box_dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># Head top point is z=0</span>
    <span class="n">v0</span><span class="p">,</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">cone</span><span class="o">.</span><span class="n">bounding_box</span>
    <span class="n">cone</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">z</span> <span class="o">-=</span> <span class="n">v1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="c1"># Small arrows: Vectors whose length &lt; min_length</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>

    <span class="c1"># Minimum length</span>
    <span class="c1"># Below this length, the arrow is scaled</span>

    <span class="n">min_length</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">head_height</span>

    <span class="c1"># Small and long arrows if any</span>
    <span class="n">small_arrows</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
    <span class="n">long_arrows</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>

    <span class="n">small</span> <span class="o">=</span> <span class="n">lengths</span> <span class="o">&lt;</span> <span class="n">min_length</span>
    <span class="n">nsmalls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">small</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">nsmalls</span><span class="p">:</span>
        <span class="c1"># shaft height = head height</span>
        <span class="n">cyl_height</span> <span class="o">=</span> <span class="n">min_length</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">.01</span>
        <span class="n">arrow</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cylinder</span><span class="p">(</span><span class="n">vertices</span><span class="o">=</span><span class="n">segments</span><span class="p">,</span> <span class="n">side_segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">cyl_height</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">)</span>
        <span class="n">arrow</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">z</span> <span class="o">+=</span> <span class="n">cyl_height</span><span class="o">/</span><span class="mi">2</span>

        <span class="c1"># Join the head</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_mesh</span><span class="p">(</span><span class="n">cone</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">z</span> <span class="o">+=</span> <span class="n">min_length</span>

        <span class="n">arrow</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

        <span class="c1"># Duplicate the geometry            </span>
        <span class="n">small_arrows</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">*</span><span class="n">nsmalls</span>
        <span class="n">small_arrows</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nsmalls</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrow</span><span class="o">.</span><span class="n">points</span><span class="p">))</span>

        <span class="c1"># Rotate, scale and translate</span>
        <span class="n">lg</span> <span class="o">=</span> <span class="n">lengths</span><span class="p">[</span><span class="n">small</span><span class="p">]</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">lg</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">lg</span><span class="p">),</span> <span class="n">lg</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">small_arrows</span><span class="o">.</span><span class="n">transformation</span><span class="p">(</span>
            <span class="n">rotation</span> <span class="o">=</span> <span class="n">Rotation</span><span class="o">.</span><span class="n">look_at</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">vectors</span><span class="p">[</span><span class="n">small</span><span class="p">])[:,</span> <span class="kc">None</span><span class="p">],</span> 
            <span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span> 
            <span class="n">translation</span> <span class="o">=</span> <span class="n">locations</span><span class="p">[</span><span class="n">small</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="n">small_arrows</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>


    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="c1"># Long arrows</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>

    <span class="n">long</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">small</span><span class="p">)</span>
    <span class="n">nlongs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span> <span class="o">-</span> <span class="n">nsmalls</span>
    <span class="k">if</span> <span class="n">nlongs</span><span class="p">:</span>

        <span class="c1"># Shaft model with a normalized height = 1</span>
        <span class="n">shaft</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cylinder</span><span class="p">(</span><span class="n">vertices</span><span class="o">=</span><span class="n">segments</span><span class="p">,</span> <span class="n">side_segments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">materials</span><span class="o">=</span><span class="n">materials</span><span class="p">)</span>
        <span class="n">shaft</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">z</span> <span class="o">+=</span> <span class="mf">.5</span>

        <span class="c1"># We duplicate and transform the shafts with a scale long z</span>
        <span class="n">long_arrows</span> <span class="o">=</span> <span class="n">shaft</span><span class="o">*</span><span class="n">nlongs</span>
        <span class="n">long_arrows</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nlongs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">shaft</span><span class="o">.</span><span class="n">points</span><span class="p">))</span>

        <span class="n">lg</span> <span class="o">=</span> <span class="n">lengths</span><span class="p">[</span><span class="n">long</span><span class="p">]</span> <span class="o">-</span> <span class="n">head_height</span> <span class="o">+</span> <span class="mf">.01</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">lg</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">lg</span><span class="p">),</span> <span class="n">lg</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">long_arrows</span><span class="o">.</span><span class="n">transformation</span><span class="p">(</span>
            <span class="n">rotation</span> <span class="o">=</span> <span class="n">Rotation</span><span class="o">.</span><span class="n">look_at</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">vectors</span><span class="p">[</span><span class="n">long</span><span class="p">])[:,</span> <span class="kc">None</span><span class="p">],</span> 
            <span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span> 
            <span class="n">translation</span> <span class="o">=</span> <span class="n">locations</span><span class="p">[</span><span class="n">long</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="n">long_arrows</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># We duplicate and tranform the heads with no scale</span>
        <span class="n">heads</span> <span class="o">=</span> <span class="n">cone</span><span class="o">*</span><span class="n">nlongs</span>
        <span class="n">heads</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nlongs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cone</span><span class="o">.</span><span class="n">points</span><span class="p">))</span>
        <span class="n">heads</span><span class="o">.</span><span class="n">transformation</span><span class="p">(</span>
            <span class="n">rotation</span> <span class="o">=</span> <span class="n">Rotation</span><span class="o">.</span><span class="n">look_at</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">vectors</span><span class="p">[</span><span class="n">long</span><span class="p">])[:,</span> <span class="kc">None</span><span class="p">],</span> 
            <span class="n">translation</span> <span class="o">=</span> <span class="n">locations</span><span class="p">[</span><span class="n">long</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">+</span> <span class="n">vectors</span><span class="p">[</span><span class="n">long</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="n">heads</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">long_arrows</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">heads</span><span class="p">)</span>

    <span class="c1"># Let&#39;s join the result</span>
    <span class="n">arrows</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
    <span class="n">arrows</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">small_arrows</span><span class="p">,</span> <span class="n">long_arrows</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">arrows</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="npblender.Meshes" class="doc doc-heading">
            <code>Meshes</code>


<a href="#npblender.Meshes" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Geometry (npblender.geometry.Geometry)" href="#npblender.Geometry">Geometry</a></code></p>









              <details class="quote">
                <summary>Source code in <code>npblender/instances.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Meshes</span><span class="p">(</span><span class="n">Geometry</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mesh_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attr_from</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Instances based on mesh buckets.</span>

<span class="sd">        Instances is best for managing a high number of instances with a low number</span>
<span class="sd">        of models.</span>
<span class="sd">        Meshes manages one mesh per point</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - mesh (Mesh) : the mesh containing the geometry</span>
<span class="sd">            - mesh_id (int = None) : mesh points attribute defining the instances</span>
<span class="sd">            - attr_from (Geometry) : geometry where to capture attributes from</span>
<span class="sd">            - **attributes (dict) : other geometry attributes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span>  <span class="o">=</span> <span class="n">Point</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">join_attributes</span><span class="p">(</span><span class="n">attr_from</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_init_buckets</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">mesh_id</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Utilities</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;Meshes: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">, total vertices: </span><span class="si">{</span><span class="mi">0</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="kc">None</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="p">)</span><span class="si">}</span><span class="s2">&gt;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Loop on the buckets</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">bucket</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">buckets</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">offset</span>
            <span class="n">offset</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Init buckets</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_init_buckets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">mesh_id</span><span class="p">):</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">.mesh</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mesh</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">mesh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buckets</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">buckets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">make_buckets</span><span class="p">(</span><span class="n">mesh_id</span><span class="p">)</span>
            <span class="n">npoints</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">buckets</span><span class="p">])</span>

            <span class="c1"># Position of each mesh</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">npoints</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bfloat</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">offset</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">bucket</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">position</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">bucket</span><span class="p">)]</span> <span class="o">=</span> <span class="n">pos</span>

                <span class="c1"># Put the mesh at center (position is captured by points.position)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">bucket</span><span class="p">]</span> <span class="o">-=</span> <span class="n">pos</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Check</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Meshes Check&quot;</span><span class="p">,</span> <span class="n">halt</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">npoints</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">buckets</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">npoints</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The numbers of points </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="p">)</span><span class="si">}</span><span class="s2"> in the mesh is different from the buckets length </span><span class="si">{</span><span class="n">npoints</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">halt</span><span class="p">:</span>
                <span class="k">assert</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Get the mesh ids</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mesh_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mesh_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bint</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">mesh_id</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">bucket</span><span class="p">)]</span> <span class="o">=</span> <span class="n">index</span>
        <span class="k">return</span> <span class="n">mesh_id</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># From meshes</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_meshes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">meshes</span><span class="p">):</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">.mesh</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mesh</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">meshes</span><span class="p">,</span> <span class="n">Meshes</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;meshes argument is not Meshes &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">meshes</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>

        <span class="n">m</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">attr_from</span><span class="o">=</span><span class="n">meshes</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_mesh</span><span class="p">(</span><span class="n">meshes</span><span class="o">.</span><span class="n">mesh</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">buckets</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">meshes</span><span class="o">.</span><span class="n">buckets</span><span class="p">]</span>
        <span class="n">m</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">meshes</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;COPY&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">m</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># From islands</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_mesh_islands</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">mesh</span><span class="p">):</span>
        <span class="n">face_islands</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">get_islands</span><span class="p">()</span>
        <span class="n">islands</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">compute_attribute_on_domain</span><span class="p">(</span><span class="s2">&quot;faces&quot;</span><span class="p">,</span> <span class="n">face_islands</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">mesh_id</span><span class="o">=</span><span class="n">islands</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Serialization</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;geometry&#39;</span><span class="p">:</span>   <span class="s1">&#39;Meshes&#39;</span><span class="p">,</span>
            <span class="s1">&#39;points&#39;</span><span class="p">:</span>     <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
            <span class="s1">&#39;mesh&#39;</span><span class="p">:</span>       <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
            <span class="s1">&#39;buckets&#39;</span><span class="p">:</span>    <span class="bp">self</span><span class="o">.</span><span class="n">buckets</span><span class="p">,</span>
            <span class="p">}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.mesh</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mesh</span>

        <span class="n">meshes</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">meshes</span><span class="o">.</span><span class="n">points</span>     <span class="o">=</span> <span class="n">Point</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">])</span>
        <span class="n">meshes</span><span class="o">.</span><span class="n">mesh</span>       <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">])</span>
        <span class="n">meshes</span><span class="o">.</span><span class="n">buckets</span>    <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;buckets&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">meshes</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># To mesh</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">realize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">.mesh</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mesh</span>

        <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_mesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">)</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">join_fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>

        <span class="n">attr_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">actual_names</span> <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;position&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">offset</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>

            <span class="n">sl</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">offset</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">bucket</span><span class="p">))</span>
            <span class="c1"># Transfer the attrbutes</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">attr_names</span><span class="p">:</span>
                <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">bucket</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">bucket</span><span class="p">),</span> <span class="kc">None</span><span class="p">]</span>

            <span class="c1"># Transformation</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">has_rotation</span><span class="p">:</span>
                <span class="n">rot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">rotation</span><span class="p">[</span><span class="n">sl</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rot</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scale&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">scale</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span><span class="p">[</span><span class="n">sl</span><span class="p">]</span>

            <span class="n">transfo</span> <span class="o">=</span> <span class="n">Transformation</span><span class="o">.</span><span class="n">from_components</span><span class="p">(</span>
                <span class="n">rotation</span> <span class="o">=</span> <span class="n">rot</span><span class="p">,</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span><span class="p">,</span>
                <span class="n">translation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">sl</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">bucket</span><span class="p">]</span> <span class="o">=</span> <span class="n">transfo</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">@</span> <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">bucket</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">mesh</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Joining meshes</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">others</span><span class="p">):</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">.mesh</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mesh</span>

        <span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">others</span><span class="p">:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Meshes</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Meshes can be joined with Meshes only, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">mesh</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ob</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">buckets</span><span class="p">:</span>
                <span class="n">ok</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sb</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buckets</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">ob</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">sb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">buckets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sb</span><span class="p">,</span> <span class="n">ob</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">ok</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">buckets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ob</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Multiply</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="n">count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">attr_from</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">in_place</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">attr_from</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Multiply the buckets</span>
        <span class="n">npoints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buckets</span><span class="p">)):</span>
            <span class="n">bucket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buckets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">n</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">bucket</span> <span class="o">=</span> <span class="n">bucket</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">*</span><span class="n">npoints</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buckets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">count</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>

        <span class="c1"># Multiply the points and the mesh        </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Operations</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clear_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">.mesh</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mesh</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">()</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">buckets</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Set an attribute on mesh points</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_mesh_points_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>

        <span class="c1"># Will raise en error if attribute doesn&#39; exist</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

        <span class="c1"># _infos can be accessed securely</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">_infos</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;shape&#39;</span><span class="p">])</span>

        <span class="c1"># Loop on the buckets</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">bucket</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">buckets</span><span class="p">:</span>
            <span class="n">attr</span><span class="p">[</span><span class="n">bucket</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">bucket</span><span class="p">),</span> <span class="kc">None</span><span class="p">]</span>
            <span class="n">offset</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="npblender.Meshes.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mesh_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attr_from</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">)</span></code>

<a href="#npblender.Meshes.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Instances based on mesh buckets.</p>
<p>Instances is best for managing a high number of instances with a low number
of models.
Meshes manages one mesh per point</p>
<h5 id="npblender.Meshes.__init__--arguments">Arguments<a class="headerlink" href="#npblender.Meshes.__init__--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="k">-</span> mesh (Mesh) : the mesh containing the geometry
<span class="k">-</span> mesh_id (int = None) : mesh points attribute defining the instances
<span class="k">-</span> attr_from (Geometry) : geometry where to capture attributes from
<span class="k">-</span> **attributes (dict) : other geometry attributes
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/instances.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mesh_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attr_from</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Instances based on mesh buckets.</span>

<span class="sd">    Instances is best for managing a high number of instances with a low number</span>
<span class="sd">    of models.</span>
<span class="sd">    Meshes manages one mesh per point</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - mesh (Mesh) : the mesh containing the geometry</span>
<span class="sd">        - mesh_id (int = None) : mesh points attribute defining the instances</span>
<span class="sd">        - attr_from (Geometry) : geometry where to capture attributes from</span>
<span class="sd">        - **attributes (dict) : other geometry attributes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">points</span>  <span class="o">=</span> <span class="n">Point</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">join_attributes</span><span class="p">(</span><span class="n">attr_from</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_init_buckets</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">mesh_id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="npblender.MultiResGrid" class="doc doc-heading">
            <code>MultiResGrid</code>


<a href="#npblender.MultiResGrid" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="npblender.mesh.Mesh" href="mesh/#npblender.mesh.Mesh">Mesh</a></code></p>


        <p>Multi resolution grid</p>
<p>A surface defined by a function of two parameters u and v.
The function can return either a vector or an altitude, u and being interpretated as (x, y).</p>
<p>The grid resolution is defined by a depth when calling the method update_grid.
The method accepts a camera to adapt its the resolution only to the visible parts.</p>
<h4 id="npblender.MultiResGrid--arguments">Arguments<a class="headerlink" href="#npblender.MultiResGrid--arguments" title="Permanent link">&para;</a></h4>
<ul>
<li>shape (2-tuple of ints) : initial division</li>
<li>u_space (2-tuple of floats) : u min and max values</li>
<li>v_space (2-tuple of floats) : v min and max values</li>
<li>is_altitude (bool = False) : the function returns z only vector is built with (u, v) as (x, y)</li>
</ul>








              <details class="quote">
                <summary>Source code in <code>npblender/multiresgrid.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MultiResGrid</span><span class="p">(</span><span class="n">Mesh</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Multi resolution grid</span>

<span class="sd">    A surface defined by a function of two parameters u and v.</span>
<span class="sd">    The function can return either a vector or an altitude, u and being interpretated as (x, y).</span>

<span class="sd">    The grid resolution is defined by a depth when calling the method update_grid.</span>
<span class="sd">    The method accepts a camera to adapt its the resolution only to the visible parts.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    - shape (2-tuple of ints) : initial division</span>
<span class="sd">    - u_space (2-tuple of floats) : u min and max values</span>
<span class="sd">    - v_space (2-tuple of floats) : v min and max values</span>
<span class="sd">    - is_altitude (bool = False) : the function returns z only vector is built with (u, v) as (x, y)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">u_space</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">v_space</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">is_altitude</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">normal_func</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">U</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_altitude</span> <span class="o">=</span> <span class="n">is_altitude</span>

        <span class="k">if</span> <span class="n">normal_func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">use_normals</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">use_normals</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normal_func</span> <span class="o">=</span> <span class="n">normal_func</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">uv_shape</span> <span class="o">=</span> <span class="n">shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ufac</span> <span class="o">=</span> <span class="n">u_space</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">u_space</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">u_space</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vfac</span> <span class="o">=</span> <span class="n">v_space</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v_space</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v_space</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_grid</span><span class="p">()</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Call the surface function</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">call_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Call the surface function</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        - u (array of floats) : u value</span>
<span class="sd">        - v (array of floats) : v value</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        - array of vectors</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u0</span> <span class="o">+</span> <span class="n">u</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ufac</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v0</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">vfac</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_altitude</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="p">,))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="p">,))</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Get the normals to the surface</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_normals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Call the surface function</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        - u (array of floats) : u value</span>
<span class="sd">        - v (array of floats) : v value</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        - array of vectors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_normals</span><span class="p">:</span>

            <span class="n">shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u0</span> <span class="o">+</span> <span class="n">u</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ufac</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v0</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">vfac</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="p">,))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Compute the normals</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_normals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">du</span><span class="p">,</span> <span class="n">dv</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Compute the face normals</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;normal_func&#39;</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u0</span> <span class="o">+</span> <span class="n">u</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ufac</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v0</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">vfac</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="p">,))</span>

        <span class="c1">#dx, dy = du*self.ufac, dv*self.vfac</span>

        <span class="n">O</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_func</span><span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">du</span><span class="p">,</span> <span class="n">v</span> <span class="o">-</span> <span class="n">dv</span><span class="p">)</span>
        <span class="n">I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_func</span><span class="p">(</span><span class="n">u</span> <span class="o">+</span> <span class="n">du</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">-</span> <span class="n">O</span>
        <span class="n">J</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_func</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">+</span> <span class="n">dv</span><span class="p">)</span> <span class="o">-</span> <span class="n">O</span>

        <span class="n">vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">J</span><span class="p">)</span>
        <span class="n">vecs</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vecs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">vecs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="p">,))</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Update the grid with the given depth</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">camera</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_vertices</span><span class="o">=</span><span class="mi">10_000_000</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="mf">.05</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Update the grid resolution with the given depth</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        - depth (int) : maximum depth</span>
<span class="sd">        - camera (Camera) : camera to compute visible faces</span>
<span class="sd">        - max_vertices (int = 10_000_000) : maximum number of vertices</span>
<span class="sd">        - max_size (float = .05) : maximum size of faces</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">normals_done</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Prepare</span>

        <span class="n">du</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">uv_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uv_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">du</span>

        <span class="n">dv</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">uv_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uv_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">dv</span>

        <span class="n">U</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="n">vecs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_func</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">)</span>

        <span class="n">verts</span> <span class="o">=</span> <span class="n">FieldArray</span><span class="p">()</span>
        <span class="n">verts</span><span class="o">.</span><span class="n">new_field</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">,</span> <span class="n">bfloat</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">verts</span><span class="o">.</span><span class="n">new_field</span><span class="p">(</span><span class="s2">&quot;size&quot;</span><span class="p">,</span>     <span class="n">bfloat</span><span class="p">)</span>
        <span class="n">verts</span><span class="o">.</span><span class="n">new_field</span><span class="p">(</span><span class="s2">&quot;u&quot;</span><span class="p">,</span>        <span class="n">bfloat</span><span class="p">)</span>
        <span class="n">verts</span><span class="o">.</span><span class="n">new_field</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">,</span>        <span class="n">bfloat</span><span class="p">)</span>
        <span class="n">verts</span><span class="o">.</span><span class="n">new_field</span><span class="p">(</span><span class="s2">&quot;du&quot;</span><span class="p">,</span>       <span class="n">bfloat</span><span class="p">)</span>
        <span class="n">verts</span><span class="o">.</span><span class="n">new_field</span><span class="p">(</span><span class="s2">&quot;dv&quot;</span><span class="p">,</span>       <span class="n">bfloat</span><span class="p">)</span>

        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uv_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">uv_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ufac</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uv_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vfac</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uv_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">du</span> <span class="o">/=</span> <span class="mi">2</span>
        <span class="n">dv</span> <span class="o">/=</span> <span class="mi">2</span>
        <span class="n">verts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">vecs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="n">size</span>     <span class="o">=</span> <span class="n">size</span><span class="p">,</span>
            <span class="n">u</span>        <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n</span><span class="p">),</span>
            <span class="n">v</span>        <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n</span><span class="p">),</span>
            <span class="n">du</span>       <span class="o">=</span> <span class="n">du</span><span class="p">,</span>
            <span class="n">dv</span>       <span class="o">=</span> <span class="n">dv</span><span class="p">)</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Loop on depth</span>

        <span class="c1">#final = verts.clone(empty=True)</span>
        <span class="n">final</span> <span class="o">=</span> <span class="n">FieldArray</span><span class="p">()</span><span class="o">.</span><span class="n">join_fields</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idepth</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth</span><span class="p">):</span>

            <span class="n">normals</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">final</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">normals_done</span><span class="p">:</span>
                <span class="n">normals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_normals</span><span class="p">(</span><span class="n">verts</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="n">verts</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">du</span><span class="p">,</span> <span class="n">dv</span><span class="p">)</span>
                <span class="n">normals_done</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">camera</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">p_vis</span><span class="p">,</span> <span class="n">p_size</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">visible_points</span><span class="p">(</span><span class="n">verts</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">verts</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">normals</span><span class="o">=</span><span class="n">normals</span><span class="p">)</span>
                <span class="n">vis</span> <span class="o">=</span> <span class="n">p_vis</span><span class="p">[:,</span> <span class="n">camera</span><span class="o">.</span><span class="n">VISIBLE</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">normals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">vis</span> <span class="o">&amp;=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">p_vis</span><span class="p">[:,</span> <span class="n">camera</span><span class="o">.</span><span class="n">BACK_FACE</span><span class="p">])</span>
                <span class="n">vis</span> <span class="o">&amp;=</span> <span class="n">p_size</span><span class="p">[:,</span> <span class="n">camera</span><span class="o">.</span><span class="n">SIZE</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">max_size</span>
                <span class="k">del</span> <span class="n">p_vis</span><span class="p">,</span> <span class="n">p_size</span>

                <span class="n">final</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">verts</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">vis</span><span class="p">)])</span>
                <span class="c1">#verts = verts.extract(vis)</span>
                <span class="n">verts</span> <span class="o">=</span> <span class="n">FieldArray</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="n">vis</span><span class="p">)</span>

            <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">count</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="n">size</span> <span class="o">/=</span> <span class="mi">2</span>
            <span class="n">du</span> <span class="o">/=</span> <span class="mi">2</span>
            <span class="n">dv</span> <span class="o">/=</span> <span class="mi">2</span>

            <span class="n">verts</span><span class="o">.</span><span class="n">du</span><span class="p">,</span> <span class="n">verts</span><span class="o">.</span><span class="n">dv</span> <span class="o">=</span> <span class="n">du</span><span class="p">,</span> <span class="n">dv</span>

            <span class="c1">#new_verts = verts.clone(empty=True)</span>
            <span class="n">new_verts</span> <span class="o">=</span> <span class="n">FieldArray</span><span class="p">()</span><span class="o">.</span><span class="n">join_fields</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>
            <span class="n">new_verts</span><span class="o">.</span><span class="n">set_buffer_size</span><span class="p">(</span><span class="n">count</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span>

            <span class="n">new_verts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">size</span> <span class="o">=</span> <span class="n">size</span><span class="p">,</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">verts</span><span class="o">.</span><span class="n">u</span> <span class="o">-</span> <span class="n">du</span><span class="p">,</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">verts</span><span class="o">.</span><span class="n">v</span> <span class="o">-</span> <span class="n">dv</span><span class="p">,</span>
                <span class="n">du</span> <span class="o">=</span> <span class="n">du</span><span class="p">,</span>
                <span class="n">dv</span> <span class="o">=</span> <span class="n">dv</span>
            <span class="p">)</span>
            <span class="n">new_verts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">size</span> <span class="o">=</span> <span class="n">size</span><span class="p">,</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">verts</span><span class="o">.</span><span class="n">u</span> <span class="o">+</span> <span class="n">du</span><span class="p">,</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">verts</span><span class="o">.</span><span class="n">v</span> <span class="o">-</span> <span class="n">dv</span><span class="p">,</span>
                <span class="n">du</span> <span class="o">=</span> <span class="n">du</span><span class="p">,</span>
                <span class="n">dv</span> <span class="o">=</span> <span class="n">dv</span>
            <span class="p">)</span>
            <span class="n">new_verts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">size</span> <span class="o">=</span> <span class="n">size</span><span class="p">,</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">verts</span><span class="o">.</span><span class="n">u</span> <span class="o">+</span> <span class="n">du</span><span class="p">,</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">verts</span><span class="o">.</span><span class="n">v</span> <span class="o">+</span> <span class="n">dv</span><span class="p">,</span>
                <span class="n">du</span> <span class="o">=</span> <span class="n">du</span><span class="p">,</span>
                <span class="n">dv</span> <span class="o">=</span> <span class="n">dv</span>
            <span class="p">)</span>
            <span class="n">new_verts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">size</span> <span class="o">=</span> <span class="n">size</span><span class="p">,</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">verts</span><span class="o">.</span><span class="n">u</span> <span class="o">-</span> <span class="n">du</span><span class="p">,</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">verts</span><span class="o">.</span><span class="n">v</span> <span class="o">+</span> <span class="n">dv</span><span class="p">,</span>
                <span class="n">du</span> <span class="o">=</span> <span class="n">du</span><span class="p">,</span>
                <span class="n">dv</span> <span class="o">=</span> <span class="n">dv</span>
            <span class="p">)</span>

            <span class="n">new_verts</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_func</span><span class="p">(</span><span class="n">new_verts</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="n">new_verts</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>

            <span class="k">del</span> <span class="n">verts</span>
            <span class="n">verts</span> <span class="o">=</span> <span class="n">new_verts</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">final</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_vertices</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Compute the vertices in the quads centered on the points</span>

        <span class="n">final</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">verts</span>
        <span class="n">nfinal</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">final</span><span class="p">)</span>

        <span class="n">Ul</span> <span class="o">=</span> <span class="n">final</span><span class="o">.</span><span class="n">u</span> <span class="o">-</span> <span class="n">final</span><span class="o">.</span><span class="n">du</span>
        <span class="n">Ur</span> <span class="o">=</span> <span class="n">final</span><span class="o">.</span><span class="n">u</span> <span class="o">+</span> <span class="n">final</span><span class="o">.</span><span class="n">du</span>
        <span class="n">U4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">Ul</span><span class="p">,</span> <span class="n">Ur</span><span class="p">,</span> <span class="n">Ur</span><span class="p">,</span> <span class="n">Ul</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">Ul</span><span class="p">,</span> <span class="n">Ur</span>

        <span class="n">Vb</span> <span class="o">=</span> <span class="n">final</span><span class="o">.</span><span class="n">v</span> <span class="o">-</span> <span class="n">final</span><span class="o">.</span><span class="n">dv</span>
        <span class="n">Vt</span> <span class="o">=</span> <span class="n">final</span><span class="o">.</span><span class="n">v</span> <span class="o">+</span> <span class="n">final</span><span class="o">.</span><span class="n">dv</span>
        <span class="n">V4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">Vb</span><span class="p">,</span> <span class="n">Vb</span><span class="p">,</span> <span class="n">Vt</span><span class="p">,</span> <span class="n">Vt</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">Vb</span><span class="p">,</span> <span class="n">Vt</span>

        <span class="n">corners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nfinal</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span>

        <span class="n">UV</span><span class="p">,</span> <span class="n">inv</span> <span class="o">=</span> <span class="n">merge_by_distance_2D</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">U4</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">V4</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">precision</span><span class="o">=</span><span class="p">(</span><span class="n">du</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">dv</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_func</span><span class="p">(</span><span class="n">UV</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">UV</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">corners</span> <span class="o">=</span> <span class="n">inv</span><span class="p">[</span><span class="n">corners</span><span class="p">]</span>

        <span class="c1"># ----- To mesh</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clear_geometry</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">,</span>
            <span class="n">corners</span> <span class="o">=</span> <span class="n">corners</span><span class="p">,</span>
            <span class="n">faces</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
            <span class="n">UVMap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">U4</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">V4</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Demo function</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sphere_demo</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">sphere</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">):</span>
            <span class="n">ct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">cp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
            <span class="n">sp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">cp</span><span class="o">*</span><span class="n">ct</span><span class="p">,</span> <span class="n">cp</span><span class="o">*</span><span class="n">st</span><span class="p">,</span> <span class="n">sp</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">sphere</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">u_space</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">v_space</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">demo_sphere</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">.camera</span><span class="w"> </span><span class="kn">import</span> <span class="n">Camera</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.engine</span><span class="w"> </span><span class="kn">import</span> <span class="n">engine</span>

        <span class="n">sphere</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">sphere_demo</span><span class="p">()</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">():</span>
            <span class="n">sphere</span><span class="o">.</span><span class="n">update_grid</span><span class="p">(</span>
                <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span>
                <span class="n">camera</span><span class="o">=</span><span class="n">Camera</span><span class="p">(),</span> 
                <span class="n">max_vertices</span><span class="o">=</span><span class="mi">10_000_000</span><span class="p">,</span> 
                <span class="n">max_size</span><span class="o">=</span><span class="mf">.05</span><span class="p">)</span>

            <span class="n">sphere</span><span class="o">.</span><span class="n">to_object</span><span class="p">(</span><span class="s2">&quot;MR Sphere&quot;</span><span class="p">,</span> <span class="n">shade_smooth</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">engine</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">update</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">demo_terrain</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">.camera</span><span class="w"> </span><span class="kn">import</span> <span class="n">Camera</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.engine</span><span class="w"> </span><span class="kn">import</span> <span class="n">engine</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.maths.perlin</span><span class="w"> </span><span class="kn">import</span> <span class="n">noise</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">altitude</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">noise</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">octaves</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">lacunarity</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">algo</span><span class="o">=</span><span class="s1">&#39;hetero&#39;</span><span class="p">)</span>

        <span class="n">surface</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">altitude</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">u_space</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">v_space</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">is_altitude</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">():</span>
            <span class="n">surface</span><span class="o">.</span><span class="n">update_grid</span><span class="p">(</span>
                <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span>
                <span class="n">camera</span><span class="o">=</span><span class="n">Camera</span><span class="p">(),</span> 
                <span class="n">max_vertices</span><span class="o">=</span><span class="mi">10_000_000</span><span class="p">,</span> 
                <span class="n">max_size</span><span class="o">=</span><span class="mf">.01</span><span class="p">)</span>

            <span class="n">surface</span><span class="o">.</span><span class="n">to_object</span><span class="p">(</span><span class="s2">&quot;Terrain&quot;</span><span class="p">,</span> <span class="n">shade_smooth</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">engine</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="n">update</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="npblender.MultiResGrid.call_func" class="doc doc-heading">
            <code class=" language-python"><span class="n">call_func</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span></code>

<a href="#npblender.MultiResGrid.call_func" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Call the surface function</p>
<h5 id="npblender.MultiResGrid.call_func--arguments">Arguments<a class="headerlink" href="#npblender.MultiResGrid.call_func--arguments" title="Permanent link">&para;</a></h5>
<ul>
<li>u (array of floats) : u value</li>
<li>v (array of floats) : v value</li>
</ul>
<h5 id="npblender.MultiResGrid.call_func--returns">Returns<a class="headerlink" href="#npblender.MultiResGrid.call_func--returns" title="Permanent link">&para;</a></h5>
<ul>
<li>array of vectors</li>
</ul>


            <details class="quote">
              <summary>Source code in <code>npblender/multiresgrid.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">call_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Call the surface function</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    - u (array of floats) : u value</span>
<span class="sd">    - v (array of floats) : v value</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    - array of vectors</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u0</span> <span class="o">+</span> <span class="n">u</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ufac</span>
    <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v0</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">vfac</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_altitude</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="p">,))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="p">,))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.MultiResGrid.compute_normals" class="doc doc-heading">
            <code class=" language-python"><span class="n">compute_normals</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">du</span><span class="p">,</span> <span class="n">dv</span><span class="p">)</span></code>

<a href="#npblender.MultiResGrid.compute_normals" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute the face normals</p>


            <details class="quote">
              <summary>Source code in <code>npblender/multiresgrid.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_normals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">du</span><span class="p">,</span> <span class="n">dv</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Compute the face normals</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;normal_func&#39;</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u0</span> <span class="o">+</span> <span class="n">u</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ufac</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v0</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">vfac</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="p">,))</span>

    <span class="c1">#dx, dy = du*self.ufac, dv*self.vfac</span>

    <span class="n">O</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_func</span><span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">du</span><span class="p">,</span> <span class="n">v</span> <span class="o">-</span> <span class="n">dv</span><span class="p">)</span>
    <span class="n">I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_func</span><span class="p">(</span><span class="n">u</span> <span class="o">+</span> <span class="n">du</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">-</span> <span class="n">O</span>
    <span class="n">J</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_func</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">+</span> <span class="n">dv</span><span class="p">)</span> <span class="o">-</span> <span class="n">O</span>

    <span class="n">vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">J</span><span class="p">)</span>
    <span class="n">vecs</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vecs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">vecs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="p">,))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.MultiResGrid.get_normals" class="doc doc-heading">
            <code class=" language-python"><span class="n">get_normals</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span></code>

<a href="#npblender.MultiResGrid.get_normals" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Call the surface function</p>
<h5 id="npblender.MultiResGrid.get_normals--arguments">Arguments<a class="headerlink" href="#npblender.MultiResGrid.get_normals--arguments" title="Permanent link">&para;</a></h5>
<ul>
<li>u (array of floats) : u value</li>
<li>v (array of floats) : v value</li>
</ul>
<h5 id="npblender.MultiResGrid.get_normals--returns">Returns<a class="headerlink" href="#npblender.MultiResGrid.get_normals--returns" title="Permanent link">&para;</a></h5>
<ul>
<li>array of vectors</li>
</ul>


            <details class="quote">
              <summary>Source code in <code>npblender/multiresgrid.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_normals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Call the surface function</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    - u (array of floats) : u value</span>
<span class="sd">    - v (array of floats) : v value</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    - array of vectors</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_normals</span><span class="p">:</span>

        <span class="n">shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u0</span> <span class="o">+</span> <span class="n">u</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ufac</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v0</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">vfac</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="p">,))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.MultiResGrid.update_grid" class="doc doc-heading">
            <code class=" language-python"><span class="n">update_grid</span><span class="p">(</span><span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">camera</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_vertices</span><span class="o">=</span><span class="mi">10000000</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span></code>

<a href="#npblender.MultiResGrid.update_grid" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Update the grid resolution with the given depth</p>
<h5 id="npblender.MultiResGrid.update_grid--arguments">Arguments<a class="headerlink" href="#npblender.MultiResGrid.update_grid--arguments" title="Permanent link">&para;</a></h5>
<ul>
<li>depth (int) : maximum depth</li>
<li>camera (Camera) : camera to compute visible faces</li>
<li>max_vertices (int = 10_000_000) : maximum number of vertices</li>
<li>max_size (float = .05) : maximum size of faces</li>
</ul>


            <details class="quote">
              <summary>Source code in <code>npblender/multiresgrid.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">camera</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_vertices</span><span class="o">=</span><span class="mi">10_000_000</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="mf">.05</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Update the grid resolution with the given depth</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    - depth (int) : maximum depth</span>
<span class="sd">    - camera (Camera) : camera to compute visible faces</span>
<span class="sd">    - max_vertices (int = 10_000_000) : maximum number of vertices</span>
<span class="sd">    - max_size (float = .05) : maximum size of faces</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">normals_done</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Prepare</span>

    <span class="n">du</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">uv_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uv_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">du</span>

    <span class="n">dv</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">uv_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uv_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">dv</span>

    <span class="n">U</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="n">vecs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_func</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">)</span>

    <span class="n">verts</span> <span class="o">=</span> <span class="n">FieldArray</span><span class="p">()</span>
    <span class="n">verts</span><span class="o">.</span><span class="n">new_field</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">,</span> <span class="n">bfloat</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">verts</span><span class="o">.</span><span class="n">new_field</span><span class="p">(</span><span class="s2">&quot;size&quot;</span><span class="p">,</span>     <span class="n">bfloat</span><span class="p">)</span>
    <span class="n">verts</span><span class="o">.</span><span class="n">new_field</span><span class="p">(</span><span class="s2">&quot;u&quot;</span><span class="p">,</span>        <span class="n">bfloat</span><span class="p">)</span>
    <span class="n">verts</span><span class="o">.</span><span class="n">new_field</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">,</span>        <span class="n">bfloat</span><span class="p">)</span>
    <span class="n">verts</span><span class="o">.</span><span class="n">new_field</span><span class="p">(</span><span class="s2">&quot;du&quot;</span><span class="p">,</span>       <span class="n">bfloat</span><span class="p">)</span>
    <span class="n">verts</span><span class="o">.</span><span class="n">new_field</span><span class="p">(</span><span class="s2">&quot;dv&quot;</span><span class="p">,</span>       <span class="n">bfloat</span><span class="p">)</span>

    <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uv_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">uv_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ufac</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uv_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vfac</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uv_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">du</span> <span class="o">/=</span> <span class="mi">2</span>
    <span class="n">dv</span> <span class="o">/=</span> <span class="mi">2</span>
    <span class="n">verts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">position</span> <span class="o">=</span> <span class="n">vecs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
        <span class="n">size</span>     <span class="o">=</span> <span class="n">size</span><span class="p">,</span>
        <span class="n">u</span>        <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n</span><span class="p">),</span>
        <span class="n">v</span>        <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n</span><span class="p">),</span>
        <span class="n">du</span>       <span class="o">=</span> <span class="n">du</span><span class="p">,</span>
        <span class="n">dv</span>       <span class="o">=</span> <span class="n">dv</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Loop on depth</span>

    <span class="c1">#final = verts.clone(empty=True)</span>
    <span class="n">final</span> <span class="o">=</span> <span class="n">FieldArray</span><span class="p">()</span><span class="o">.</span><span class="n">join_fields</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">idepth</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth</span><span class="p">):</span>

        <span class="n">normals</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">final</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">normals_done</span><span class="p">:</span>
            <span class="n">normals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_normals</span><span class="p">(</span><span class="n">verts</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="n">verts</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">du</span><span class="p">,</span> <span class="n">dv</span><span class="p">)</span>
            <span class="n">normals_done</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">camera</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">p_vis</span><span class="p">,</span> <span class="n">p_size</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">visible_points</span><span class="p">(</span><span class="n">verts</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">verts</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">normals</span><span class="o">=</span><span class="n">normals</span><span class="p">)</span>
            <span class="n">vis</span> <span class="o">=</span> <span class="n">p_vis</span><span class="p">[:,</span> <span class="n">camera</span><span class="o">.</span><span class="n">VISIBLE</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">normals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">vis</span> <span class="o">&amp;=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">p_vis</span><span class="p">[:,</span> <span class="n">camera</span><span class="o">.</span><span class="n">BACK_FACE</span><span class="p">])</span>
            <span class="n">vis</span> <span class="o">&amp;=</span> <span class="n">p_size</span><span class="p">[:,</span> <span class="n">camera</span><span class="o">.</span><span class="n">SIZE</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">max_size</span>
            <span class="k">del</span> <span class="n">p_vis</span><span class="p">,</span> <span class="n">p_size</span>

            <span class="n">final</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">verts</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">vis</span><span class="p">)])</span>
            <span class="c1">#verts = verts.extract(vis)</span>
            <span class="n">verts</span> <span class="o">=</span> <span class="n">FieldArray</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="n">vis</span><span class="p">)</span>

        <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">count</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="n">size</span> <span class="o">/=</span> <span class="mi">2</span>
        <span class="n">du</span> <span class="o">/=</span> <span class="mi">2</span>
        <span class="n">dv</span> <span class="o">/=</span> <span class="mi">2</span>

        <span class="n">verts</span><span class="o">.</span><span class="n">du</span><span class="p">,</span> <span class="n">verts</span><span class="o">.</span><span class="n">dv</span> <span class="o">=</span> <span class="n">du</span><span class="p">,</span> <span class="n">dv</span>

        <span class="c1">#new_verts = verts.clone(empty=True)</span>
        <span class="n">new_verts</span> <span class="o">=</span> <span class="n">FieldArray</span><span class="p">()</span><span class="o">.</span><span class="n">join_fields</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>
        <span class="n">new_verts</span><span class="o">.</span><span class="n">set_buffer_size</span><span class="p">(</span><span class="n">count</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span>

        <span class="n">new_verts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">size</span><span class="p">,</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">verts</span><span class="o">.</span><span class="n">u</span> <span class="o">-</span> <span class="n">du</span><span class="p">,</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">verts</span><span class="o">.</span><span class="n">v</span> <span class="o">-</span> <span class="n">dv</span><span class="p">,</span>
            <span class="n">du</span> <span class="o">=</span> <span class="n">du</span><span class="p">,</span>
            <span class="n">dv</span> <span class="o">=</span> <span class="n">dv</span>
        <span class="p">)</span>
        <span class="n">new_verts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">size</span><span class="p">,</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">verts</span><span class="o">.</span><span class="n">u</span> <span class="o">+</span> <span class="n">du</span><span class="p">,</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">verts</span><span class="o">.</span><span class="n">v</span> <span class="o">-</span> <span class="n">dv</span><span class="p">,</span>
            <span class="n">du</span> <span class="o">=</span> <span class="n">du</span><span class="p">,</span>
            <span class="n">dv</span> <span class="o">=</span> <span class="n">dv</span>
        <span class="p">)</span>
        <span class="n">new_verts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">size</span><span class="p">,</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">verts</span><span class="o">.</span><span class="n">u</span> <span class="o">+</span> <span class="n">du</span><span class="p">,</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">verts</span><span class="o">.</span><span class="n">v</span> <span class="o">+</span> <span class="n">dv</span><span class="p">,</span>
            <span class="n">du</span> <span class="o">=</span> <span class="n">du</span><span class="p">,</span>
            <span class="n">dv</span> <span class="o">=</span> <span class="n">dv</span>
        <span class="p">)</span>
        <span class="n">new_verts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">size</span><span class="p">,</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">verts</span><span class="o">.</span><span class="n">u</span> <span class="o">-</span> <span class="n">du</span><span class="p">,</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">verts</span><span class="o">.</span><span class="n">v</span> <span class="o">+</span> <span class="n">dv</span><span class="p">,</span>
            <span class="n">du</span> <span class="o">=</span> <span class="n">du</span><span class="p">,</span>
            <span class="n">dv</span> <span class="o">=</span> <span class="n">dv</span>
        <span class="p">)</span>

        <span class="n">new_verts</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_func</span><span class="p">(</span><span class="n">new_verts</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="n">new_verts</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>

        <span class="k">del</span> <span class="n">verts</span>
        <span class="n">verts</span> <span class="o">=</span> <span class="n">new_verts</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">final</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_vertices</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Compute the vertices in the quads centered on the points</span>

    <span class="n">final</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">verts</span>
    <span class="n">nfinal</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">final</span><span class="p">)</span>

    <span class="n">Ul</span> <span class="o">=</span> <span class="n">final</span><span class="o">.</span><span class="n">u</span> <span class="o">-</span> <span class="n">final</span><span class="o">.</span><span class="n">du</span>
    <span class="n">Ur</span> <span class="o">=</span> <span class="n">final</span><span class="o">.</span><span class="n">u</span> <span class="o">+</span> <span class="n">final</span><span class="o">.</span><span class="n">du</span>
    <span class="n">U4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">Ul</span><span class="p">,</span> <span class="n">Ur</span><span class="p">,</span> <span class="n">Ur</span><span class="p">,</span> <span class="n">Ul</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">Ul</span><span class="p">,</span> <span class="n">Ur</span>

    <span class="n">Vb</span> <span class="o">=</span> <span class="n">final</span><span class="o">.</span><span class="n">v</span> <span class="o">-</span> <span class="n">final</span><span class="o">.</span><span class="n">dv</span>
    <span class="n">Vt</span> <span class="o">=</span> <span class="n">final</span><span class="o">.</span><span class="n">v</span> <span class="o">+</span> <span class="n">final</span><span class="o">.</span><span class="n">dv</span>
    <span class="n">V4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">Vb</span><span class="p">,</span> <span class="n">Vb</span><span class="p">,</span> <span class="n">Vt</span><span class="p">,</span> <span class="n">Vt</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">Vb</span><span class="p">,</span> <span class="n">Vt</span>

    <span class="n">corners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nfinal</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span>

    <span class="n">UV</span><span class="p">,</span> <span class="n">inv</span> <span class="o">=</span> <span class="n">merge_by_distance_2D</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">U4</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">V4</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">precision</span><span class="o">=</span><span class="p">(</span><span class="n">du</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">dv</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_func</span><span class="p">(</span><span class="n">UV</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">UV</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">corners</span> <span class="o">=</span> <span class="n">inv</span><span class="p">[</span><span class="n">corners</span><span class="p">]</span>

    <span class="c1"># ----- To mesh</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">clear_geometry</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">,</span>
        <span class="n">corners</span> <span class="o">=</span> <span class="n">corners</span><span class="p">,</span>
        <span class="n">faces</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
        <span class="n">UVMap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">U4</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">V4</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="npblender.ShapeKeys" class="doc doc-heading">
            <code>ShapeKeys</code>


<a href="#npblender.ShapeKeys" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">









              <details class="quote">
                <summary>Source code in <code>npblender/shapekeys.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ShapeKeys</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rec_array</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">relative</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">extrapolation</span><span class="o">=</span><span class="s1">&#39;CLIP&#39;</span><span class="p">,</span> <span class="n">ignore_int</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ignore_bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ShapeKeys manages a stack of structured arrays (like FieldArrays),</span>
<span class="sd">        with the same structure and same number of elements in each array.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec_array : np.ndarray (structured) or FieldArray</span>
<span class="sd">            The reference array to replicate.</span>
<span class="sd">        count : int</span>
<span class="sd">            The number of copies to initialize.</span>
<span class="sd">        relative : bool</span>
<span class="sd">            Optional flag, for later use.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rec_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rec_array</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ref</span> <span class="o">=</span> <span class="n">rec_array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relative</span> <span class="o">=</span> <span class="n">relative</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extrapolation</span> <span class="o">=</span> <span class="n">extrapolation</span>

        <span class="c1"># Ensure it&#39;s a structured 1D array</span>
        <span class="k">assert</span> <span class="n">rec_array</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">rec_array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_build_layout</span><span class="p">(</span><span class="n">ignore_int</span><span class="o">=</span><span class="n">ignore_int</span><span class="p">,</span> <span class="n">ignore_bool</span><span class="o">=</span><span class="n">ignore_bool</span><span class="p">)</span>

        <span class="n">count</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>

        <span class="c1"># Initialize by stacking `count` copies</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_flat_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ref</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="c1">#self._mat = np.stack([a.copy() for _ in range(count)], axis=0)</span>



    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;ShapeKeys of shape (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_mat</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">) keys with attributes </span><span class="si">{</span><span class="p">[</span><span class="n">name</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">_layout</span><span class="p">]</span><span class="si">}</span><span class="s2">&gt;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_flat_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mat</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mat</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_flat_array</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">as_array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mat</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_flat_array</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_mat</span><span class="p">,</span> <span class="p">[</span><span class="n">a</span><span class="p">]])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">array</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_flat_array</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mat</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mat</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Conversion to array of floats</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Build the conversion layout</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_build_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignore_int</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ignore_bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyze self._ref and store layout for flattening.&quot;&quot;&quot;</span>

        <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ref</span><span class="o">.</span><span class="n">dtype</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="n">dt</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">dtype</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="n">base_dtype</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">base</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">shape</span> <span class="ow">or</span> <span class="p">()</span>
            <span class="n">kind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">base_dtype</span><span class="p">)</span><span class="o">.</span><span class="n">kind</span>

            <span class="k">if</span> <span class="n">ignore_bool</span> <span class="ow">and</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">ignore_int</span> <span class="ow">and</span> <span class="n">kind</span> <span class="ow">in</span> <span class="s1">&#39;iu&#39;</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shape</span> <span class="ow">or</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)))</span>
            <span class="n">sl</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">count</span><span class="p">)</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">base_dtype</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">sl</span><span class="p">))</span>
            <span class="n">offset</span> <span class="o">+=</span> <span class="n">count</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_layout</span> <span class="o">=</span> <span class="n">layout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_total_scalars</span> <span class="o">=</span> <span class="n">offset</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Flatten field array</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_to_flat_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Flatten structured array using precomputed self._layout.&quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">flatten</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_total_scalars</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">sl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layout</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">shape</span> <span class="o">==</span> <span class="p">():</span>
                <span class="n">flatten</span><span class="p">[:,</span> <span class="n">sl</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flatten</span><span class="p">[:,</span> <span class="n">sl</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>

        <span class="k">return</span> <span class="n">flatten</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># From flatten to array with fields</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_from_flat_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flat</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a flat (N, D) or (M, N, D) float array to a recarray with float fields only,</span>
<span class="sd">        using the layout defined at initialization.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">flat</span><span class="p">)</span>
        <span class="n">single</span> <span class="o">=</span> <span class="n">flat</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span>  <span class="c1"># (N, D)</span>

        <span class="k">if</span> <span class="n">single</span><span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">flat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],)</span>  <span class="c1"># N</span>
            <span class="n">flat_2d</span> <span class="o">=</span> <span class="n">flat</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="n">flat</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>    <span class="c1"># (M, N)</span>
            <span class="n">flat_2d</span> <span class="o">=</span> <span class="n">flat</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">flat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># (M*N, D)</span>

        <span class="c1"># Build dtype with only interpolated fields</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="n">name</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">fshape</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">fshape</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layout</span><span class="p">]</span>

        <span class="c1"># Allocate output array</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">flat_2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">fshape</span><span class="p">,</span> <span class="n">sl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layout</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fshape</span> <span class="o">==</span> <span class="p">():</span>  <span class="c1"># scalar</span>
                <span class="n">out</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">flat_2d</span><span class="p">[:,</span> <span class="n">sl</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">flat_2d</span><span class="p">[:,</span> <span class="n">sl</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">fshape</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">recarray</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Interpolation</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Absolute interpolation</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">abs_interpolate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">smooth</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Absolute interpolation between keyframes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        t : float or array_like</span>
<span class="sd">            Interpolation factor(s) in [0, 1].</span>
<span class="sd">        extrapolation : {&#39;CLIP&#39;, &#39;CYCLIC&#39;, &#39;BACK&#39;}, default &#39;CLIP&#39;</span>
<span class="sd">            How to handle t values outside [0, 1].</span>
<span class="sd">        smooth : int, str or callable, default 1</span>
<span class="sd">            Smoothing method:</span>
<span class="sd">                - int: degree of BSpline</span>
<span class="sd">                - &#39;CUBIC&#39;: cubic spline</span>
<span class="sd">                - callable: function to apply to t</span>
<span class="sd">                - None: linear interpolation</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        recarray or array of recarrays</span>
<span class="sd">            Interpolated values with only float fields (others ignored).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">single</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">single</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>

        <span class="c1"># --------------------------</span>
        <span class="c1"># Extrapolation handling</span>
        <span class="c1"># --------------------------</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">extrapolation</span> <span class="o">==</span> <span class="s1">&#39;CLIP&#39;</span><span class="p">:</span>
            <span class="n">factors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">extrapolation</span> <span class="o">==</span> <span class="s1">&#39;CYCLIC&#39;</span><span class="p">:</span>
            <span class="n">factors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">extrapolation</span> <span class="o">==</span> <span class="s1">&#39;BACK&#39;</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)</span>
            <span class="n">factors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">f</span> <span class="o">&gt;</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span> <span class="o">-</span> <span class="n">f</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid extrapolation mode: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">extrapolation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># --------------------------</span>
        <span class="c1"># Smoothing</span>
        <span class="c1"># --------------------------</span>
        <span class="n">degree</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">use_cubic</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">smooth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">degree</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">smooth</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">degree</span> <span class="o">=</span> <span class="n">smooth</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">smooth</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">):</span>
            <span class="n">factors</span> <span class="o">=</span> <span class="n">smooth</span><span class="p">(</span><span class="n">factors</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">smooth</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">smooth</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;CUBIC&#39;</span><span class="p">:</span>
                <span class="n">use_cubic</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="kn">from</span><span class="w"> </span><span class="nn">.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">maprange</span>
                <span class="n">factors</span> <span class="o">=</span> <span class="n">maprange</span><span class="p">(</span><span class="n">factors</span><span class="p">,</span> <span class="n">easing</span><span class="o">=</span><span class="n">smooth</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid smooth type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">smooth</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># --------------------------</span>
        <span class="c1"># Interpolation</span>
        <span class="c1"># --------------------------</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mat</span>  <span class="c1"># shape (K, N, D)</span>
        <span class="n">n_keys</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">degree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fs</span> <span class="o">=</span> <span class="n">factors</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_keys</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">inds</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n_keys</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>

            <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">fs</span> <span class="o">-</span> <span class="n">inds</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>  <span class="c1"># (..., 1, 1) for broadcast</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">inds</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">interp_flat</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">p</span>  <span class="c1"># shape (..., N, D)</span>

        <span class="k">elif</span> <span class="n">use_cubic</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.interpolate</span><span class="w"> </span><span class="kn">import</span> <span class="n">CubicSpline</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_keys</span><span class="p">)</span>
            <span class="n">interp_flat</span> <span class="o">=</span> <span class="n">CubicSpline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">extrapolate</span><span class="o">=</span><span class="kc">False</span><span class="p">)(</span><span class="n">factors</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.interpolate</span><span class="w"> </span><span class="kn">import</span> <span class="n">BSpline</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">degree</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_keys</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">k</span> <span class="o">*</span> <span class="n">dx</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">dx</span><span class="p">,</span> <span class="n">n_keys</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">interp_flat</span> <span class="o">=</span> <span class="n">BSpline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">extrapolate</span><span class="o">=</span><span class="kc">False</span><span class="p">)(</span><span class="n">factors</span><span class="p">)</span>

        <span class="c1"># --------------------------</span>
        <span class="c1"># Convert back to structured recarray</span>
        <span class="c1"># --------------------------</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_flat_array</span><span class="p">(</span><span class="n">interp_flat</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">single</span> <span class="k">else</span> <span class="n">result</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Relative interpolation</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rel_interpolate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">smooth</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Relative interpolation using deltas from base shape.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        weights : array_like</span>
<span class="sd">            - shape (K,) for one result</span>
<span class="sd">            - shape (M, K) for multiple results</span>
<span class="sd">            where K = number of shapes - 1</span>
<span class="sd">        smooth : int, str, callable, or None</span>
<span class="sd">            Smoothing method (same as abs_interpolate)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.recarray or array of recarrays</span>
<span class="sd">            Interpolated result(s) (only float fields)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
        <span class="n">n_shapes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">n_weights</span> <span class="o">=</span> <span class="n">n_shapes</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="c1"># --------------------------</span>
        <span class="c1"># Validate shape of weights</span>
        <span class="c1"># --------------------------</span>
        <span class="n">single</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">weights</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">weights</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">n_weights</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected shape (</span><span class="si">{</span><span class="n">n_weights</span><span class="si">}</span><span class="s2">,), got </span><span class="si">{</span><span class="n">weights</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>  <span class="c1"># shape (1, K)</span>
            <span class="n">single</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">weights</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">n_weights</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected shape (..., </span><span class="si">{</span><span class="n">n_weights</span><span class="si">}</span><span class="s2">), got </span><span class="si">{</span><span class="n">weights</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># --------------------------</span>
        <span class="c1"># Apply smoothing if needed</span>
        <span class="c1"># --------------------------</span>
        <span class="n">degree</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">use_cubic</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">smooth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">degree</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">smooth</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">degree</span> <span class="o">=</span> <span class="n">smooth</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">smooth</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">):</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">smooth</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">smooth</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">smooth</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;CUBIC&#39;</span><span class="p">:</span>
                <span class="n">use_cubic</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="kn">from</span><span class="w"> </span><span class="nn">.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">maprange</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">maprange</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">easing</span><span class="o">=</span><span class="n">smooth</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid smooth type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">smooth</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># --------------------------</span>
        <span class="c1"># Perform interpolation</span>
        <span class="c1"># --------------------------</span>
        <span class="n">base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># shape (N, D)</span>
        <span class="n">deltas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mat</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">base</span>  <span class="c1"># shape (K, N, D)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>  <span class="c1"># shape (..., 1, 1)</span>
        <span class="n">weighted</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">deltas</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># shape (..., N, D)</span>
        <span class="n">interp_flat</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">weighted</span>

        <span class="c1"># --------------------------</span>
        <span class="c1"># Reconstruct structured recarray</span>
        <span class="c1"># --------------------------</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_flat_array</span><span class="p">(</span><span class="n">interp_flat</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">single</span> <span class="k">else</span> <span class="n">result</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Interpolation</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">interpolate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">smooth</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">relative</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_interpolate</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">smooth</span><span class="o">=</span><span class="n">smooth</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">abs_interpolate</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">smooth</span><span class="o">=</span><span class="n">smooth</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Interface with Blender</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Load mesh shapekeys</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_mesh_objet</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">spec</span><span class="p">):</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">blender</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.</span> <span class="n">mesh</span> <span class="kn">import</span><span class="w"> </span><span class="nn">Mesh</span>

        <span class="n">obj</span>   <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">shape_keys_count</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">npoints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>

        <span class="n">sks</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">npoints</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">sl</span> <span class="ow">in</span> <span class="n">sks</span><span class="o">.</span><span class="n">_layout</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;position&#39;</span><span class="p">:</span>
                <span class="n">pos_slice</span> <span class="o">=</span> <span class="n">sl</span>

        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
            <span class="n">kb</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">get_key_block</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
            <span class="n">kb</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">foreach_get</span><span class="p">(</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
            <span class="n">sks</span><span class="o">.</span><span class="n">_mat</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="p">:,</span> <span class="n">pos_slice</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>

        <span class="k">return</span> <span class="n">sks</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Store mesh shapekeys</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_mesh_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">blender</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">vertices</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">clear</span><span class="p">:</span>
            <span class="n">blender</span><span class="o">.</span><span class="n">shape_keys_clear</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">sl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layout</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;position&#39;</span><span class="p">:</span>
                <span class="n">pos_slice</span> <span class="o">=</span> <span class="n">sl</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_mat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="n">kb</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">get_key_block</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">a</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mat</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="p">:,</span> <span class="n">pos_slice</span><span class="p">]</span>
            <span class="n">kb</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">foreach_set</span><span class="p">(</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">obj</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Load curve shapekeys</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_curve_object</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">spec</span><span class="p">):</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">blender</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">curve</span><span class="w"> </span><span class="kn">import</span> <span class="n">Curve</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>

        <span class="n">count</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">shape_keys_count</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># No shape key</span>

        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Read the splines</span>

        <span class="n">curve</span> <span class="o">=</span> <span class="n">Curve</span><span class="o">.</span><span class="n">FromObject</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="n">sks</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">FromGeometry</span><span class="p">(</span><span class="n">curve</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>

        <span class="n">is_mix</span>     <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">has_mix_types</span>
        <span class="n">has_bezier</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">has_bezier</span>
        <span class="n">nverts</span>     <span class="o">=</span> <span class="n">sks</span><span class="o">.</span><span class="n">points_count</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_mix</span><span class="p">:</span>
            <span class="n">v_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">nverts</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
            <span class="n">f_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">nverts</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Loop on the shape keys</span>

        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>

            <span class="n">key_data</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">get_key_block</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>

            <span class="c1"># ----- Mix types : we must loop on the splines</span>

            <span class="k">if</span> <span class="n">is_mix</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">curve_type</span><span class="p">,</span> <span class="n">loop_start</span><span class="p">,</span> <span class="n">loop_total</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">curve_type</span><span class="p">,</span> <span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">loop_start</span><span class="p">,</span> <span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">loop_total</span><span class="p">):</span>

                    <span class="c1"># ----- Bezier</span>

                    <span class="k">if</span> <span class="n">curve_type</span> <span class="o">==</span> <span class="n">blender</span><span class="o">.</span><span class="n">BEZIER</span><span class="p">:</span>

                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">loop_total</span><span class="p">):</span>
                            <span class="n">sks</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">sks</span><span class="o">.</span><span class="n">_slices</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">key_data</span><span class="p">[</span><span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">co</span>
                            <span class="n">sks</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">sks</span><span class="o">.</span><span class="n">_slices</span><span class="p">[</span><span class="s1">&#39;handle_left&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">key_data</span><span class="p">[</span><span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">handle_left</span>
                            <span class="n">sks</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">sks</span><span class="o">.</span><span class="n">_slices</span><span class="p">[</span><span class="s1">&#39;handle_right&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">key_data</span><span class="p">[</span><span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">handle_right</span>

                            <span class="n">sks</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">sks</span><span class="o">.</span><span class="n">_slices</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">key_data</span><span class="p">[</span><span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">radius</span>
                            <span class="n">sks</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">sks</span><span class="o">.</span><span class="n">_slices</span><span class="p">[</span><span class="s1">&#39;tilt&#39;</span><span class="p">]]</span>   <span class="o">=</span> <span class="n">key_data</span><span class="p">[</span><span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tilt</span>

                    <span class="c1"># ----- Non Bezier</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">loop_total</span><span class="p">):</span>
                            <span class="n">sks</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">sks</span><span class="o">.</span><span class="n">_slices</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">key_data</span><span class="p">[</span><span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">co</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">radius</span><span class="p">,</span> <span class="n">tilt</span> <span class="o">=</span> <span class="n">key_data</span><span class="p">[</span><span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">key_data</span><span class="p">[</span><span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tilt</span>
                            <span class="k">except</span><span class="p">:</span>
                                <span class="n">radius</span><span class="p">,</span> <span class="n">tilt</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span>

                            <span class="n">sks</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">sks</span><span class="o">.</span><span class="n">_slices</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">radius</span>
                            <span class="n">sks</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">sks</span><span class="o">.</span><span class="n">_slices</span><span class="p">[</span><span class="s1">&#39;tilt&#39;</span><span class="p">]]</span>   <span class="o">=</span> <span class="n">tilt</span>

            <span class="c1"># ----- Only BEZIER or non Bezier</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">key_data</span><span class="o">.</span><span class="n">foreach_get</span><span class="p">(</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">v_array</span><span class="p">)</span>
                <span class="n">sks</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">v_array</span><span class="p">,</span> <span class="p">(</span><span class="n">nverts</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

                <span class="n">key_data</span><span class="o">.</span><span class="n">foreach_get</span><span class="p">(</span><span class="s1">&#39;radius&#39;</span><span class="p">,</span> <span class="n">f_array</span><span class="p">)</span>
                <span class="n">sks</span><span class="o">.</span><span class="n">radius</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">f_array</span>

                <span class="n">key_data</span><span class="o">.</span><span class="n">foreach_get</span><span class="p">(</span><span class="s1">&#39;tilt&#39;</span><span class="p">,</span> <span class="n">f_array</span><span class="p">)</span>
                <span class="n">sks</span><span class="o">.</span><span class="n">tilt</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">f_array</span>

                <span class="k">if</span> <span class="n">has_bezier</span><span class="p">:</span>
                    <span class="n">key_data</span><span class="o">.</span><span class="n">foreach_get</span><span class="p">(</span><span class="s1">&#39;handle_left&#39;</span><span class="p">,</span> <span class="n">v_array</span><span class="p">)</span>
                    <span class="n">sks</span><span class="o">.</span><span class="n">handle_left</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">v_array</span><span class="p">,</span> <span class="p">(</span><span class="n">nverts</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

                    <span class="n">key_data</span><span class="o">.</span><span class="n">foreach_get</span><span class="p">(</span><span class="s1">&#39;handle_right&#39;</span><span class="p">,</span> <span class="n">v_array</span><span class="p">)</span>
                    <span class="n">sks</span><span class="o">.</span><span class="n">handle_right</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">v_array</span><span class="p">,</span> <span class="p">(</span><span class="n">nverts</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">sks</span>

    <span class="c1"># -----------------------------------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Write the shapes in an existing curve object</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_curve_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">):</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">npblender</span><span class="w"> </span><span class="kn">import</span> <span class="n">Curve</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="n">curve</span> <span class="o">=</span> <span class="n">Curve</span><span class="o">.</span><span class="n">FromObject</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">:</span>
            <span class="n">blender</span><span class="o">.</span><span class="n">shape_keys_clear</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="n">is_mix</span>     <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">has_mix_types</span>
        <span class="n">has_bezier</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">has_bezier</span>
        <span class="n">nverts</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points_count</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_mix</span><span class="p">:</span>
            <span class="n">v_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">nverts</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
            <span class="n">f_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">nverts</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>

        <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
        <span class="c1"># Loop on the shapekeys</span>

        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>

            <span class="n">key_data</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">get_key_block</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">key_name</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>

            <span class="c1"># ----- Mix types : we must loop on the splines</span>

            <span class="k">if</span> <span class="n">is_mix</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">curve_type</span><span class="p">,</span> <span class="n">loop_start</span><span class="p">,</span> <span class="n">loop_total</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">curve_type</span><span class="p">,</span> <span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">loop_start</span><span class="p">,</span> <span class="n">curve</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">loop_total</span><span class="p">):</span>

                    <span class="c1"># ----- Bezier</span>

                    <span class="k">if</span> <span class="n">curve_type</span> <span class="o">==</span> <span class="n">blender</span><span class="o">.</span><span class="n">BEZIER</span><span class="p">:</span>

                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">loop_total</span><span class="p">):</span>
                            <span class="n">key_data</span><span class="p">[</span><span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">co</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slices</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]]</span>
                            <span class="n">key_data</span><span class="p">[</span><span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">handle_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slices</span><span class="p">[</span><span class="s1">&#39;handle_left&#39;</span><span class="p">]]</span>
                            <span class="n">key_data</span><span class="p">[</span><span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">handle_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slices</span><span class="p">[</span><span class="s1">&#39;handle_right&#39;</span><span class="p">]]</span>

                            <span class="n">key_data</span><span class="p">[</span><span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slices</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]]</span>
                            <span class="n">key_data</span><span class="p">[</span><span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tilt</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slices</span><span class="p">[</span><span class="s1">&#39;tilt&#39;</span><span class="p">]]</span>

                    <span class="c1"># ----- Non Bezier</span>

                    <span class="k">else</span><span class="p">:</span>

                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">loop_total</span><span class="p">):</span>
                            <span class="n">key_data</span><span class="p">[</span><span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">co</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slices</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]]</span>
                            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">key_data</span><span class="p">[</span><span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">],</span> <span class="s1">&#39;radius&#39;</span><span class="p">):</span>
                                <span class="n">key_data</span><span class="p">[</span><span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slices</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]]</span>
                                <span class="n">key_data</span><span class="p">[</span><span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tilt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">loop_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slices</span><span class="p">[</span><span class="s1">&#39;tilt&#39;</span><span class="p">]]</span>

            <span class="c1"># ----- Only BEZIER or non Bezier</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">v_array</span><span class="p">,</span> <span class="p">(</span><span class="n">nverts</span><span class="p">,</span> <span class="mi">3</span><span class="p">))[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="n">key_data</span><span class="o">.</span><span class="n">foreach_set</span><span class="p">(</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">v_array</span><span class="p">)</span>

                <span class="n">f_array</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="n">key_data</span><span class="o">.</span><span class="n">foreach_set</span><span class="p">(</span><span class="s1">&#39;radius&#39;</span><span class="p">,</span> <span class="n">f_array</span><span class="p">)</span>

                <span class="n">f_array</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tilt</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="n">key_data</span><span class="o">.</span><span class="n">foreach_set</span><span class="p">(</span><span class="s1">&#39;tilt&#39;</span><span class="p">,</span> <span class="n">f_array</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">has_bezier</span><span class="p">:</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">v_array</span><span class="p">,</span> <span class="p">(</span><span class="n">nverts</span><span class="p">,</span> <span class="mi">3</span><span class="p">))[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_left</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                    <span class="n">key_data</span><span class="o">.</span><span class="n">foreach_set</span><span class="p">(</span><span class="s1">&#39;handle_left&#39;</span><span class="p">,</span> <span class="n">v_array</span><span class="p">)</span>

                    <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">v_array</span><span class="p">,</span> <span class="p">(</span><span class="n">nverts</span><span class="p">,</span> <span class="mi">3</span><span class="p">))[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_right</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                    <span class="n">key_data</span><span class="o">.</span><span class="n">foreach_set</span><span class="p">(</span><span class="s1">&#39;handle_right&#39;</span><span class="p">,</span> <span class="n">v_array</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">obj</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="npblender.ShapeKeys.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">rec_array</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">relative</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">extrapolation</span><span class="o">=</span><span class="s1">&#39;CLIP&#39;</span><span class="p">,</span> <span class="n">ignore_int</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ignore_bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#npblender.ShapeKeys.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>ShapeKeys manages a stack of structured arrays (like FieldArrays),
with the same structure and same number of elements in each array.</p>
<h5 id="npblender.ShapeKeys.__init__--parameters">Parameters<a class="headerlink" href="#npblender.ShapeKeys.__init__--parameters" title="Permanent link">&para;</a></h5>
<p>rec_array : np.ndarray (structured) or FieldArray
    The reference array to replicate.
count : int
    The number of copies to initialize.
relative : bool
    Optional flag, for later use.</p>


            <details class="quote">
              <summary>Source code in <code>npblender/shapekeys.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rec_array</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">relative</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">extrapolation</span><span class="o">=</span><span class="s1">&#39;CLIP&#39;</span><span class="p">,</span> <span class="n">ignore_int</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ignore_bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ShapeKeys manages a stack of structured arrays (like FieldArrays),</span>
<span class="sd">    with the same structure and same number of elements in each array.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rec_array : np.ndarray (structured) or FieldArray</span>
<span class="sd">        The reference array to replicate.</span>
<span class="sd">    count : int</span>
<span class="sd">        The number of copies to initialize.</span>
<span class="sd">    relative : bool</span>
<span class="sd">        Optional flag, for later use.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rec_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rec_array</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_ref</span> <span class="o">=</span> <span class="n">rec_array</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">relative</span> <span class="o">=</span> <span class="n">relative</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">extrapolation</span> <span class="o">=</span> <span class="n">extrapolation</span>

    <span class="c1"># Ensure it&#39;s a structured 1D array</span>
    <span class="k">assert</span> <span class="n">rec_array</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">rec_array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_build_layout</span><span class="p">(</span><span class="n">ignore_int</span><span class="o">=</span><span class="n">ignore_int</span><span class="p">,</span> <span class="n">ignore_bool</span><span class="o">=</span><span class="n">ignore_bool</span><span class="p">)</span>

    <span class="n">count</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>

    <span class="c1"># Initialize by stacking `count` copies</span>
    <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_flat_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ref</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.ShapeKeys.abs_interpolate" class="doc doc-heading">
            <code class=" language-python"><span class="n">abs_interpolate</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">smooth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

<a href="#npblender.ShapeKeys.abs_interpolate" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Absolute interpolation between keyframes.</p>
<h5 id="npblender.ShapeKeys.abs_interpolate--parameters">Parameters<a class="headerlink" href="#npblender.ShapeKeys.abs_interpolate--parameters" title="Permanent link">&para;</a></h5>
<p>t : float or array_like
    Interpolation factor(s) in [0, 1].
extrapolation : {'CLIP', 'CYCLIC', 'BACK'}, default 'CLIP'
    How to handle t values outside [0, 1].
smooth : int, str or callable, default 1
    Smoothing method:
        - int: degree of BSpline
        - 'CUBIC': cubic spline
        - callable: function to apply to t
        - None: linear interpolation</p>
<h5 id="npblender.ShapeKeys.abs_interpolate--returns">Returns<a class="headerlink" href="#npblender.ShapeKeys.abs_interpolate--returns" title="Permanent link">&para;</a></h5>
<p>recarray or array of recarrays
    Interpolated values with only float fields (others ignored).</p>


            <details class="quote">
              <summary>Source code in <code>npblender/shapekeys.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">abs_interpolate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">smooth</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Absolute interpolation between keyframes.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t : float or array_like</span>
<span class="sd">        Interpolation factor(s) in [0, 1].</span>
<span class="sd">    extrapolation : {&#39;CLIP&#39;, &#39;CYCLIC&#39;, &#39;BACK&#39;}, default &#39;CLIP&#39;</span>
<span class="sd">        How to handle t values outside [0, 1].</span>
<span class="sd">    smooth : int, str or callable, default 1</span>
<span class="sd">        Smoothing method:</span>
<span class="sd">            - int: degree of BSpline</span>
<span class="sd">            - &#39;CUBIC&#39;: cubic spline</span>
<span class="sd">            - callable: function to apply to t</span>
<span class="sd">            - None: linear interpolation</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    recarray or array of recarrays</span>
<span class="sd">        Interpolated values with only float fields (others ignored).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">single</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">single</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>

    <span class="c1"># --------------------------</span>
    <span class="c1"># Extrapolation handling</span>
    <span class="c1"># --------------------------</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">extrapolation</span> <span class="o">==</span> <span class="s1">&#39;CLIP&#39;</span><span class="p">:</span>
        <span class="n">factors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">extrapolation</span> <span class="o">==</span> <span class="s1">&#39;CYCLIC&#39;</span><span class="p">:</span>
        <span class="n">factors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">extrapolation</span> <span class="o">==</span> <span class="s1">&#39;BACK&#39;</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)</span>
        <span class="n">factors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">f</span> <span class="o">&gt;</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span> <span class="o">-</span> <span class="n">f</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid extrapolation mode: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">extrapolation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># --------------------------</span>
    <span class="c1"># Smoothing</span>
    <span class="c1"># --------------------------</span>
    <span class="n">degree</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">use_cubic</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">smooth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">degree</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">smooth</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">degree</span> <span class="o">=</span> <span class="n">smooth</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">smooth</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">):</span>
        <span class="n">factors</span> <span class="o">=</span> <span class="n">smooth</span><span class="p">(</span><span class="n">factors</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">smooth</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">smooth</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;CUBIC&#39;</span><span class="p">:</span>
            <span class="n">use_cubic</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">maprange</span>
            <span class="n">factors</span> <span class="o">=</span> <span class="n">maprange</span><span class="p">(</span><span class="n">factors</span><span class="p">,</span> <span class="n">easing</span><span class="o">=</span><span class="n">smooth</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid smooth type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">smooth</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># --------------------------</span>
    <span class="c1"># Interpolation</span>
    <span class="c1"># --------------------------</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mat</span>  <span class="c1"># shape (K, N, D)</span>
    <span class="n">n_keys</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">degree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="n">factors</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_keys</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">inds</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n_keys</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">fs</span> <span class="o">-</span> <span class="n">inds</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>  <span class="c1"># (..., 1, 1) for broadcast</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">inds</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">interp_flat</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">p</span>  <span class="c1"># shape (..., N, D)</span>

    <span class="k">elif</span> <span class="n">use_cubic</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.interpolate</span><span class="w"> </span><span class="kn">import</span> <span class="n">CubicSpline</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_keys</span><span class="p">)</span>
        <span class="n">interp_flat</span> <span class="o">=</span> <span class="n">CubicSpline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">extrapolate</span><span class="o">=</span><span class="kc">False</span><span class="p">)(</span><span class="n">factors</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.interpolate</span><span class="w"> </span><span class="kn">import</span> <span class="n">BSpline</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">degree</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_keys</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">k</span> <span class="o">*</span> <span class="n">dx</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">dx</span><span class="p">,</span> <span class="n">n_keys</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">interp_flat</span> <span class="o">=</span> <span class="n">BSpline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">extrapolate</span><span class="o">=</span><span class="kc">False</span><span class="p">)(</span><span class="n">factors</span><span class="p">)</span>

    <span class="c1"># --------------------------</span>
    <span class="c1"># Convert back to structured recarray</span>
    <span class="c1"># --------------------------</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_flat_array</span><span class="p">(</span><span class="n">interp_flat</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">single</span> <span class="k">else</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.ShapeKeys.rel_interpolate" class="doc doc-heading">
            <code class=" language-python"><span class="n">rel_interpolate</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">smooth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

<a href="#npblender.ShapeKeys.rel_interpolate" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Relative interpolation using deltas from base shape.</p>
<h5 id="npblender.ShapeKeys.rel_interpolate--parameters">Parameters<a class="headerlink" href="#npblender.ShapeKeys.rel_interpolate--parameters" title="Permanent link">&para;</a></h5>
<p>weights : array_like
    - shape (K,) for one result
    - shape (M, K) for multiple results
    where K = number of shapes - 1
smooth : int, str, callable, or None
    Smoothing method (same as abs_interpolate)</p>
<h5 id="npblender.ShapeKeys.rel_interpolate--returns">Returns<a class="headerlink" href="#npblender.ShapeKeys.rel_interpolate--returns" title="Permanent link">&para;</a></h5>
<p>np.recarray or array of recarrays
    Interpolated result(s) (only float fields)</p>


            <details class="quote">
              <summary>Source code in <code>npblender/shapekeys.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rel_interpolate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">smooth</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Relative interpolation using deltas from base shape.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : array_like</span>
<span class="sd">        - shape (K,) for one result</span>
<span class="sd">        - shape (M, K) for multiple results</span>
<span class="sd">        where K = number of shapes - 1</span>
<span class="sd">    smooth : int, str, callable, or None</span>
<span class="sd">        Smoothing method (same as abs_interpolate)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.recarray or array of recarrays</span>
<span class="sd">        Interpolated result(s) (only float fields)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="n">n_shapes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">n_weights</span> <span class="o">=</span> <span class="n">n_shapes</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="c1"># --------------------------</span>
    <span class="c1"># Validate shape of weights</span>
    <span class="c1"># --------------------------</span>
    <span class="n">single</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">weights</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">weights</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">n_weights</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected shape (</span><span class="si">{</span><span class="n">n_weights</span><span class="si">}</span><span class="s2">,), got </span><span class="si">{</span><span class="n">weights</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>  <span class="c1"># shape (1, K)</span>
        <span class="n">single</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">weights</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">n_weights</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected shape (..., </span><span class="si">{</span><span class="n">n_weights</span><span class="si">}</span><span class="s2">), got </span><span class="si">{</span><span class="n">weights</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># --------------------------</span>
    <span class="c1"># Apply smoothing if needed</span>
    <span class="c1"># --------------------------</span>
    <span class="n">degree</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">use_cubic</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">smooth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">degree</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">smooth</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">degree</span> <span class="o">=</span> <span class="n">smooth</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">smooth</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">):</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">smooth</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">smooth</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">smooth</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;CUBIC&#39;</span><span class="p">:</span>
            <span class="n">use_cubic</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">maprange</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">maprange</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">easing</span><span class="o">=</span><span class="n">smooth</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid smooth type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">smooth</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># --------------------------</span>
    <span class="c1"># Perform interpolation</span>
    <span class="c1"># --------------------------</span>
    <span class="n">base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># shape (N, D)</span>
    <span class="n">deltas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mat</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">base</span>  <span class="c1"># shape (K, N, D)</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>  <span class="c1"># shape (..., 1, 1)</span>
    <span class="n">weighted</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">deltas</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># shape (..., N, D)</span>
    <span class="n">interp_flat</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">weighted</span>

    <span class="c1"># --------------------------</span>
    <span class="c1"># Reconstruct structured recarray</span>
    <span class="c1"># --------------------------</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_flat_array</span><span class="p">(</span><span class="n">interp_flat</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">single</span> <span class="k">else</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="npblender.Simulation" class="doc doc-heading">
            <code>Simulation</code>


<a href="#npblender.Simulation" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="npblender.engine.Animation">Animation</span></code></p>









              <details class="quote">
                <summary>Source code in <code>npblender/simulation.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Simulation</span><span class="p">(</span><span class="n">Animation</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">view</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="n">compute</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="n">reset</span><span class="p">,</span> <span class="n">view</span><span class="o">=</span><span class="n">view</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Dump</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Simulation: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">)</span><span class="si">}</span><span class="s2"> actions&gt;&quot;</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Property</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">actions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_actions&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">points</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;points&#39; property not defined for the class &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Actions management</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># An action can be specified by its name</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">str_to_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="s1">&#39;__func__&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">func</span><span class="o">.</span><span class="vm">__func__</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">func</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Add an action</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Add an action to the simulation</span>

<span class="sd">        To add an event, you can use &lt;#add_event&gt;.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        - func (function) : function of template f(simulation, *args, **kwargs)</span>
<span class="sd">        - top (float = 0) : start time for the actiuon</span>
<span class="sd">        - duration (float = None) : duration of the action (0: call once, None: never stops)</span>
<span class="sd">        - after (bool = False) : exec the action after the exec_loop</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        - Action : the action added to the simulation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">Action</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">str_to_func</span><span class="p">(</span><span class="n">func</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">action</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Add an event</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Add an event to the simulation</span>

<span class="sd">        The event is executed once. To add an action called at each step, use &lt;#add_action&gt;.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        - func (function) : function of template f(simulation, *args, **kwargs)</span>
<span class="sd">        - top (float = 0) : start time for the actiuon</span>
<span class="sd">        - after (bool = False) : exec the action after the exec_loop</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        - Action : the event added to the simulation</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">action</span> <span class="o">=</span> <span class="n">Action</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">str_to_func</span><span class="p">(</span><span class="n">func</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">action</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Run the actions</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">flags</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">actions</span><span class="o">.</span><span class="n">flags</span><span class="p">):</span>
                <span class="n">action</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Reset</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Reset the simulation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
            <span class="n">action</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Compute</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_compute&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_compute</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_actions</span><span class="p">()</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># View</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">geo</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_view&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="n">geo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">to_object</span><span class="p">(</span><span class="s2">&quot;Simulation&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">view</span><span class="p">()</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Baking</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_frame_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">geo</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">geo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">geo</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_frame_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">geo</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">geo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LOADED&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Useful actions</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">change_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">incr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Modify a points attribute</span>

<span class="sd">        ``` python</span>
<span class="sd">        # gravity</span>
<span class="sd">        self.add_action(&quot;change_attribute&quot;, &quot;accel&quot;, value=(0, 0, -9.81))</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>

            <span class="n">factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">factor</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span><span class="o">*</span><span class="n">factor</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG --&gt;: </span><span class="si">{</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">incr</span> <span class="o">==</span> <span class="s1">&#39;+&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">incr</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">-=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">incr</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">*=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">incr</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">/=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Gravity</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">gravity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.81</span><span class="p">]),</span> <span class="n">factor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_attribute</span><span class="p">(</span><span class="s2">&quot;accel&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="n">factor</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># A force</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_attribute</span><span class="p">(</span><span class="s2">&quot;force&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="n">factor</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># A torque</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">torque</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">torque</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_attribute</span><span class="p">(</span><span class="s2">&quot;torque&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="n">factor</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Newton&#39;s Law</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">newton_law</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_distance</span><span class="o">=</span><span class="mf">.001</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Newton&#39;s law between points</span>

<span class="sd">        The force between two points is given by:</span>

<span class="sd">        F = G.m1.m2 / dist**p</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Vectors between couples of points</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">position</span> <span class="o">-</span> <span class="n">pts</span><span class="o">.</span><span class="n">position</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>

        <span class="c1"># Distance</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">close</span> <span class="o">=</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">min_distance</span>

        <span class="n">d</span><span class="p">[</span><span class="n">close</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">F</span> <span class="o">=</span> <span class="p">(</span><span class="n">G</span><span class="o">*</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="n">d</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">power</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">F</span> <span class="o">*=</span> <span class="n">pts</span><span class="o">.</span><span class="n">mass</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">F</span> <span class="o">*=</span> <span class="n">pts</span><span class="o">.</span><span class="n">mass</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">F</span><span class="p">[</span><span class="n">close</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">pts</span><span class="o">.</span><span class="n">force</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Central force</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">central_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">force_factor</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">power</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_distance</span><span class="o">=</span><span class="mf">.001</span><span class="p">):</span>

        <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="n">v</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">position</span> <span class="o">-</span> <span class="n">location</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">close</span> <span class="o">=</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">min_distance</span>

        <span class="n">d</span><span class="p">[</span><span class="n">close</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">F</span> <span class="o">=</span> <span class="p">(</span><span class="n">force_factor</span><span class="o">*</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="n">power</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">F</span><span class="p">[</span><span class="n">close</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">pts</span><span class="o">.</span><span class="n">force</span> <span class="o">+=</span> <span class="n">F</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Centrifugal and Coriolis acceleration</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">centrifugal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">omega</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">coriolis_factor</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>

        <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="n">axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>

        <span class="c1"># Position relatively to the axis of rotation</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">position</span> <span class="o">-</span> <span class="n">location</span>

        <span class="c1"># Decompose height / vector to axis then distance</span>
        <span class="n">z</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;...i, ...i&#39;</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="n">v</span> <span class="o">-</span> <span class="n">axis</span><span class="o">*</span><span class="n">z</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Centrifugal</span>
        <span class="n">acc</span> <span class="o">=</span> <span class="n">xy</span><span class="o">*</span><span class="p">(</span><span class="n">omega</span><span class="o">*</span><span class="n">omega</span><span class="p">)</span>

        <span class="c1"># Coriolis</span>
        <span class="c1"># Factor articially controls the intensity of the Coriolis force</span>

        <span class="n">acc</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">((</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">omega</span><span class="p">)</span><span class="o">*</span><span class="n">axis</span><span class="p">,</span> <span class="n">pts</span><span class="o">.</span><span class="n">speed</span><span class="p">)</span><span class="o">*</span><span class="n">coriolis_factor</span>

        <span class="n">pts</span><span class="o">.</span><span class="n">accel</span> <span class="o">+=</span> <span class="n">acc</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Viscosity :  slow down speed according a power law</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">viscosity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viscosity_factor</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_force</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fluid_speed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span>

        <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">speed</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">speed</span>

        <span class="c1"># Speed relative to fluid speed</span>
        <span class="k">if</span> <span class="n">fluid_speed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">fluid_speed</span><span class="p">):</span>
            <span class="n">spped</span> <span class="o">-=</span> <span class="n">fluid_speed</span><span class="p">(</span><span class="n">pts</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">speed</span> <span class="o">-=</span> <span class="n">fluid_speed</span>

        <span class="c1"># Direction and norm</span>
        <span class="n">nrm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">nrm</span><span class="p">[</span><span class="n">nrm</span> <span class="o">&lt;</span> <span class="mf">.001</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">speed</span><span class="o">/</span><span class="n">nrm</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>

        <span class="c1"># Raw force</span>
        <span class="k">if</span> <span class="s1">&#39;viscosity&#39;</span> <span class="ow">in</span> <span class="n">pts</span><span class="o">.</span><span class="n">actual_names</span><span class="p">:</span>
            <span class="n">viscosity_factor</span> <span class="o">=</span> <span class="n">viscosity_factor</span><span class="o">*</span><span class="n">pts</span><span class="o">.</span><span class="n">viscosity</span>

        <span class="n">F</span> <span class="o">=</span> <span class="n">viscosity_factor</span><span class="o">*</span><span class="p">(</span><span class="n">nrm</span><span class="o">**</span><span class="n">power</span><span class="p">)</span>

        <span class="c1"># Make sure the force doesn&#39;t invese de speed</span>
        <span class="n">max_F</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">mass</span><span class="o">*</span><span class="n">nrm</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">delta_time</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">max_F</span><span class="p">)</span>

        <span class="n">pts</span><span class="o">.</span><span class="n">force</span> <span class="o">-=</span> <span class="n">u</span><span class="o">*</span><span class="n">F</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Simulation</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Dynamics</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_motion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">translation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">torque</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="c1"># ---------------------------------------------------------------------------</span>
        <span class="c1"># Prepare</span>
        <span class="c1"># ---------------------------------------------------------------------------</span>

        <span class="c1"># Reset the acceleration and force</span>
        <span class="k">if</span> <span class="n">translation</span><span class="p">:</span>
            <span class="n">pts</span><span class="o">.</span><span class="n">accel</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">pts</span><span class="o">.</span><span class="n">force</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Reset angular torque</span>
        <span class="k">if</span> <span class="n">torque</span><span class="p">:</span>
            <span class="n">pts</span><span class="o">.</span><span class="n">torque</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># ---------------------------------------------------------------------------</span>
        <span class="c1"># Run the actions</span>
        <span class="c1"># ---------------------------------------------------------------------------</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">run_actions</span><span class="p">(</span><span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">)</span>

        <span class="c1"># ---------------------------------------------------------------------------</span>
        <span class="c1"># Translation</span>
        <span class="c1"># ---------------------------------------------------------------------------</span>

        <span class="k">if</span> <span class="n">translation</span><span class="p">:</span>
            <span class="n">F</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">force</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">mass</span> <span class="o">!=</span> <span class="mi">0</span>
            <span class="n">F</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">/=</span> <span class="n">pts</span><span class="o">.</span><span class="n">mass</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
            <span class="n">F</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># Full acceleration</span>
            <span class="n">accel</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">accel</span> <span class="o">+</span> <span class="n">F</span>

            <span class="c1"># Move the particles</span>
            <span class="n">new_speed</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">speed</span> <span class="o">+</span> <span class="n">accel</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">delta_time</span>
            <span class="n">pts</span><span class="o">.</span><span class="n">position</span> <span class="o">+=</span> <span class="p">(</span><span class="n">pts</span><span class="o">.</span><span class="n">speed</span> <span class="o">+</span> <span class="n">new_speed</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delta_time</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">pts</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="n">new_speed</span>

        <span class="c1"># ---------------------------------------------------------------------------</span>
        <span class="c1"># Rotation</span>
        <span class="c1"># ---------------------------------------------------------------------------</span>

        <span class="k">if</span> <span class="n">torque</span><span class="p">:</span>
            <span class="n">torque</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">torque</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">moment</span> <span class="o">!=</span> <span class="mi">0</span>
            <span class="n">torque</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">/=</span> <span class="n">pts</span><span class="o">.</span><span class="n">moment</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
            <span class="n">torque</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">omega</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">omega</span>
            <span class="n">new_omega</span> <span class="o">=</span> <span class="n">omega</span> <span class="o">+</span> <span class="n">torque</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">delta_time</span>
            <span class="n">pts</span><span class="o">.</span><span class="n">omega</span> <span class="o">=</span> <span class="p">(</span><span class="n">omega</span> <span class="o">+</span> <span class="n">new_omega</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delta_time</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rotation</span><span class="p">:</span>
            <span class="n">domg</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">omega</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">delta_time</span>
            <span class="n">ag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">domg</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">ag</span> <span class="o">!=</span> <span class="mi">0</span>
            <span class="n">domg</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">domg</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">/</span><span class="n">ag</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
            <span class="n">domg</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="n">quat</span> <span class="o">=</span> <span class="n">Quaternion</span><span class="o">.</span><span class="n">from_axis_angle</span><span class="p">(</span><span class="n">domg</span><span class="p">,</span> <span class="n">ag</span><span class="p">)</span>
            <span class="n">new_rot</span> <span class="o">=</span> <span class="n">quat</span> <span class="o">@</span> <span class="n">pts</span><span class="o">.</span><span class="n">rotation</span>
            <span class="k">if</span> <span class="s2">&quot;euler&quot;</span> <span class="ow">in</span> <span class="n">pts</span><span class="o">.</span><span class="n">euler</span><span class="p">:</span>
                <span class="n">pts</span><span class="o">.</span><span class="n">euler</span> <span class="o">=</span> <span class="n">new_rot</span><span class="o">.</span><span class="n">as_euler</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pts</span><span class="o">.</span><span class="n">quat</span> <span class="o">=</span> <span class="n">new_rot</span><span class="o">.</span><span class="n">as_quaternion</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="npblender.Simulation.add_action" class="doc doc-heading">
            <code class=" language-python"><span class="n">add_action</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#npblender.Simulation.add_action" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Add an action to the simulation</p>
<p>To add an event, you can use &lt;#add_event&gt;.</p>
<h5 id="npblender.Simulation.add_action--arguments">Arguments<a class="headerlink" href="#npblender.Simulation.add_action--arguments" title="Permanent link">&para;</a></h5>
<ul>
<li>func (function) : function of template f(simulation, <em>args, </em>*kwargs)</li>
<li>top (float = 0) : start time for the actiuon</li>
<li>duration (float = None) : duration of the action (0: call once, None: never stops)</li>
<li>after (bool = False) : exec the action after the exec_loop</li>
</ul>
<h5 id="npblender.Simulation.add_action--returns">Returns<a class="headerlink" href="#npblender.Simulation.add_action--returns" title="Permanent link">&para;</a></h5>
<ul>
<li>Action : the action added to the simulation</li>
</ul>


            <details class="quote">
              <summary>Source code in <code>npblender/simulation.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Add an action to the simulation</span>

<span class="sd">    To add an event, you can use &lt;#add_event&gt;.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    - func (function) : function of template f(simulation, *args, **kwargs)</span>
<span class="sd">    - top (float = 0) : start time for the actiuon</span>
<span class="sd">    - duration (float = None) : duration of the action (0: call once, None: never stops)</span>
<span class="sd">    - after (bool = False) : exec the action after the exec_loop</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    - Action : the action added to the simulation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">Action</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">str_to_func</span><span class="p">(</span><span class="n">func</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">action</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Simulation.add_event" class="doc doc-heading">
            <code class=" language-python"><span class="n">add_event</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#npblender.Simulation.add_event" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Add an event to the simulation</p>
<p>The event is executed once. To add an action called at each step, use &lt;#add_action&gt;.</p>
<h5 id="npblender.Simulation.add_event--arguments">Arguments<a class="headerlink" href="#npblender.Simulation.add_event--arguments" title="Permanent link">&para;</a></h5>
<ul>
<li>func (function) : function of template f(simulation, <em>args, </em>*kwargs)</li>
<li>top (float = 0) : start time for the actiuon</li>
<li>after (bool = False) : exec the action after the exec_loop</li>
</ul>
<h5 id="npblender.Simulation.add_event--returns">Returns<a class="headerlink" href="#npblender.Simulation.add_event--returns" title="Permanent link">&para;</a></h5>
<ul>
<li>Action : the event added to the simulation</li>
</ul>


            <details class="quote">
              <summary>Source code in <code>npblender/simulation.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Add an event to the simulation</span>

<span class="sd">    The event is executed once. To add an action called at each step, use &lt;#add_action&gt;.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    - func (function) : function of template f(simulation, *args, **kwargs)</span>
<span class="sd">    - top (float = 0) : start time for the actiuon</span>
<span class="sd">    - after (bool = False) : exec the action after the exec_loop</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    - Action : the event added to the simulation</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">action</span> <span class="o">=</span> <span class="n">Action</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">str_to_func</span><span class="p">(</span><span class="n">func</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">action</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Simulation.change_attribute" class="doc doc-heading">
            <code class=" language-python"><span class="n">change_attribute</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">incr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#npblender.Simulation.change_attribute" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Modify a points attribute</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># gravity</span>
<span class="bp">self</span><span class="o">.</span><span class="n">add_action</span><span class="p">(</span><span class="s2">&quot;change_attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;accel&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.81</span><span class="p">))</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/simulation.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">change_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">incr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Modify a points attribute</span>

<span class="sd">    ``` python</span>
<span class="sd">    # gravity</span>
<span class="sd">    self.add_action(&quot;change_attribute&quot;, &quot;accel&quot;, value=(0, 0, -9.81))</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>

        <span class="n">factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">factor</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span><span class="o">*</span><span class="n">factor</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG --&gt;: </span><span class="si">{</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">incr</span> <span class="o">==</span> <span class="s1">&#39;+&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span>
    <span class="k">elif</span> <span class="n">incr</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">-=</span> <span class="n">value</span>
    <span class="k">elif</span> <span class="n">incr</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">*=</span> <span class="n">value</span>
    <span class="k">elif</span> <span class="n">incr</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">/=</span> <span class="n">value</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Simulation.newton_law" class="doc doc-heading">
            <code class=" language-python"><span class="n">newton_law</span><span class="p">(</span><span class="n">G</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_distance</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span></code>

<a href="#npblender.Simulation.newton_law" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Newton's law between points</p>
<p>The force between two points is given by:</p>
<p>F = G.m1.m2 / dist**p</p>


            <details class="quote">
              <summary>Source code in <code>npblender/simulation.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">newton_law</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_distance</span><span class="o">=</span><span class="mf">.001</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Newton&#39;s law between points</span>

<span class="sd">    The force between two points is given by:</span>

<span class="sd">    F = G.m1.m2 / dist**p</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># Vectors between couples of points</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">position</span> <span class="o">-</span> <span class="n">pts</span><span class="o">.</span><span class="n">position</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>

    <span class="c1"># Distance</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">close</span> <span class="o">=</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">min_distance</span>

    <span class="n">d</span><span class="p">[</span><span class="n">close</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">F</span> <span class="o">=</span> <span class="p">(</span><span class="n">G</span><span class="o">*</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="n">d</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">power</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">F</span> <span class="o">*=</span> <span class="n">pts</span><span class="o">.</span><span class="n">mass</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">F</span> <span class="o">*=</span> <span class="n">pts</span><span class="o">.</span><span class="n">mass</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">F</span><span class="p">[</span><span class="n">close</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">pts</span><span class="o">.</span><span class="n">force</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Simulation.reset" class="doc doc-heading">
            <code class=" language-python"><span class="n">reset</span><span class="p">()</span></code>

<a href="#npblender.Simulation.reset" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Reset the simulation</p>


            <details class="quote">
              <summary>Source code in <code>npblender/simulation.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Reset the simulation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
        <span class="n">action</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="npblender.Spline" class="doc doc-heading">
            <code>Spline</code>


<a href="#npblender.Spline" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="npblender.domain.FaceSplineDomain">FaceSplineDomain</span></code></p>


        <p>Spline domain.</p>
<p>Spline domain is specific to Curve geometry. A spline is an array of control points.
A Spline is similare to a Face but points directly to the control points and not indirectly
as for the faces.</p>
<h4 id="npblender.Spline--attributes">Attributes<a class="headerlink" href="#npblender.Spline--attributes" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="k">-</span> loop_start (int) : first index in control points array
<span class="k">-</span> loop_total (int) : number of control points
<span class="k">-</span> material_index (int, optional) : material index
<span class="k">-</span> resolution (int, optional) : spline resolution
<span class="k">-</span> cyclic (bool, optional) : spline is cyclic or not
<span class="k">-</span> order (int, optional) : Nurbs spline order
<span class="k">-</span> bezierpoint (bool, optional) : Nurbs spline bezierpoint flag
<span class="k">-</span> endpoint (bool, optional) : Nurbs spline endpoint flag
</code></pre></div>








              <details class="quote">
                <summary>Source code in <code>npblender/domain.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Spline</span><span class="p">(</span><span class="n">FaceSplineDomain</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Spline domain.</span>

<span class="sd">    Spline domain is specific to Curve geometry. A spline is an array of control points.</span>
<span class="sd">    A Spline is similare to a Face but points directly to the control points and not indirectly</span>
<span class="sd">    as for the faces.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">        - loop_start (int) : first index in control points array</span>
<span class="sd">        - loop_total (int) : number of control points</span>
<span class="sd">        - material_index (int, optional) : material index</span>
<span class="sd">        - resolution (int, optional) : spline resolution</span>
<span class="sd">        - cyclic (bool, optional) : spline is cyclic or not</span>
<span class="sd">        - order (int, optional) : Nurbs spline order</span>
<span class="sd">        - bezierpoint (bool, optional) : Nurbs spline bezierpoint flag</span>
<span class="sd">        - endpoint (bool, optional) : Nurbs spline endpoint flag</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">domain_name</span> <span class="o">=</span> <span class="s1">&#39;SPLINE&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">declare_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">declare_attributes</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">new_int</span><span class="p">(</span><span class="s1">&#39;curve_type&#39;</span><span class="p">,</span> <span class="n">transdom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">new_int</span><span class="p">(</span><span class="s1">&#39;resolution&#39;</span><span class="p">,</span>   <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">transdom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_bool</span><span class="p">(</span><span class="s1">&#39;cyclic&#39;</span><span class="p">,</span>      <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">transdom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Nurbs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_int</span><span class="p">(</span><span class="s1">&#39;order&#39;</span><span class="p">,</span>        <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">transdom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_bool</span><span class="p">(</span><span class="s1">&#39;bezierpoint&#39;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transdom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_bool</span><span class="p">(</span><span class="s1">&#39;endpoint&#39;</span><span class="p">,</span>    <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transdom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Properties</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">has_bezier</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curve_type</span> <span class="o">==</span> <span class="n">BEZIER</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Delete splines</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_splines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="p">,</span> <span class="n">cpoints</span><span class="p">):</span>
        <span class="n">corner_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span><span class="o">.</span><span class="n">get_corner_indices</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>
        <span class="n">cpoints</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">corner_indices</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Sample attribute</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">npoints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bspline</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">npoints</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cyclic</span> <span class="k">else</span> <span class="p">(</span><span class="n">npoints</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">+</span> <span class="mi">1</span>


    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Adding splines</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_splines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">splines</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Add splines.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - splines (array of ints) : the number of control points per spline</span>
<span class="sd">            - attributes (attribute names, attribute values) : value of the corner attributes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_loops</span><span class="p">(</span><span class="n">splines</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Parameter</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the functions representing the splines.</span>

<span class="sd">        The functions are scipy BSplines initialized with the splines parameters.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - list of BSpline functions</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">funcs</span> <span class="o">=</span> <span class="n">BSplines</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">curve_type</span><span class="p">,</span> <span class="n">loop_start</span><span class="p">,</span> <span class="n">loop_total</span><span class="p">,</span> <span class="n">cyclic</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curve_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop_total</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cyclic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">)):</span>

            <span class="k">if</span> <span class="n">curve_type</span> <span class="o">==</span> <span class="n">BEZIER</span><span class="p">:</span>
                <span class="n">funcs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bezier</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">loop_start</span><span class="p">:</span><span class="n">loop_start</span> <span class="o">+</span> <span class="n">loop_total</span><span class="p">],</span> <span class="n">cyclic</span><span class="o">=</span><span class="n">cyclic</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
                                <span class="n">lefts</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">handle_left</span><span class="p">[</span><span class="n">loop_start</span><span class="p">:</span><span class="n">loop_start</span> <span class="o">+</span> <span class="n">loop_total</span><span class="p">],</span>
                                <span class="n">rights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">handle_right</span><span class="p">[</span><span class="n">loop_start</span><span class="p">:</span><span class="n">loop_start</span> <span class="o">+</span> <span class="n">loop_total</span><span class="p">]</span>
                                <span class="p">))</span>

            <span class="k">elif</span> <span class="n">curve_type</span> <span class="o">==</span> <span class="n">POLY</span><span class="p">:</span>
                <span class="n">funcs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Poly</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">loop_start</span><span class="p">:</span><span class="n">loop_start</span> <span class="o">+</span> <span class="n">loop_total</span><span class="p">],</span> <span class="n">cyclic</span><span class="o">=</span><span class="n">cyclic</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">curve_type</span> <span class="o">==</span> <span class="n">NURBS</span><span class="p">:</span>
                <span class="n">funcs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Nurbs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">loop_start</span><span class="p">:</span><span class="n">loop_start</span> <span class="o">+</span> <span class="n">loop_total</span><span class="p">],</span> <span class="n">cyclic</span><span class="o">=</span><span class="n">cyclic</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
                                    <span class="n">w</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="n">loop_start</span><span class="p">:</span><span class="n">loop_start</span> <span class="o">+</span> <span class="n">loop_total</span><span class="p">],</span>
                                    <span class="n">order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">[</span><span class="n">loop_start</span><span class="p">:</span><span class="n">loop_start</span> <span class="o">+</span> <span class="n">loop_total</span><span class="p">],</span>
                                    <span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">funcs</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Length of the splines.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - List of spline lengths</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">length</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">tangent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Tangents of the splines at a given time.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - t (float) : spline parameter between 0 and 1</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            - list of spline tangents evaluated at time t.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">tangent</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Interface with Blender</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Read data attributes</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_bl_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Read the object attributes.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - spec (str or data) : the data to set the attributes to</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">blender</span>

        <span class="n">size</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;attributes&#39;</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">binfo</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="c1"># Must be external and in the domain</span>
            <span class="k">if</span> <span class="n">binfo</span><span class="o">.</span><span class="n">domain</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="ow">or</span> <span class="n">binfo</span><span class="o">.</span><span class="n">is_internal</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Create if it doesn&#39;t exist</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_field</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">new_attribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">binfo</span><span class="o">.</span><span class="n">data_type</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">transfer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Adjust size</span>
            <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">binfo</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Should never append</span>
                <span class="k">assert</span> <span class="n">size</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">binfo</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="s2">&quot;Blender read algorithm is incorrect&quot;</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to read attribute &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; from Blender: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>
    <span class="c1"># Write data attributes</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Transfer the attributes to a blender mesh object.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">            - spec (str or data) : the mesh to set the attributes to</span>
<span class="sd">            - attributes (array of st = None) : the attributes to transfer (all if None)</span>
<span class="sd">            - update (bool=False) : update the attributes values without trying to create them</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">blender</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;attributes&#39;</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;transfer&#39;</span><span class="p">]:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;data_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;STRING&#39;</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">if</span> <span class="n">update</span><span class="p">:</span>
                <span class="n">blender</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">blender</span><span class="o">.</span><span class="n">create_attribute</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;data_type&#39;</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>    

    <span class="c1"># ====================================================================================================</span>
    <span class="c1"># Compute attribute on points</span>
    <span class="c1"># ====================================================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_attribute_on_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>

        <span class="nd">@njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">_to_points</span><span class="p">(</span><span class="n">loop_start</span><span class="p">,</span> <span class="n">loop_total</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span> 
            <span class="n">nsplines</span> <span class="o">=</span> <span class="n">loop_start</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">ispline</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsplines</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">loop_start</span><span class="p">[</span><span class="n">ispline</span><span class="p">]</span>
                <span class="n">total</span> <span class="o">=</span> <span class="n">loop_total</span><span class="p">[</span><span class="n">ispline</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">ipoint</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">start</span> <span class="o">+</span> <span class="n">total</span><span class="p">):</span>
                    <span class="n">res</span><span class="p">[</span><span class="n">ipoint</span><span class="p">]</span> <span class="o">+=</span> <span class="n">source</span><span class="p">[</span><span class="n">ispline</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">res</span>        

        <span class="n">attr</span><span class="p">,</span> <span class="n">item_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_attribute_to_compute</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">),)</span> <span class="o">+</span> <span class="n">item_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">attr</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_to_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop_total</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>                
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="npblender.Spline.functions" class="doc doc-heading">
            <code class=" language-python"><span class="n">functions</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#npblender.Spline.functions" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Return the functions representing the splines.</p>
<p>The functions are scipy BSplines initialized with the splines parameters.</p>
<h5 id="npblender.Spline.functions--returns">Returns<a class="headerlink" href="#npblender.Spline.functions--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- list of BSpline functions
</code></pre></div>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="npblender.Spline.length" class="doc doc-heading">
            <code class=" language-python"><span class="n">length</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#npblender.Spline.length" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Length of the splines.</p>
<h5 id="npblender.Spline.length--returns">Returns<a class="headerlink" href="#npblender.Spline.length--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- List of spline lengths
</code></pre></div>

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="npblender.Spline.add_splines" class="doc doc-heading">
            <code class=" language-python"><span class="n">add_splines</span><span class="p">(</span><span class="n">splines</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">)</span></code>

<a href="#npblender.Spline.add_splines" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Add splines.</p>
<h5 id="npblender.Spline.add_splines--arguments">Arguments<a class="headerlink" href="#npblender.Spline.add_splines--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- splines (array of ints) : the number of control points per spline
- attributes (attribute names, attribute values) : value of the corner attributes
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/domain.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_splines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">splines</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Add splines.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - splines (array of ints) : the number of control points per spline</span>
<span class="sd">        - attributes (attribute names, attribute values) : value of the corner attributes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_loops</span><span class="p">(</span><span class="n">splines</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Spline.load_bl_attributes" class="doc doc-heading">
            <code class=" language-python"><span class="n">load_bl_attributes</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

<a href="#npblender.Spline.load_bl_attributes" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Read the object attributes.</p>
<h5 id="npblender.Spline.load_bl_attributes--arguments">Arguments<a class="headerlink" href="#npblender.Spline.load_bl_attributes--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- spec (str or data) : the data to set the attributes to
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/domain.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_bl_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Read the object attributes.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - spec (str or data) : the data to set the attributes to</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">blender</span>

    <span class="n">size</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;attributes&#39;</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">binfo</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

        <span class="c1"># Must be external and in the domain</span>
        <span class="k">if</span> <span class="n">binfo</span><span class="o">.</span><span class="n">domain</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="ow">or</span> <span class="n">binfo</span><span class="o">.</span><span class="n">is_internal</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># Create if it doesn&#39;t exist</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_field</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new_attribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">binfo</span><span class="o">.</span><span class="n">data_type</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">transfer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Adjust size</span>
        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">binfo</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Should never append</span>
            <span class="k">assert</span> <span class="n">size</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">binfo</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="s2">&quot;Blender read algorithm is incorrect&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">blender</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to read attribute &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; from Blender: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Spline.tangent" class="doc doc-heading">
            <code class=" language-python"><span class="n">tangent</span><span class="p">(</span><span class="n">t</span><span class="p">)</span></code>

<a href="#npblender.Spline.tangent" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Tangents of the splines at a given time.</p>
<h5 id="npblender.Spline.tangent--arguments">Arguments<a class="headerlink" href="#npblender.Spline.tangent--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- t (float) : spline parameter between 0 and 1
</code></pre></div>

<h5 id="npblender.Spline.tangent--returns">Returns<a class="headerlink" href="#npblender.Spline.tangent--returns" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>- list of spline tangents evaluated at time t.
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/domain.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">tangent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Tangents of the splines at a given time.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - t (float) : spline parameter between 0 and 1</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        - list of spline tangents evaluated at time t.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">tangent</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="npblender.Spline.to_object" class="doc doc-heading">
            <code class=" language-python"><span class="n">to_object</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#npblender.Spline.to_object" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Transfer the attributes to a blender mesh object.</p>
<h5 id="npblender.Spline.to_object--arguments">Arguments<a class="headerlink" href="#npblender.Spline.to_object--arguments" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="nv">spec</span><span class="w"> </span><span class="ss">(</span><span class="nv">str</span><span class="w"> </span><span class="nv">or</span><span class="w"> </span><span class="nv">data</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">mesh</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">set</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">attributes</span><span class="w"> </span><span class="nv">to</span>
<span class="o">-</span><span class="w"> </span><span class="nv">attributes</span><span class="w"> </span><span class="ss">(</span><span class="nv">array</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">st</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">None</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">attributes</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">transfer</span><span class="w"> </span><span class="ss">(</span><span class="nv">all</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">None</span><span class="ss">)</span>
<span class="o">-</span><span class="w"> </span><span class="nv">update</span><span class="w"> </span><span class="ss">(</span><span class="nv">bool</span><span class="o">=</span><span class="nv">False</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">update</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">attributes</span><span class="w"> </span><span class="nv">values</span><span class="w"> </span><span class="nv">without</span><span class="w"> </span><span class="nv">trying</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">create</span><span class="w"> </span><span class="nv">them</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>npblender/domain.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Transfer the attributes to a blender mesh object.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        - spec (str or data) : the mesh to set the attributes to</span>
<span class="sd">        - attributes (array of st = None) : the attributes to transfer (all if None)</span>
<span class="sd">        - update (bool=False) : update the attributes values without trying to create them</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">blender</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;attributes&#39;</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;transfer&#39;</span><span class="p">]:</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;data_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;STRING&#39;</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="n">update</span><span class="p">:</span>
            <span class="n">blender</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">blender</span><span class="o">.</span><span class="n">create_attribute</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;data_type&#39;</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>    
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.sections", "navigation.instant", "navigation.tracking", "content.code.copy"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copi\u00e9 dans le presse-papier", "clipboard.copy": "Copier dans le presse-papier", "search.result.more.one": "1 de plus sur cette page", "search.result.more.other": "# de plus sur cette page", "search.result.none": "Aucun document trouv\u00e9", "search.result.one": "1 document trouv\u00e9", "search.result.other": "# documents trouv\u00e9s", "search.result.placeholder": "Taper pour d\u00e9marrer la recherche", "search.result.term.missing": "Non trouv\u00e9", "select.version": "S\u00e9lectionner la version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>